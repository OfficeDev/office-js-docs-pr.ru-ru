# <a name="automatically-open-a-task-pane-with-a-document"></a>Автоматическое открытие области задач с документом

Команды в надстройке Office позволяют расширить возможности пользовательского интерфейса Office, добавляя кнопки в ленту Office. Когда пользователи нажимают кнопки, выполняются различные операции (например, открывается область задач). 

В некоторых сценариях требуется, чтобы область задач открывалась автоматически вместе с документом без явного взаимодействия с пользователем. Функция автоматического открытия области задач, представленная в наборе требований AddInCommands 1.1, позволяет автоматически открывать область задач, если это требуется в вашем сценарии. 


## <a name="how-is-the-autoopen-feature-different-from-inserting-a-task-pane"></a>Чем функция автоматического открытия отличается от вставки области задач? 

Если пользователь запускает надстройки, которые не используют команды надстроек (например, в Office 2013), они вставляются в документ и сохраняются в нем. Таким образом, при открытии этого документа другими пользователями, им будет предложено установить надстройку и откроется область задач. Недостатки этой модели часто связаны с тем, что пользователи не хотят сохранять надстройку для документа. Например, учащийся, который использует надстройку словаря в документе Word, может не захотеть, чтобы его преподаватели или одноклассники получили запрос на установку этой надстройки при открытии документа.  

Функция автоматического открытия позволяет явно определить или дать разрешение пользователю определять необходимость в сохранении конкретной надстройки области задач в конкретном документе. 

## <a name="support-and-availability"></a>Поддержка и доступность
Ниже перечислены продукты и платформы, <!-- in **developer preview** and it is only --> в которых поддерживается функция автоматического открытия.

|**Продукты**|**Платформы**|
|:-----------|:------------|
|<ul><li>Word</li><li>Excel</li><li>PowerPoint</li></ul>|<ul><li>Office для компьютера с Windows. Сборка 16.0.8121.1000+</li><li>Office для Mac. Сборка 15.34.17051500+</li><li>Office Online</li></ul>|


## <a name="best-practices"></a>Советы и рекомендации

При использовании функции автоматического открытия придерживайтесь указанных рекомендаций.

- Используйте функцию автоматического открытия, если она повысит эффективность работы пользователей в подобных случаях:
    - Если надстройка требуется для правильной работы документа. Например, для электронной таблицы, содержащей стоимость запасов, которая периодически обновляется с помощью надстройки. Надстройка должна открываться автоматически вместе с электронной таблицей, чтобы значения своевременно обновлялись. 
    - Если пользователь с большой вероятностью всегда будет использовать эту надстройку при работе с определенным документом. Пример: надстройка, которая помогает пользователям добавлять данные в документы или вносить изменения, извлекая информацию из серверной системы. 
- Разрешите пользователям включать и выключать функцию автоматического открытия. Добавьте параметр в интерфейс для пользователей, чтобы автоматическое открытие области задач надстройки можно было отключить.  
- Используйте средство обнаружения набора требований, чтобы определять доступность функции автоматического открытия, и предоставить отработку отказа при ее отсутствии.
- Не используйте функцию автоматического открытия, чтобы искусственно увеличивать показатели использования надстройки. Если автоматическое открытие надстройки нецелесообразно для определенных документов, эта функция может раздражать пользователей. 

    >**Примечание.** Если корпорация Майкрософт обнаружит, что функция автоматического открытия применяется не по назначению, возможно отклонение вашей надстройки из Магазина Office. 

- Не используйте эту функцию, чтобы закрепить несколько областей задач. Можно задать только одну область вашей надстройки для автоматического открытия вместе с документом.  

## <a name="implementation"></a>Реализация
Выполните следующие действия, чтобы использовать функцию автоматического открытия.

- Укажите область задач, которую необходимо открывать автоматически.
- Отметьте документ, который будет автоматически открывать эту область задач.

>**Важно!** Области, отмеченные для автоматического открытия, будут открываться, только если необходимая надстройка уже установлена на устройстве пользователя. Если у пользователя не установлена необходимая надстройка, функция автоматического открытия не сработает при открытии документа, а установка будет проигнорирована. Чтобы надстройка распространялась вместе с документом, задайте для свойства видимости значение 1. Это можно сделать только с помощью OpenXML. Соответствующий пример приводится ниже в этой статье. 

### <a name="step-1-specify-the-task-pane-to-open"></a>Шаг 1. Указание области задач, которую необходимо открывать
Чтобы указать область задач, которую необходимо открывать автоматически, задайте для [TaskpaneId](https://dev.office.com/reference/add-ins/manifest/action#taskpaneid) значение **Office.AutoShowTaskpaneWithDocument**. Это значение можно установить только в одной области задач. Если установить это значение для нескольких областей задач, распознается только первый случай его использования, а все остальные будут игнорироваться. 

Ниже представлен пример, где для TaskPaneId задано значение Office.AutoShowTaskpaneWithDocument.
          
```xml
<Action xsi:type="ShowTaskpane">
    <TaskpaneId>Office.AutoShowTaskpaneWithDocument</TaskpaneId>
    <SourceLocation resid="Contoso.Taskpane.Url" />
</Action>
```     

### <a name="step-2-tag-the-document-to-automatically-open-the-task-pane"></a>Шаг 2. Установка отметки для документа, вместе с которым будет автоматически открываться область задач

Вы можете отметить документ для запуска функции автоматического открытия одним из двух способов. Выберите вариант, который лучше всего подходит для вашего сценария.  


#### <a name="tag-the-document-on-the-client-side"></a>Установка отметки для документа на стороне клиента
Используйте метод Office.js [settings.set](https://dev.office.com/reference/add-ins/shared/settings.set), чтобы установить для **Office.AutoShowTaskpaneWithDocument** значение **true**, как показано в следующем примере.   

```js
Office.context.document.settings.set("Office.AutoShowTaskpaneWithDocument", true);
Office.context.document.settings.saveAsync();
```

Используйте этот метод, если нужно отметить документ в рамках взаимодействия с надстройкой (например, после создания пользователем привязки или выбора параметра, он сможет указать необходимость в автоматическом открытии области).

#### <a name="use-open-xml-to-tag-the-document"></a>Установка отметки для документа с помощью Open XML
С помощью Open XML можно создать документ и вносить в него изменения, а также добавлять соответствующие исправления в Open Office XML для запуска функции автоматического открытия. Пример с иллюстрацией того, как это можно сделать, см. в статье [Office-OOXML-EmbedAddin](https://github.com/OfficeDev/Office-OOXML-EmbedAddin). 

Добавьте в документ две части Open XML:

- часть webextension;
- часть taskpane.

В следующем примере показано, как добавить часть webextension.

```xml
<we:webextension xmlns:we="http://schemas.microsoft.com/office/webextensions/webextension/2010/11" id="[ADD-IN ID PER MANIFEST]">
  <we:reference id="[GUID or Office Store asset ID]" version="[your add-in version]" store="[Pointer to store or catalog]" storeType="[Store or catalog type]"/>
  <we:alternateReferences/>
  <we:properties>
    <we:property name="Office.AutoShowTaskpaneWithDocument" value="true"/>
  </we:properties>
  <we:bindings/>
  <we:snapshot xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"/>
</we:webextension>
```

Часть webextension содержит контейнер свойств, а также свойство под названием **Office.AutoShowTaskpaneWithDocument**, для которого необходимо установить значение `true`.

Часть webextension также содержит ссылку на магазин или каталог с атрибутами для `id`, `storeType`, `store`, и `version`. Только 4 значения `storeType` относятся к функции автоматического открытия. Значения для остальных трех атрибутов зависят от значения для `storeType`, как показано в таблице ниже. 

| Значение **`storeType`** | Значение **`id`**    |Значение **`store`** | Значение **`version`**|
|:---------------|:---------------|:---------------|:---------------|
|OMEX (магазин Office)|ИД ресурса надстройки в магазине Office.\*|Языковой стандарт магазина Office (например, "ru-ru").|Версия в каталоге магазина Office.\*|
|FileSystem (общий сетевой ресурс)|GUID надстройки в ее манифесте.|Путь к сетевой папке (например, "\\\\MyComputer\\MySharedFolder").|Версия в манифесте надстройки.|
|EXCatalog (развертывание через Exchange Server) |GUID надстройки в ее манифесте.|"EXCatalog"|Версия в манифесте надстройки.
|Registry (реестр системы)|GUID надстройки в ее манифесте.|"developer"|Версия в манифесте надстройки.|

>\* Для поиска ИД и версии надстройки в магазине Office перейдите на целевую страницу магазина Office для соответствующей надстройки. ИД ресурса отображается в адресной строке браузера. Версия указана в разделе **подробностей** на этой странице.

Дополнительные сведения об исправлении webextension см. в документе [[MS-OWEXML] 2.2.5. WebExtensionReference](https://msdn.microsoft.com/en-us/library/hh695383(v=office.12).aspx).

В следующем примере показано, как добавить часть taskpane.

```xml
<wetp:taskpane dockstate="right" visibility="0" width="350" row="4" xmlns:wetp="http://schemas.microsoft.com/office/webextensions/taskpanes/2010/11">
  <wetp:webextensionref xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" r:id="rId1" />
</wetp:taskpane>
```

Обратите внимание, что в этом примере для атрибута `visibility` установлено значение "0". Это означает, что после добавления частей webextension и taskpane при первом открытии документа пользователю необходимо будет установить надстройку, нажав кнопку **надстройки** на ленте. После этого область задач надстройки будет открываться автоматически вместе с файлом. Кроме того, если установить для `visibility` значение "0", можно с помощью Office.js предоставить пользователям возможность включать и выключать функцию автоматического открытия. В частности, ваш скрипт устанавливает для параметра документа **Office.AutoShowTaskpaneWithDocument** значение `true` или `false`. (Дополнительные сведения см. в разделе [Установка отметки для документа на стороне клиента](#tag-the-document-on-the-client-side).) 

Если для `visibility` установлено значение "1", область задач откроется автоматически при первом открытии документа. Пользователю будет предложено доверять надстройке. В случае предоставления доверия надстройка откроется. После этого область задач надстройки будет открываться автоматически вместе с файлом. Однако если установить для `visibility` значение "1", можно с помощью Office.js предоставить пользователям возможность включать и выключать функцию автоматического открытия. 

Значение "1" отлично подходит для свойства `visibility`, если надстройка и шаблон или содержимое документа интегрированы настолько тесно, что пользователь не откажется от использования функции автоматического открытия. 

>**Примечание.** Если вы хотите распространить надстройку вместе с документом, чтобы пользователям предлагалось установить ее, необходимо задать для свойства visibility значение "1". Это можно сделать только через Open XML.

Самый простой способ записи XML — сначала запустить надстройку и [отметить документ на стороне клиента](#tag-the-document-on-the-client-side), чтобы записать значение, а затем сохранить документ и проверить созданный XML. Office обнаружит и укажет соответствующие значения атрибута. Инструмент [Open XML SDK 2.5 Productivity Tool](https://www.microsoft.com/en-us/download/details.aspx?id=30425) также можно использовать для создания кода на языке C#, чтобы программным способом добавить исправление на основе создаваемого XML.

## <a name="additional-resources"></a>Дополнительные ресурсы

Пример использования функции автоматического открытия см. в статье [Примеры команд для надстройки Office](https://github.com/OfficeDev/Office-Add-in-Commands-Samples/tree/master/AutoOpenTaskpane). 

