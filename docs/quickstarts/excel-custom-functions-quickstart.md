---
ms.date: 01/13/2022
description: Краткое руководство по разработке пользовательских функций в Excel.
title: Краткое руководство по пользовательским функциям
ms.prod: excel
ms.localizationpriority: high
ms.openlocfilehash: 2f15be99499e42c0598d70ae91b937c6637c0149
ms.sourcegitcommit: 45f7482d5adcb779a9672669360ca4d8d5c85207
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/19/2022
ms.locfileid: "62222306"
---
# <a name="get-started-developing-excel-custom-functions"></a>Начало разработки пользовательских функций Excel

С помощью пользовательских функций разработчики могут добавлять новые функции в Excel путем их определения в JavaScript или Typescript как части надстройки. Пользователи Excel могут получить доступ к пользовательским функциям так же, как и к любой встроенной функции в Excel, например `SUM()`.

## <a name="prerequisites"></a>Предварительные требования

[!include[Set up requirements](../includes/set-up-dev-environment-beforehand.md)]
[!include[Yeoman generator prerequisites](../includes/quickstart-yo-prerequisites.md)]

- Excel для Windows (версии 1904 или более поздней) или Excel в Интернете.
- Пользовательские функции Excel поддерживаются в Office для Mac (подключенном к подписке на Microsoft 365), и ожидается обновление данного руководства.

## <a name="build-your-first-custom-functions-project"></a>Создание первого проекта пользовательских функций

Чтобы начать работу, создайте проект пользовательских функций с помощью генератора Yeoman. Это позволит настроить для проекта правильную структуру папок, исходные файлы и зависимости, чтобы начать написание кода пользовательских функций.

1. [!include[Yeoman generator create project guidance](../includes/yo-office-command-guidance.md)]

    - **Выберите тип проекта:** `Excel Custom Functions Add-in project`
    - **Выберите тип сценария:** `JavaScript`
    - **Как вы хотите назвать надстройку?** `starcount`

    ![Снимок экрана: интерфейс командной строки генератора Yeoman надстроек Office, запрашивающий проекты пользовательских функций.](../images/starcountPrompt.png)

    Генератор Yeoman создаст файлы проекта и установит вспомогательные компоненты Node.

1. Генератор Yeoman предоставит вам инструкции в командной строке по действиям с проектом, но вам нужно их проигнорировать и продолжить выполнять наши инструкции. Перейдите к корневой папке проекта.

    ```command&nbsp;line
    cd starcount
    ```

1. Выполните построение проекта.

    ```command&nbsp;line
    npm run build
    ```

1. Запустите локальный веб-сервер, работающий на Node.js. Вы можете попробовать использовать надстройку пользовательской функции в Excel в Интернете или для Windows. Вам может быть предложено открыть область задач надстройки, но это необязательно. Вы по-прежнему можете запускать свои пользовательские функции, не открывая область задач надстройки.

# <a name="excel-on-windows"></a>[Excel для Windows](#tab/excel-windows)

Чтобы проверить надстройку в Excel для Windows, выполните следующую команду. Когда вы выполните эту команду, запустится локальный веб-сервер и откроется приложение Excel, в котором будет загружена ваша надстройка.

```command&nbsp;line
npm run start:desktop
```

[!INCLUDE [alert use https](../includes/alert-use-https.md)]
    
# <a name="excel-on-the-web"></a>[Excel в Интернете](#tab/excel-online)

Чтобы проверить надстройку в Excel в Интернете, выполните следующую команду. После выполнения этой команды запустится локальный веб-сервер. Замените "{url}" на URL-адрес документа Excel в OneDrive или библиотеке SharePoint, для которой у вас есть разрешения.

[!INCLUDE [npm start:web command syntax](../includes/start-web-sideload-instructions.md)]

[!INCLUDE [alert use https](../includes/alert-use-https.md)]

Чтобы использовать надстройку пользовательских функций, откройте новую книгу Excel в браузере. В этой книге выполните шаги, описанные ниже, чтобы загрузить неопубликованную надстройку.

1. В Excel на вкладке **Вставка** выберите пункт **Надстройки**.

   ![Снимок экрана: лента "Вставка" в Excel в Интернете с выделенной кнопкой "Мои надстройки".](../images/excel-cf-online-register-add-in-1.png)

1. Выберите пункт **Управление моими надстройками**, а затем выберите **Отправить мою надстройку**.

1. Выберите **Обзор...** и откройте корневой каталог проекта, созданный генератором Yeoman.

1. Выберите файл **manifest.xml** и нажмите **Открыть**, затем нажмите кнопку **Отправить**.

---

## <a name="try-out-a-prebuilt-custom-function"></a>Проверка работы готовой пользовательской функции

Проект пользовательских функций, созданный с помощью генератора Yeoman, содержит некоторые готовые пользовательские функции, определенные в файле **./src/functions/functions.js**. Файл **./manifest.xml** в корневом каталоге проекта указывает, что все пользовательские функции принадлежат пространству имен `CONTOSO`.

В книге Excel проверьте, как работает пользовательская функция `ADD`, выполнив описанные ниже шаги.

1. Выделите ячейку и введите `=CONTOSO`. Обратите внимание, что в меню автозаполнения содержится список всех функций в пространстве имен `CONTOSO`.

1. Запустите функцию `CONTOSO.ADD` с числами `10` и `200` в качестве входных параметров, введя значение `=CONTOSO.ADD(10,200)` в ячейке и нажав клавишу ВВОД.

Пользовательская функция `ADD` вычисляет сумму двух чисел, которые вы указываете в качестве входных параметров. При вводе `=CONTOSO.ADD(10,200)` в ячейке должен отобразиться результат **210** после нажатия клавиши ВВОД.

## <a name="next-steps"></a>Дальнейшие действия

Поздравляем, вы успешно создали пользовательскую функцию в надстройке Excel! Затем создайте более сложную надстройку с возможностью потоковой передачи данных. Следующая ссылка поможет вам выполнить дальнейшие действия в руководстве по надстройке Excel с пользовательскими функциями.

> [!div class="nextstepaction"]
> [Руководство по надстройке Excel для пользовательских функций](../tutorials/excel-tutorial-create-custom-functions.md#create-a-custom-function-that-requests-data-from-the-web)

## <a name="troubleshooting"></a>Устранение неполадок

При многократном выполнении быстрого запуска могут возникнуть проблемы. Если в кэше Office уже есть экземпляр функции с таким же именем, в вашей надстройке возникнет ошибка при ее загрузке без публикации. Это можно предотвратить путем [очистки кэша Office](../testing/clear-cache.md) перед запуском `npm run start`.

:::image type="content" source="../images/custom-function-already-exists-error.png" alt-text="Сообщение об ошибке в Excel под названием &quot;Ошибка при установке функций&quot;. Она содержит текст &quot;Эта надстройка не была установлена, так как пользовательская функция с тем же именем уже существует&quot;.":::

## <a name="see-also"></a>См. также

- [Обзор пользовательских функций](../excel/custom-functions-overview.md)
- [Метаданные пользовательских функций](../excel/custom-functions-json.md)
- [Среда выполнения для пользовательских функций Excel](../excel/custom-functions-runtime.md)
