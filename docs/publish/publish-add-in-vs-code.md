---
title: Публикация надстройки с помощью Visual Studio Code и Azure
description: Публикация надстройки с помощью Visual Studio Code и Azure Active Directory
ms.date: 09/07/2022
ms.custom: vscode-azure-extension-update-completed
ms.localizationpriority: medium
ms.openlocfilehash: b2d05ba9fb1c20529731312dab112abe6a00cfc7
ms.sourcegitcommit: 3abcf7046446e7b02679c79d9054843088312200
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/02/2022
ms.locfileid: "68810073"
---
# <a name="publish-an-add-in-developed-with-visual-studio-code"></a>Публикация надстройки, разработанной с помощью Visual Studio Code

В этой статье описано, как опубликовать надстройку Office, созданную с помощью генератора Yeoman и разработанную в [Visual Studio Code (VS Code)](https://code.visualstudio.com) или любом другом редакторе.

> [!NOTE]
> Сведения о публикации надстройки Office, созданной с помощью Visual Studio, см. в статье [Публикация надстройки с помощью Visual Studio](package-your-add-in-using-visual-studio.md).

## <a name="publishing-an-add-in-for-other-users-to-access"></a>Публикация надстройки для доступа других пользователей

An Office Add-in consists of a web application and a manifest file. The web application defines the add-in's user interface and functionality, while the manifest specifies the location of the web application and defines settings and capabilities of the add-in.

Во время разработки надстройку можно запустить на локальном веб-сервере (`localhost`). Когда вы будете готовы опубликовать его для доступа других пользователей, необходимо развернуть веб-приложение и обновить манифест, указав URL-адрес развернутого приложения.

Если надстройка работает должным образом, ее можно опубликовать непосредственно через Visual Studio Code с помощью расширения службы хранилища Azure.

## <a name="using-visual-studio-code-to-publish"></a>Использование Visual Studio Code для публикации

>[!NOTE]
> Эти действия работают только для проектов, созданных с помощью генератора Yeoman.

1. Откройте проект из корневой папки в Visual Studio Code (VS Code).
1. Выберите **Просмотр** > **расширений** (CTRL+SHIFT+X), чтобы открыть представление Расширения.
1. Найдите расширение **службы хранилища Azure** и установите его.
1. После установки на **панель действий** добавляется значок Azure. Выберите его, чтобы получить доступ к расширению. Если **панель действий** скрыта, откройте ее, выбрав **Просмотр** > **панели действий** **внешнего вида** > .
1. Выберите **Войти в Azure,** чтобы войти в учетную запись Azure. Если у вас еще нет учетной записи Azure, создайте ее, выбрав **Создать учетную запись Azure**. Выполните указанные действия, чтобы настроить учетную запись.

    :::image type="content" source="../images/azure-extension-sign-in.png" alt-text="Кнопка &quot;Войти в Azure&quot;, выбранная в расширении Azure.":::

1. После входа вы увидите, что учетные записи хранения Azure отображаются в расширении. Если у вас еще нет учетной записи хранения, создайте ее с помощью параметра **Создать учетную запись хранения** в палитре команд. Присвойте учетной записи хранения глобально уникальное имя, используя только "a-z" и "0-9". Обратите внимание, что по умолчанию создается учетная запись хранения и группа ресурсов с тем же именем. Она автоматически помещает учетную запись хранения в западную часть США. Это можно изменить в интернете с помощью [учетной записи Azure](https://portal.azure.com/).

    :::image type="content" source="../images/azure-extension-create-storage-account.png" alt-text="Выберите Учетные записи хранения > Создать учетную запись хранения в расширении Azure.":::

1. Щелкните правой кнопкой мыши учетную запись хранения и выберите **Настроить статический веб-сайт**. Вам будет предложено ввести имя документа индекса и имя документа 404. Измените имя документа индекса с по умолчанию `index.html` на **`taskpane.html`**. Вы также можете изменить имя документа 404, но это не обязательно.
1. Снова щелкните правой кнопкой мыши учетную запись хранения и на этот раз выберите **Обзор статического веб-сайта**. В открывающемся окне браузера скопируйте URL-адрес веб-сайта.
1. Откройте файл манифеста проекта (`manifest.xml`) и измените все ссылки на URL-адрес localhost (например `https://localhost:3000`, ) на скопированный URL-адрес. Эта конечная точка является URL-адресом статического веб-сайта для созданной учетной записи хранения. Сохраните изменения в файле манифеста.
1. Откройте командную строку или окно терминала и перейдите в корневой каталог проекта надстройки. Выполните следующую команду, чтобы подготовить все файлы для развертывания в рабочей среде.

    ```command&nbsp;line
    npm run build
    ```

    После завершения сборки папка **dist** в корневом каталоге проекта надстройки будет содержать файлы, разворачиваемые на следующих этапах.

1. В VS Code перейдите в обозреватель, щелкните правой кнопкой мыши папку **dist** и выберите **Развернуть на статический веб-сайт через службу хранилища Azure**. При появлении запроса выберите созданную ранее учетную запись хранения.

    :::image type="content" source="../images/deploy-to-static-website.png" alt-text="Выберите папку dist, щелкните правой кнопкой мыши и выберите Развернуть на статический веб-сайт через службу хранилища Azure.":::

1. После завершения развертывания щелкните правой кнопкой мыши созданную ранее учетную запись хранения и выберите **Обзор статического веб-сайта**. Откроется статический веб-сайт и отобразится область задач.

1. Наконец, [загрузите неопубликованный файл манифеста](../testing/sideload-office-add-ins-for-testing.md) , и надстройка загрузится со статического веб-сайта, который вы только что развернули.

## <a name="deploy-custom-functions-for-excel"></a>Развертывание пользовательских функций для Excel

Если надстройка имеет пользовательские функции, их можно включить в учетной записи хранения Azure еще несколько действий. Сначала включите CORS, чтобы Office могла получить доступ к файлу functions.json.

1. Щелкните правой кнопкой мыши учетную запись хранения Azure и выберите **Открыть на портале**.
1. В группе Параметры выберите **Общий доступ к ресурсам (CORS).** Вы также можете использовать поле поиска, чтобы найти его.
1. Создайте новое правило CORS со следующими параметрами.

    |Свойство        |Значение                        |
    |----------------|-----------------------------|
    |Допустимые источники | \*                          |
    |Разрешенные методы | GET                         |
    |Разрешенные заголовки | \*                          |
    |Доступные заголовки | Access-Control-Allow-Origin |
    |Максимальный возраст         | 200                         |

1. Нажмите кнопку **Сохранить**.

> [!CAUTION]
> Эта конфигурация CORS предполагает, что все файлы на сервере являются общедоступными для всех доменов.  

Затем добавьте тип MIME для json-файлов.

1. Создайте файл в папке /src с именем **web.config**.
1. Вставьте следующий XML-код и сохраните файл.

    ```xml
    <?xml version="1.0"?>
    <configuration>
      <system.webServer>
        <staticContent>
          <mimeMap fileExtension=".json" mimeType="application/json" />
        </staticContent>
      </system.webServer>
    </configuration> 
    ```

1. Откройте файл **webpack.config.js**.
1. Добавьте следующий код в список , `plugins` чтобы скопировать web.config в пакет при выполнении сборки.

    ```javascript
    new CopyWebpackPlugin({
      patterns: [
      {
        from: "src/web.config",
        to: "src/web.config",
      },
     ],
    }),
    ```

1. Откройте командную строку и перейдите в корневой каталог проекта надстройки. Затем выполните следующую команду, чтобы подготовить все файлы к развертыванию.

    ```command&nbsp;line
    npm run build
    ```

    После завершения сборки папка **dist** в корневом каталоге проекта надстройки будет содержать файлы, которые вы будете развертывать.

1. Чтобы развернуть, в **обозревателе** VS Code щелкните правой кнопкой мыши папку **dist** и выберите **Развернуть на статический веб-сайт через службу хранилища Azure**. При появлении запроса выберите созданную ранее учетную запись хранения. Если вы уже развернули папку **dist** , вам будет предложено перезаписать файлы в службе хранилища Azure с последними изменениями.

## <a name="see-also"></a>См. также

- [Разработка надстроек Office с помощью Visual Studio Code](../develop/develop-add-ins-vscode.md)
- [Развертывание и публикация надстройки Office](../publish/publish.md)
- [Поддержка общего доступа к ресурсам между источниками (CORS) для службы хранилища Azure](/rest/api/storageservices/cross-origin-resource-sharing--cors--support-for-the-azure-storage-services)
