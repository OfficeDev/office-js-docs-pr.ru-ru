---
title: Проверка подлинности пользователя с помощью маркера единого входа
description: Узнайте, как реализовать единый вход в службе с помощью маркера единого входа, предоставляемого надстройкой Outlook.
ms.date: 04/28/2020
localization_priority: Normal
ms.openlocfilehash: 588979159446b2ceb0b1bce834d72e6853cef5ee
ms.sourcegitcommit: 0fdb78cefa669b727b817614a4147a46d249a0ed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "43930304"
---
# <a name="authenticate-a-user-with-a-single-sign-on-token-in-an-outlook-add-in-preview"></a><span data-ttu-id="0c97d-103">Проверка подлинности пользователя с помощью маркера единого входа в надстройке Outlook (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="0c97d-103">Authenticate a user with a single-sign-on token in an Outlook add-in (preview)</span></span>

<span data-ttu-id="0c97d-104">Единый вход (SSO) упрощает проверку подлинности пользователей в надстройке (и, при необходимости, получение маркеров доступа для вызова [API Microsoft Graph](/graph/overview)).</span><span class="sxs-lookup"><span data-stu-id="0c97d-104">Single sign-on (SSO) provides a seamless way for your add-in to authenticate users (and optionally to obtain access tokens to call the [Microsoft Graph API](/graph/overview)).</span></span>

<span data-ttu-id="0c97d-105">Так надстройка может получить маркер доступа, действующий во внутреннем API сервера.</span><span class="sxs-lookup"><span data-stu-id="0c97d-105">Using this method, your add-in can obtain an access token scoped to your server back-end API.</span></span> <span data-ttu-id="0c97d-106">Надстройка использует этот маркер в качестве токена носителя в заголовке `Authorization`, чтобы выполнять проверку подлинности обратного вызова API.</span><span class="sxs-lookup"><span data-stu-id="0c97d-106">The add-in uses this as a bearer token in the `Authorization` header to authenticate a call back to your API.</span></span> <span data-ttu-id="0c97d-107">При необходимости серверный код также может:</span><span class="sxs-lookup"><span data-stu-id="0c97d-107">Optionally, you can also have your server-side code:</span></span>

- <span data-ttu-id="0c97d-108">выполнить поток "от имени", чтобы получить маркер доступа, действующий в API Microsoft Graph;</span><span class="sxs-lookup"><span data-stu-id="0c97d-108">Complete the On-Behalf-Of flow to obtain an access token scoped to the Microsoft Graph API</span></span>
- <span data-ttu-id="0c97d-109">использовать сведения об удостоверении в маркере для определения удостоверения пользователя и проверки подлинности во внутренних службах.</span><span class="sxs-lookup"><span data-stu-id="0c97d-109">Use the identity information in the token to establish the user's identity and authenticate to your own back-end services</span></span>

<span data-ttu-id="0c97d-110">Общие сведения о едином входе в надстройках Office см. в статье [Включение единого входа для надстроек Office (тестовый режим)](../develop/sso-in-office-add-ins.md) и [Авторизация для Microsoft Graph в надстройке Office](../develop/authorize-to-microsoft-graph.md).</span><span class="sxs-lookup"><span data-stu-id="0c97d-110">For an overview of SSO in Office Add-ins, see [Enable single sign-on for Office Add-ins](../develop/sso-in-office-add-ins.md) and [Authorize to Microsoft Graph in your Office Add-in](../develop/authorize-to-microsoft-graph.md).</span></span>

> [!NOTE]
> <span data-ttu-id="0c97d-111">Чтобы использовать единый вход, вам необходимо загрузить бета-версию библиотеки JavaScript Office из https://appsforoffice.microsoft.com/lib/beta/hosted/office.js на страницу подготовки HTML для надстройки.</span><span class="sxs-lookup"><span data-stu-id="0c97d-111">To use SSO, you must load the beta version of the Office JavaScript Library from https://appsforoffice.microsoft.com/lib/beta/hosted/office.js in the startup HTML page of the add-in.</span></span> <span data-ttu-id="0c97d-112">Однако в производственных надстройках **не** следует использовать бета-версии API.</span><span class="sxs-lookup"><span data-stu-id="0c97d-112">However, you should **not** use beta APIs in production add-ins.</span></span>

## <a name="enable-modern-authentication-in-your-office-365-tenancy"></a><span data-ttu-id="0c97d-113">Включение современной проверки подлинности в клиенте Office 365</span><span class="sxs-lookup"><span data-stu-id="0c97d-113">Enable modern authentication in your Office 365 tenancy</span></span>

<span data-ttu-id="0c97d-114">Чтобы использовать единый вход с надстройкой Outlook, необходимо включить современную проверку подлинности для клиента Office 365.</span><span class="sxs-lookup"><span data-stu-id="0c97d-114">To use SSO with an Outlook add-in, you must enable Modern Authentication for the Office 365 tenancy.</span></span> <span data-ttu-id="0c97d-115">Сведения о том, как это сделать, см. в статье [Exchange Online: как включить в клиенте современную проверку подлинности](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="0c97d-115">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="register-your-add-in"></a><span data-ttu-id="0c97d-116">Регистрация надстройки</span><span class="sxs-lookup"><span data-stu-id="0c97d-116">Register your add-in</span></span>

<span data-ttu-id="0c97d-117">Чтобы использовать единый вход, надстройке Outlook потребуется серверный веб-API, зарегистрированный в Azure Active Directory (AAD) версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="0c97d-117">To use SSO, your Outlook add-in will need to have a server-side web API that is registered with Azure Active Directory (AAD) v2.0.</span></span> <span data-ttu-id="0c97d-118">Дополнительные сведения см. в статье [Регистрация надстройки Office, использующей единый вход с конечной точкой Microsoft Azure AD версии 2.0](../develop/register-sso-add-in-aad-v2.md).</span><span class="sxs-lookup"><span data-stu-id="0c97d-118">For more information, see [Register an Office Add-in that uses SSO with the Azure AD v2.0 endpoint](../develop/register-sso-add-in-aad-v2.md).</span></span>

### <a name="provide-consent-when-sideloading-an-add-in"></a><span data-ttu-id="0c97d-119">Предоставление согласия при загрузке неопубликованной надстройки</span><span class="sxs-lookup"><span data-stu-id="0c97d-119">Provide consent when sideloading an add-in</span></span>

<span data-ttu-id="0c97d-120">Во время приобретения надстройки, использующей единый вход, пользовательский интерфейс магазина AppSource предлагает пользователю согласиться на предоставление запрашиваемых разрешений Graph.</span><span class="sxs-lookup"><span data-stu-id="0c97d-120">When an add-in that uses SSO is acquired from AppSource, the store UI handles prompting the user for consent to the requested Graph permissions.</span></span> <span data-ttu-id="0c97d-121">Однако при разработке надстройки необходимо предоставлять согласие заранее.</span><span class="sxs-lookup"><span data-stu-id="0c97d-121">However, when you are developing an add-in, you have to provide consent in advance.</span></span> <span data-ttu-id="0c97d-122">Дополнительные сведения см. в статье [Предоставление надстройке согласия администратора](../develop/grant-admin-consent-to-an-add-in.md)</span><span class="sxs-lookup"><span data-stu-id="0c97d-122">For more information, see [Grant administrator consent to the add-in](../develop/grant-admin-consent-to-an-add-in.md)</span></span>

## <a name="update-the-add-in-manifest"></a><span data-ttu-id="0c97d-123">Обновление манифеста надстройки</span><span class="sxs-lookup"><span data-stu-id="0c97d-123">Update the add-in manifest</span></span>

<span data-ttu-id="0c97d-124">Следующий этап включения единого входа в надстройке — добавление элемента `WebApplicationInfo` в конце элемента [VersionOverrides](../reference/manifest/versionoverrides.md) библиотеки `VersionOverridesV1_1`.</span><span class="sxs-lookup"><span data-stu-id="0c97d-124">The next step to enable SSO in the add-in is to add a `WebApplicationInfo` element at the end of the `VersionOverridesV1_1` [VersionOverrides](../reference/manifest/versionoverrides.md) element.</span></span> <span data-ttu-id="0c97d-125">Дополнительные сведения см. в статье [Конфигурация надстройки](../develop/sso-in-office-add-ins.md#configure-the-add-in).</span><span class="sxs-lookup"><span data-stu-id="0c97d-125">For more information, see [Configure the add-in](../develop/sso-in-office-add-ins.md#configure-the-add-in).</span></span>

## <a name="get-the-sso-token"></a><span data-ttu-id="0c97d-126">Получение маркера единого входа</span><span class="sxs-lookup"><span data-stu-id="0c97d-126">Get the SSO token</span></span>

<span data-ttu-id="0c97d-127">Надстройка получает маркер единого входа с помощью клиентского скрипта.</span><span class="sxs-lookup"><span data-stu-id="0c97d-127">The add-in gets an SSO token with client-side script.</span></span> <span data-ttu-id="0c97d-128">Дополнительные сведения см. в разделе [Добавление кода для клиента](../develop/sso-in-office-add-ins.md#add-client-side-code).</span><span class="sxs-lookup"><span data-stu-id="0c97d-128">For more information, see [Add client-side code](../develop/sso-in-office-add-ins.md#add-client-side-code).</span></span>

## <a name="use-the-sso-token-at-the-back-end"></a><span data-ttu-id="0c97d-129">Использование маркера единого входа во внутренней службе</span><span class="sxs-lookup"><span data-stu-id="0c97d-129">Use the SSO token at the back-end</span></span>

<span data-ttu-id="0c97d-130">В большинстве случаев практически нет смысла получать маркер доступа, если надстройка не передает его на сторону сервера и не использует его там.</span><span class="sxs-lookup"><span data-stu-id="0c97d-130">In most scenarios, there would be little point to obtaining the access token, if your add-in does not pass it on to a server-side and use it there.</span></span> <span data-ttu-id="0c97d-131">Дополнительные сведения о том, какие действия должны выполняться на стороне сервера, а какие нет, см. в разделе [Добавление серверного кода](../develop/sso-in-office-add-ins.md#add-server-side-code).</span><span class="sxs-lookup"><span data-stu-id="0c97d-131">For details on what your server-side could and should do, see [Add server-side code](../develop/sso-in-office-add-ins.md#add-server-side-code).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0c97d-132">При использовании маркера единого входа в качестве удостоверения в *Outlook* рекомендуем также [использовать маркер удостоверения Exchange](authenticate-a-user-with-an-identity-token.md) в качестве альтернативного удостоверения.</span><span class="sxs-lookup"><span data-stu-id="0c97d-132">When using the SSO token as an identity in an *Outlook* add-in, we recommend that you also [use the Exchange identity token](authenticate-a-user-with-an-identity-token.md) as an alternate identity.</span></span> <span data-ttu-id="0c97d-133">Пользователи надстройки могут использовать различные клиенты, не все и которых поддерживают предоставление маркера единого входа.</span><span class="sxs-lookup"><span data-stu-id="0c97d-133">Users of your add-in may use multiple clients, and some may not support providing an SSO token.</span></span> <span data-ttu-id="0c97d-134">Если в качестве альтернативы используется маркер удостоверения Exchange, вы можете избежать повторного запрашивания учетных данных этих пользователей.</span><span class="sxs-lookup"><span data-stu-id="0c97d-134">By using the Exchange identity token as an alternate, you can avoid having to prompt these users for credentials multiple times.</span></span> <span data-ttu-id="0c97d-135">Дополнительные сведения см. в статье [Сценарий: реализация единого входа для службы в надстройке Outlook](implement-sso-in-outlook-add-in.md).</span><span class="sxs-lookup"><span data-stu-id="0c97d-135">For more information, see [Scenario: Implement single sign-on to your service in an Outlook add-in](implement-sso-in-outlook-add-in.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="0c97d-136">См. также</span><span class="sxs-lookup"><span data-stu-id="0c97d-136">See also</span></span>

- <span data-ttu-id="0c97d-137">Пример надстройки Outlook, использующей маркер единого входа для доступа к API Microsoft Graph: [Пример надстройки AttachmentsDemo](https://github.com/OfficeDev/outlook-add-in-attachments-demo).</span><span class="sxs-lookup"><span data-stu-id="0c97d-137">For a sample Outlook add-in that uses the SSO token to access the Microsoft Graph API, see [AttachmentsDemo Sample Add-in](https://github.com/OfficeDev/outlook-add-in-attachments-demo).</span></span>
- [<span data-ttu-id="0c97d-138">Справочные материалы по API единого входа</span><span class="sxs-lookup"><span data-stu-id="0c97d-138">SSO API reference</span></span>](../develop/sso-in-office-add-ins.md#sso-api-reference)
- [<span data-ttu-id="0c97d-139">Настройка требования IdentityAPI</span><span class="sxs-lookup"><span data-stu-id="0c97d-139">IdentityAPI requirement set</span></span>](../reference/requirement-sets/identity-api-requirement-sets.md)
