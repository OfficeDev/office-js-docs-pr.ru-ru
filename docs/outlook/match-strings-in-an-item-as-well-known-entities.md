---
title: Сопоставление строк как известных сущностей в надстройке Outlook
description: С помощью API JavaScript для Office можно получить строки, которые совпадают с определенными известными сущностями для дальнейшей обработки.
ms.date: 04/15/2019
localization_priority: Normal
ms.openlocfilehash: c3e9e9812118e06285b76970dae49381a73206c2
ms.sourcegitcommit: be23b68eb661015508797333915b44381dd29bdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/08/2020
ms.locfileid: "44609050"
---
# <a name="match-strings-in-an-outlook-item-as-well-known-entities"></a>Сопоставление строк в элементе Outlook как известных сущностей

Прежде чем отправить сообщение или приглашение на собрание, Exchange Server анализирует содержимое элемента, определяет в теме и тексте строки, похожие на известные Exchange сущности, например адреса электронной почты, номера телефонов и URL-адреса, и добавляет соответствующие метки. Exchange Server отправляет сообщения и приглашения на собрания с помеченными известными сущностями в папку "Входящие" приложения Outlook. 

С помощью API JavaScript для Office можно получить эти строки, соответствующие определенным известным сущностям для дальнейшей обработки. Известную сущность также можно указать в правиле в манифесте надстройки, чтобы программа Outlook смогла активировать надстройку, когда пользователь просматривает элемент, который содержит совпадения с этой сущностью. Затем вы можете извлечь и обработать совпадения с этой сущностью. 

Возможность найти или извлечь такие экземпляры из выбранного сообщения или встречи очень полезна. Например, вы можете создавать сервис обратного просмотра телефона как надстройку Outlook. Надстройка может извлекать строки в теме или основном тексте элемента, которые напоминают номер телефона, выполнять обратный поиск, а также отображать зарегистрированного владельца каждого номера телефона.

В этой статье приводятся общие сведения об этих известных сущностях, приводятся примеры основанных на них правил активации, а также описывается, как извлекать совпадения с сущностями независимо от того, используются ли они в правилах активации.


## <a name="support-for-well-known-entities"></a>Поддержка известных сущностей

После отправки элемента и до его доставки получателю Exchange Server добавляет метки к известным сущностям в сообщении или приглашении на собрание. Поэтому метки добавляются только к тем элементам, которые транспортировались через Exchange, и приложение Outlook может активировать надстройки на основе этих меток, когда пользователь просматривает такие элементы. С другой стороны, когда пользователь создает или просматривает в папке "Отправленные" элемент, который не прошел процесс транспортировки, Outlook не может активировать надстройки на основе известных сущностей. 

По этой же причине невозможно извлечь известные сущности из элементов, которые создаются или находятся в папке "Отправленные", так как эти элементы не прошли процесс транспортировки и не содержат метки. Дополнительные сведения о типах элементов, которые поддерживают активацию, см. в статье [Правила активации надстроек Outlook](activation-rules.md).

В следующей таблице перечислены сущности, которые поддерживаются и распознаются приложениями Exchange Server и Outlook (отсюда и название "известные сущности"), а также типы экземпляров каждой сущности. Распознавание строки в качестве одной из этих сущностей основано на модели обучения восприятию естественного языка, выработанной путем анализа большого объема данных. Поэтому распознавание является недетерминированным. Дополнительные сведения об условиях распознавания см. в статье [Советы по использованию известных сущностей](#tips-for-using-well-known-entities).

**Таблица 1. Поддерживаемые сущности и их типы**

|Тип сущности|Условия для распознавания|Тип объекта|
|:-----|:-----|:-----|
|**Адрес**|Адреса в Соединенных Штатах, например: 1234 Main Street, Redmond, WA 07722. В целом, чтобы адрес был распознан, он должен соответствовать структуре почтовых адресов в Соединенных Штатах с присутствием большинства элементов, таких как номер дома, название улицы, города, штата и почтовый индекс. Адрес можно указать в одной или нескольких строках.|Объект JavaScript **String**|
|**Контакт**|Ссылки на сведения о человеке распознаются на естественном языке. Распознавание контакта зависит от контекста. Например, подпись в конце сообщения или имя человека появляются в непосредственной близости от таких сведений, как номер телефона, адрес, адрес эл. почты и URL-адрес.|[Объект ](/javascript/api/outlook/office.contact)Contact|
|**EmailAddress**|SMTP-адреса электронной почты.|`String`Объект JavaScript|
|**MeetingSuggestion**|Ссылка на событие или собрание. Например, Exchange 2013 распознает следующий текст как приглашение на собрание: _Let's meet tomorrow for lunch (Встретимся завтра за обедом)._|[Объект ](/javascript/api/outlook/office.meetingsuggestion)MeetingSuggestion|
|**PhoneNumber**|Телефонные номера в США, например: _(235) 555-0110._|[Объект](/javascript/api/outlook/office.phonenumber)PhoneNumber|
|**TaskSuggestion**|Предложения в сообщении эл. почты, являющиеся призывами к действию. Например: _Please update the spreadsheet (Просьба обновить таблицу)._|[Объект ](/javascript/api/outlook/office.tasksuggestion)TaskSuggestion|
|**Url**|Веб-адрес, который в явной форме указывает сетевое расположение и идентификатор веб-ресурса. Exchange Server не требует протокола доступа в веб-адресе и не распознает URL-адреса, внедренные в текст ссылки в качестве экземпляров `Url` сущности. Exchange Server может быть сопоставлен следующим примерам: `www.youtube.com/user/officevideos``https://www.youtube.com/user/officevideos` |`String`Объект JavaScript|

<br/>

На рисунке ниже показано, как Exchange Server и Outlook поддерживают известные сущности для надстроек, а также действия, которые надстройки могут совершать с ними. Дополнительные сведения см. в разделах [Получение сущностей в надстройке](#retrieving-entities-in-your-add-in) и [Активация надстройки в зависимости от наличия сущности](#activating-an-add-in-based-on-the-existence-of-an-entity).

**Поддержка известных сущностей в Exchange Server, Outlook и надстройках**

![Поддержка и использование известных сущностей в почтовом приложении](../images/well-known-entities-info.png)


## <a name="permissions-to-extract-entities"></a>Разрешения на извлечение сущностей

Чтобы извлечь сущности в коде JavaScript или активировать надстройку в зависимости от наличия определенных известных сущностей, запросите нужные разрешения в манифесте приложения.

Задание ограниченного разрешения по умолчанию позволяет надстройке извлекать `Address` объект, `MeetingSuggestion` или `TaskSuggestion` сущность. Для извлечения любой другой сущности укажите чтение элемента, чтение и запись элемента или разрешение на чтение и запись для почтового ящика. Чтобы сделать это в манифесте, используйте элемент [Permissions](../reference/manifest/permissions.md) и укажите соответствующее разрешение&mdash;**Restricted**, **ReadItem**, **ReadWriteItem** или **ReadWriteMailbox**&mdash;, как в следующем примере:

```xml
<Permissions>ReadItem</Permissions>
```


## <a name="retrieving-entities-in-your-add-in"></a>Получение сущностей в надстройке

Если тема или текст элемента, которые просматривает пользователь, содержат строки, которые Exchange и Outlook могут распознать как известные сущности, то эти экземпляры будут доступны надстройке, даже если она была активирована без использования известных сущностей. С соответствующим разрешением можно использовать `getEntities` `getEntitiesByType` метод или для получения известных сущностей, присутствующих в текущем сообщении или встрече.

`getEntities`Метод возвращает массив объектов [Entities](/javascript/api/outlook/office.entities) , который содержит все известные сущности элемента.

Если вы заинтересованы в определенном типе сущностей, используйте метод, `getEntitiesByType` возвращающий массив только нужных объектов. Перечисление [EntityType](/javascript/api/outlook/office.mailboxenums.entitytype) представляет все типы известных сущностей, которые можно извлечь.

После вызова `getEntities` можно использовать соответствующее свойство `Entities` объекта, чтобы получить массив экземпляров типа сущности. В зависимости от типа сущности экземпляры в массиве могут быть просто строками или могут сопоставляться с конкретными объектами. 

Как показано в примере на рисунке выше, чтобы получить адреса в элементе, получите доступ к массиву, возвращенному с помощью `getEntities().addresses[]`. `Entities.addresses`Свойство возвращает массив строк, которые Outlook распознает как почтовые адреса. Аналогично, `Entities.contacts` свойство возвращает массив `Contact` объектов, которые Outlook распознает как контактные данные. В таблице 1 приведен список типов объектов экземпляра каждой поддерживаемой сущности.

В следующем примере показано, как получить любые адреса, найденные в сообщении.

```js
// Get the address entities from the item.
var entities = Office.context.mailbox.item.getEntities();
// Check to make sure that address entities are present.
if (null != entities && null != entities.addresses && undefined != entities.addresses) {
   //Addresses are present, so use them here.
}

```


## <a name="activating-an-add-in-based-on-the-existence-of-an-entity"></a>Активация надстройки в зависимости от наличия сущности

Другой способ использовать известные сущности — активировать надстройку Outlook в зависимости от наличия одного или нескольких типов сущностей в теме или тексте элемента, который вы просматриваете в данный момент. Это можно сделать, указав `ItemHasKnownEntity` правило в манифесте надстройки. Простой тип [EntityType](/javascript/api/outlook/office.mailboxenums.entitytype) представляет различные типы известных сущностей, которые поддерживаются `ItemHasKnownEntity` правилами. После активации надстройки вы также сможете получить экземпляры таких сущностей для ваших целей, как описано в предыдущем разделе [Получение сущностей в надстройке](#retrieving-entities-in-your-add-in).

При необходимости можно применить регулярное выражение в `ItemHasKnownEntity` правиле, чтобы при дальнейшем отфильтровать экземпляры сущности и позволить Outlook активировать надстройку только на подмножестве экземпляров сущности. Например, можно указать сущность адреса в сообщении, содержащем почтовый индекс штата Вашингтон, который начинается с "98". Чтобы применить фильтр к экземплярам сущностей, используйте `RegExFilter` атрибуты и `FilterName` в `Rule` элементе типа [ItemHasKnownEntity](../reference/manifest/rule.md#itemhasknownentity-rule) .

Как и для других правил активации, можно указать несколько правил, составляющих коллекцию для вашей надстройки. В следующем примере применяется операция "и" для 2 правил: `ItemIs` правило и `ItemHasKnownEntity` правило. Эта коллекция правил активирует надстройку, если текущий элемент является сообщением и Outlook распознает адрес в теме или тексте элемента.

```XML
<Rule xsi:type="RuleCollection" Mode="And">
   <Rule xsi:type="ItemIs" ItemType="Message" />
   <Rule xsi:type="ItemHasKnownEntity" EntityType="Address" />
</Rule>
```

<br/>

В следующем примере используется `getEntitiesByType` текущий элемент, чтобы задать `addresses` для переменной результаты предыдущего набора правил.

```js
var addresses = Office.context.mailbox.item.getEntitiesByType(Office.MailboxEnums.EntityType.Address);
```

<br/>

Следующий `ItemHasKnownEntity` Пример правила активирует надстройку, когда в теме или тексте текущего элемента есть URL-адрес, а URL-адрес содержит строку "YouTube" независимо от регистра строки.

```XML
<Rule xsi:type="ItemHasKnownEntity" 
    EntityType="Url" 
    RegExFilter="youtube"
    FilterName="youtube"
    IgnoreCase="true"/>
```

<br/>

В приведенном ниже примере показано использование `getFilteredEntitiesByName(name)` текущего элемента для задания переменной `videos` для получения массива результатов, которые совпадают с регулярным выражением предыдущего `ItemHasKnownEntity` правила.

```js
var videos = Office.context.mailbox.item.getFilteredEntitiesByName(youtube);
```


## <a name="tips-for-using-well-known-entities"></a>Советы по использованию известных сущностей

Необходимо помнить о некоторых аспектах и ограничениях при использовании известных сущностей в надстройке. Следующие действия применяются, если надстройка активируется, когда пользователь просматривает элемент, который содержит совпадения известных сущностей, независимо от того, используется ли `ItemHasKnownEntity` правило:


- Вы можете извлечь строки, представляющие известные сущности, только если они на английском языке.
    
- Вы можете извлечь известные сущности только из первых 2000 символов в тексте элемента. Это помогает сбалансировать функциональность и производительность, чтобы Exchange Server и Outlook не тратили слишком много ресурсов на анализ и поиск экземпляров известных сущностей в крупных сообщениях и встречах. Обратите внимание, что это предельное значение не зависит от того, указывает ли надстройка `ItemHasKnownEntity` правило. Если она использует такое правило, обратите внимание на предел обработки правил в элементе 2 ниже для полнофункционального клиента Outlook.
    
- Вы можете извлекать сущности из встреч — собраний, организованных не владельцем почтового ящика. Нельзя извлекать сущности из элементов календарей, которые не являются собраниями, или собраний, организованных владельцем почтового ящика.
    
- Вы можете извлекать сущности `MeetingSuggestion` типа только из сообщений, но не встреч.
    
- Вы можете извлекать URL-адреса, явно указанные в теле элемента, но не URL-адреса, встроенные в текст гиперссылок в HTML-элементе. Рассмотрите возможность использования `ItemHasRegularExpressionMatch` правила для получения явных и внедренных URL-адресов. Укажите в `BodyAsHTML` качестве _PropertyName_и регулярное выражение, которое соответствует URL-адресам в качестве _RegExValue_.
    
- Невозможно извлечь сущности из элементов в папке "Отправленные".
    
Кроме того, если вы используете правило [ItemHasKnownEntity](../reference/manifest/rule.md#itemhasknownentity-rule), применяются следующие условия, которые могут повлиять на ситуации, связанные с активацией надстройки:

- При использовании этого `ItemHasKnownEntity` правила предполагается, что Outlook будет сопоставлять строки сущностей только на английском языке независимо от языкового стандарта по умолчанию, указанного в манифесте.
    
- Когда надстройка работает в полнофункциональном клиенте Outlook, приложение Outlook должно применить `ItemHasKnownEntity` правило к первому мегабайту тела элемента, а не к остальному тексту за это предельное значение.
    
- Вы не можете использовать `ItemHasKnownEntity` правила для активации надстройки для элементов в папке "Отправленные".
    

## <a name="see-also"></a>См. также

- [Создание надстроек Outlook для форм чтения](read-scenario.md)
- [Извлечение строк сущности из элемента Outlook](extract-entity-strings-from-an-item.md)
- [Правила активации для надстроек Outlook](activation-rules.md)
- [Использование правил активации на основе регулярных выражений для отображения надстройки Outlook](use-regular-expressions-to-show-an-outlook-add-in.md)
- [Общие сведения о разрешениях для надстройки Outlook](understanding-outlook-add-in-permissions.md)
