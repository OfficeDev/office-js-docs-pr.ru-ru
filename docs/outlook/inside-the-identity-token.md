---
title: Подробные сведения о маркере удостоверения Exchange в надстройке Outlook
description: Узнайте, из чего состоит маркер удостоверения пользователя Exchange, созданный в надстройке Outlook.
ms.date: 10/31/2019
localization_priority: Normal
ms.openlocfilehash: 4cbbcdc587495a9b490f300414235cba1c5c570a
ms.sourcegitcommit: a3ddfdb8a95477850148c4177e20e56a8673517c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2020
ms.locfileid: "42166757"
---
# <a name="inside-the-exchange-identity-token"></a>Подробные сведения о маркере удостоверения Exchange

Маркер удостоверения пользователя Exchange, возвращаемый методом [getUserIdentityTokenAsync](../reference/objectmodel/preview-requirement-set/office.context.mailbox.md#methods), позволяет надстройке включать удостоверение пользователя в вызовы внутренней службы. В этой статье рассматриваются формат и содержимое маркера.

Маркер удостоверения пользователя Exchange — это строка URL-адреса с кодировкой Base64, подписанная сервером Exchange Server, который отправил ее. Маркер не шифруется, а открытый ключ, используемый для проверки подписи, хранится на сервере Exchange Server, который выдал маркер. Маркер состоит из трех частей: заголовка, полезных данных и подписи. В строке маркера части отделяются друг от друга точкой (`.`), чтобы маркер было проще разделить.

В Exchange для маркера удостоверения используется формат JSON Web Token (JWT). Сведения о маркерах JWT см. в документе [RFC 7519 JSON Web Token (JWT)](https://www.rfc-editor.org/rfc/rfc7519.txt).

## <a name="identity-token-header"></a>Заголовок маркера удостоверения

Заголовок содержит сведения о формате и подписи маркера. В приведенном ниже примере показано, как выглядит заголовок маркера.

```JSON
{
  "typ": "JWT",
  "alg": "RS256",
  "x5t": "Un6V7lYN-rMgaCoFSTO5z707X-4"
}
```

<br/>
 
В приведенной ниже таблице описаны части заголовка маркера.

| Утверждение | Значение | Описание |
|:-----|:-----|:-----|
| `typ` | `JWT` | Определяет маркер как JSON Web Token. Все маркеры удостоверений, предоставленные сервером Exchange Server, являются маркерами JWT. |
| `alg` | `RS256` | Алгоритм хэширования, используемый для создания подписи. Все маркеры, предоставляемые сервером Exchange Server, используют алгоритм хэширования RSASSA-PKCS1-v1_5 с SHA-256. |
| `x5t` | Отпечаток сертификата | Отпечаток маркера X.509. |

## <a name="identity-token-payload"></a>Полезные данные маркера удостоверения

Полезные данные содержат утверждения проверки подлинности, которые идентифицируют учетную запись электронной почты, а также сервер Exchange, который отправляет маркер. В следующем примере показано, как выглядит раздел полезных данных.

```JSON
{ 
  "aud": "https://mailhost.contoso.com/IdentityTest.html", 
  "iss": "00000002-0000-0ff1-ce00-000000000000@mailhost.contoso.com", 
  "nbf": "1331579055", 
  "exp": "1331607855", 
  "appctxsender": "00000002-0000-0ff1-ce00-000000000000@mailhost.context.com",
  "isbrowserhostedapp": "true",
  "appctx": { 
    "msexchuid": "53e925fa-76ba-45e1-be0f-4ef08b59d389@mailhost.contoso.com",
    "version": "ExIdTok.V1",
    "amurl": "https://mailhost.contoso.com:443/autodiscover/metadata/json/1"
  } 
}
```

<br/>
 
В приведенной ниже таблице описаны части полезных данных маркера удостоверения.

| Утверждение | Описание |
|:-----|:-----|
| `aud` | URL-адрес надстройки, запросившей маркер. Маркер действителен, только если он отправлен из надстройки, работающей в браузере клиента. Если надстройка использует схему манифестов надстроек Office версии 1.1, то этот URL-адрес указан в первом элементе `SourceLocation` под типом формы `ItemRead` или `ItemEdit` (в зависимости от того, какой из них указан первым в элементе [FormSettings](../reference/manifest/formsettings.md) манифеста надстройки). |
| `iss` | Уникальный идентификатор сервера Exchange, выпустившего маркер. Все маркеры, выпущенные сервером Exchange, будут иметь одинаковый идентификатор. |
| `nbf` | Дата и время начала срока действия маркера. Значением является количество секунд с 1 января 1970 г. |
| `exp` | Дата и время окончания срока действия маркера. Значением является количество секунд с 1 января 1970 г. |
| `appctxsender` | Уникальный идентификатор для сервера Exchange Server, который отправляет контекст приложения. |
| `isbrowserhostedapp` | Указывает, размещается ли надстройка в браузере. |
| `appctx` | Контекст приложения для маркера. |

Сведения из утверждения appctx содержат уникальный идентификатор учетной записи и расположение открытого ключа, используемого для подписывания маркера. В приведенной ниже таблице перечислены части утверждения `appctx`.

| Свойство контекста приложения | Описание |
|:-----|:-----|
| `msexchuid` | Уникальный идентификатор, связанный с учетной записью электронной почты и сервером Exchange Server. |
| `version` | Номер версии маркера. Для всех маркеров, предоставленных средой Exchange, используется значение `ExIdTok.V1`. |
| `amurl` | URL-адрес документа метаданных проверки подлинности, который содержит открытый ключ сертификата X.509, который использовался для подписи маркера.<br/><br/>Дополнительные сведения об использовании документа метаданных проверки подлинности см. в статье [Проверка маркера удостоверения Exchange](validate-an-identity-token.md). |

## <a name="identity-token-signature"></a>Подпись маркера удостоверения

Подпись создается путем хэширования разделов заголовка и полезных данных с использованием алгоритма, указанного в заголовке, а также самозаверяющего сертификата X509, размещенного на сервере в месте, указанном в полезных данных. Веб-служба может проверить эту подпись, чтобы убедиться в происхождении маркера удостоверения именно на том сервере, который должен был отправить такой маркер.

## <a name="see-also"></a>См. также

Пример, в котором анализируется маркер удостоверения пользователя Exchange: [Outlook-Add-In-Token-Viewer](https://github.com/OfficeDev/Outlook-Add-In-Token-Viewer).
