
1. Перейдите на страницу [регистрации приложений портала Azure](https://go.microsoft.com/fwlink/?linkid=2083908), чтобы зарегистрировать свое приложение.

1. Вопишитесь с ***учетными*** данными администратора в Microsoft 365 аренды. Пример: MyName@contoso.onmicrosoft.com.

1. Выберите **Новая регистрация**. На странице **Регистрация приложения** задайте необходимые значения следующим образом.

    * Параметру **Имя** присвойте значение **$ADD-IN-NAME$**.
    * Для параметра **Поддерживаемые типы учетных записей** укажите вариант **Учетные записи в любом каталоге организации (любой каталог Azure AD — мультитенантный) и личные учетные записи Майкрософт (например, Skype, Xbox)**.
    * Оставьте поле **URI перенаправления** пустым.
    * Нажмите кнопку **Зарегистрировать**.

1. На странице **$ADD-IN-NAME$** скопируйте и сохраните значения параметров **Идентификатор приложения (клиент)** и **Идентификатор каталога (клиент)**. Они понадобятся вам позже.

    > [!NOTE]
    > Этот ID является значением "аудитория", когда другие приложения, например клиентская Office (например, PowerPoint, Word, Excel), ищут авторизованный доступ к приложению. Кроме того, он используется как идентификатор клиента, когда приложение, в свою очередь, пытается получить авторизованный доступ к Microsoft Graph.

1. Выберите **Сертификаты и секреты** в разделе **Управление**. Нажмите кнопку **Новый секрет клиента**. Введите значение параметра **Описание**, выберите соответствующий вариант для параметра **Истекает срок действия** и нажмите кнопку **Добавить**. *Сразу скопируйте значение секрета клиента и сохраните его с идентификатором приложения* перед продолжением, так как он понадобится вам позже.

1. Выберите пункт **Предоставление API** в разделе **Управление**. Щелкните ссылку **Задать**, чтобы создать URI идентификатора приложения в формате "api://$ИД приложения GUID$". Вставьте **$FQDN-WITHOUT-PROTOCOL$** (с косой чертой "/" в конце) между двойной косой чертой и GUID. Весь идентификатор должен отображаться в формате `api://$FQDN-WITHOUT-PROTOCOL$/$App ID GUID$`, например: `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.

    > [!NOTE]
    > В этот момент может возникнуть некорректная ошибка с сообщением "URI идентификатора приложения должен быть допустимым URI, начинающимся с HTTPS, API, URN или MS-APPX. Он не может заканчиваться косой чертой". Если идентификатор соответствует указанным условиям, игнорируйте сообщение об ошибке и сохраните изменение.

    > [!NOTE]
    > Если возникает ошибка с сообщением о том, что домен уже занят, но при этом вы являетесь его владельцем, следуйте процедуре в статье [Краткое руководство. Добавление имени личного домена в Azure Active Directory](/azure/active-directory/add-custom-domain), чтобы зарегистрировать его, а затем повторите этот шаг. (Эта ошибка также может возникнуть, если вы не подписаны с учетными данными администратора в Microsoft 365 аренды. См. шаг 2. Выйдите и снова войдите с помощью учетных данных администратора и повторите процесс на шаге 3.)

1. Нажмите кнопку **Добавить область**. В открывшейся панели введите `access_as_user` в качестве параметра **Имя области**.

1. Для параметра **Кто может давать согласие?** установите вариант **Администраторы и пользователи**.

1. Заполните поля для настройки API администратора и согласия пользователя со значениями, подходящими для области, которая позволяет приложению Office использовать веб-API надстройки с тем же правами, что и текущий `access_as_user` пользователь. Предложения:

    - **Имя отображения согласия администратора:** Office может выступать в качестве пользователя.
    - **Описание согласия администратора:** позволяет Office вызывать веб-интерфейсы API надстройки с такими же правами, как у текущего пользователя.
    - **Имя отображения согласия пользователя:** Office может действовать так, как вы.
    - **Описание согласия пользователя:** позволяет Office вызывать веб-интерфейсы API надстройки с такими же правами, как у вас.

1. Убедитесь, что параметру **Состояние** присвоено значение **Включено**.

1. Нажмите кнопку **Добавить область**.

    > [!NOTE]
    > Доменная часть **имени области**, отображаемая непосредственно под текстовым полем, должна автоматически соответствовать **URI идентификатора приложения**, заданного на предыдущем шаге, с добавлением `/access_as_user` в конце, например: `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user`.

1. В разделе **Авторизованные клиентские приложения** укажите приложения, которые необходимо авторизовать для веб-приложения надстройки. Необходимо обеспечить предварительную авторизацию для всех указанных ниже идентификаторов.
  
    * `d3590ed6-52b3-4102-aeff-aad2292ab01c` (Microsoft Office).
    * `ea5a67f6-b6f3-4338-b240-c655ddc3cc8e` (Microsoft Office).
    * `57fb890c-0dab-4253-a5e0-7188c88b2bb4` (Office в Интернете).
    * `08e18876-6177-487e-b8b5-cf950c1e598c` (Office в Интернете).
    * `bc59ab01-8403-45c6-8796-ac3ef710b3e3` (Outlook в Интернете).

    Для каждого ИД необходимо предпринять эти действия.

      а. Нажмите кнопку **Добавить клиентское приложение**, в открывшейся панели присвойте параметру **Идентификатор клиента** соответствующий код GUID и установите флажок `api://$FQDN-WITHOUT-PROTOCOL$/$App ID GUID$/access_as_user`.

      б. Нажмите кнопку **Добавить приложение**.

1. В **статье Управление** **выбором проверки подлинности** выберите **Добавить платформу.**

1. В области **Настройка платформ выберите** **Веб,** а затем установите значение **URI перенаправления.** `https://$FQDN-WITHOUT-PROTOCOL$`

1. Выберите элемент **Настроить**.

1. В **статье Управление** выберите разрешения **API** и выберите Добавить **разрешение.** На открываемой панели выберите **Microsoft Graph,** а затем выберите делегирование **разрешений.**

1. Используйте поле поиска **Выбрать разрешения**, чтобы найти нужные разрешения для надстройки. Ниже приведены примеры.

    * Files.Read.All
    * offline_access
    * openid
    * profile

    > [!NOTE]
    > Разрешение `User.Read` может быть уже указано по умолчанию. Незачем запрашивать ненужные разрешения, поэтому рекомендуем снять флажок рядом с разрешением, которое не требуется вашей надстройке.

1. Установите флажок для каждого отображаемого разрешения (обратите внимание, что разрешения скрываются из списка после их выбора). Выбрав нужные для надстройки разрешения, нажмите кнопку **Добавить разрешения** в нижней части панели.
