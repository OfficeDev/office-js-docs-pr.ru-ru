## <a name="create-an-app-registration"></a>Создание регистрации приложения

Регистрация приложения (надстройки) устанавливает отношение доверия между надстройки и платформа удостоверений Майкрософт. Доверие является однонаправленным: ваша надстройка доверяет платформа удостоверений Майкрософт, а не наоборот.

1. Войдите [в портал Azure с](https://portal.azure.com/) учетными данными ***admin** _ в клиенте Microsoft 365 клиента. Например, _*MyName@contoso.onmicrosoft.com**.
1. В **разделе "Управление**" **выберите** >  Регистрация приложений **New registration**. На странице **Зарегистрировать приложение** задайте необходимые значения следующим образом.

    * Введите **имя** `<add-in-name>`.
    * **Задайте** для поддерживаемых типов учетных записей учетные записи в любом каталоге организации (любой каталог Azure AD — мультитенантный) и личных учетных записях **Майкрософт (например, Skype, Xbox).**
    * Оставьте поле **URI перенаправления** пустым.
    * Нажмите кнопку **Зарегистрировать**.

1. Скопируйте и сохраните значения идентификатора приложения **(клиента)** и **идентификатора каталога (клиента**). Они понадобятся вам позже.

    > [!NOTE]
    > Этот идентификатор является значением аудитории, когда другие приложения, такие как клиентское приложение Office (например, PowerPoint, Word, Excel), ищут авторизованный доступ к приложению. Кроме того, он используется как идентификатор клиента, когда приложение, в свою очередь, пытается получить авторизованный доступ к Microsoft Graph.

## <a name="add-a-client-secret"></a>Добавление секрета клиента

Иногда называется _паролем приложения_. Секрет клиента — это строковое значение, которое приложение может использовать вместо сертификата для идентификации самого себя.

1. В **портал Azure в Регистрация приложений** выберите свое приложение.
1. Выберите **"Сертификаты& секрет клиента** **secretsClient** >  **secretsNew** > .
1. Добавьте описание секрета клиента.
1. Выберите срок действия секрета или укажите пользовательское время существования.
    * Время существования секрета клиента ограничено двумя летами (24 месяцами) или меньше. Вы не можете указать пользовательское время существования дольше 24 месяцев.
    * Корпорация Майкрософт рекомендует установить срок действия менее 12 месяцев.
1. Нажмите кнопку **Добавить**.
1. _Запишите значение секрета для_ использования в коде клиентского приложения. Это значение секрета _больше не отображается после_ выхода из этой страницы.

## <a name="expose-a-web-api"></a>Предоставление веб-API

1. Убедитесь, что вы просматриваете только что созданную регистрацию приложения.
1. В **разделе "Управление**" **выберите "Предоставить API**" и щелкните ссылку **"Задать** ". Откроется поле **"Задать URI идентификатора** приложения" с созданным URI идентификатора приложения в форме `api://<application-id>`. Вставьте полное доменное имя перед .`<application-id>` Весь идентификатор должен иметь форму, `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`например `api://<fully-qualified-domain-name>/<application-id>`.

    > [!NOTE]
    > Если возникает ошибка с сообщением о том, что домен уже занят, но при этом вы являетесь его владельцем, следуйте процедуре в статье [Краткое руководство. Добавление имени личного домена в Azure Active Directory](/azure/active-directory/add-custom-domain), чтобы зарегистрировать его, а затем повторите этот шаг. (Эта ошибка также может возникнуть, если вы не вошли с учетными данными администратора в клиенте Microsoft 365 клиента. См. шаг 2. Выйдите и снова войдите с помощью учетных данных администратора и повторите процесс на шаге 3.)

## <a name="add-a-scope"></a>Добавление области

1. Нажмите кнопку **Добавить область**. В открывшейся панели введите `access_as_user` в качестве параметра **Имя области**.

1. Для параметра **Кто может давать согласие?** установите вариант **Администраторы и пользователи**.

1. `access_as_user` Заполните поля для настройки запросов согласия администратора и пользователя значениями, подходящими для области, которая позволяет клиентским приложениям Office использовать веб-API надстройки с правами текущего пользователя. Предложения:

    * **Отображаемое имя согласия администратора:** Office может выступать в качестве пользователя.
    * **Описание согласия администратора:** позволяет Office вызывать веб-интерфейсы API надстройки с такими же правами, как у текущего пользователя.
    * **Отображаемое имя** согласия пользователя: Office может действовать от имени пользователя.
    * **Описание согласия пользователя:** позволяет Office вызывать веб-интерфейсы API надстройки с такими же правами, как у вас.

1. Убедитесь, что параметру **Состояние** присвоено значение **Включено**.

1. Нажмите кнопку **Добавить область**.

    > [!NOTE]
    > Доменная часть **имени области**, отображаемая непосредственно под текстовым полем, должна автоматически соответствовать **URI идентификатора приложения**, заданного на предыдущем шаге, с добавлением `/access_as_user` в конце, например: `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user`.

1. В разделе **"Авторизованные** клиентские приложения" введите следующий идентификатор, чтобы предварительно авторизовать Microsoft Office конечных точек приложения.

   - `ea5a67f6-b6f3-4338-b240-c655ddc3cc8e`(Все Microsoft Office приложения)

    > [!NOTE]
    > Идентификатор `ea5a67f6-b6f3-4338-b240-c655ddc3cc8e` предварительно авторизует Office на всех следующих платформах. Кроме того, можно ввести соответствующее подмножество следующих идентификаторов, если по какой-либо причине вы хотите запретить авторизацию Office на некоторых платформах. Просто оставьте идентификаторы платформ, с которых требуется отостановить авторизацию. Пользователи надстройки на этих платформах не смогут вызывать веб-API, но другие функции надстройки по-прежнему будут работать.
    >
    > - `d3590ed6-52b3-4102-aeff-aad2292ab01c` (Microsoft Office).
    > - `93d53678-613d-4013-afc1-62e9e444a0a5` (Office в Интернете).
    > - `bc59ab01-8403-45c6-8796-ac3ef710b3e3` (Outlook в Интернете).

1. Выберите **Добавить клиентское приложение**. На открываемой панели задайте для идентификатора клиента соответствующий GUID и установите флажок для . `api://<fully-qualified-domain-name>/<application-id>/access_as_user`

1. Нажмите кнопку **Добавить приложение**.

## <a name="add-microsoft-graph-permissions"></a>Добавление разрешений Graph Майкрософт

1. В **разделе "Управление**" выберите **"Проверка подлинности**", а затем **выберите "Добавить платформу"**.

1. В области **"Настройка платформ" выберите** "Интернет **", а** затем задайте **значение URI** перенаправления `https://<fully-qualified-domain-name>`.

1. Выберите элемент **Настроить**.

1. В **разделе "** Управление" выберите **разрешения API** и нажмите кнопку **"Добавить разрешение"**. На открываемой панели выберите **Microsoft Graph**, а затем — **делегированные разрешения**.

1. Используйте поле поиска **Выбрать разрешения**, чтобы найти нужные разрешения для надстройки. Ниже приведены примеры.

    * Files.Read.All
    * offline_access
    * openid
    * profile

    > [!NOTE]
    > Разрешение `User.Read` может быть уже указано по умолчанию. Рекомендуется запрашивать только необходимые разрешения, поэтому рекомендуется снять флажок для этого разрешения, если надстройка в действительности не нужна.

1. Установите флажок для каждого отображаемого разрешения (обратите внимание, что разрешения скрываются из списка после их выбора). После выбора разрешений, необходимых надстройке, нажмите кнопку **"Добавить** разрешения".
