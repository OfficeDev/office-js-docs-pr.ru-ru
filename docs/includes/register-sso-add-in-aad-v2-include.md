

1. <span data-ttu-id="d9288-101">Перейдите на страницу [регистрации приложений портала Azure](https://go.microsoft.com/fwlink/?linkid=2083908), чтобы зарегистрировать свое приложение.</span><span class="sxs-lookup"><span data-stu-id="d9288-101">Navigate to the [Azure portal - App registrations](https://go.microsoft.com/fwlink/?linkid=2083908) page to register your app.</span></span>

1. <span data-ttu-id="d9288-102">Войдите в клиент Office 365, используя учетные данные ***администратора***.</span><span class="sxs-lookup"><span data-stu-id="d9288-102">Sign in with the ***admin*** credentials to your Office 365 tenancy.</span></span> <span data-ttu-id="d9288-103">Пример: MyName@contoso.onmicrosoft.com.</span><span class="sxs-lookup"><span data-stu-id="d9288-103">For example, MyName@contoso.onmicrosoft.com.</span></span>

1. <span data-ttu-id="d9288-104">Выберите **Новая регистрация**.</span><span class="sxs-lookup"><span data-stu-id="d9288-104">Select **New registration**.</span></span> <span data-ttu-id="d9288-105">На странице **Регистрация приложения** задайте необходимые значения следующим образом.</span><span class="sxs-lookup"><span data-stu-id="d9288-105">On the **Register an application** page, set the values as follows.</span></span>

    * <span data-ttu-id="d9288-106">Параметру **Имя** присвойте значение **$ADD-IN-NAME$**.</span><span class="sxs-lookup"><span data-stu-id="d9288-106">Set **Name** to **$ADD-IN-NAME$**.</span></span>
    * <span data-ttu-id="d9288-107">Для параметра **Поддерживаемые типы учетных записей** укажите вариант **Учетные записи в любом каталоге организации и личные учетные записи Майкрософт (например, Skype, Xbox, Outlook.com)**.</span><span class="sxs-lookup"><span data-stu-id="d9288-107">Set **Supported account types** to **Accounts in any organizational directory and personal Microsoft accounts (e.g. Skype, Xbox, Outlook.com)**.</span></span>
    * <span data-ttu-id="d9288-108">Оставьте поле **URI перенаправления** пустым.</span><span class="sxs-lookup"><span data-stu-id="d9288-108">Leave **Redirect URI** empty.</span></span>
    * <span data-ttu-id="d9288-109">Нажмите кнопку **Зарегистрировать**.</span><span class="sxs-lookup"><span data-stu-id="d9288-109">Choose **Register**.</span></span>

1. <span data-ttu-id="d9288-110">На странице **$ADD-IN-NAME$** скопируйте и сохраните значения параметров **Идентификатор приложения (клиент)** и **Идентификатор каталога (клиент)**.</span><span class="sxs-lookup"><span data-stu-id="d9288-110">On the **$ADD-IN-NAME$** page, copy and save the values for the **Application (client) ID** and the **Directory (tenant) ID**.</span></span> <span data-ttu-id="d9288-111">Они понадобятся вам позже.</span><span class="sxs-lookup"><span data-stu-id="d9288-111">You'll use both of them in later procedures.</span></span>

    > [!NOTE]
    > <span data-ttu-id="d9288-112">Этот идентификатор представляет собой значение аудитории, используемое, когда другие приложения, например ведущее приложение Office (PowerPoint, Word, Excel и т. д.), пытаются получить авторизованный доступ к вашему приложению.</span><span class="sxs-lookup"><span data-stu-id="d9288-112">This ID is the "audience" value when other applications, such as the Office host application (e.g., PowerPoint, Word, Excel), seek authorized access to the application.</span></span> <span data-ttu-id="d9288-113">Кроме того, он используется как идентификатор клиента, когда приложение, в свою очередь, пытается получить авторизованный доступ к Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="d9288-113">It is also the "client ID" of the application when it, in turn, seeks authorized access to Microsoft Graph.</span></span>

1. <span data-ttu-id="d9288-114">Выберите **Сертификаты и секреты** в разделе **Управление**.</span><span class="sxs-lookup"><span data-stu-id="d9288-114">Select **Certificates & secrets** under **Manage**.</span></span> <span data-ttu-id="d9288-115">Нажмите кнопку **Новый секрет клиента**.</span><span class="sxs-lookup"><span data-stu-id="d9288-115">Select the **New client secret** button.</span></span> <span data-ttu-id="d9288-116">Введите значение параметра **Описание**, выберите соответствующий вариант для параметра **Истекает срок действия** и нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="d9288-116">Enter a value for **Description** then select an appropriate option for **Expires** and choose **Add**.</span></span> <span data-ttu-id="d9288-117">*Сразу скопируйте значение секрета клиента и сохраните его с идентификатором приложения* перед продолжением, так как он понадобится вам позже.</span><span class="sxs-lookup"><span data-stu-id="d9288-117">*Copy the client secret value immediately and save it with the application ID* before proceeding as you'll need it in a later procedure.</span></span>

1. <span data-ttu-id="d9288-118">Выберите пункт **Предоставление API** в разделе **Управление**.</span><span class="sxs-lookup"><span data-stu-id="d9288-118">Select **Expose an API** under **Manage**.</span></span> <span data-ttu-id="d9288-119">Щелкните ссылку **Задать**, чтобы создать URI идентификатора приложения в формате "api://$ИД приложения GUID$".</span><span class="sxs-lookup"><span data-stu-id="d9288-119">Select the **Set** link to generate the Application ID URI in the form "api://$App ID GUID$".</span></span> <span data-ttu-id="d9288-120">Вставьте **$FQDN-WITHOUT-PROTOCOL$** (с косой чертой "/" в конце) между двойной косой чертой и GUID.</span><span class="sxs-lookup"><span data-stu-id="d9288-120">Insert the **$FQDN-WITHOUT-PROTOCOL$** (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="d9288-121">Весь идентификатор должен отображаться в формате `api://$FQDN-WITHOUT-PROTOCOL$/$App ID GUID$`, например: `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.</span><span class="sxs-lookup"><span data-stu-id="d9288-121">The entire ID should have the form `api://$FQDN-WITHOUT-PROTOCOL$/$App ID GUID$`; for example `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.</span></span>

    > [!NOTE]
    > <span data-ttu-id="d9288-122">В этот момент может возникнуть некорректная ошибка с сообщением "URI идентификатора приложения должен быть допустимым URI, начинающимся с HTTPS, API, URN или MS-APPX.</span><span class="sxs-lookup"><span data-stu-id="d9288-122">You may get an inaccurate error at this point saying "The application ID URI must be a valid URI starting with HTTPS, API, URN, MS-APPX.</span></span> <span data-ttu-id="d9288-123">Он не может заканчиваться косой чертой".</span><span class="sxs-lookup"><span data-stu-id="d9288-123">It must not end in a slash."</span></span> <span data-ttu-id="d9288-124">Если идентификатор соответствует указанным условиям, игнорируйте сообщение об ошибке и сохраните изменение.</span><span class="sxs-lookup"><span data-stu-id="d9288-124">If the ID meets the stated conditions, ignore the error and save your change.</span></span>

    > [!NOTE]
    > <span data-ttu-id="d9288-125">Если возникает ошибка с сообщением о том, что домен уже занят, но при этом вы являетесь его владельцем, следуйте процедуре в статье [Краткое руководство. Добавление имени личного домена в Azure Active Directory](/azure/active-directory/add-custom-domain), чтобы зарегистрировать его, а затем повторите этот шаг.</span><span class="sxs-lookup"><span data-stu-id="d9288-125">If you get an error saying that the domain is already owned but you own it, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/add-custom-domain) to register it, and then repeat this step.</span></span> <span data-ttu-id="d9288-126">(Эта ошибка также может возникать, если вы не вошли в систему с помощью учетных данных администратора в клиенте Office 365.</span><span class="sxs-lookup"><span data-stu-id="d9288-126">(This error can also occur if you are not signed in with credentials of an admin in the Office 365 tenancy.</span></span> <span data-ttu-id="d9288-127">См. шаг 2.</span><span class="sxs-lookup"><span data-stu-id="d9288-127">See step 2.</span></span> <span data-ttu-id="d9288-128">Выйдите и снова войдите с помощью учетных данных администратора и повторите процесс на шаге 3.)</span><span class="sxs-lookup"><span data-stu-id="d9288-128">Sign out and sign in again with admin credentials and repeat the process from step 3.)</span></span>

1. <span data-ttu-id="d9288-129">Нажмите кнопку **Добавить область**.</span><span class="sxs-lookup"><span data-stu-id="d9288-129">Select the **Add a scope** button.</span></span> <span data-ttu-id="d9288-130">В открывшейся панели введите `access_as_user` в качестве параметра **Имя области**.</span><span class="sxs-lookup"><span data-stu-id="d9288-130">In the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>

1. <span data-ttu-id="d9288-131">Для параметра **Кто может давать согласие?** установите вариант **Администраторы и пользователи**.</span><span class="sxs-lookup"><span data-stu-id="d9288-131">Set **Who can consent?** to **Admins and users**.</span></span>

1. <span data-ttu-id="d9288-132">Заполните поля для настройки запросов согласия администраторов и пользователей значениями, соответствующими области `access_as_user`, позволяющей ведущему приложению Office использовать веб-интерфейсы API надстройки с такими же правами, как у текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9288-132">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope which enables the Office host application to use your add-in's web APIs with the same rights as the current user.</span></span> <span data-ttu-id="d9288-133">Возможные варианты:</span><span class="sxs-lookup"><span data-stu-id="d9288-133">Suggestions:</span></span>

    - <span data-ttu-id="d9288-134">**Отображаемое имя согласия администратора:** Office может действовать в качестве пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9288-134">**Admin consent title:** Office can act as the user.</span></span>
    - <span data-ttu-id="d9288-135">**Описание согласия администратора:** позволяет Office вызывать веб-интерфейсы API надстройки с такими же правами, как у текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9288-135">**Admin consent description:** Enable Office to call the add-in's web APIs with the same rights as the current user.</span></span>
    - <span data-ttu-id="d9288-136">**Отображаемое имя согласия пользователя:** Office может действовать от вашего имени.</span><span class="sxs-lookup"><span data-stu-id="d9288-136">**User consent title:** Office can act as you.</span></span>
    - <span data-ttu-id="d9288-137">**Описание согласия администратора:** позволяет Office вызывать веб-интерфейсы API надстройки с такими же правами, как у вас.</span><span class="sxs-lookup"><span data-stu-id="d9288-137">**Admin consent description:** Enable Office to call the add-in's web APIs with the same rights that you have.</span></span>

1. <span data-ttu-id="d9288-138">Убедитесь, что параметру **Состояние** присвоено значение **Включено**.</span><span class="sxs-lookup"><span data-stu-id="d9288-138">Ensure that **State** is set to **Enabled**.</span></span>

1. <span data-ttu-id="d9288-139">Нажмите кнопку **Добавить область**.</span><span class="sxs-lookup"><span data-stu-id="d9288-139">Select **Add scope**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="d9288-140">Доменная часть **имени области**, отображаемая непосредственно под текстовым полем, должна автоматически соответствовать **URI идентификатора приложения**, заданного на предыдущем шаге, с добавлением `/access_as_user` в конце, например: `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user`.</span><span class="sxs-lookup"><span data-stu-id="d9288-140">The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID URI** set in the previous step, with `/access_as_user` appended to the end; for example, `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user`.</span></span>

1. <span data-ttu-id="d9288-141">В разделе **Авторизованные клиентские приложения** укажите приложения, которые необходимо авторизовать для веб-приложения надстройки.</span><span class="sxs-lookup"><span data-stu-id="d9288-141">In the **Authorized client applications** section, you identify the applications that you want to authorize to your add-in's web application.</span></span> <span data-ttu-id="d9288-142">Необходимо обеспечить предварительную авторизацию для всех указанных ниже идентификаторов.</span><span class="sxs-lookup"><span data-stu-id="d9288-142">Each of the following IDs needs to be pre-authorized.</span></span>
  
    * <span data-ttu-id="d9288-143">`d3590ed6-52b3-4102-aeff-aad2292ab01c` (Microsoft Office).</span><span class="sxs-lookup"><span data-stu-id="d9288-143">`d3590ed6-52b3-4102-aeff-aad2292ab01c` (Microsoft Office)</span></span>
    * <span data-ttu-id="d9288-144">`57fb890c-0dab-4253-a5e0-7188c88b2bb4` (Office Online).</span><span class="sxs-lookup"><span data-stu-id="d9288-144">`57fb890c-0dab-4253-a5e0-7188c88b2bb4` (Office Online)</span></span>
    * <span data-ttu-id="d9288-145">`bc59ab01-8403-45c6-8796-ac3ef710b3e3` (Office Online).</span><span class="sxs-lookup"><span data-stu-id="d9288-145">`bc59ab01-8403-45c6-8796-ac3ef710b3e3` (Office Online)</span></span>

    <span data-ttu-id="d9288-146">Для каждого идентификатора сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="d9288-146">For each ID, take these steps:</span></span>

      <span data-ttu-id="d9288-147">а.</span><span class="sxs-lookup"><span data-stu-id="d9288-147">a.</span></span> <span data-ttu-id="d9288-148">Нажмите кнопку **Добавить клиентское приложение**, в открывшейся панели присвойте параметру **Идентификатор клиента** соответствующий код GUID и установите флажок `api://$FQDN-WITHOUT-PROTOCOL$/$App ID GUID$/access_as_user`.</span><span class="sxs-lookup"><span data-stu-id="d9288-148">Select **Add a client application** button then, in the panel that opens, set the **Client ID** to the respective GUID and check the box for `api://$FQDN-WITHOUT-PROTOCOL$/$App ID GUID$/access_as_user`.</span></span>

      <span data-ttu-id="d9288-149">б.</span><span class="sxs-lookup"><span data-stu-id="d9288-149">b.</span></span> <span data-ttu-id="d9288-150">Нажмите кнопку **Добавить приложение**.</span><span class="sxs-lookup"><span data-stu-id="d9288-150">Select **Add application**.</span></span>

1. <span data-ttu-id="d9288-151">Выберите **Проверка подлинности** в разделе **Управление**.</span><span class="sxs-lookup"><span data-stu-id="d9288-151">Select **Authentication** under **Manage**.</span></span> <span data-ttu-id="d9288-152">В разделе **URI перенаправления** выберите вариант **Веб** в раскрывающемся списке **Тип** и присвойте параметру **URI перенаправления** значение `https://$FQDN-WITHOUT-PROTOCOL$`.</span><span class="sxs-lookup"><span data-stu-id="d9288-152">In the **Redirect URIs** section, select **Web** in the **Type** dropdown then set the **Redirect URI** value to `https://$FQDN-WITHOUT-PROTOCOL$`.</span></span>

1. <span data-ttu-id="d9288-153">Щелкните **Сохранить** в верхней части формы.</span><span class="sxs-lookup"><span data-stu-id="d9288-153">Select **Save** at the top of the form.</span></span>

1. <span data-ttu-id="d9288-154">Выберите пункт **Разрешения API** в разделе **Управление** и нажмите кнопку **Добавить разрешение**.</span><span class="sxs-lookup"><span data-stu-id="d9288-154">Select **API permissions** under **Manage** and select **Add a permission**.</span></span> <span data-ttu-id="d9288-155">В открывшейся панели выберите **Microsoft Graph** и щелкните **Делегированные разрешения**.</span><span class="sxs-lookup"><span data-stu-id="d9288-155">On the panel that opens, choose **Microsoft Graph** and then choose **Delegated permissions**.</span></span>

1. <span data-ttu-id="d9288-156">Используйте поле поиска **Выбрать разрешения**, чтобы найти нужные разрешения для надстройки.</span><span class="sxs-lookup"><span data-stu-id="d9288-156">Use the **Select permissions** search box to search for the permissions your add-in needs.</span></span> <span data-ttu-id="d9288-157">Ниже приведены примеры.</span><span class="sxs-lookup"><span data-stu-id="d9288-157">The following are examples.</span></span>

    * <span data-ttu-id="d9288-158">Files.Read.All</span><span class="sxs-lookup"><span data-stu-id="d9288-158">Files.Read.All</span></span>
    * <span data-ttu-id="d9288-159">offline_access</span><span class="sxs-lookup"><span data-stu-id="d9288-159">offline_access</span></span>
    * <span data-ttu-id="d9288-160">openid</span><span class="sxs-lookup"><span data-stu-id="d9288-160">openid</span></span>
    * <span data-ttu-id="d9288-161">profile</span><span class="sxs-lookup"><span data-stu-id="d9288-161">profile</span></span>

    > [!NOTE]
    > <span data-ttu-id="d9288-162">Разрешение `User.Read` может быть уже указано по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="d9288-162">The `User.Read` permission may already be listed by default.</span></span> <span data-ttu-id="d9288-163">Незачем запрашивать ненужные разрешения, поэтому рекомендуем снять флажок рядом с разрешением, которое не требуется вашей надстройке.</span><span class="sxs-lookup"><span data-stu-id="d9288-163">It is a good practice not to ask for permissions that are not needed, so we recommend that you uncheck the box for this permission if your add-in does not actually need it.</span></span>

1. <span data-ttu-id="d9288-164">Установите флажок для каждого отображаемого разрешения (обратите внимание, что разрешения скрываются из списка после их выбора).</span><span class="sxs-lookup"><span data-stu-id="d9288-164">Select the check box for each permission as it appears (note that the permissions will not remain visible in the list as you select each one).</span></span> <span data-ttu-id="d9288-165">Выбрав нужные для надстройки разрешения, нажмите кнопку **Добавить разрешения** в нижней части панели.</span><span class="sxs-lookup"><span data-stu-id="d9288-165">After selecting the permissions that your add-in needs, select the **Add permissions** button at the bottom of the panel.</span></span>
