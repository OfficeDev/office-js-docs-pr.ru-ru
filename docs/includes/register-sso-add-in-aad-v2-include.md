## <a name="create-an-app-registration"></a>Создание регистрации приложения

Регистрация приложения (надстройки) устанавливает доверительные отношения между надстройки и платформа удостоверений Майкрософт. Доверие однонаправленное: ваша надстройка доверяет платформа удостоверений Майкрософт, а не наоборот.

1. Во входе на портал [Azure](https://portal.azure.com/) с учетными данными ***admin** _ в Microsoft 365 аренды. Например, _*MyName@contoso.onmicrosoft.com**.
1. В **статье Управление** выберите **регистрация приложений** > **.** На странице **Зарегистрировать приложение** задайте необходимые значения следующим образом.

    * Введите **имя** `<add-in-name>`.
    * Установите **поддерживаемые** типы учетных записей для учетных записей в любом организационном каталоге (любой каталог Azure AD — многоступенчатый) и личных учетных записях **Майкрософт (например, Skype, Xbox)**.
    * Оставьте поле **URI перенаправления** пустым.
    * Нажмите кнопку **Зарегистрировать**.

1. Скопируйте и сохраните значения для **ID приложения (клиента)** и **ID каталога (клиента**). Они понадобятся вам позже.

    > [!NOTE]
    > Этот ID является значением "аудитория", когда другие приложения, например клиентская Office (например, PowerPoint, Word, Excel), ищут авторизованный доступ к приложению. Кроме того, он используется как идентификатор клиента, когда приложение, в свою очередь, пытается получить авторизованный доступ к Microsoft Graph.

## <a name="add-a-client-secret"></a>Добавление секрета клиента

Иногда называется _паролем приложения_, клиентская тайна — это строковое значение, которое приложение может использовать в качестве сертификата для удостоверения.

1. На портале Azure в **регистрациях приложений** выберите приложение.
1. Выберите **сертификаты &** **SecretsClient** >  **SecretNew** >  client secret.
1. Добавьте описание секрета клиента.
1. Выберите срок действия секрета или укажите настраиваемый срок службы.
    * Срок службы секрета клиента ограничен двумя годами (24 месяца) или менее. Нельзя указать настраиваемый срок службы более 24 месяцев.
    * Корпорация Майкрософт рекомендует установить срок действия менее 12 месяцев.
1. Нажмите **Добавить**.
1. _Зафиксировать значение секрета для_ использования в коде клиентского приложения. Это секретное значение _никогда не отображается после_ того, как вы оставите эту страницу.

## <a name="expose-a-web-api"></a>Обналичить веб-API

1. Убедитесь, что вы просматриваете только что созданную регистрацию приложений.
1. В **статье Управление** выберите **Expose aPI** и выберите ссылку **Set** . Это открывает поле **Set the App ID URI** с созданным URI ID приложения в форме `api://<application-id>`. Вставьте полностью квалифицированное доменное имя перед .`<application-id>` Весь ID должен иметь форму `api://<fully-qualified-domain-name>/<application-id>`; например, `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.

    > [!NOTE]
    > Если возникает ошибка с сообщением о том, что домен уже занят, но при этом вы являетесь его владельцем, следуйте процедуре в статье [Краткое руководство. Добавление имени личного домена в Azure Active Directory](/azure/active-directory/add-custom-domain), чтобы зарегистрировать его, а затем повторите этот шаг. (Эта ошибка также может возникнуть, если вы не подписаны с учетными данными администратора в Microsoft 365 аренды. См. шаг 2. Выйдите и снова войдите с помощью учетных данных администратора и повторите процесс на шаге 3.)

## <a name="add-a-scope"></a>Добавление области

1. Нажмите кнопку **Добавить область**. В открывшейся панели введите `access_as_user` в качестве параметра **Имя области**.

1. Для параметра **Кто может давать согласие?** установите вариант **Администраторы и пользователи**.

1. `access_as_user` Заполните поля для настройки запросов на согласие администратора и пользователя со значениями, подходящими для области, которая позволяет приложению Office использовать веб-API надстройки с тем же правами, что и текущий пользователь. Предложения:

    * **Имя отображения согласия** администратора: Office может выступать в качестве пользователя.
    * **Описание согласия администратора:** позволяет Office вызывать веб-интерфейсы API надстройки с такими же правами, как у текущего пользователя.
    * **Имя отображения согласия пользователя:** Office может действовать так, как вы.
    * **Описание согласия пользователя:** позволяет Office вызывать веб-интерфейсы API надстройки с такими же правами, как у вас.

1. Убедитесь, что параметру **Состояние** присвоено значение **Включено**.

1. Нажмите кнопку **Добавить область**.

    > [!NOTE]
    > Доменная часть **имени области**, отображаемая непосредственно под текстовым полем, должна автоматически соответствовать **URI идентификатора приложения**, заданного на предыдущем шаге, с добавлением `/access_as_user` в конце, например: `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user`.

1. В разделе **Авторизованные клиентские приложения** укажите приложения, которые необходимо авторизовать для веб-приложения надстройки. Необходимо обеспечить предварительную авторизацию для всех указанных ниже идентификаторов.
  
    * `d3590ed6-52b3-4102-aeff-aad2292ab01c` (Microsoft Office).
    * `ea5a67f6-b6f3-4338-b240-c655ddc3cc8e` (Microsoft Office).
    * `93d53678-613d-4013-afc1-62e9e444a0a5` (Office в Интернете).
    * `57fb890c-0dab-4253-a5e0-7188c88b2bb4` (Office в Интернете).
    * `08e18876-6177-487e-b8b5-cf950c1e598c` (Office в Интернете).
    * `bc59ab01-8403-45c6-8796-ac3ef710b3e3` (Outlook в Интернете).

    > [!NOTE]
    > ID `ea5a67f6-b6f3-4338-b240-c655ddc3cc8e` включает все остальные перечисленные ИД и может использоваться сингулярно для предварительной авторизации всех конечных точек Office для использования в службе в потоке SSO Office надстройки.

    Для каждого ИД необходимо предпринять эти действия.

      а. Выберите **Добавить клиентское приложение**. На открываемой панели установите **ИД клиента** в соответствующий GUID и проверьте поле `api://<fully-qualified-domain-name>/<application-id>/access_as_user`для .

      б. Нажмите кнопку **Добавить приложение**.

## <a name="add-microsoft-graph-permissions"></a>Добавление разрешений Graph Microsoft

1. В **статье Управление** выберите **проверку подлинности**, а затем **добавьте платформу**.

1. В области **Настройка платформ выберите** **Веб,а** затем установите значение **URI перенаправления**`https://<fully-qualified-domain-name>`.

1. Выберите элемент **Настроить**.

1. В **статье Управление** выберите **разрешения API** и добавьте **разрешение**. На открываемой панели выберите **Microsoft Graph**, а затем выберите **делегирование разрешений**.

1. Используйте поле поиска **Выбрать разрешения**, чтобы найти нужные разрешения для надстройки. Ниже приведены примеры.

    * Files.Read.All
    * offline_access
    * openid
    * profile

    > [!NOTE]
    > Разрешение `User.Read` может быть уже указано по умолчанию. Рекомендуется запрашивать только необходимые разрешения, поэтому рекомендуется отопросить поле для этого разрешения, если надстройка на самом деле не нужна.

1. Установите флажок для каждого отображаемого разрешения (обратите внимание, что разрешения скрываются из списка после их выбора). После выбора разрешений, необходимых для надстройки, выберите кнопку **Добавить разрешения** .
