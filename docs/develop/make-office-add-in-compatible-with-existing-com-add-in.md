---
title: Убедитесь, что надстройка Office совместима с существующей надстройкой COM
description: Включить совместимость между Office надстройки и эквивалентной надстройки COM.
ms.date: 03/09/2021
localization_priority: Normal
ms.openlocfilehash: e2ab1bb1eda548ff8e0923b8fbccfa9e007a6a0c
ms.sourcegitcommit: ee9e92a968e4ad23f1e371f00d4888e4203ab772
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/23/2021
ms.locfileid: "53076001"
---
# <a name="make-your-office-add-in-compatible-with-an-existing-com-add-in"></a>Убедитесь, что надстройка Office совместима с существующей надстройкой COM

Если у вас есть существующая надстройка COM, вы можете создать эквивалентную функциональность в Office надстройки, что позволит вашему решению работать на других платформах, таких как Office в Интернете или Mac. В некоторых случаях Office надстройка может быть не в состоянии предоставить все функциональные возможности, доступные в соответствующей надстройки COM. В таких ситуациях надстройка COM может предоставлять пользователям более Windows, чем соответствующие Office надстройки.

Можно настроить надстройку Office так, чтобы при установке эквивалентной надстройки COM на компьютере пользователя Office на Windows надстройка COM вместо надстройки Office. Надстройка COM называется "эквивалентной", так как Office плавно переходит между надстройки COM и надстройки Office, в соответствии с которой устанавливается компьютер пользователя.

> [!NOTE]
> Эта функция поддерживается следующими платформами при под подключении к Microsoft 365 подписке.
>
> - Excel, Word и PowerPoint в Интернете
> - Excel, Word и PowerPoint на Windows (версия 1904 или более поздней версии)
> - Excel, Word и PowerPoint Mac (версия 13.329 или более поздней версии)
> - Outlook на Windows (версия 2102 или более поздней версии)

## <a name="specify-an-equivalent-com-add-in"></a>Укажите эквивалентную надстройка COM

### <a name="manifest"></a>Манифест

> [!IMPORTANT]
> Применяется к Excel, PowerPoint и Word. Outlook поддержка скоро.

Чтобы обеспечить совместимость Office надстройки и надстройки COM, определите эквивалентную надстройка COM в манифесте Office надстройки. [](add-in-manifests.md) Затем Office на Windows надстройка COM вместо надстройки Office, если они установлены.

В следующем примере показана часть манифеста, которая указывает надстройки COM в качестве эквивалентной надстройки. Значение элемента определяет надстройку COM, а элемент EquivalentAddins должен быть позиционен непосредственно `ProgId` перед закрывающими [](../reference/manifest/equivalentaddins.md) `VersionOverrides` тегами.

```xml
<VersionOverrides>
  ...
  <EquivalentAddins>
    <EquivalentAddin>
      <ProgId>ContosoCOMAddin</ProgId>
      <Type>COM</Type>
    </EquivalentAddin>
  </EquivalentAddins>
</VersionOverrides>
```

> [!TIP]
> Сведения о совместимости надстройки COM и совместимости XLL UDF см. в ссылке [Make your custom functions compatible with XLL user-defined functions.](../excel/make-custom-functions-compatible-with-xll-udf.md)

### <a name="group-policy"></a>Групповая политика

> [!IMPORTANT]
> Применяется только Outlook.

Чтобы объявить совместимость между Outlook веб-надстройки и надстройки COM/VSTO, определите эквивалентную надстройку COM в групповой политике **Deactivate Outlook** веб-надстроек, эквивалентные com или VSTO надстройки, установленные путем настройки на компьютере пользователя. Затем Outlook на Windows будет использовать надстройки COM вместо веб-надстройки, если они установлены.

1. Скачайте последний [инструмент административных шаблонов,](https://www.microsoft.com/download/details.aspx?id=49030)обращая внимание на инструкции по установке **средства.**
1. Откройте редактор локальной групповой политики **(gpedit.msc).**
1. Перейдите **к административным** шаблонам конфигурации  >     >  **пользователей Microsoft Outlook 2016**  >  **разных типов.**
1. Выберите параметр **Deactivate Outlook веб-надстроек,** у которых установлен эквивалент com или VSTO надстройка.
1. Откройте ссылку для редактирования параметра политики.
1. В диалоговом **Outlook веб-надстроек для отключения:**
    1. Установите **имя value** для найденного в манифесте `Id` веб-надстройки. **Важно.** *Не добавляйте* фигурные скобки `{}` вокруг входа.
    1. **Задайте** значение `ProgId` эквивалентной надстройки COM/VSTO.
    1. Выберите **ОК,** чтобы вложить обновление в действие.
    ![Снимок экрана, показывающий диалоговое окно "Outlook веб-надстроек для деактивации".](../images/outlook-deactivate-gpo-dialog.png)

## <a name="equivalent-behavior-for-users"></a>Эквивалентное поведение для пользователей

При [указании](#specify-an-equivalent-com-add-in)эквивалентной надстройки COM Office на Windows не будет отображаться пользовательский интерфейс Office надстройки (UI), если установлена эквивалентная надстройка COM. Office только скрывает кнопки ленты надстройки Office надстройки и не препятствует установке. Поэтому Office надстройка по-прежнему будет отображаться в следующих расположениях в пользовательском интерфейсе:

- В **статье Мои надстройки**
- В качестве записи в диспетчере ленты (только Excel, Word и PowerPoint)

> [!NOTE]
> Указание эквивалентной надстройки COM в манифесте не влияет на другие платформы, такие как Office в Интернете или Mac.

В следующих сценариях описывается, что происходит в зависимости от того, как пользователь Office надстройку.

### <a name="appsource-acquisition-of-an-office-add-in"></a>Приобретение appSource Office надстройки

Если пользователь приобретает надстройки Office AppSource и эквивалентная надстройка COM уже установлена, Office будет:

1. Установите Office надстройки.
2. Скрыть интерфейс Office надстройки в ленте.
3. Отображение вызова для пользователя, который указывает кнопку ленты надстройки COM.

### <a name="centralized-deployment-of-office-add-in"></a>Централизованное развертывание Office надстройки

Если администратор развертывает надстройку Office клиента с помощью централизованного развертывания, а эквивалентная надстройка COM уже установлена, пользователь должен перезапустить Office, прежде чем они увидят какие-либо изменения. После Office перезапуска будет:

1. Установите Office надстройки.
2. Скрыть интерфейс Office надстройки в ленте.
3. Отображение вызова для пользователя, который указывает кнопку ленты надстройки COM.

### <a name="document-shared-with-embedded-office-add-in"></a>Документ, общий со встроенными Office надстройки

Если у пользователя установлена надстройка COM, а затем он получает общий документ со встроенной надстройки Office, то при открываемом документе Office:

1. Запрос пользователя на доверие Office надстройки.
2. При доверии Office надстройка будет устанавливаться.
3. Скрыть интерфейс Office надстройки в ленте.

## <a name="other-com-add-in-behavior"></a>Другое поведение надстройки COM

### <a name="excel-powerpoint-word"></a>Excel, PowerPoint, Word

Если пользователь отреставрирует эквивалентную надстройку COM, Office на Windows восстанавливает пользовательский интерфейс Office надстройки.

После указания эквивалентной надстройки COM для Office надстройки Office обработку обновлений Office надстройки. Чтобы получить последние обновления для надстройки Office, пользователю необходимо сначала удалить надстройку COM.

### <a name="outlook"></a>Outlook

Надстройка com/VSTO должна быть подключена при Outlook, чтобы соответствующая веб-надстройка была отключена.

Если надстройка com/VSTO отключена во время последующего сеанса Outlook, веб-надстройка, скорее всего, будет отключена до Outlook перезапуска.

## <a name="see-also"></a>См. также

- [Совместите пользовательские функции с определенными функциями пользователя XLL](../excel/make-custom-functions-compatible-with-xll-udf.md)
