---
title: Убедитесь, что надстройка Office совместима с существующей надстройкой COM
description: Включить совместимость между надстройки Office и эквивалентной надстройки COM.
ms.date: 03/09/2021
localization_priority: Normal
ms.openlocfilehash: b5235255987cc6a644491bc548b92701b350a179
ms.sourcegitcommit: c0c61fe84f3c5de88bd7eac29120056bb1224fc8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/17/2021
ms.locfileid: "50836856"
---
# <a name="make-your-office-add-in-compatible-with-an-existing-com-add-in"></a>Убедитесь, что надстройка Office совместима с существующей надстройкой COM

Если у вас есть существующая надстройка COM, вы можете создать эквивалентные функции в надстройки Office, что позволит вашему решению работать на других платформах, таких как Office в Интернете или Mac. В некоторых случаях надстройка Office может быть не в состоянии предоставить все функции, доступные в соответствующей надстройки COM. В таких ситуациях надстройка COM может обеспечить более удобное пользовательский интерфейс в Windows, чем может предоставить соответствующая надстройка Office.

Можно настроить надстройку Office таким образом, чтобы, когда эквивалентная надстройка COM уже установлена на компьютере пользователя, Office on Windows запускает надстройку COM вместо надстройки Office. Надстройка COM называется "эквивалентной", так как Office плавно переходит между надстройки COM и надстройки Office, в соответствии с которой устанавливается компьютер пользователя.

> [!NOTE]
> Эта функция поддерживается следующими платформами, подключенными к подписке Microsoft 365.
>
> - Excel, Word и PowerPoint в Интернете
> - Excel, Word и PowerPoint в Windows (версия 1904 или более поздней версии)
> - Excel, Word и PowerPoint на Mac (версия 13.329 или более поздней версии)
> - Outlook для Windows (версия 2102 или более поздней версии)

## <a name="specify-an-equivalent-com-add-in"></a>Укажите эквивалентную надстройка COM

### <a name="manifest"></a>Манифест

> [!IMPORTANT]
> Применяется к Excel, PowerPoint и Word. Поддержка Outlook скоро.

Чтобы обеспечить совместимость надстройки Office и COM, определите эквивалентную [](add-in-manifests.md) надстройка COM в манифесте надстройки Office. Затем Office на Windows будет использовать надстройки COM вместо надстройки Office, если они установлены.

В следующем примере показана часть манифеста, которая указывает надстройки COM в качестве эквивалентной надстройки. Значение элемента определяет надстройку COM, а элемент EquivalentAddins должен быть позиционен непосредственно `ProgId` перед закрывающими [](../reference/manifest/equivalentaddins.md) `VersionOverrides` тегами.

```xml
<VersionOverrides>
  ...
  <EquivalentAddins>
    <EquivalentAddin>
      <ProgId>ContosoCOMAddin</ProgId>
      <Type>COM</Type>
    </EquivalentAddin>
  </EquivalentAddins>
</VersionOverrides>
```

> [!TIP]
> Сведения о совместимости надстройки COM и совместимости XLL UDF см. в ссылке [Make your custom functions compatible with XLL user-defined functions.](../excel/make-custom-functions-compatible-with-xll-udf.md)

### <a name="group-policy"></a>Групповая политика

> [!IMPORTANT]
> Применяется только к Outlook.

Чтобы объявить совместимость между веб-надстройка Outlook и надстройка COM/VSTO, определите эквивалентную надстройку COM в групповой политике Деактивировать веб-надстройки Outlook, эквивалентные надстройке COM или **VSTO,** установленной путем настройки на компьютере пользователя. Затем Outlook на Windows будет использовать надстройки COM вместо веб-надстройки, если они установлены.

1. Скачайте последний [инструмент административных шаблонов,](https://www.microsoft.com/download/details.aspx?id=49030)обращая внимание на инструкции по установке **средства.**
1. Откройте редактор локальной групповой политики **(gpedit.msc).**
1. Перейдите **к административным**  >  **шаблонам**   >  **конфигурации пользователей Microsoft Outlook 2016.**  >  
1. Выберите параметр **Деактивировать веб-надстройки Outlook,** эквивалентные надстройки COM или VSTO.
1. Откройте ссылку для редактирования параметра политики.
1. В диалоговом **диалоговом веб-надстройки Outlook** для отключения:
    1. Установите **имя value** для найденного в манифесте `Id` веб-надстройки. **Важно.** *Не добавляйте* фигурные скобки `{}` вокруг входа.
    1. **Задайте** значение `ProgId` эквивалентной надстройки COM/VSTO.
    1. Выберите **ОК,** чтобы вложить обновление в действие.
    ![Снимок экрана, показывающий диалоговое окно "Отключение веб-надстроек Outlook"](../images/outlook-deactivate-gpo-dialog.png)

## <a name="equivalent-behavior-for-users"></a>Эквивалентное поведение для пользователей

При [указании](#specify-an-equivalent-com-add-in)эквивалентной надстройки COM Office на Windows не будет отображать пользовательский интерфейс вашей надстройки Office(UI), если установлена эквивалентная надстройка COM. Office скрывает только кнопки ленты надстройки Office и не препятствует установке. Поэтому надстройка Office по-прежнему будет отображаться в следующих расположениях в пользовательском интерфейсе:

- В **статье Мои надстройки**
- В качестве записи в диспетчере ленты (только Excel, Word и PowerPoint)

> [!NOTE]
> Указание эквивалентной надстройки COM в манифесте не влияет на другие платформы, такие как Office в Интернете или на Mac.

В следующих сценариях описывается, что происходит в зависимости от того, как пользователь приобретает надстройку Office.

### <a name="appsource-acquisition-of-an-office-add-in"></a>Приобретение AppSource надстройки Office

Если пользователь приобретает надстройки Office из AppSource и эквивалентная надстройка COM уже установлена, То Office будет:

1. Установка надстройки Office.
2. Скрыть пользовательский интерфейс надстройки Office в ленте.
3. Отображение вызова для пользователя, который указывает кнопку ленты надстройки COM.

### <a name="centralized-deployment-of-office-add-in"></a>Централизованное развертывание надстройки Office

Если администратор развертывает надстройку Office для клиента с помощью централизованного развертывания, а эквивалентная надстройка COM уже установлена, пользователь должен перезапустить Office, прежде чем они увидят какие-либо изменения. После перезапуска Office будет:

1. Установка надстройки Office.
2. Скрыть пользовательский интерфейс надстройки Office в ленте.
3. Отображение вызова для пользователя, который указывает кнопку ленты надстройки COM.

### <a name="document-shared-with-embedded-office-add-in"></a>Документ, общий доступ к встроенной надстройки Office

Если у пользователя установлена надстройка COM, а затем он получает общий документ со встроенной надстройки Office, то при открываемом документе Office будет:

1. Запрос пользователя на доверие надстройки Office.
2. При доверии будет устанавливаться надстройка Office.
3. Скрыть пользовательский интерфейс надстройки Office в ленте.

## <a name="other-com-add-in-behavior"></a>Другое поведение надстройки COM

### <a name="excel-powerpoint-word"></a>Excel, PowerPoint, Word

Если пользователь отреставрирует эквивалентную надстройку COM, office on Windows восстанавливает пользовательский интерфейс надстройки Office.

После указания эквивалентной надстройки COM для надстройки Office Office прекращает обработку обновлений для надстройки Office. Чтобы получить последние обновления для надстройки Office, пользователю необходимо сначала удалить надстройку COM.

### <a name="outlook"></a>Outlook

Надстройка COM/VSTO должна быть подключена при работе с Outlook для отключения соответствующей веб-надстройки.

Если надстройка COM/VSTO отключена во время последующего сеанса Outlook, веб-надстройка, скорее всего, будет отключена до перезагрузки Outlook.

## <a name="see-also"></a>См. также

- [Совместите пользовательские функции с определенными функциями пользователя XLL](../excel/make-custom-functions-compatible-with-xll-udf.md)
