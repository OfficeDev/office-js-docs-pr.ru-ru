---
title: Загрузка модели DOM и среды выполнения
description: ''
ms.date: 06/20/2019
localization_priority: Priority
ms.openlocfilehash: 78ddd10e9106e6668e2bb8cd40f58cbdb7b862d9
ms.sourcegitcommit: 382e2735a1295da914f2bfc38883e518070cec61
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/21/2019
ms.locfileid: "35128103"
---
# <a name="loading-the-dom-and-runtime-environment"></a>Загрузка модели DOM и среды выполнения

Перед запуском собственной логики надстройка должна проверить, что загружены модель DOM и среда выполнения Надстройки Office. 

## <a name="startup-of-a-content-or-task-pane-add-in"></a>Запуск контентной надстройки или надстройки области задач

На рисунке ниже приведен поток событий, происходящих при запуске контентной надстройки или надстройки области задач в Excel, PowerPoint, Project, Word или Access.

![Поток событий при запуске контентной надстройки или надстройки области задач](../images/office15-app-sdk-loading-dom-agave-runtime.png)

При запуске контентной надстройки или надстройки области задач возникают указанные ниже события.

1. Пользователь открывает документ, который уже содержит надстройку, или вставляет надстройку в документ.

2. Ведущее приложение Office читает XML-манифест надстройки из AppSource, каталога приложений в SharePoint или каталога общей папки, в зависимости от того, откуда берется надстройка.

3. Ведущее приложение Office открывает HTML-страницу надстройки в элементе управления браузера.

    Следующие два действия, 4 и 5, выполняются одновременно и параллельно. Поэтому код надстройки перед обработкой должен убедиться, что и модель DOM, и среда выполнения надстройки полностью загрузились.

4. Элемент управления браузера загружает модель DOM и основной текст HTML, а также вызывает обработчик для события **window.onload**.

5. Ведущее приложение Office загружает среду выполнения, которая загружает и кэширует API JavaScript для файлов библиотеки JavaScript с сервера сети доставки содержимого, а затем вызывает обработчик события [инициализации](/javascript/api/office#office-initialize) объекта [Office](/javascript/api/office), если ему назначен обработчик. В это время также проверяется, выполнялась ли передача (или связывание) любых обратных вызовов (или связанных функций `then()`) обработчику `Office.onReady`. Дополнительные сведения о различии между `Office.initialize` и `Office.onReady` см. в статье [Инициализация надстройки](/office/dev/add-ins/develop/understanding-the-javascript-api-for-office#initializing-your-add-in).

6. После завершения загрузки DOM и основного текста HTML и инициализации надстройки запускается основная функция надстройки.


## <a name="startup-of-an-outlook-add-in"></a>Запуск надстройки Outlook

На рисунке ниже приведен поток событий при запуске надстройки Outlook на настольном компьютере, планшетном ПК или смартфоне.

![Поток событий при запуске надстройки Outlook](../images/outlook15-loading-dom-agave-runtime.png)

При запуске надстройки Outlook происходят указанные ниже события.

1. При запуске Outlook считывает XML-манифесты надстроек Outlook, установленных для учетной записи пользователя.

2. Пользователь выбирает элемент в Outlook.

3. Если выбранный элемент удовлетворяет условиям активации надстройки Outlook, то Outlook активирует надстройку и делает соответствующую кнопку видимой в пользовательском интерфейсе.

4. Если пользователь нажимает кнопку для запуска надстройки Outlook, то ведущее приложение открывает HTML-страницу в элементе управления браузером. Следующие два шага, шаг 5 и шаг 6, выполняются одновременно.

5. Элемент управления браузером загружает DOM и основной текст HTML и вызывает обработчик события **onload**.

6. Outlook загружает среду выполнения, которая загружает и кэширует API JavaScript для файлов библиотеки JavaScript с сервера сети доставки содержимого, а затем вызывает обработчик события [инициализации](/javascript/api/office#office-initialize) объекта [Office](/javascript/api/office) надстройки, если ему назначен обработчик. В это время также проверяется, выполнялась ли передача (или связывание) любых обратных вызовов (или связанных функций `then()`) обработчику `Office.onReady`. Дополнительные сведения о различии между `Office.initialize` и `Office.onReady` см. в статье [Инициализация надстройки](/office/dev/add-ins/develop/understanding-the-javascript-api-for-office#initializing-your-add-in).

7. После завершения загрузки DOM и основного текста HTML и инициализации надстройки запускается основная функция надстройки.


## <a name="checking-the-load-status"></a>Проверка состояния загрузки

Одним из способов проверки завершения загрузки DOM и среды выполнения надстроек является использование функции [.ready()](https://api.jquery.com/ready/) jQuery — `$(document).ready()`. Например, указанный ниже обработчик событий **onReady** убеждается в полной загрузке DOM, прежде чем выполняется код, относящийся к инициализации надстройки. После этого обработчик **onReady** переходит на использование свойства [mailbox.item](/javascript/api/outlook/office.mailbox) для получения выбранного в настоящий момент элемента Outlook и вызывает основную функцию надстройки `initDialer`.

```js
Office.onReady()
    .then(
        // Checks for the DOM to load.
        $(document).ready(function () {
            // After the DOM is loaded, add-in-specific code can run.
            var mailbox = Office.context.mailbox;
            _Item = mailbox.item;
            initDialer();
        });
);
```

Кроме того, можно использовать такой же код в обработчике событий **инициализации**, как показано в приведенном ниже примере.

```js
Office.initialize = function () {
    // Checks for the DOM to load.
    $(document).ready(function () {
        // After the DOM is loaded, add-in-specific code can run.
        var mailbox = Office.context.mailbox;
        _Item = mailbox.item;
        initDialer();
    });
}
```

Этот же способ можно использовать в обработчиках **инициализации** или **onReady** любой надстройки Office.

В примере надстройки Outlook "Телефон" показан несколько другой подход, использующий только JavaScript для проверки тех же условий. 

> [!IMPORTANT]
> Даже если у надстройки нет задач инициализации, необходимо включить по крайней мере вызов обработчика **Office.onReady** или назначить минимальную функцию обработчика событий **Office.initialize**, как показано в примере ниже.
>
>```js
>Office.onReady();
>```
>
>```js
>Office.initialize = function () {};
>```
>
> Если не вызвать **Office.onReady** или не назначить обработчик событий **Office.initialize**, надстройка может выдать ошибку при запуске. Кроме того, если пользователь попробует использовать надстройку с веб-клиентом Office, например Excel, PowerPoint или Outlook, произойдет сбой.
>
> Если надстройка содержит несколько страниц, каждая загружаемая страница должна вызывать  **Office.onReady** или назначать обработчик событий **Office.initialize**.

## <a name="see-also"></a>См. также

- [Общие сведения об интерфейсе API JavaScript для Office](understanding-the-javascript-api-for-office.md)
