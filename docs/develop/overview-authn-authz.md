---
title: Обзор проверки подлинности и авторизации в надстройках Office
description: Требовать от пользователей аутентификации при входе в веб-приложения и надстройки Office.
ms.date: 07/30/2020
localization_priority: Priority
ms.openlocfilehash: fb4771daacd2e666d57c238b950803a70a3b0fc0
ms.sourcegitcommit: ccc0a86d099ab4f5ef3d482e4ae447c3f9b818a3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "50237695"
---
# <a name="overview-of-authentication-and-authorization-in-office-add-ins"></a><span data-ttu-id="6a761-103">Обзор проверки подлинности и авторизации в надстройках Office</span><span class="sxs-lookup"><span data-stu-id="6a761-103">Overview of authentication and authorization in Office Add-ins</span></span>

<span data-ttu-id="6a761-104">Веб-приложения и, следовательно, надстройки Office по умолчанию поддерживают анонимный доступ, но вы можете требовать проверку подлинности пользователей с помощью входа.</span><span class="sxs-lookup"><span data-stu-id="6a761-104">Web applications and, hence, Office Add-ins allow anonymous access by default, but you can require users to authenticate with a login.</span></span> <span data-ttu-id="6a761-105">Например, вы можете требовать, чтобы пользователи выполняли вход с помощью учетной записи Майкрософт, Microsoft 365 для образования, рабочей учебной записи либо другой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="6a761-105">For example, you can require that your users be logged in with a Microsoft account, a Microsoft 365 Education or work account, or other common account.</span></span> <span data-ttu-id="6a761-106">Эта задача называется проверкой подлинности пользователей, так как она позволяет надстройке определить пользователя.</span><span class="sxs-lookup"><span data-stu-id="6a761-106">This task is called user authentication because it enables the add-in to know who the user is.</span></span>

<span data-ttu-id="6a761-107">Ваша надстройка также может получать согласие пользователя на доступ к данным Microsoft Graph (например, к профилю Microsoft 365, файлам OneDrive и данным SharePoint) или данным в других внешних источниках, таких как Google, Facebook, LinkedIn, SalesForce и GitHub.</span><span class="sxs-lookup"><span data-stu-id="6a761-107">Your add-in can also get the user's consent to access their Microsoft Graph data (such as their Microsoft 365 profile, OneDrive files, and SharePoint data) or to data in other external sources such as Google, Facebook, LinkedIn, SalesForce, and GitHub.</span></span> <span data-ttu-id="6a761-108">Эта задача называется авторизацией надстройки (или приложения), так как выполняется авторизация *надстройки*, а не пользователя.</span><span class="sxs-lookup"><span data-stu-id="6a761-108">This task is called add-in (or app) authorization, because it is the *add-in* that is being authorized, not the user.</span></span>

<span data-ttu-id="6a761-109">Можно выбрать один из двух способов выполнения проверки подлинности и авторизации.</span><span class="sxs-lookup"><span data-stu-id="6a761-109">You have a choice of two ways to accomplish authentication and authorization.</span></span>

- <span data-ttu-id="6a761-110">**Единый вход (SSO) Office** — система, позволяющая использовать вход пользователя в Office в качестве входа в надстройку.</span><span class="sxs-lookup"><span data-stu-id="6a761-110">**Office Single Sign-on (SSO)**: A system that enables the user's login to Office to also function as a login to the add-in.</span></span> <span data-ttu-id="6a761-111">При необходимости надстройка также может использовать учетные данные пользователя Office для своей авторизации в Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="6a761-111">Optionally, the add-in can also use the user's Office credentials to authorize the add-in to Microsoft Graph.</span></span> <span data-ttu-id="6a761-112">(Источники, отличные от Майкрософт, не поддерживаются в этой системе.)</span><span class="sxs-lookup"><span data-stu-id="6a761-112">(Non-Microsoft sources are not accessible through this system.)</span></span>
- <span data-ttu-id="6a761-113">**Проверка подлинности и авторизация веб-приложения с помощью Azure Active Directory**. Это не новое решение,</span><span class="sxs-lookup"><span data-stu-id="6a761-113">**Web Application Authentication and Authorization with Azure Active Directory**: This isn't something new or special.</span></span> <span data-ttu-id="6a761-114">а просто способ, которым надстройки Office (и другие веб-приложения) проверяли подлинность пользователей и авторизовали приложения до появления системы единого входа Office. Он по-прежнему используется в сценариях, не поддерживающих единый вход.</span><span class="sxs-lookup"><span data-stu-id="6a761-114">It's just the way Office Add-ins (and other web apps) authenticated users and authorized apps before there was an Office SSO system, and it is still used in scenarios where Office SSO cannot be.</span></span> <span data-ttu-id="6a761-115">Кроме того, существуют сценарии, в которых вам может требоваться отдельный вход пользователей в вашу надстройку даже при доступности единого входа. Например, если вы хотите, чтобы у них была возможность входа в надстройку с помощью другого идентификатора, отличающегося от текущего входа в Office.</span><span class="sxs-lookup"><span data-stu-id="6a761-115">Also, there are scenarios in which you want to have your users log in to your add-in separately even when SSO is available; for example, if you want them to have the option of logging in to the add-in with a different ID from the one with which they are currently logged in to Office.</span></span>

<span data-ttu-id="6a761-116">На следующей блок-схеме показаны решения, которые нужно принять разработчику надстройки.</span><span class="sxs-lookup"><span data-stu-id="6a761-116">The following flowchart shows you the decisions that you need to make as an add-in developer.</span></span> <span data-ttu-id="6a761-117">Подробные сведения см. далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="6a761-117">Details are later in this article.</span></span>

![Изображение с блок-схемой решений для включения проверки подлинности и авторизации в надстройках Office](../images/authflowchart.png)

## <a name="user-authentication-without-sso"></a><span data-ttu-id="6a761-119">Проверка подлинности пользователей без единого входа</span><span class="sxs-lookup"><span data-stu-id="6a761-119">User authentication without SSO</span></span>

<span data-ttu-id="6a761-120">Вы можете проверить подлинность пользователя в надстройке Office с помощью Azure Active Directory (AAD) как в любом другом веб-приложении с одним исключением: служба AAD не разрешает открывать свою страницу входа в элементе iframe.</span><span class="sxs-lookup"><span data-stu-id="6a761-120">You can authenticate a user in an Office Add-in with Azure Active Directory (AAD) as you would in other web applications with one exception: AAD does not allow its login page to open in an iframe.</span></span> <span data-ttu-id="6a761-121">При работе с надстройкой Office в *Office в Интернете* область задач является элементом iframe.</span><span class="sxs-lookup"><span data-stu-id="6a761-121">When an Office Add-in is running on *Office on the web*, the task pane is an iframe.</span></span> <span data-ttu-id="6a761-122">Это означает, что вам потребуется открыть экран входа в AAD в диалоговом окне, вызванном с помощью Dialog API для Office.</span><span class="sxs-lookup"><span data-stu-id="6a761-122">This means that you'll need to open the AAD login screen in a dialog box opened with the Office dialog API.</span></span> <span data-ttu-id="6a761-123">Это влияет на способ использования библиотек помощника проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="6a761-123">This affects how you use authentication helper libraries.</span></span> <span data-ttu-id="6a761-124">Дополнительные сведения см. в статье [Проверка подлинности с помощью Dialog API для Office](auth-with-office-dialog-api.md).</span><span class="sxs-lookup"><span data-stu-id="6a761-124">For more information, see [Authentication with the Office dialog API](auth-with-office-dialog-api.md).</span></span>

<span data-ttu-id="6a761-125">Сведения о программной проверке подлинности с помощью AAD см. в статье [Общие сведения о платформе удостоверений Майкрософт (версии 2.0)](/azure/active-directory/develop/v2-overview), где вы найдете множество учебников и руководств, а также ссылки на соответствующие примеры и библиотеки.</span><span class="sxs-lookup"><span data-stu-id="6a761-125">For information about programming authentication with AAD, begin with [Microsoft identity platform (v2.0) overview](/azure/active-directory/develop/v2-overview) where you'll find many tutorials and guides, as well as links to relevant samples and libraries.</span></span> <span data-ttu-id="6a761-126">Как описано в статье [Проверка подлинности с помощью Dialog API для Office](auth-with-office-dialog-api.md), вам может потребоваться изменить код из примеров, чтобы запустить его в диалоговом окне Office.</span><span class="sxs-lookup"><span data-stu-id="6a761-126">As explained in [Authentication with the Office dialog API](auth-with-office-dialog-api.md), you may need to adjust the code in the samples to run in the Office dialog box.</span></span>

## <a name="access-to-microsoft-graph-without-sso"></a><span data-ttu-id="6a761-127">Доступ к Microsoft Graph без единого входа</span><span class="sxs-lookup"><span data-stu-id="6a761-127">Access to Microsoft Graph without SSO</span></span>

<span data-ttu-id="6a761-128">Вы можете получить для надстройки разрешение на доступ к данным Microsoft Graph, получив маркер доступа к Graph из Azure Active Directory (AAD).</span><span class="sxs-lookup"><span data-stu-id="6a761-128">You can get authorization to Microsoft Graph data for your add-in by obtaining an access token to Graph from Azure Active Directory (AAD).</span></span> <span data-ttu-id="6a761-129">Это можно сделать без использования единого входа Office.</span><span class="sxs-lookup"><span data-stu-id="6a761-129">You can do this without relying on Office SSO.</span></span> <span data-ttu-id="6a761-130">Дополнительные сведения об этом см. в статье [Доступ к Microsoft Graph без единого входа](authorize-to-microsoft-graph-without-sso.md), содержащей подробности и ссылки на примеры.</span><span class="sxs-lookup"><span data-stu-id="6a761-130">For more information about how, see [Access to Microsoft Graph without SSO](authorize-to-microsoft-graph-without-sso.md) which has more details and links to samples.</span></span>

## <a name="user-authentication-with-sso"></a><span data-ttu-id="6a761-131">Проверка подлинности пользователей с помощью единого входа</span><span class="sxs-lookup"><span data-stu-id="6a761-131">User authentication with SSO</span></span>

<span data-ttu-id="6a761-132">Для проверки подлинности пользователей с помощью единого входа код в области задач или файл функции вызывает метод [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span><span class="sxs-lookup"><span data-stu-id="6a761-132">To authenticate the user using SSO, your code in a task pane or function file calls the [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-) method.</span></span> <span data-ttu-id="6a761-133">Если пользователь не выполнил вход, Office откроет диалоговое окно и перейдет к странице входа в Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="6a761-133">If the user is not signed in, Office will open a dialog box and navigate to the Azure Active Directory login page.</span></span> <span data-ttu-id="6a761-134">После входа пользователя метод возвращает маркер доступа,</span><span class="sxs-lookup"><span data-stu-id="6a761-134">After the user signs in, or if the user is already signed in, the method returns an access token.</span></span> <span data-ttu-id="6a761-135">являющийся маркером начальной загрузки в потоке **От имени**.</span><span class="sxs-lookup"><span data-stu-id="6a761-135">The token is a bootstrap token in the **On Behalf Of** flow.</span></span> <span data-ttu-id="6a761-136">(См. раздел [Доступ к Microsoft Graph с помощью единого входа](#access-to-microsoft-graph-with-sso).) Однако его также можно использовать в качестве маркера идентификации, так как он содержит несколько утверждений, уникальных для текущего пользователя, включая `preferred_username`, `name`, `sub` и `oid`.</span><span class="sxs-lookup"><span data-stu-id="6a761-136">(See [Access to Microsoft Graph with SSO](#access-to-microsoft-graph-with-sso).) However, it can be used as an ID token as well, because it contains several claims that are unique to the current user, including `preferred_username`, `name`, `sub`, and `oid`.</span></span> <span data-ttu-id="6a761-137">Инструкции о том, какое свойство использовать в качестве конечного идентификатора пользователя, см. в статье [Маркеры доступа платформы удостоверений Майкрософт](/azure/active-directory/develop/access-tokens#payload-claims).</span><span class="sxs-lookup"><span data-stu-id="6a761-137">For guidance on which property to use as the ultimate user ID, see [Microsoft identity platform access tokens](/azure/active-directory/develop/access-tokens#payload-claims).</span></span> <span data-ttu-id="6a761-138">Пример одного из этих маркеров см. в статье с [примером маркера доступа](sso-in-office-add-ins.md#example-access-token).</span><span class="sxs-lookup"><span data-stu-id="6a761-138">For an example of a one of these tokens, see [Example access token](sso-in-office-add-ins.md#example-access-token).</span></span>

<span data-ttu-id="6a761-139">После извлечения кодом нужного утверждения из маркера он использует это значение для поиска пользователя в таблице пользователей или вашей базе данных пользователей.</span><span class="sxs-lookup"><span data-stu-id="6a761-139">After your code has extracted the desired claim from the token, it uses that value to look up the user in a user table or user database that you maintain.</span></span> <span data-ttu-id="6a761-140">Используйте базу данных для хранения сведений, относящихся к пользователям, например параметров пользователя или состояния учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="6a761-140">Use the database to store user-relative information such as the user's preferences or the state of the user's account.</span></span> <span data-ttu-id="6a761-141">Так как вы используете единый вход, пользователи не входят отдельно в вашу надстройку, поэтому вам не нужно хранить пароли для пользователей.</span><span class="sxs-lookup"><span data-stu-id="6a761-141">Since you are using SSO, your users don't sign-in separately to your add-in, so you do not need to store a password for the user.</span></span>

<span data-ttu-id="6a761-142">Перед началом внедрения проверки подлинности пользователей с помощью единого входа внимательно ознакомьтесь со статьей [Включение единого входа для надстроек Office](sso-in-office-add-ins.md). Также обратите внимание на следующие примеры:</span><span class="sxs-lookup"><span data-stu-id="6a761-142">Before you begin implementing user authentication with SSO, be sure that you are thoroughly familiar with the article [Enable single sign-on for Office Add-ins](sso-in-office-add-ins.md). Note also these samples:</span></span>

- <span data-ttu-id="6a761-143">[Единый вход с использованием NodeJS для надстройки Office](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO), особенно на файл [ssoAuthES6.js](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Complete/public/javascripts/ssoAuthES6.js).</span><span class="sxs-lookup"><span data-stu-id="6a761-143">[Office Add-in NodeJS SSO](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO), especially the file [ssoAuthES6.js](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Complete/public/javascripts/ssoAuthES6.js).</span></span>
- <span data-ttu-id="6a761-144">[Единый вход с использованием ASP.NET для надстройки Office](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO).</span><span class="sxs-lookup"><span data-stu-id="6a761-144">[Office Add-in ASP.NET SSO](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO).</span></span>

<span data-ttu-id="6a761-145">Однако в этих примерах маркер не используется в качестве маркера идентификации.</span><span class="sxs-lookup"><span data-stu-id="6a761-145">These samples, however, do not use the token as an ID token.</span></span> <span data-ttu-id="6a761-146">Он используется для получения доступа к Microsoft Graph с потоком **от имени**.</span><span class="sxs-lookup"><span data-stu-id="6a761-146">They use it to get access to Microsoft Graph with the **On Behalf Of** flow.</span></span>

## <a name="access-to-microsoft-graph-with-sso"></a><span data-ttu-id="6a761-147">Доступ к Microsoft Graph с помощью единого входа</span><span class="sxs-lookup"><span data-stu-id="6a761-147">Access to Microsoft Graph with SSO</span></span>

<span data-ttu-id="6a761-148">Чтобы использовать единый вход для получения доступа к Microsoft Graph, ваша надстройка в области задач или файл функции вызывает метод [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span><span class="sxs-lookup"><span data-stu-id="6a761-148">To use SSO to access Microsoft Graph, your add-in in a task pane or function file calls the [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-) method.</span></span> <span data-ttu-id="6a761-149">Если пользователь не выполнил вход, Office откроет диалоговое окно и перейдет к странице входа в Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="6a761-149">If the user is not signed in, Office will open a dialog box and navigate it to the Azure Active Directory login page.</span></span> <span data-ttu-id="6a761-150">После входа пользователя метод возвращает маркер доступа,</span><span class="sxs-lookup"><span data-stu-id="6a761-150">After the user signs in, or if the user is already signed in, the method returns an access token.</span></span> <span data-ttu-id="6a761-151">являющийся маркером начальной загрузки в потоке **От имени**.</span><span class="sxs-lookup"><span data-stu-id="6a761-151">The token is a bootstrap token in the **On Behalf Of** flow.</span></span> <span data-ttu-id="6a761-152">В частности он содержит утверждение `scope` со значением `access_as_user`.</span><span class="sxs-lookup"><span data-stu-id="6a761-152">Specifically, it has a `scope` claim with the value `access_as_user`.</span></span> <span data-ttu-id="6a761-153">Руководство по утверждениям в маркере см. в статье [Маркеры доступа платформы удостоверений Майкрософт](/azure/active-directory/develop/access-tokens#payload-claims).</span><span class="sxs-lookup"><span data-stu-id="6a761-153">For guidance about the claims in the token, see [Microsoft identity platform access tokens](/azure/active-directory/develop/access-tokens#payload-claims).</span></span> <span data-ttu-id="6a761-154">Пример одного из этих маркеров см. в статье с [примером маркера доступа](sso-in-office-add-ins.md#example-access-token).</span><span class="sxs-lookup"><span data-stu-id="6a761-154">For an example of a one of these tokens, see [Example access token](sso-in-office-add-ins.md#example-access-token).</span></span>

<span data-ttu-id="6a761-155">После получения маркера кодом он используется в потоке **От имени**, чтобы получить второй маркер: маркер доступа к Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="6a761-155">After your code obtains the token, it uses it in the **On Behalf Of** flow to obtain a second token: an access token to Microsoft Graph.</span></span>

<span data-ttu-id="6a761-156">Перед началом внедрения единого входа Office внимательно ознакомьтесь со следующими двумя статьями:</span><span class="sxs-lookup"><span data-stu-id="6a761-156">Before you begin implementing Office SSO, be sure that you are thoroughly familiar with these two articles:</span></span>

- [<span data-ttu-id="6a761-157">Включение единого входа для надстроек Office</span><span class="sxs-lookup"><span data-stu-id="6a761-157">Enable single sign-on for Office Add-ins</span></span>](sso-in-office-add-ins.md)
- [<span data-ttu-id="6a761-158">Авторизация в Microsoft Graph с помощью единого входа</span><span class="sxs-lookup"><span data-stu-id="6a761-158">Authorize to Microsoft Graph with SSO</span></span>](authorize-to-microsoft-graph.md)

<span data-ttu-id="6a761-159">Вам также следует ознакомиться хотя бы с одним руководством, указанным здесь.</span><span class="sxs-lookup"><span data-stu-id="6a761-159">You should also read at least one of the walkthrough articles listed here.</span></span> <span data-ttu-id="6a761-160">Даже если вы не выполняете описанные действия, они содержат важную информацию о реализации единого входа Office и потока **От имени**.</span><span class="sxs-lookup"><span data-stu-id="6a761-160">Even if you don't carry out the steps, these contain valuable information about how you implement Office SSO and the **On Behalf Of** flow.</span></span> 

- [<span data-ttu-id="6a761-161">Создание надстройки Office на платформе ASP.NET с использованием единого входа</span><span class="sxs-lookup"><span data-stu-id="6a761-161">Create an ASP.NET Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-aspnet.md)
- [<span data-ttu-id="6a761-162">Создание надстройки Office на платформе Node.js с использованием единого входа</span><span class="sxs-lookup"><span data-stu-id="6a761-162">Create an Node.js Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-nodejs.md)

<span data-ttu-id="6a761-163">Также обратите внимание на следующие примеры:</span><span class="sxs-lookup"><span data-stu-id="6a761-163">Note also these samples:</span></span>

- [<span data-ttu-id="6a761-164">Единый вход с использованием NodeJS для надстройки Office</span><span class="sxs-lookup"><span data-stu-id="6a761-164">Office Add-in NodeJS SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO)
- [<span data-ttu-id="6a761-165">Единый вход с использованием ASP.NET для надстройки Office</span><span class="sxs-lookup"><span data-stu-id="6a761-165">Office Add-in ASP.NET SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO)

## <a name="access-to-non-microsoft-data-sources"></a><span data-ttu-id="6a761-166">Доступ к сторонним источникам данных (отличным от Майкрософт)</span><span class="sxs-lookup"><span data-stu-id="6a761-166">Access to non-Microsoft data sources</span></span>

<span data-ttu-id="6a761-167">С помощью популярных веб-служб, в том числе Google, Facebook, LinkedIn, SalesForce и GitHub, разработчики могут предоставлять пользователям доступ к их учетным записям в других приложениях.</span><span class="sxs-lookup"><span data-stu-id="6a761-167">Popular online services, including Google, Facebook, LinkedIn, SalesForce, and GitHub, let developers give users access to their accounts in other applications.</span></span> <span data-ttu-id="6a761-168">Благодаря этому вы можете включать эти службы в свои надстройки Office.</span><span class="sxs-lookup"><span data-stu-id="6a761-168">This gives you the ability to include these services in your Office Add-in.</span></span> <span data-ttu-id="6a761-169">Обзор способов, доступных вашей надстройке для выполнения этих действий, см. в статье [Авторизация внешних служб в надстройке Office](auth-external-add-ins.md).</span><span class="sxs-lookup"><span data-stu-id="6a761-169">For an overview of the ways that your add-in can do this, see [Authorize external services in your Office Add-in](auth-external-add-ins.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6a761-170">Перед началом создания кода выясните, позволяет ли источник данных экрану входа открываться в элементе iframe.</span><span class="sxs-lookup"><span data-stu-id="6a761-170">Before you begin coding, find out if the data source allows its login in screen to open in an iframe.</span></span> <span data-ttu-id="6a761-171">При работе с надстройкой Office в *Office в Интернете* область задач является элементом iframe.</span><span class="sxs-lookup"><span data-stu-id="6a761-171">When an Office Add-in is running on *Office on the web*, the task pane is an iframe.</span></span> <span data-ttu-id="6a761-172">Если источник данных не позволяет экрану входа открываться в элементе iframe, вам потребуется открыть экран входа в диалоговом окне, вызываемом с помощью Dialog API для Office.</span><span class="sxs-lookup"><span data-stu-id="6a761-172">If the data source does not allow its login screen to open in an iframe, then you'll need to open the login screen in a dialog box opened with the Office dialog API.</span></span> <span data-ttu-id="6a761-173">Дополнительные сведения см. в статье [Проверка подлинности с помощью Dialog API для Office](auth-with-office-dialog-api.md).</span><span class="sxs-lookup"><span data-stu-id="6a761-173">For more information, see [Authentication with the Office dialog API](auth-with-office-dialog-api.md).</span></span>