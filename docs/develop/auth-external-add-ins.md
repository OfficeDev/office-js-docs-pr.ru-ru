---
title: Авторизация внешних служб в надстройке Office
description: ''
ms.date: 12/04/2017
ms.openlocfilehash: 12f6f80b1679eeec8aec569b534aca074610e929
ms.sourcegitcommit: 4de2a1b62ccaa8e51982e95537fc9f52c0c5e687
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/10/2018
ms.locfileid: "22925292"
---
# <a name="authorize-external-services-in-your-office-add-in"></a><span data-ttu-id="1b5d8-102">Авторизация внешних служб в надстройке Office</span><span class="sxs-lookup"><span data-stu-id="1b5d8-102">Authorize external services in your Office Add-in</span></span>

<span data-ttu-id="1b5d8-p101">С помощью популярных веб-служб, в том числе Office 365, Google, Facebook, LinkedIn, SalesForce и GitHub, разработчики могут предоставлять пользователям доступ к их учетным записям в других приложениях. Благодаря этому вы можете включать эти службы в свои надстройки Office.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p101">Popular online services, including Office 365, Google, Facebook, LinkedIn, SalesForce, and GitHub, let developers give users access to their accounts in other applications. This gives you the ability to include these services in your Office Add-in.</span></span>

<span data-ttu-id="1b5d8-p102">Стандартная платформа, позволяющая обеспечить доступ веб-приложения к веб-службе, — **OAuth 2.0**. В большинстве ситуаций не обязательно знать абсолютно все о работе платформы, чтобы использовать ее в своей надстройке. Доступно множество библиотек, упрощающих работу с платформой.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p102">The industry standard framework for enabling web application access to an online service is **OAuth 2.0**. In most situations, you don't need to know the details of how the framework works to use it in your add-in. Many libraries are available that simplify the details for you.</span></span>

<span data-ttu-id="1b5d8-p103">Основной принцип работы OAuth заключается в том, что приложение может быть субъектом безопасности для самого себя (как пользователь или группа) и использовать собственное удостоверение и набор разрешений. В большинстве типичных сценариев, когда пользователь выполняет действие в надстройке Office, требующее вовлечения веб-службы, надстройка отправляет службе запрос на получение определенного набора разрешений для учетной записи пользователя. Затем служба предлагает пользователю предоставить надстройке эти разрешения. После предоставления разрешений служба отправляет надстройке небольшой зашифрованный *маркер доступа*. Надстройка может использовать службу, включая этот маркер во все свои запросы к API-интерфейсам службы. Но надстройка может действовать только в рамках разрешений, предоставленных ей пользователем. Кроме того, срок действия маркера ограничен указанным периодом времени.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p103">A fundamental idea of OAuth is that an application can be a security principal unto itself, just like a user or a group, with its own identity and set of permissions. In the most typical scenarios, when the user takes an action in the Office add-in that requires the online service, the add-in sends the service a request for a specific set of permissions to the user's account. The service then prompts the user to grant the add-in those permissions. After the permissions are granted, the service sends the add-in a small encoded *access token*. The add-in can use the service by including the token in all its requests to the service's APIs. But the add-in can act only within the permissions that the user granted it. The token also expires after a specified time.</span></span>

<span data-ttu-id="1b5d8-115">Разные шаблоны OAuth (*потоки* или *типы предоставления*) предназначены для разных сценариев.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-115">Several OAuth patterns, called *flows* or *grant types*, are designed for different scenarios.</span></span> <span data-ttu-id="1b5d8-116">Наиболее часто используются следующие два шаблона:</span><span class="sxs-lookup"><span data-stu-id="1b5d8-116">The following two patterns are the most commonly implemented:</span></span>

- <span data-ttu-id="1b5d8-117">**Неявный поток.** Обмен данными между надстройкой и веб-службой реализуется с помощью JavaScript на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-117">**Implicit flow**: Communication between the add-in and the online service is implemented with client-side JavaScript.</span></span>
- <span data-ttu-id="1b5d8-p105">**Поток кода авторизации.** Используется подключение типа *сервер-сервер* между веб-приложением надстройки и веб-службой. Следовательно, она реализуется с помощью серверного кода.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p105">**Authorization Code flow**: Communication is *server-to-server* between your add-in's web application and the online service. So, it is implemented with server-side code.</span></span>

<span data-ttu-id="1b5d8-p106">Поток OAuth предназначен для защиты удостоверения и авторизации приложения. В потоке кода авторизации вам предоставляется *секрет клиента*, который необходимо держать в тайне. Одностраничное приложение (SPA) не может защитить секрет, поэтому рекомендуем использовать в таких приложениях неявный поток.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p106">The purpose of an OAuth flow is to secure the identity and authorization of the application. In the Authorization Code flow, you're provided a *client secret* that needs to be kept hidden. A Single Page Application (SPA) has no way to protect the secret, so we recommend that you use the Implicit flow in SPAs.</span></span>

<span data-ttu-id="1b5d8-123">Дополнительные сведения о преимуществах и недостатках потока кода авторизации и неявного потока</span><span class="sxs-lookup"><span data-stu-id="1b5d8-123">You should be familiar with the pros and cons of the Implicit flow and the Authorization Code flow.</span></span> <span data-ttu-id="1b5d8-124">см. в разделах [Код авторизации](https://tools.ietf.org/html/rfc6749#section-1.3.1) и [Неявный поток](https://tools.ietf.org/html/rfc6749#section-1.3.2).</span><span class="sxs-lookup"><span data-stu-id="1b5d8-124">For more infomation about these two flows, see [Authorization Code](https://tools.ietf.org/html/rfc6749#section-1.3.1) and [Implicit](https://tools.ietf.org/html/rfc6749#section-1.3.2).</span></span>

> [!NOTE]
> <span data-ttu-id="1b5d8-125">Вы также можете использовать службу-посредник, которая будет выполнять авторизацию и передавать маркер доступа надстройке.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-125">You also have the option of using a middleman service to perform authorization and pass the access token to your add-in.</span></span> <span data-ttu-id="1b5d8-126">Подробная информация об этом сценарии приведена в разделе **Службы-посредники** далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-126">For details about this scenario, see the **Middleman services** section later in this article.</span></span>

## <a name="authorization-to-microsoft-graph"></a><span data-ttu-id="1b5d8-127">Авторизация в Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="1b5d8-127">Authorization to Microsoft Graph</span></span>

<span data-ttu-id="1b5d8-128">Если через Microsoft Graph доступна внешняя служба (Office 365 или OneDrive), вы можете обеспечить максимальное удобство работы пользователей и облегчить свой процесс разработки за счет системы единого входа, описанной в статье [Авторизованный доступ в Microsoft Graph из вашей надстройки Office](authorize-to-microsoft-graph.md) и связанных с ней статьях.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-128">If the external service is accessible through Microsoft Graph, such as Office 365 or OneDrive, then you can provide the best experience for your users, and the easiest development experience for yourself, by using the single sign-on system described at [Enable single sign-on for Office Add-ins](authorize-to-microsoft-graph.md) and its related articles.</span></span> <span data-ttu-id="1b5d8-129">Способы, описанные в этой статье, лучше всего использовать для внешних служб, недоступных через Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-129">The techniques described in this article are best used for external services that are not accessible with Microsoft Graph.</span></span> <span data-ttu-id="1b5d8-130">Однако их *можно* использовать для доступа к Microsoft Graph вместо системы единого входа.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-130">However, they *can* be used to access Microsoft Graph, and you might prefer them to the advantages of single sign-on.</span></span> <span data-ttu-id="1b5d8-131">Например, для системы единого входа требуется серверный код, поэтому ее нельзя использовать с одностраничным приложением.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-131">For example, the single sign-on system requires server-side code, so it cannot be used with a true single page app.</span></span> <span data-ttu-id="1b5d8-132">Кроме того, система единого входа пока поддерживается не на всех платформах.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-132">Also, the single sign-on system is not yet supported on all platforms.</span></span>

## <a name="using-the-implicit-flow-in-office-add-ins"></a><span data-ttu-id="1b5d8-133">Использование неявного потока в надстройках Office</span><span class="sxs-lookup"><span data-stu-id="1b5d8-133">Using the Implicit flow in Office Add-ins</span></span>
<span data-ttu-id="1b5d8-134">Узнать, поддерживает ли веб-служба неявный поток, можно из документации к ней.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-134">The best way to find out if an online service supports the Implicit flow is to consult the service's documentation.</span></span> <span data-ttu-id="1b5d8-135">Если служба поддерживает неявный поток, можете использовать библиотеку JavaScript **Office-js-helpers** для автоматизации работы:</span><span class="sxs-lookup"><span data-stu-id="1b5d8-135">For services that support the Implicit flow, you can use the **Office-js-helpers** JavaScript library to do all the detailed work for you:</span></span>

- [<span data-ttu-id="1b5d8-136">Office-js-helpers</span><span class="sxs-lookup"><span data-stu-id="1b5d8-136">Office-js-helpers</span></span>](https://github.com/OfficeDev/office-js-helpers)

<span data-ttu-id="1b5d8-137">Сведения о других библиотек, которые поддерживают неявный поток, см. в разделе **Библиотеки** далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-137">For information about other libraries that support the Implicit flow, see the **Libraries** section later in this article.</span></span>

## <a name="using-the-authorization-code-flow-in-office-add-ins"></a><span data-ttu-id="1b5d8-138">Использование потока кода авторизации в надстройках Office</span><span class="sxs-lookup"><span data-stu-id="1b5d8-138">Using the Authorization Code flow in Office Add-ins</span></span>

<span data-ttu-id="1b5d8-p111">Доступно множество библиотек, позволяющих реализовать поток кода авторизации на различных языках и платформах. Дополнительные сведения о некоторых из этих библиотек см. в разделе **Библиотеки** далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p111">Many libraries are available for implementing the Authorization Code flow in various languages and frameworks. For more information about some of these libraries, see the **Libraries** section later in this article.</span></span>

<span data-ttu-id="1b5d8-141">Примеры надстроек, использующих поток кода авторизации:</span><span class="sxs-lookup"><span data-stu-id="1b5d8-141">The following samples provide examples of add-ins that implement the Authorization Code flow:</span></span>

- <span data-ttu-id="1b5d8-142">[Office-Add-in-Nodejs-ServerAuth](https://github.com/OfficeDev/Office-Add-in-Nodejs-ServerAuth) (NodeJS)</span><span class="sxs-lookup"><span data-stu-id="1b5d8-142">[Office-Add-in-Nodejs-ServerAuth](https://github.com/OfficeDev/Office-Add-in-Nodejs-ServerAuth) (NodeJS)</span></span>
- <span data-ttu-id="1b5d8-143">[PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart) (ASP.NET MVC)</span><span class="sxs-lookup"><span data-stu-id="1b5d8-143">[PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart) (ASP.NET MVC)</span></span>

### <a name="relayproxy-functions"></a><span data-ttu-id="1b5d8-144">Функции ретрансляции и проксирования</span><span class="sxs-lookup"><span data-stu-id="1b5d8-144">Relay/Proxy functions</span></span>

<span data-ttu-id="1b5d8-p112">Вы можете использовать поток кода авторизации даже с веб-приложением без сервера. Для этого необходимо сохранить **идентификатор** и **секрет клиента** в простой функции, размещенной в такой службе, как [Функции Azure](https://azure.microsoft.com/services/functions) или [Amazon Lambda](https://aws.amazon.com/lambda). Функция обменивает полученный код на **маркер доступа** и ретранслирует его обратно клиенту. Безопасность этого подхода зависит от того, как защищен доступ к функции.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p112">You can use the Authorization Code flow even with a serverless web application by storing the **client ID** and **client secret** values in a simple function that is hosted in a service such as [Azure Functions](https://azure.microsoft.com/services/functions) or [Amazon Lambda](https://aws.amazon.com/lambda). The function exchanges a given code for an **access token** and relays it back to the client. The security of this approach depends on how well access to the function is guarded.</span></span>

<span data-ttu-id="1b5d8-p113">Для использования такого подхода надстройка выводит пользовательский интерфейс или всплывающее окно с экраном входа в веб-службу (например, Google или Facebook). Когда пользователь выполнит вход и предоставит надстройке разрешение на доступ к своим ресурсам в веб-службе, надстройка получит код, который затем можно отправить веб-функции. Службы, описанные в разделе **Службы-посредники** далее в этой статье, используют поток, подобный этому.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p113">To use this technique, your add-in displays a UI/popup to show the login screen for the online service (Google, Facebook, and so on). When the user signs in and grants the add-in permission to her resources in the online service, the add-in receives a code which can be then sent to the online function. The services described in the **Middleman services** section later in this article use a similar flow.</span></span>

## <a name="libraries"></a><span data-ttu-id="1b5d8-151">Библиотеки</span><span class="sxs-lookup"><span data-stu-id="1b5d8-151">Libraries</span></span>

<span data-ttu-id="1b5d8-152">Библиотеки доступны для многих языков и платформ, как для неявного потока, так и для потока кода авторизации.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-152">Libraries are available for many languages and platforms, for both the Implicit flow and the Authorization Code flow.</span></span> <span data-ttu-id="1b5d8-153">Одни из них универсальны, а другие предназначены для определенных веб-служб.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-153">Some libraries are general purpose, while others are for specific online services.</span></span>

<span data-ttu-id="1b5d8-p115">Библиотеки для **Office 365 и других служб, использующих Azure Active Directory в качестве поставщика авторизации,** указаны в статье [Библиотеки проверки подлинности Azure Active Directory](https://azure.microsoft.com/documentation/articles/active-directory-authentication-libraries/). Кроме того, доступна предварительная версия [библиотеки проверки подлинности (Майкрософт)](https://www.nuget.org/packages/Microsoft.Identity.Client).</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p115">**Office 365 and other services that use Azure Active Directory as the authorization provider**: [Azure Active Directory Authentication Libraries](https://azure.microsoft.com/documentation/articles/active-directory-authentication-libraries/). A preview is also available for the [Microsoft Authentication Library](https://www.nuget.org/packages/Microsoft.Identity.Client).</span></span>

<span data-ttu-id="1b5d8-p116">Если вы используете **Google**, выполните на странице [GitHub.com/Google](https://github.com/google) поиск по запросу "auth" или названию языка. Имена почти всех соответствующих репозиториев представлены в формате `google-auth-library-[name of language]`.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p116">**Google**: Search [GitHub.com/Google](https://github.com/google) for "auth" or the name of your language. Most of the relevant repos are named `google-auth-library-[name of language]`.</span></span>

<span data-ttu-id="1b5d8-158">Если вы используете **Facebook**, выполните на сайте [Facebook для разработчиков](https://developers.facebook.com) поиск по запросу "library" или "sdk".</span><span class="sxs-lookup"><span data-stu-id="1b5d8-158">**Facebook**: Search [Facebook for Developers](https://developers.facebook.com) for "library" or "sdk".</span></span>

<span data-ttu-id="1b5d8-p117">Если вы ищете **общие библиотеки OAuth 2.0**, откройте страницу [Код OAuth](http://oauth.net/code/), которую обновляет рабочая группа IETF по OAuth. Эта страница содержит ссылки на библиотеки, рассчитанные на более десятка языков. Обратите внимание, что некоторые из этих библиотек предназначены для реализации службы, поддерживающей OAuth. На этой странице библиотеки, представляющие интерес для разработчиков надстроек, называются *клиентскими* библиотеками, так как веб-сервер является клиентом службы, поддерживающей OAuth.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p117">**General OAuth 2.0**: A page of links to libraries for over a dozen languages is maintained by the IETF OAuth Working Group at: [OAuth Code](http://oauth.net/code/). Note that some of these libraries are for implementing an OAuth compliant service. The libraries of interest to you as a an add-in developer are called *client* libraries on this page because your web server is a client of the OAuth compliant service.</span></span>

## <a name="middleman-services"></a><span data-ttu-id="1b5d8-162">Службы-посредники</span><span class="sxs-lookup"><span data-stu-id="1b5d8-162">Middleman services</span></span>

<span data-ttu-id="1b5d8-p118">Вы также можете использовать для авторизации службу-посредник, например OAuth.io или Auth0. Служба-посредник может либо предоставлять маркеры доступа для популярных веб-служб, либо упрощать процесс входа в надстройку через социальные сети. Используя минимум кода, надстройка может подключаться к службе-посреднику с помощью клиентского или серверного кода и отправлять надстройке все необходимые токены для веб-службы. Весь код, реализующий авторизацию, находится в службе-посреднике.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p118">Your add-in can use a middleman service such as OAuth.io or Auth0 to perform authorization. A middleman service may either provide access tokens for popular online services or simplify the process of enabling social login for your add-in, or both. With very little code, your add-in can use either client-side script or server-side code to connect to the middleman service and it will send your add-in any required tokens for the online service. All of the authorization implementation code is in the middleman service.</span></span>

<span data-ttu-id="1b5d8-167">Примеры надстроек, использующих для авторизации службу-посредника:</span><span class="sxs-lookup"><span data-stu-id="1b5d8-167">For examples of add-ins that use a middleman service for authorization, see the following samples:</span></span>

- <span data-ttu-id="1b5d8-168">[Office-Add-in-Auth0](https://github.com/OfficeDev/Office-Add-in-Auth0) использует Auth0 для входа через Facebook, Google и учетные записи Майкрософт:</span><span class="sxs-lookup"><span data-stu-id="1b5d8-168">[Office-Add-in-Auth0](https://github.com/OfficeDev/Office-Add-in-Auth0) uses Auth0 to enable social login with Facebook, Google, and Microsoft Accounts.</span></span>

- <span data-ttu-id="1b5d8-169">[Office-Add-in-OAuth.io](https://github.com/OfficeDev/Office-Add-in-OAuth.io) использует OAuth.io для получения маркеров доступа из Facebook и Google.</span><span class="sxs-lookup"><span data-stu-id="1b5d8-169">[Office-Add-in-OAuth.io](https://github.com/OfficeDev/Office-Add-in-OAuth.io) uses OAuth.io to get access tokens from Facebook and Google.</span></span>

## <a name="what-is-cors"></a><span data-ttu-id="1b5d8-170">Что такое CORS?</span><span class="sxs-lookup"><span data-stu-id="1b5d8-170">What is CORS?</span></span>

<span data-ttu-id="1b5d8-p119">CORS расшифровывается как [общий доступ к ресурсам независимо от источника](https://developer.mozilla.org/docs/Web/HTTP/Access_control_CORS) (Cross Origin Resource Sharing). Сведения об использовании CORS в надстройках см. в статье [Устранение в надстройках Office ограничений, вызванных принципом одинакового источника](addressing-same-origin-policy-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="1b5d8-p119">CORS stands for [Cross Origin Resource Sharing](https://developer.mozilla.org/docs/Web/HTTP/Access_control_CORS). For information about how to use CORS inside add-ins, see [Addressing same-origin policy limitations in Office Add-ins](addressing-same-origin-policy-limitations.md).</span></span>
