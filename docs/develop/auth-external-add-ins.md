---
title: Авторизация с поставщиками удостоверений, не в microsoft
description: Получите авторизацию для не microsoft data sources с помощью OAuth 2.0 и кода авторизации и неявных потоков.
ms.date: 01/25/2022
ms.localizationpriority: medium
ms.openlocfilehash: 873bf0ad86490670db7a4733db971e377748babf
ms.sourcegitcommit: 968d637defe816449a797aefd930872229214898
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2022
ms.locfileid: "63743642"
---
# <a name="authorization-with-non-microsoft-identity-providers"></a>Авторизация с поставщиками удостоверений, не в microsoft

Существует множество популярных служб удостоверений, помимо платформа удостоверений Майкрософт, которые можно использовать в надстройки. Они дают пользователям и приложениям, Office надстройки, доступ к учетным записям пользователей в других приложениях.

Стандартная платформа, позволяющая обеспечить доступ веб-приложения к веб-службе, — **OAuth 2.0**. В большинстве ситуаций не обязательно знать абсолютно все о работе платформы, чтобы использовать ее в своей надстройке. Доступно множество библиотек, упрощающих работу с платформой.

Основной принцип работы OAuth заключается в том, что приложение может быть [субъектом безопасности](/windows/security/identity-protection/access-control/security-principals) для самого себя (как пользователь или группа) и использовать собственное удостоверение и набор разрешений. В большинстве типичных сценариев, когда пользователь выполняет действие в надстройке Office, требующее вовлечения веб-службы, надстройка отправляет службе запрос на получение определенного набора разрешений для учетной записи пользователя. Затем служба предлагает пользователю предоставить надстройке эти разрешения. После предоставления разрешений служба отправляет надстройке небольшой зашифрованный *маркер доступа*. Надстройка может использовать службу, включая этот маркер во все свои запросы к API-интерфейсам службы. Но надстройка может действовать только в рамках разрешений, предоставленных ей пользователем. Кроме того, срок действия маркера ограничен указанным периодом времени.

Разные шаблоны OAuth (*потоки* или *типы предоставления*) предназначены для разных сценариев. Наиболее часто реализуются следующие два шаблона.

- **Неявный поток.** Обмен данными между надстройкой и веб-службой реализуется с помощью JavaScript на стороне клиента. Этот поток часто используется в одностраничных приложениях (SPA).
- **Поток кода авторизации.** Используется подключение типа *сервер-сервер* между веб-приложением надстройки и веб-службой. Следовательно, она реализуется с помощью серверного кода.

Поток OAuth предназначен для безопасной идентификации и авторизации приложения. В потоке кода авторизации вам предоставляется *секрет клиента*, который необходимо держать в тайне. Приложение без серверной части, например SPA, не может защитить секрет, поэтому в таких приложениях рекомендуется использовать неявный поток.

Дополнительные сведения о преимуществах и недостатках неявного потока и потока кода авторизации см. в разделах [Код авторизации](https://tools.ietf.org/html/rfc6749#section-1.3.1) и [Неявный поток](https://tools.ietf.org/html/rfc6749#section-1.3.2).

> [!NOTE]
> Вы также можете использовать службу-посредник, которая будет выполнять авторизацию и передавать маркер доступа надстройке. Подробная информация об этом сценарии приведена в разделе **Службы-посредники** далее в этой статье.

## <a name="use-the-implicit-flow-in-office-add-ins"></a>Использование неявного потока Office надстройки

Узнать, поддерживает ли веб-служба неявный поток, можно из документации к ней.

Сведения о библиотеках, поддерживающих неявный поток, см. в разделе **Библиотеки** далее в этой статье.

## <a name="use-the-authorization-code-flow-in-office-add-ins"></a>Использование потока кода авторизации в Office надстройки

Доступно множество библиотек, позволяющих реализовать поток кода авторизации на различных языках и платформах. Дополнительные сведения о некоторых из этих библиотек см. в разделе **Библиотеки** далее в этой статье.

## <a name="libraries"></a>Библиотеки

Библиотеки доступны для многих языков и платформ, как для неявного потока, так и для потока кода авторизации. Одни из них универсальны, а другие предназначены для определенных веб-служб.

Если вы используете **Facebook**, выполните на сайте [Facebook для разработчиков](https://developers.facebook.com) поиск по запросу "library" или "sdk".

Если вы ищете **общие библиотеки OAuth 2.0**, откройте страницу [Код OAuth](https://oauth.net/code/), которую обновляет рабочая группа IETF по OAuth. Эта страница содержит ссылки на библиотеки, рассчитанные на более десятка языков. Обратите внимание, что некоторые из этих библиотек предназначены для реализации службы, поддерживающей OAuth. На этой странице библиотеки, представляющие интерес для разработчиков надстроек, называются *клиентскими* библиотеками, так как веб-сервер является клиентом службы, поддерживающей OAuth.

## <a name="middleman-services"></a>Службы-посредники

Ваша надстройка также может использовать для авторизации службу-посредник, например [OAuth.io](https://oauth.io) или [Auth0](https://auth0.com). Служба-посредник может либо предоставлять маркеры доступа для популярных веб-служб, либо упрощать процесс входа в надстройку через социальные сети. Благодаря минимуму кода надстройка может подключаться к службе-посреднику с помощью клиентского скрипта или серверного кода, чтобы та отправила надстройке необходимые токены для веб-службы. Весь код, реализующий авторизацию, находится в службе-посреднике.

Рекомендуем сделать так, чтобы надстройка при проверке подлинности или авторизации использовала наши Dialog API для открытия страницы входа. Дополнительные сведения см. в статье [Использование Dialog API в потоке проверки подлинности](dialog-api-in-office-add-ins.md#use-the-dialog-apis-in-an-authentication-flow). Когда вы открываете диалоговое окно Office так, оно открывается в совершенно новом экземпляре браузера. При этом используется модуль JavaScript из экземпляра на родительской странице (например, область задач надстройки, FunctionFile). Токен и другие данные, которые можно преобразовать в строку, передается на родительскую страницу с помощью API под названием `messageParent`. Затем родительская страница может использовать этот токен для авторизованных вызовов ресурса. Из-за особенностей архитектуры те API, которые предоставляет служба-посредник, следует использовать с осторожностью. Часто служба предоставляет набор API, в котором ваш код создает определенный объект контекста, получающий токен и использующий его для последующих вызовов ресурса. Часто у службы есть один метод API, который делает начальный вызов *и* создает объект контекста. Подобный объект невозможно полностью преобразовать в строку, поэтому его нельзя передать из диалогового окна Office на родительскую страницу. Как правило, служба-посредник предоставляет второй набор API с более низким уровнем абстракции (например, REST API). Этот второй набор содержит API, который получает токен из службы, и другие API, которые передают токен службе при использовании для авторизованного доступа к ресурсу. Вам нужно работать с API на этом нижнем уровне абстракции, чтобы можно было получить токен в диалоговом окне Office, а затем использовать `messageParent` для его передачи на родительскую страницу.

## <a name="what-is-cors"></a>Что такое CORS?

CORS расшифровывается как [общий доступ к ресурсам независимо от источника](https://developer.mozilla.org/docs/Web/HTTP/Access_control_CORS) (Cross Origin Resource Sharing). Сведения об использовании CORS в надстройках см. в статье [Устранение в надстройках Office ограничений, вызванных принципом одинакового источника](addressing-same-origin-policy-limitations.md).

## <a name="see-also"></a>См. также

- [Обзор проверки подлинности и авторизации в Office надстройки](overview-authn-authz.md).