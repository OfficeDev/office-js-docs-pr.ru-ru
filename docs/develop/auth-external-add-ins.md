---
title: Авторизация внешних служб в надстройке Office
description: Получение авторизации для сторонних источников данных (отличных от Майкрософт), например Google, Facebook, LinkedIn, SalesForce и GitHub, с помощью OAuth 2.0, кода авторизации и неявных потоков.
ms.date: 08/07/2019
localization_priority: Priority
ms.openlocfilehash: 3b6ba291912f9d6284ca5e71a7bf634261a0bd24
ms.sourcegitcommit: 24303ca235ebd7144a1d913511d8e4fb7c0e8c0d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2019
ms.locfileid: "36838545"
---
# <a name="authorize-external-services-in-your-office-add-in"></a><span data-ttu-id="a7e5c-103">Авторизация внешних служб в надстройке Office</span><span class="sxs-lookup"><span data-stu-id="a7e5c-103">Authorize external services in your Office Add-in</span></span>

<span data-ttu-id="a7e5c-p101">С помощью популярных веб-служб, в том числе Office 365, Google, Facebook, LinkedIn, SalesForce и GitHub, разработчики могут предоставлять пользователям доступ к их учетным записям в других приложениях. Благодаря этому вы можете включать эти службы в свои надстройки Office.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-p101">Popular online services, including Office 365, Google, Facebook, LinkedIn, SalesForce, and GitHub, let developers give users access to their accounts in other applications. This gives you the ability to include these services in your Office Add-in.</span></span>

> [!NOTE]
> <span data-ttu-id="a7e5c-106">В оставшейся части этой статьи рассматривается доступ к сторонним службам (отличным от Майкрософт).</span><span class="sxs-lookup"><span data-stu-id="a7e5c-106">The remainder of this article is about accessing non-Microsoft services.</span></span> <span data-ttu-id="a7e5c-107">Сведения о доступе к Microsoft Graph (включая Office 365) см. в разделах [Доступ к Microsoft Graph с помощью единого входа](overview-authn-authz.md#access-to-microsoft-graph-with-sso) и [Доступ к Microsoft Graph без единого входа](overview-authn-authz.md#access-to-microsoft-graph-without-sso).</span><span class="sxs-lookup"><span data-stu-id="a7e5c-107">For information about accessing Microsoft Graph (including Office 365), see [Access to Microsoft Graph with SSO](overview-authn-authz.md#access-to-microsoft-graph-with-sso) and [Access to Microsoft Graph without SSO](overview-authn-authz.md#access-to-microsoft-graph-without-sso).</span></span>

<span data-ttu-id="a7e5c-p103">Стандартная платформа, позволяющая обеспечить доступ веб-приложения к веб-службе, — **OAuth 2.0**. В большинстве ситуаций не обязательно знать абсолютно все о работе платформы, чтобы использовать ее в своей надстройке. Доступно множество библиотек, упрощающих работу с платформой.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-p103">The industry standard framework for enabling web application access to an online service is **OAuth 2.0**. In most situations, you don't need to know the details of how the framework works to use it in your add-in. Many libraries are available that simplify the details for you.</span></span>

<span data-ttu-id="a7e5c-111">Основной принцип работы OAuth заключается в том, что приложение может быть [субъектом безопасности](/windows/security/identity-protection/access-control/security-principals) для самого себя (как пользователь или группа) и использовать собственное удостоверение и набор разрешений.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-111">A fundamental idea of OAuth is that an application can be a security principal unto itself, just like a user or a group, with its own identity and set of permissions.</span></span> <span data-ttu-id="a7e5c-112">В большинстве типичных сценариев, когда пользователь выполняет действие в надстройке Office, требующее вовлечения веб-службы, надстройка отправляет службе запрос на получение определенного набора разрешений для учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-112">In the most typical scenarios, when the user takes an action in the Office Add-in that requires the online service, the add-in sends the service a request for a specific set of permissions to the user's account.</span></span> <span data-ttu-id="a7e5c-113">Затем служба предлагает пользователю предоставить надстройке эти разрешения.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-113">The service then prompts the user to grant the add-in those permissions.</span></span> <span data-ttu-id="a7e5c-114">После предоставления разрешений служба отправляет надстройке небольшой зашифрованный *маркер доступа*.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-114">After the permissions are granted, the service sends the add-in a small encoded *access token*.</span></span> <span data-ttu-id="a7e5c-115">Надстройка может использовать службу, включая этот маркер во все свои запросы к API-интерфейсам службы.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-115">The add-in can use the service by including the token in all its requests to the service's APIs.</span></span> <span data-ttu-id="a7e5c-116">Но надстройка может действовать только в рамках разрешений, предоставленных ей пользователем.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-116">But the add-in can act only within the permissions that the user granted it.</span></span> <span data-ttu-id="a7e5c-117">Кроме того, срок действия маркера ограничен указанным периодом времени.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-117">The token also expires after a specified time.</span></span>

<span data-ttu-id="a7e5c-118">Разные шаблоны OAuth (*потоки* или *типы предоставления*) предназначены для разных сценариев.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-118">Several OAuth patterns, called *flows* or *grant types*, are designed for different scenarios.</span></span> <span data-ttu-id="a7e5c-119">Наиболее часто используются следующие два шаблона:</span><span class="sxs-lookup"><span data-stu-id="a7e5c-119">The following two patterns are the most commonly implemented:</span></span>

- <span data-ttu-id="a7e5c-120">**Неявный поток.** Обмен данными между надстройкой и веб-службой реализуется с помощью JavaScript на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-120">**Implicit flow**: Communication between the add-in and the online service is implemented with client-side JavaScript.</span></span> <span data-ttu-id="a7e5c-121">Этот поток часто используется в одностраничных приложениях (SPA).</span><span class="sxs-lookup"><span data-stu-id="a7e5c-121">This flow is commonly used in single-page applications (SPAs).</span></span>
- <span data-ttu-id="a7e5c-122">**Поток кода авторизации**. Используется подключение типа *сервер-сервер* между веб-приложением надстройки и веб-службой.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-122">**Authorization Code flow**: Communication is *server-to-server* between your add-in's web application and the online service. So, it is implemented with server-side code.</span></span> <span data-ttu-id="a7e5c-123">Следовательно, используется серверный код.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-123">So, it is implemented with server-side code.</span></span>

<span data-ttu-id="a7e5c-124">Поток OAuth предназначен для безопасной идентификации и авторизации приложения.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-124">The purpose of an OAuth flow is to secure the identity and authorization of the application.</span></span> <span data-ttu-id="a7e5c-125">В потоке кода авторизации вам предоставляется *секрет клиента*, который необходимо держать в тайне.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-125">In the Authorization Code flow, you're provided a *client secret* that needs to be kept hidden.</span></span> <span data-ttu-id="a7e5c-126">Приложение без серверной части, например SPA, не может защитить секрет, поэтому в таких приложениях рекомендуется использовать неявный поток.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-126">An application that has no server-side backend, such as an SPA, has no way to protect the secret, so we recommend that you use the Implicit flow in SPAs.</span></span>

<span data-ttu-id="a7e5c-127">Дополнительные сведения о преимуществах и недостатках неявного потока и потока кода авторизации</span><span class="sxs-lookup"><span data-stu-id="a7e5c-127">You should be familiar with the pros and cons of the Implicit flow and the Authorization Code flow.</span></span> <span data-ttu-id="a7e5c-128">см. в разделах [Код авторизации](https://tools.ietf.org/html/rfc6749#section-1.3.1) и [Неявный поток](https://tools.ietf.org/html/rfc6749#section-1.3.2).</span><span class="sxs-lookup"><span data-stu-id="a7e5c-128">For more infomation about these two flows, see [Authorization Code](https://tools.ietf.org/html/rfc6749#section-1.3.1) and [Implicit](https://tools.ietf.org/html/rfc6749#section-1.3.2).</span></span>

> [!NOTE]
> <span data-ttu-id="a7e5c-p110">Вы также можете использовать службу-посредник, которая будет выполнять авторизацию и передавать маркер доступа надстройке. Подробная информация об этом сценарии приведена в разделе **Службы-посредники** далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-p110">You also have the option of using a middleman service to perform authorization and pass the access token to your add-in. For details about this scenario, see the **Middleman services** section later in this article.</span></span>

## <a name="using-the-implicit-flow-in-office-add-ins"></a><span data-ttu-id="a7e5c-131">Использование неявного потока в надстройках Office</span><span class="sxs-lookup"><span data-stu-id="a7e5c-131">Using the Implicit flow in Office Add-ins</span></span>

<span data-ttu-id="a7e5c-132">Узнать, поддерживает ли веб-служба неявный поток, можно из документации к ней.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-132">The best way to find out if an online service supports the Implicit flow is to consult the service's documentation.</span></span>

<span data-ttu-id="a7e5c-133">Сведения о библиотеках, поддерживающих неявный поток, см. в разделе **Библиотеки** далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-133">For information about other libraries that support the Implicit flow, see the **Libraries** section later in this article.</span></span>

## <a name="using-the-authorization-code-flow-in-office-add-ins"></a><span data-ttu-id="a7e5c-134">Использование потока кода авторизации в надстройках Office</span><span class="sxs-lookup"><span data-stu-id="a7e5c-134">Using the Authorization Code flow in Office Add-ins</span></span>

<span data-ttu-id="a7e5c-p111">Доступно множество библиотек, позволяющих реализовать поток кода авторизации на различных языках и платформах. Дополнительные сведения о некоторых из этих библиотек см. в разделе **Библиотеки** далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-p111">Many libraries are available for implementing the Authorization Code flow in various languages and frameworks. For more information about some of these libraries, see the **Libraries** section later in this article.</span></span>

## <a name="libraries"></a><span data-ttu-id="a7e5c-137">Библиотеки</span><span class="sxs-lookup"><span data-stu-id="a7e5c-137">Libraries</span></span>

<span data-ttu-id="a7e5c-p112">Библиотеки доступны для многих языков и платформ, как для неявного потока, так и для потока кода авторизации. Одни из них универсальны, а другие предназначены для определенных веб-служб.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-p112">Libraries are available for many languages and platforms, for both the Implicit flow and the Authorization Code flow. Some libraries are general purpose, while others are for specific online services.</span></span>

<span data-ttu-id="a7e5c-p113">Если вы используете **Google**, выполните на странице [GitHub.com/Google](https://github.com/google) поиск по запросу "auth" или названию языка. Имена почти всех соответствующих репозиториев представлены в формате `google-auth-library-[name of language]`.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-p113">**Google**: Search [GitHub.com/Google](https://github.com/google) for "auth" or the name of your language. Most of the relevant repos are named `google-auth-library-[name of language]`.</span></span>

<span data-ttu-id="a7e5c-142">Если вы используете **Facebook**, выполните на сайте [Facebook для разработчиков](https://developers.facebook.com) поиск по запросу "library" или "sdk".</span><span class="sxs-lookup"><span data-stu-id="a7e5c-142">**Facebook**: Search [Facebook for Developers](https://developers.facebook.com) for "library" or "sdk".</span></span>

<span data-ttu-id="a7e5c-p114">Если вы ищете **общие библиотеки OAuth 2.0**, откройте страницу [Код OAuth](https://oauth.net/code/), которую обновляет рабочая группа IETF по OAuth. Эта страница содержит ссылки на библиотеки, рассчитанные на более десятка языков. Обратите внимание, что некоторые из этих библиотек предназначены для реализации службы, поддерживающей OAuth. На этой странице библиотеки, представляющие интерес для разработчиков надстроек, называются *клиентскими* библиотеками, так как веб-сервер является клиентом службы, поддерживающей OAuth.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-p114">**General OAuth 2.0**: A page of links to libraries for over a dozen languages is maintained by the IETF OAuth Working Group at: [OAuth Code](https://oauth.net/code/). Note that some of these libraries are for implementing an OAuth compliant service. The libraries of interest to you as a an add-in developer are called *client* libraries on this page because your web server is a client of the OAuth compliant service.</span></span>

## <a name="middleman-services"></a><span data-ttu-id="a7e5c-146">Службы-посредники</span><span class="sxs-lookup"><span data-stu-id="a7e5c-146">Middleman services</span></span>

<span data-ttu-id="a7e5c-p115">Ваша надстройка также может использовать для авторизации службу-посредник, например [OAuth.io](https://oauth.io) или [Auth0](https://auth0.com). Служба-посредник может либо предоставлять маркеры доступа для популярных веб-служб, либо упрощать процесс входа в надстройку через социальные сети. Благодаря минимуму кода надстройка может подключаться к службе-посреднику с помощью клиентского скрипта или серверного кода, чтобы та отправила надстройке необходимые токены для веб-службы. Весь код, реализующий авторизацию, находится в службе-посреднике.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-p115">Your add-in can use a middleman service such as [OAuth.io](https://oauth.io) or [Auth0](https://auth0.com) to perform authorization. A middleman service may either provide access tokens for popular online services or simplify the process of enabling social login for your add-in, or both. With very little code, your add-in can use either client-side script or server-side code to connect to the middleman service and it will send your add-in any required tokens for the online service. All of the authorization implementation code is in the middleman service.</span></span> 

<span data-ttu-id="a7e5c-151">Рекомендуем сделать так, чтобы надстройка при проверке подлинности или авторизации использовала наши Dialog API для открытия страницы входа.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-151">We recommend that the UI for authentication/authorization in your add-in use our Dialog APIs to open a login page.</span></span> <span data-ttu-id="a7e5c-152">Дополнительные сведения см. в статье [Использование Dialog API в потоке проверки подлинности](dialog-api-in-office-add-ins.md#use-the-dialog-apis-in-an-authentication-flow).</span><span class="sxs-lookup"><span data-stu-id="a7e5c-152">See [Use the Dialog APIs in an authentication flow](dialog-api-in-office-add-ins.md#use-the-dialog-apis-in-an-authentication-flow) for more information.</span></span> <span data-ttu-id="a7e5c-153">Когда вы открываете диалоговое окно Office так, оно открывается в совершенно новом экземпляре браузера. При этом используется модуль JavaScript из экземпляра на родительской странице (например, область задач надстройки, FunctionFile).</span><span class="sxs-lookup"><span data-stu-id="a7e5c-153">When you open an Office dialog in this way, the dialog has a completely new and separate instance of the browser and JavaScript engine from the instance in the parent page (e.g., the add-in's task pane or FunctionFile).</span></span> <span data-ttu-id="a7e5c-154">Токен и другие данные, которые можно преобразовать в строку, передается на родительскую страницу с помощью API под названием `messageParent`.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-154">A token, and any other information that can be converted to a string, is passed back to the parent using an API called `messageParent`.</span></span> <span data-ttu-id="a7e5c-155">Затем родительская страница может использовать этот токен для авторизованных вызовов ресурса.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-155">The parent page can then use the token to make authorized calls to the resource.</span></span> <span data-ttu-id="a7e5c-156">Из-за особенностей архитектуры те API, которые предоставляет служба-посредник, следует использовать с осторожностью.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-156">Because of this architecture, you must be careful how you use the APIs provided by a middleman service.</span></span> <span data-ttu-id="a7e5c-157">Часто служба предоставляет набор API, в котором ваш код создает определенный объект контекста, получающий токен и использующий его для последующих вызовов ресурса.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-157">Often the service will provide an API set in which your code creates some kind of context object which both gets a token and uses that token in making subsequent calls to the resource.</span></span> <span data-ttu-id="a7e5c-158">Часто у службы есть один метод API, который делает начальный вызов *и* создает объект контекста.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-158">Often the service has a single API method that makes the initial call *and* creates the context object.</span></span> <span data-ttu-id="a7e5c-159">Подобный объект невозможно полностью преобразовать в строку, поэтому его нельзя передать из диалогового окна Office на родительскую страницу.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-159">An object like this cannot be completely stringified, so it cannot be passed from the Office dialog to the parent page.</span></span> <span data-ttu-id="a7e5c-160">Как правило, служба-посредник предоставляет второй набор API с более низким уровнем абстракции (например, REST API).</span><span class="sxs-lookup"><span data-stu-id="a7e5c-160">Typically, the middleman service provides a second API set, at a lower level of abstraction, such as a REST API.</span></span> <span data-ttu-id="a7e5c-161">Этот второй набор содержит API, который получает токен из службы, и другие API, которые передают токен службе при использовании для авторизованного доступа к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-161">This second set will have an API that gets a token from the service, and other APIs that pass the token to service when using it to get authorized access to the resource.</span></span> <span data-ttu-id="a7e5c-162">Вам нужно работать с API на этом нижнем уровне абстракции, чтобы можно было получить токен в диалоговом окне Office, а затем использовать `messageParent` для его передачи на родительскую страницу.</span><span class="sxs-lookup"><span data-stu-id="a7e5c-162">You need to work with an API at this lower level of abstraction so that you can get the token in the Office dialog and then use `messageParent` to pass it to the parent page.</span></span> 

## <a name="what-is-cors"></a><span data-ttu-id="a7e5c-163">Что такое CORS?</span><span class="sxs-lookup"><span data-stu-id="a7e5c-163">What is CORS?</span></span>

<span data-ttu-id="a7e5c-p117">CORS расшифровывается как [общий доступ к ресурсам независимо от источника](https://developer.mozilla.org/docs/Web/HTTP/Access_control_CORS) (Cross Origin Resource Sharing). Сведения об использовании CORS в надстройках см. в статье [Устранение в надстройках Office ограничений, вызванных принципом одинакового источника](addressing-same-origin-policy-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="a7e5c-p117">CORS stands for [Cross Origin Resource Sharing](https://developer.mozilla.org/docs/Web/HTTP/Access_control_CORS). For information about how to use CORS inside add-ins, see [Addressing same-origin policy limitations in Office Add-ins](addressing-same-origin-policy-limitations.md).</span></span>
