---
title: Общие сведения об интерфейсе API JavaScript для Office
description: ''
ms.date: 01/23/2018
ms.openlocfilehash: 12e7d9030ec37746f84e3fc725cddda2a5675761
ms.sourcegitcommit: 5bef9828f047da03ecf2f43c6eb5b8514eff28ce
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/31/2018
ms.locfileid: "23782796"
---
# <a name="understanding-the-javascript-api-for-office"></a>Общие сведения об интерфейсе API JavaScript для Office

В этой статье можно узнать об интерфейсе API JavaScript для Office и о том, как его использовать. Справочные сведения см. в разделе [API JavaScript для Office](https://dev.office.com/reference/add-ins/javascript-api-for-office). О том, как обновить файлы проекта Visual Studio до последней версии API JavaScript для Office, см. в статье [Обновление версии API JavaScript для Office и файлов схемы манифеста](update-your-javascript-api-for-office-and-manifest-schema-version.md).

> [!NOTE]
> Если вы планируете [опубликовать](../publish/publish.md) надстройку в AppSource и сделать ее доступной в интерфейсе Office, убедитесь, что она соответствует [политикам проверки AppSource](https://docs.microsoft.com/office/dev/store/validation-policies). Например, чтобы пройти проверку, надстройка работать на всех платформах, поддерживающих определенные вами методы. Дополнительные сведения см. в [разделе 4.12](https://docs.microsoft.com/office/dev/store/validation-policies#4-apps-and-add-ins-behave-predictably) и на [странице со сведениями о доступности и ведущих приложениях для надстроек Office](../overview/office-add-in-availability.md). 

## <a name="referencing-the-javascript-api-for-office-library-in-your-add-in"></a>Ссылки на библиотеку API JavaScript для Office в надстройке

Библиотека [API JavaScript для Office](https://dev.office.com/reference/add-ins/javascript-api-for-office) состоит из файла Office.js и связанных JS-файлов ведущего приложения, например Excel-15.js и Outlook-15.js. Простейший способ сослаться на API — использовать нашу сеть доставки содержимого (CDN), добавив следующий код `<script>` в тег `<head>` страницы:  

```html
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/Office.js" type="text/javascript"></script>
```

Это приведет к скачиванию и кэшированию файлов JavaScript API для Office при первой загрузке надстройки, чтобы убедиться, что она использует актуальную реализацию Office.js и сопутствующих файлов для указанной версии.

Подробные сведения о CDN-версии файла Office.js, включая способы управления версиями и обратной совместимостью, приведены в разделе [Указание ссылок на библиотеку API JavaScript для Office из сети доставки содержимого (CDN)](referencing-the-javascript-api-for-office-library-from-its-cdn.md).

## <a name="initializing-your-add-in"></a>Инициализация надстройки

**Область применения:** все типы надстроек

Надстройки Office часто имеют логику, выполняющую при запуске такие действия, как:

- Проверка того, будет ли поддерживать пользовательская версия Office все функции API для Office, вызываемые вашим кодом.

- Проверка наличия некоторых артефактов, таких как лист с конкретным именем.

- Пользователю предлагается выбрать несколько ячеек в Excel, а затем вставить диаграмму, созданную с использованием этих выбранных значений.

- Установление привязок.

- Используйте диалоговое API для Office, предлагающее пользователю установить для параметров надстройки значения по умолчанию.

При этом код запуска не должен вызывать функции API для Office.js до завершения загрузки библиотеки. Существует два способа, с помощью которых код может определить, загружена ли библиотека. Они описаны в следующих разделах. Мы рекомендуем использовать более новый и гибкий способ под названием `Office.onReady()`. Более старый способ, назначающий обработчик для `Office.initialize`, по-прежнему поддерживается. См. также раздел [Основные различия между Office.initialize и Office.onReady()](#major-differences-between-office-initialize-and-office-onready).

Дополнительные сведения о последовательности событий при инициализации надстройки приведены в разделе [Загрузка модели DOM и среды выполнения](loading-the-dom-and-runtime-environment.md).

### <a name="initialize-with-officeonready"></a>Инициализация с использованием функции Office.onReady()

`Office.onReady()` представляет собой асинхронный метод, который возвращает объект Promise, проверяя при этом, полностью ли загружена библиотека Office.js. Только в том случае, если библиотека загружена, метод разрешает Promise как объект, определяющий ведущее приложение Office с помощью значения перечисления `Office.HostType` (`Excel`, `Word` и т. д.) и платформу с помощью значения перечисления `Office.PlatformType` (`PC`, `Mac`, `OfficeOnline` и т. д.). Если библиотека уже загружена, выполняется вызов `Office.onReady()`, и разрешение объекта Promise производится немедленно.

Для вызова `Office.onReady()` необходимо передать ему метод обратного вызова. Пример:

```js
Office.onReady(function(info) {
    if (info.host === Office.HostType.Excel) {
        // Do Excel-specific initialization (for example, make add-in task pane's
        // appearance compatible with Excel "green").
    }
    if (info.platform === Office.PlatformType.PC) {
        // Make minor layout changes in the task pane.
    }
    console.log(`Office.js is now ready in ${info.host} on ${info.platform}`);
});
```

Кроме того, вместо передачи обратного вызова можно объединить метод `then()` с вызовом `Office.onReady()`. Например, следующий код проверяет, поддерживает ли пользовательская версия Excel все функции API, которые могут быть вызваны надстройкой.

```js
Office.onReady()
    .then(function() {
        if (!Office.context.requirements.isSetSupported('ExcelApi', '1.7')) {
            console.log("Sorry, this add-in only works with newer versions of Excel.");
        }
    });
```

Ниже приведен тот же пример с использованием ключевых слов `async` и `await` в TypeScript:

```typescript
(async () => {
    await Office.onReady();
    if (!Office.context.requirements.isSetSupported('ExcelApi', '1.7')) {
        console.log("Sorry, this add-in only works with newer versions of Excel.");
    }
})();
```

При использовании дополнительных платформ JavaScript, включающих собственный обработчик событий инициализации или тесты, их *обычно* размещают в ответе на `Office.onReady()`. Например, ссылка на функцию [JQuery](https://jquery.com) `$(document).ready()` может выглядеть следующим образом:

```js
Office.onReady(function() {
    // Office is ready
    $(document).ready(function () {
        // The document is ready
    });
});
```

Тем не менее существуют некоторые исключения из этого метода. Например, предположим, что вы хотите открыть свою надстройку в браузере (вместо того, чтобы загружать ее в ведущее приложение Office) для отладки пользовательского интерфейса с помощью инструментов веб-обозревателя. Поскольку файл Office.js не будет загружаться в веб-обозревателе, `onReady` и `$(document).ready` не будут выполняться при вызове в `onReady` для Office. Еще одно исключение: вы хотите, чтобы при загрузке надстройки в области задач отображался индикатор выполнения. В этом случае код должен вызывать метод jQuery `ready` и использовать его обратный вызов для отображения индикатора выполнения. После этого обратный вызов `onReady` для Office может заменить индикатор выполнения в окончательном варианте пользовательского интерфейса. 

### <a name="initialize-with-officeinitialize"></a>Инициализация с использованием функции Office.initialize

Для вызова события инициализации библиотека Office.js должна быть полностью загружена и готова к взаимодействию с пользователем. Для `Office.initialize` можно назначить обработчик, реализующий логику инициализации. Ниже приведен пример, в котором проверяется, поддерживает ли пользовательская версия Excel все функции API, которые могут быть вызваны надстройкой.

```js
Office.initialize = function () {
    if (!Office.context.requirements.isSetSupported('ExcelApi', '1.7')) {
        console.log("Sorry, this add-in only works with newer versions of Excel.");
    }
};
```

При использовании дополнительных платформ JavaScript, включающих собственный обработчик событий инициализации или тесты, их *обычно* размещают в событии `Office.initialize`. (В данном случае также применяются исключения, описанные ранее в разделе **Инициализация с использованием функции Office.onReady()**.) Например, ссылка на функцию [JQuery](https://jquery.com) `$(document).ready()` может выглядеть следующим образом:

```js
Office.initialize = function () {
    // Office is ready
    $(document).ready(function () {
        // The document is ready
    });
  };
```

Для надстроек области задач и контентных надстроек `Office.initialize` обеспечивает дополнительный параметр _reason_. Этот параметр можно использовать для определения того, каким образом надстройка была добавлена в текущий документ. Это поможет обеспечить разную логику в тех случаях, когда надстройка вставляется впервые или когда она уже существует в документе.

```js
Office.initialize = function (reason) {
    $(document).ready(function () {
        switch (reason) {
            case 'inserted': console.log('The add-in was just inserted.');
            case 'documentOpened': console.log('The add-in is already part of the document.');
        }
    });
 };
```

Дополнительные сведения приведены в разделах [Событие Office.initialize](https://dev.office.com/reference/add-ins/shared/office.initialize) и [Перечисление InitializationReason](https://dev.office.com/reference/add-ins/shared/initializationreason-enumeration).

### <a name="major-differences-between-officeinitialize-and-officeonready"></a>Основные различия между Office.initialize и Office.onReady

- Вы можете назначить только один обработчик для `Office.initialize` для однократного вызова в инфраструктуре Office; но также можете вызывать `Office.onReady()` в различных местах вашего кода и использовать различные обратные вызовы. Например, код может вызывать `Office.onReady()` сразу после загрузки пользовательского сценария с обратным вызовом, который запускает логику инициализации; и ваш код также может иметь в области задач кнопку, сценарий которой вызывает `Office.onReady()` с другим обратным вызовом. В этом случае обратный вызов выполняется при нажатии кнопки.

- Событие `Office.initialize` запускается по окончании внутреннего процесса, в ходе которого Office.js выполняет самоинициализацию. И вызов данного события производится *немедленно* после завершения внутреннего процесса. Если код, в котором вы назначаете обработчик для события, выполняется слишком долго после возникновения события, ваш обработчик не запускается. Например, если вы используете диспетчер задач WebPack, он может настроить домашнюю страницу надстройки для загрузки файлов polyfill после загрузки Office.js, но до того, как он загрузит ваш собственный JavaScript. Когда ваш сценарий выполнит загрузку и назначение обработчика, событие инициализации уже произойдет. Но вызвать `Office.onReady()` никогда не поздно. Если событие инициализации уже произошло, обратный вызов выполняется немедленно.

> [!NOTE]
> Даже если у вас нет логики запуска, рекомендуется либо вызвать `Office.onReady()`, либо назначить пустую функцию для `Office.initialize` при загрузке вашей надстройки JavaScript, поскольку некоторые комбинации ведущего приложения и платформы Office не будут загружать область задач до тех пор, пока не произойдет одно из этих событий. В следующих строках показаны два способа, с помощью которых это можно сделать:
>
>```js
>Office.onReady();
>```
>
>```js
>Office.initialize = function () {};
>```

## <a name="office-javascript-api-object-model"></a>Объектная модель API JavaScript для Office

После инициализации надстройка может взаимодействовать с узлом (например, Excel, Outlook). Более подробную информацию о конкретных шаблонах использования см. на странице [Объектная модель API JavaScript для Office](office-javascript-api-object-model.md). Существует также подробная справочная документация как для [общих API-интерфейсов](https://dev.office.com/reference/add-ins/javascript-api-for-office), так и для конкретных ведущих приложений.

## <a name="api-support-matrix"></a>Матрица поддержки API

В этой таблице представлены API и функции, поддерживаемые всеми типами надстроек (контентными, области задач и Outlook), и приложения Office, в которых они могут работать, когда вы указываете ведущие приложения Office, поддерживаемые вашей надстройкой с помощью [схемы манифестов надстроек версии 1.1 и функций, поддерживаемых API JavaScript для Office версии 1.1](update-your-javascript-api-for-office-and-manifest-schema-version.md).


|||||||||
|:-----|:-----|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|
||**Имя узла**|База данных|Книга|Почтовый ящик|Презентация|Документ|Проект|
||**Поддерживаемые** **ведущие приложения**|Веб-приложения Access|Excel,<br/>Excel Online|Outlook,<br/>веб-приложение Outlook,<br/>Outlook Web App для устройств|PowerPoint,<br/>PowerPoint Online|Word|Проект|
|**Поддерживаемые типы надстроек**|Содержимое|Да|Да||Да|||
||Область задач||Да||Да|Да|Да|
||Outlook|||Да||||
|**Поддерживаемые функции API**|Чтение и запись текста||Да||Да|Да|Да<br/>(только для чтения)|
||Матрица чтения и записи||Да|||Да||
||Таблица чтения и записи||Да|||Да||
||Чтение и запись HTML|||||Да||
||Чтение и запись<br/>Office Open XML|||||Да||
||Чтение свойств задач, ресурсов, представлений и полей||||||Да|
||События изменения выделенного фрагмента||Да|||Да||
||Загрузка всего документа||||Да|Да||
||Привязки и их события|Да<br/>(только полный и частичные привязки таблиц)|Да|||Да||
||Чтение и запись настраиваемых частей XML|||||Да||
||Сохранение данных состояния надстройки (параметры)|Да<br/>(на ведущую надстройку)|Да<br/>(на документ)|Да<br/>(на почтовый ящик)|Да<br/>(на документ)|Да<br/>(на документ)||
||События изменения параметров|Да|Да||Да|Да||
||События получения активного режима просмотра<br/>и изменения представления||||Да|||
||Переход к расположениям<br/>в документе||Да||Да|Да||
||Активация в зависимости от контекста<br/>с помощью правил и RegEx|||Да||||
||Чтение свойств элемента|||Да||||
||Чтение профиля пользователя|||Да||||
||Получение вложений|||Да||||
||Получение токена удостоверения пользователя|||Да||||
||Вызов веб-служб Exchange|||Да||||
