---
title: Указание ведущих приложений Office и требований к API
description: Узнайте, как указать приложения Office и требования к API для надстройки, чтобы она работала должным образом.
ms.date: 09/26/2019
localization_priority: Normal
ms.openlocfilehash: d1c8f582086b5044b1a5ea46270ceee5f08d288e
ms.sourcegitcommit: be23b68eb661015508797333915b44381dd29bdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/08/2020
ms.locfileid: "44609368"
---
# <a name="specify-office-hosts-and-api-requirements"></a>Указание ведущих приложений Office и требований к API

Работа надстройки Office может зависеть от ведущего приложения Office, набора обязательных элементов, элемента или версии API. Например, надстройка может:

- работать в одном (например, Word или Excel) или нескольких приложениях Office;

- использовать API JavaScript, доступные только в некоторых версиях Office. Например, можно создать надстройку Excel 2016 на базе новых API JavaScript для Excel;

- работать только в версиях Office, которые поддерживают элементы API, используемые вашей надстройкой.

Эта статья поможет вам разобраться, какие параметры следует выбрать для правильной работы надстройки и максимального охвата аудитории.

> [!NOTE]
> Общие сведения о том, на каких платформах поддерживаются надстройки Office, см. в [этой статье](../overview/office-add-in-availability.md).

В таблице ниже перечислены основные понятия, рассматриваемые в этой статье.

|**Концепция**|**Описание**|
|:-----|:-----|
|Приложение Office, ведущее приложение Office или ведущее приложение|Приложение Office, используемое для запуска надстройки, например Word, Excel и т. д.|
|Платформа|Среда выполнения ведущего приложения Office, например браузер или iPad.|
|Набор обязательных элементов|Именованная группа связанных элементов API. С помощью наборов обязательных элементов надстройка определяет, поддерживает ли ведущее приложение Office элементы API, которые она использует. Проще проверять поддержку набора обязательных элементов, а не отдельных элементов API. Поддержка набора обязательных элементов зависит от ведущего приложения Office и его версии. <br >Наборы обязательных элементов указываются в файле манифеста. Задавая наборы обязательных элементов в манифесте, вы указываете, какой минимальный уровень поддержки API должно обеспечить ведущее приложение Office, чтобы можно было запустить надстройку. Надстройка не будет работать в ведущих приложениях Office, которые не поддерживают наборы обязательных элементов, указанные в манифесте, и не будет отображаться в разделе <span class="ui">Мои надстройки</span>. Это ограничивает доступность надстройки в коде с помощью проверок в среде выполнения. Полный список наборов требований см. в статье [Наборы обязательных элементов для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md).|
|Проверка в среде выполнения|Проверка в среде выполнения, которая позволяет определить, поддерживает ли ведущее приложение Office наборы требований или методы, которые использует надстройка. Для выполнения проверки во время выполнения используется оператор **If** с `isSetSupported` методом, наборами требований или именами методов, не входящими в набор требований. Проверки в среде выполнения позволяют максимально расширить аудиторию надстройки. В отличие от наборов требований, такие проверки не позволяют задать минимальный уровень поддержки API, который требуется для запуска надстройки. Вместо этого используйте оператор **If** , чтобы определить, поддерживается ли элемент API. и если это так, добавляете в надстройку дополнительные функции. Если вы используете проверки в среде выполнения, ваша надстройка всегда будет отображаться в разделе **Мои надстройки**.|

## <a name="before-you-begin"></a>Подготовка

Надстройка должна использовать последнюю версию схемы манифеста надстройки. Если вы используете проверки среды выполнения в вашей надстройке, убедитесь, что вы используете последнюю библиотеку API JavaScript для Office (Office. js).

### <a name="specify-the-latest-add-in-manifest-schema"></a>Выбор последней версии схема манифестов надстроек

Ваша надстройка должна использовать схему манифеста 1.1. Задайте `OfficeApp` элемент в манифесте надстройки следующим образом.

```XML
<OfficeApp xmlns="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="TaskPaneApp">
```

### <a name="specify-the-latest-office-javascript-api-library"></a>Указание последней версии библиотеки API JavaScript для Office

Если вы используете проверки среды выполнения, укажите самую последнюю версию библиотеки API JavaScript для Office из сети доставки содержимого (CDN). Для этого добавьте указанный ниже тег `script` в HTML-код. Чтобы всегда ссылаться на последнюю версию файла Office.js, используйте `/1/` в URL-адресе сети доставки содержимого.

```HTML
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js" type="text/javascript"></script>
```

## <a name="options-to-specify-office-hosts-or-api-requirements"></a>Параметры для задания ведущих приложений Office или требований к API

При указании ведущих приложений Office и требований к API необходимо учитывать несколько факторов. На следующей схеме показано, как выбрать правильный метод для надстройки.

![Выбор самого подходящего варианта указания ведущих приложений Office или элементов API для надстройки](../images/options-for-office-hosts.png)

- Если надстройка работает на одном узле Office, задайте `Hosts` элемент в манифесте. Дополнительные сведения см. в разделе [Задание элемента Hosts](#set-the-hosts-element).

- Чтобы задать минимальный набор требований или элементы API, которые ведущее приложение Office должно поддерживать для запуска надстройки, задайте `Requirements` элемент в манифесте. Дополнительные сведения см. [в разделе Set The требований element в манифесте](#set-the-requirements-element-in-the-manifest).

- Чтобы предоставить дополнительные функции, если определенные наборы обязательных элементов или элементы API доступны в ведущем приложении Office, выполните проверку в среде выполнения для кода JavaScript надстройки. Например, если надстройка выполняется в Excel 2016, используйте элементы нового API JavaScript для Excel, чтобы предоставить дополнительные функции. Дополнительные сведения см. в разделе [Использование проверок в среде выполнения в коде JavaScript](#use-runtime-checks-in-your-javascript-code).

## <a name="set-the-hosts-element"></a>Задание элемента Hosts

Чтобы надстройка запускалась в одном ведущем приложении Office, используйте `Hosts` `Host` элементы и в манифесте. Если элемент не указан `Hosts` , надстройка будет запускаться на всех узлах.

Например, следующее `Hosts` и `Host` объявление указывает, что надстройка будет работать с любым выпуском Excel, включающим Excel в Интернете, Windows и iPad.

```xml
<Hosts>
  <Host Name="Workbook" />
</Hosts>
```

`Hosts`Элемент может содержать один или несколько `Host` элементов. `Host`Элемент определяет ведущее приложение Office, необходимое для надстройки. `Name`Атрибут является обязательным и может иметь одно из следующих значений.

| Имя          | Ведущие приложения Office                                                                  |
|:--------------|:------------------------------------------------------------------------------------------|
| Database      | Веб-приложения Access                                                                           |
| Документ      | Word для Windows, Word для Mac, Word для iPad, Word в Интернете                               |
| Почтовый ящик       | Outlook для Windows, Outlook для Mac, Outlook в Интернете, Outlook для Android, Outlook для iOS|
| Презентация  | PowerPoint для Windows, PowerPoint для Mac, PowerPoint для iPad, PowerPoint в Интернете       |
| Проект       | Project для Windows                                                                        |
| Рабочая книга      | Excel для Windows, Excel для Mac, Excel для iPad, Excel в Интернете                           |

> [!NOTE]
> `Name`Атрибут определяет ведущее приложение Office, которое может запускать вашу надстройку. Приложения Office поддерживаются на разных платформах и работают на настольных ПК, в веб-браузерах, на планшетах и мобильных устройствах. Вам не удастся указать, какую платформу можно использовать для запуска надстройки. Например, если указать `Mailbox`, то для запуска надстройки можно будет использовать и Outlook для Windows, и Outlook в Интернете.

> [!IMPORTANT]
> Больше не рекомендуется создавать и использовать веб-приложения и базы данных Access в SharePoint. В качестве альтернативы рекомендуем использовать [Microsoft PowerApps](https://powerapps.microsoft.com/) для создания бизнес-решений для Интернета и мобильных устройств без написания кода.


## <a name="set-the-requirements-element-in-the-manifest"></a>Указание элемента Requirements в манифесте

`Requirements`Элемент указывает минимальные наборы требований или элементы API, которые должны поддерживаться ведущим приложением Office для запуска надстройки. В `Requirements` элементе можно указать наборы требований и индивидуальные методы, используемые в надстройке. В схеме манифеста надстройки версии 1,1 `Requirements` элемент является необязательным для всех надстроек, кроме надстроек Outlook.

> [!WARNING]
> Используйте элемент только `Requirements` для указания критических наборов требований или элементов API, которые должна использовать надстройка. Если ведущее приложение или платформа Office не поддерживает наборы требований или элементы API, указанные в `Requirements` элементе, надстройка не будет запускаться на этом узле или платформе и не будет отображаться в **папке "Мои**надстройки". Вместо этого мы рекомендуем сделать надстройку доступной на всех платформах ведущего приложения Office, таких как Excel в Интернете, Windows и iPad. Чтобы надстройка была доступна на _всех_ узлах Office и платформах, используйте проверки среды выполнения вместо `Requirements` элемента.

В примере кода ниже показана надстройка, которая загружается во всех ведущих приложениях Office, поддерживающих указанные ниже элементы.

-  `TableBindings`набор требований с минимальной версией "1,1".

-  `OOXML`набор требований с минимальной версией "1,1".

-  `Document.getSelectedDataAsync`WebMethod.

```XML
<Requirements>
   <Sets DefaultMinVersion="1.1">
      <Set Name="TableBindings" MinVersion="1.1"/>
      <Set Name="OOXML" MinVersion="1.1"/>
   </Sets>
   <Methods>
      <Method Name="Document.getSelectedDataAsync"/>
   </Methods>
</Requirements>
```

- `Requirements`Элемент содержит `Sets` `Methods` дочерние элементы.

- `Sets`Элемент может содержать один или несколько `Set` элементов. `DefaultMinVersion`задает значение по умолчанию `MinVersion` для всех дочерних `Set` элементов.

- `Set`Элемент указывает наборы требований, которые ведущее приложение Office должно поддерживать для запуска надстройки. `Name`Атрибут указывает имя набора требований. `MinVersion`Указывает минимальную версию набора обязательных элементов. `MinVersion`переопределяет значение `DefaultMinVersion` для получения дополнительных сведений о наборах требований и версиях набора требований, к которым относятся элементы API, ознакомьтесь со статьей " [наборы требований для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md)".

- `Methods`Элемент может содержать один или несколько `Method` элементов. Вы не можете использовать `Methods` элемент с надстройками Outlook.

- `Method`Элемент определяет отдельный метод, который должен поддерживаться ведущим приложением Office, на котором работает надстройка. `Name`Атрибут является обязательным и указывает имя метода, дополненного его родительским объектом.

## <a name="use-runtime-checks-in-your-javascript-code"></a>Использование проверок в среде выполнения в коде JavaScript

Если ведущее приложение Office поддерживает определенные наборы требований, вы можете добавить в надстройку дополнительные функции. Например, если надстройка работает в Word 2016, вы можете использовать в ней API JavaScript для Word. Для этого используйте метод [isSetSupported](/javascript/api/office/office.requirementsetsupport#issetsupported-name--minversion-) с именем набора обязательных элементов. `isSetSupported`Определяет, будет ли узел Office, на котором выполняется надстройка, поддерживать набор обязательных элементов в среде выполнения. Если набор требований поддерживается, `isSetSupported` возвращает **значение true** и запускает дополнительный код, который использует элементы API из этого набора требований. Если ведущее приложение Office не поддерживает набор требований, `isSetSupported` возвращается **значение false** , а дополнительный код не запустится. В приведенном ниже коде показан синтаксис, используемый с `isSetSupported` .

```js
if (Office.context.requirements.isSetSupported(RequirementSetName, MinimumVersion))
{
   // Code that uses API members from RequirementSetName.
}

```

- _RequirementSetName_ (обязательный параметр) — это строка, представляющая имя набора обязательных элементов (например, "**ExcelApi**", "**Mailbox**" и т. д.). Дополнительные сведения о доступных наборах обязательных элементов см. в статье [Наборы обязательных элементов для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md).
- _MinimumVersion_ (необязательный параметр) — это строка, указывающая минимальную версию набора обязательных элементов, которая должна поддерживаться ведущим приложением, чтобы выполнять код в операторе `if` (например, "**1.9**").

> [!WARNING]
> При вызове `isSetSupported` метода значение `MinimumVersion` параметра (если задано) должно быть строкой. Это обусловлено тем, что средство синтаксического анализа JavaScript не может различить числовые значения, например 1.1 и 1.10, но может различать строковые значения, например "1.1" и "1.10".
> Перегрузка оператора `number` не рекомендуется.

Используйте `isSetSupported` со `RequirementSetName` связанным с ведущим приложением Office, как показано ниже.

|Ведущее приложение Office|RequirementSetName|
|---|---|
|Excel|ExcelApi|
|OneNote|OneNoteApi|
|Outlook|Mailbox|
|Word|WordApi|

`isSetSupported`Метод и наборы требований для этих ведущих приложений доступны в последнем файле Office. js в сети CDN. Если вы не используете Office. js из сети CDN, надстройка может создать исключения, так как `isSetSupported` она будет неопределенной. Дополнительные сведения см. [в статье определение последней версии библиотеки API JavaScript для Office](#specify-the-latest-office-javascript-api-library).

В приведенном ниже примере кода показано, как функциональность надстройки может отличаться в ведущих приложениях Office, поддерживающих разные наборы обязательных элементов или элементы API.

```js
if (Office.context.requirements.isSetSupported('WordApi', '1.1'))
{
    // Run code that provides additional functionality using the Word JavaScript API when the add-in runs in Word 2016 or later.
}
else if (Office.context.requirements.isSetSupported('CustomXmlParts'))
{
    // Run code that uses API members from the CustomXmlParts requirement set.
}
else
{
    // Run additional code when the Office host is not Word 2016 or later and does not support the CustomXmlParts requirement set.
}

```

## <a name="runtime-checks-using-methods-not-in-a-requirement-set"></a>Проверки в среде выполнения с использованием методов, не входящих в набор обязательных элементов

Некоторые элементы API не входят в наборы обязательных элементов. Это относится только к элементам API, которые входят в пространство имен [API JavaScript для Office](../reference/javascript-api-for-office.md) (как и в случае с `Office.` [API почтовых ящиков Outlook](/javascript/api/outlook)), но не к элементам API, принадлежащим к [API JavaScript для Word](../reference/overview/word-add-ins-reference-overview.md) (любые в `Word.` ), [API JavaScript для Excel](../reference/overview/excel-add-ins-reference-overview.md) (что-то в `Excel.` ) или пространствах [API](../reference/overview/onenote-add-ins-javascript-reference.md) JavaScript (любых элементов `OneNote.` ). Если надстройка зависит от метода, не входящего в набор обязательных элементов, вы можете использовать проверку в среде выполнения, чтобы определить, поддерживается ли метод ведущим приложением Office, как показано в примере кода ниже. Список всех методов, не входящих в набор обязательных элементов, см. в статье [Наборы обязательных элементов для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md#methods-that-arent-part-of-a-requirement-set).

> [!NOTE]
> Рекомендуем ограничить использование этого типа проверки в среде выполнения в коде надстройки.

В следующем примере кода проверяется, поддерживает ли ведущее приложение `document.setSelectedDataAsync` .

```js
if (Office.context.document.setSelectedDataAsync)
{
    // Run code that uses document.setSelectedDataAsync.
}
```


## <a name="see-also"></a>См. также

- [XML-манифест надстройки Office](add-in-manifests.md)
- [Наборы обязательных элементов для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md)
- [Word-Add-in-Get-Set-EditOpen-XML ](https://github.com/OfficeDev/Word-Add-in-Get-Set-EditOpen-XML)
