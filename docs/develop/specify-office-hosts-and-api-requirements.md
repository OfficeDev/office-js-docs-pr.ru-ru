---
title: Указание ведущих приложений Office и требований к API
description: Узнайте, как указать Office приложений и API для вашей надстройки, чтобы работать как ожидалось.
ms.date: 01/26/2022
ms.localizationpriority: medium
ms.openlocfilehash: 1df753dfe3e5c517f49d597f9298744cf0c79f52
ms.sourcegitcommit: 968d637defe816449a797aefd930872229214898
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2022
ms.locfileid: "63744059"
---
# <a name="specify-office-applications-and-api-requirements"></a>Указание приложений Office и требований API

Ваша Office надстройка может зависеть от конкретного приложения Office (также называемого Office хост) или от определенных членов Office API JavaScript (office.js). Например, надстройка может:

- работать в одном (например, Word или Excel) или нескольких приложениях Office;
- Используйте Office API JavaScript, доступные только в некоторых версиях Office. Например, разовая версия Excel 2016 не поддерживает все API Excel связанных с Office JavaScript.

В таких ситуациях необходимо убедиться, что надстройка никогда не устанавливается на Office или Office версиях, в которых она не может работать.

Существуют также сценарии, в которых необходимо контролировать, какие функции надстройки видны пользователям на основе их Office и Office версии. Два примера:

- Ваша надстройка имеет функции, которые полезны как в Word, так и в PowerPoint, например, в обработке текста, но имеют некоторые дополнительные функции, которые имеют смысл только в PowerPoint, например функции управления слайдами. При запуске надстройки в Word необходимо скрыть функции, PowerPoint только для всех.
- У надстройки есть функция, которая требует метода API Office JavaScript, который поддерживается в некоторых версиях приложения Office, например подписка Excel, но не поддерживается в других, например в Excel 2016. Но у вашей надстройки есть другие функции, Office методы API JavaScript, поддерживаемые в Excel 2016. В этом сценарии необходимо установить надстройку в Excel 2016, но функция, которая требует неподтверченного метода, должна быть скрыта от пользователей Excel 2016.

Эта статья поможет вам разобраться, какие параметры следует выбрать для правильной работы надстройки и максимального охвата аудитории.

> [!NOTE]
> Для представления на высоком уровне о том, Office поддерживаются надстройки в настоящее время, см. в Office клиентского приложения и доступности платформы для [Office](../overview/office-add-in-availability.md) надстройки.

> [!TIP]
> Многие задачи, описанные в этой статье, делаются для вас целиком или частично при создании проекта надстройки с помощью средства, например генератора [Yeoman для Office](yeoman-generator-overview.md) надстройки или одного из шаблонов надстройки Office в Visual Studio. В таких случаях, пожалуйста, интерпретируете задачу как значение того, что вы должны убедиться, что она была сделана.

## <a name="use-the-latest-office-javascript-api-library"></a>Используйте последнюю Office API JavaScript

Надстройка должна загрузить наиболее текущую версию библиотеки API Office JavaScript из сети доставки контента (CDN). Для этого убедитесь, что в `script` первом HTML-файле откроется следующая метка. Чтобы всегда ссылаться на последнюю версию файла Office.js, используйте `/1/` в URL-адресе сети доставки содержимого.

```HTML
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js" type="text/javascript"></script>
```

## <a name="specify-which-office-applications-can-host-your-add-in"></a>Укажите, Office приложения могут принимать вашу надстройка

По умолчанию надстройка устанавливается во Office приложениях, поддерживаемых указанным типом надстройки (то есть Mail, Task pane или Content). Например, надстройка области задач устанавливается по умолчанию в Access, Excel, OneNote, PowerPoint, Project и Word. 

Чтобы убедиться, что надстройка устанавливается в подмножество приложений Office, используйте элементы [Hosts](../reference/manifest/hosts.md) и [Host](../reference/manifest/host.md) в манифесте.

Например, в следующей  декларации  хостов и хостов указывается, что надстройка может устанавливаться в любом выпуске Excel, который включает Excel в Интернете, Windows и iPad, но не может быть установлен в любом другом приложении Office.

```xml
<Hosts>
  <Host Name="Workbook" />
</Hosts>
```

Элемент **Hosts** может содержать один или несколько **элементов host** . Для каждого **приложения должен быть** отдельный элемент host Office, на котором должна быть устанавливается надстройка. Атрибут `Name` необходим и может быть задат одним из следующих значений.

| Имя          | Office клиентских приложений                     | Доступные типы надстройки |
|:--------------|:-----------------------------------------------|:-----------------------|
| Database      | Веб-приложения Access                                | Область задач              |
| Document      | Word в Интернете, Windows, Mac, iPad            | Область задач              |
| Mailbox       | Outlook в Интернете, Windows, Mac, Android, iOS | Почта                   |
| Notebook      | OneNote в Интернете                             | Области задач, контент     |
| Presentation  | PowerPoint в Интернете, Windows, Mac, iPad      | Области задач, контент     |
| Проект       | Project для Windows                             | Область задач              |
| Workbook      | Excel в Интернете, Windows, Mac, iPad           | Области задач, контент     |

> [!NOTE]
> Office поддерживаются на разных платформах и запускаются на настольных компьютерах, веб-браузерах, планшетах и мобильных устройствах. Обычно нельзя указать, какую платформу можно использовать для запуска надстройки. Например, если указать`Workbook`, Excel в Интернете и Windows можно использовать для запуска надстройки. Однако, если указать`Mailbox`, ваша надстройка не будет работать Outlook мобильных клиентов, если вы не определите точки [расширения для мобильных устройств](../reference/manifest/extensionpoint.md#mobilemessagereadcommandsurface).

> [!NOTE]
> Манифест надстройки не может применяться к более чем одному типу: mail, task pane или Content. Это означает, что если вы хотите, чтобы надстройка устанавливалась на Outlook и на одном из других приложений Office, необходимо создать две надстройки: одну  с манифестом типа Почта, а другую — с области задач или манифестом типа контента.

> [!IMPORTANT]
> Больше не рекомендуется создавать и использовать веб-приложения и базы данных Access в SharePoint. В качестве альтернативы рекомендуем использовать [Microsoft PowerApps](https://powerapps.microsoft.com/) для создания бизнес-решений для Интернета и мобильных устройств без написания кода.

## <a name="specify-which-office-versions-and-platforms-can-host-your-add-in"></a>Укажите Office какие версии и платформы могут принимать вашу надстройка

Вы не можете точно указать Office версии и сборки или платформы, на которых должна устанавливаться надстройка, и вам этого не нужно, так как вам придется пересматривать манифест всякий раз, когда поддержка функций надстройки, на которых используется надстройка, распространяется на новую версию или платформу. Вместо этого укажите в манифесте API, необходимые вашей надстройки. Office не позволяет устанавливать надстройки на сочетания Office версии и платформы, которые не поддерживают API, и гарантирует, что надстройка не появится в моих надстройких **.**

> [!IMPORTANT]
> Только используйте базовый манифест, чтобы указать членов API, которые должны иметь значение для вашей надстройки. Если ваша надстройка использует API для некоторых функций, но имеет другие полезные функции, которые не требуют API, необходимо разработать надстройки так, чтобы она устанавливалась на платформе и Office версиях, которые не поддерживают API, но предоставляют уменьшенный опыт для этих комбинаций. Дополнительные сведения см. в [веб-сведениях Design for alternate experiences](#design-for-alternate-experiences).

### <a name="requirement-sets"></a>Наборы обязательных элементов

Чтобы упростить процесс указания API, необходимых вашей надстройки, Office большинство API в *наборах требований*. API в общей [объектной модели API](understanding-the-javascript-api-for-office.md#api-models) группуются по поддерживаемой ими функции разработки. Например, все API, подключенные к привязкам таблиц, находятся в наборе требований под названием "TableBindings 1.1". API в определенных объектах [Приложения](understanding-the-javascript-api-for-office.md#api-models) группуются по моменту их выпуска для использования в производственных надстройках.

Настраиваются наборы требований. Например, API, поддерживаюные [диалоговое окно](../design/dialog-boxes.md) , находятся в наборе требований DialogApi 1.1. Когда были выпущены дополнительные API, которые позволяют обмена сообщениями из области задач в диалоговое окно, они сгруппировали в DialogApi 1.2, а также все API в DialogApi 1.1. *Каждая версия набора требований — это суперсеть всех предыдущих версий.*

Поддержка набора требований зависит Office приложения, версии Office и платформы, на которой оно запущено. Например, DialogApi 1.2 не поддерживается в одноразовой версии Office до Office 2021 г., но диалоговое окно DialogApi 1.1 поддерживается во всех одноразовых версиях покупки Office 2013 г. Вы хотите, чтобы надстройка устанавливалась на каждую комбинацию платформы и Office версии, которая поддерживает API, которые она использует, поэтому всегда следует указать в манифесте минимальную  версию каждого набора требований, которые требуются вашей надстройки. Подробные сведения о том, как это сделать, далее в этой статье.

> [!TIP]
> Дополнительные сведения о версии набора требований см. [](office-versions-and-requirement-sets.md#office-requirement-sets-availability)в Office наборов требований, а полные списки наборов требований и сведения об API в каждом из них начинаются с Office наборов требований [к надстройки](../reference/requirement-sets/office-add-in-requirement-sets.md). Справочные темы для большинства Office.js API также указывают набор требований, к который они принадлежат (если таково).

> [!NOTE]
> Некоторые наборы требований также имеют элементы манифеста, связанные с ними. Сведения о том, когда этот факт относится к разработке надстройки, см. в документе "Указание требований в [элементе VersionOverrides](#specify-requirements-in-a-versionoverrides-element) ".

#### <a name="apis-not-in-a-requirement-set"></a>API не в наборе требований

Все API в определенных моделях приложений находятся в наборах требований, но некоторые из них в модели общего API не являются. Существует также способ, который можно указать один из этих неустроимых API в манифесте, когда надстройка требует его. Подробные сведения см. далее в этой статье.

### <a name="requirements-element"></a>Элемент Requirements

Используйте элемент [Requirements](../reference/manifest/requirements.md) и его детские элементы [Sets and](../reference/manifest/sets.md) [Methods](../reference/manifest/methods.md) для указания минимальных наборов требований или членов API, которые должны поддерживаться приложением Office для установки надстройки. 

Если Office или платформа не поддерживает наборы требований или членов API, указанных в элементе **Requirements**, надстройка не будет работать в этом приложении или платформе и не будет отображаться в моих надстройких. .

> [!NOTE]
> Элемент **Requirements** необязателен для всех надстройок, за исключением Outlook надстройки. При атрибуте `xsi:type` `OfficeApp` `MailBox`корневого элемента должен быть элемент **Requirements**, который указывает минимальную версию набора требований MailBox, который требуется надстройке. Дополнительные сведения см. [в Outlook наборов требований к API JavaScript](../reference/requirement-sets/outlook-api-requirement-sets.md).

В следующем примере кода показано, как настроить надстройку, которая устанавливается во всех Office приложениях, поддерживаюх следующие:

-  `TableBindings` набор требований, который имеет минимальную версию "1.1".
-  `OOXML` набор требований, который имеет минимальную версию "1.1".
-  `Document.getSelectedDataAsync` метод.

```XML
<OfficeApp ... >
  ...
  <Requirements>
     <Sets DefaultMinVersion="1.1">
        <Set Name="TableBindings" MinVersion="1.1"/>
        <Set Name="OOXML" MinVersion="1.1"/>
     </Sets>
     <Methods>
        <Method Name="Document.getSelectedDataAsync"/>
     </Methods>
  </Requirements>
    ...
</OfficeApp>
```
Обратите внимание на следующий пример.

- Элемент **Requirements** содержит детские элементы **Sets** and **Methods** .
- Элемент **Sets** может содержать один или несколько **элементов Set** . `DefaultMinVersion` указывает значение по умолчанию `MinVersion` для всех элементов **набора** детей.
- Элемент [Set](../reference/manifest/set.md) указывает набор требований, которые Office приложение должно поддерживать для установки надстройки. Атрибут `Name` указывает имя набора требований. Указывает `MinVersion` минимальную версию набора требований. `MinVersion` переопределяет значение атрибута в `DefaultMinVersion` родительских **наборах**.
- Элемент **Methods** может содержать один или несколько [элементов Method](../reference/manifest/method.md) . Элемент **Methods** не следует использовать с надстройками Outlook.
- Элемент **Method** указывает отдельный метод, который Office приложение должно поддерживать для установки надстройки. Атрибут `Name` необходим и указывает имя метода, квалифицированного с родительским объектом.

## <a name="design-for-alternate-experiences"></a>Разработка альтернативных опытом

Возможности, которые предоставляет платформа Office надстройки, можно с пользой разделить на три вида:

- Функции extensibility, доступные сразу после установки надстройки. Этот вид функции можно использовать, настроив элемент [VersionOverrides](../reference/manifest/versionoverrides.md) в манифесте. Примером такого рода функции являются [команды надстройки](../design/add-in-commands.md), которые являются настраиваемые кнопки ленты и меню.
- Функции extensibility, доступные только при запуске надстройки и реализованных с Office.js API JavaScript; например, [диалоговое окно](../design/dialog-boxes.md).
- Функции extensibility, доступные только во время выполнения, но реализуются с сочетанием Office.js JavaScript и конфигурации в **элементе VersionOverrides** . Примеры из них — [Excel](../excel/custom-functions-overview.md)[,](sso-in-office-add-ins.md) отдельные входные и [настраиваемые контекстные вкладки](../design/contextual-tabs.md).

Если надстройка использует определенную функцию просторности для некоторых функциональных возможностей, но обладает другими полезными функциями, не требуемыми для функции раздвивемости, необходимо разработать надстройку так, чтобы она устанавливалась на платформе и Office сочетаниях версий, которые не поддерживают функцию extensibility. Это может обеспечить ценный, хотя и уменьшенный, опыт для этих комбинаций. 

Этот проект реализуется по-разному в зависимости от того, как реализована функция разнонабежности: 

- Для функций, полностью реализованных с Помощью JavaScript, см. в этой ссылке проверки времени [выполнения для поддержки набора методов и требований](#runtime-checks-for-method-and-requirement-set-support).
- Для функций, которые требуют настройки элемента **VersionOverrides** , см. в рубке Указание требований [в элементе VersionOverrides](#specify-requirements-in-a-versionoverrides-element).

### <a name="runtime-checks-for-method-and-requirement-set-support"></a>Проверка времени работы для поддержки набора методов и требований 

Во время запуска проверяются, поддерживает ли Office пользователя набор требований с [помощью метода isSetSupported](/javascript/api/office/office.requirementsetsupport#office-office-requirementsetsupport-issetsupported-member(1)). Передай имя набора требований и минимальную версию в качестве параметров. Если набор требований поддерживается, `isSetSupported` возвращается **true**. Ниже приводится пример кода.

```js
if (Office.context.requirements.isSetSupported('WordApi', '1.1'))
{
   // Code that uses API members from the WordApi 1.1 requirement set.
} else {
   // Provide diminished experience here. E.g., run alternate code when the user's Word is one-time purchase Word 2013 (which does not support WordApi 1.1).
}
```
Вот что нужно знать об этом коде:

- Требуется первый параметр. Это строка, которая представляет имя набора требований. Дополнительные сведения о доступных наборах обязательных элементов см. в статье [Наборы обязательных элементов для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md).
- Второй параметр необязателен. Это строка`if`, которая указывает минимальную версию набора требований, которую Office приложение должно поддерживать для запуска кода в заявлении (например, "**1.9**"). Если не используется, предполагается версия "1.1".

> [!WARNING]
> При вызове `isSetSupported` метода значение второго параметра (если указано) должно быть строкой, а не номером. Parser JavaScript не может различать числительные значения, такие как 1.1 и 1.10, в то время как он может для строки значений, таких как "1.1" и "1.10".

В следующей таблице показаны имена набора требований для моделей API приложения.

|Приложение Office|RequirementSetName|
|---|---|
|Excel|ExcelApi|
|OneNote|OneNoteApi|
|Outlook|Mailbox|
|PowerPoint|PowerPointApi|
|Word|WordApi|

Ниже приводится пример использования метода с одним из наборов требований к модели API.

```js
if (Office.context.requirements.isSetSupported('CustomXmlParts'))
{
    // Run code that uses API members from the CustomXmlParts requirement set.
}
else
{
    // Run alternate code when the user's Word doesn't support the CustomXmlParts requirement set.
}
```

> [!NOTE] 
> Метод `isSetSupported` и наборы требований для этих приложений доступны в последнем Office.js файле CDN. Если вы не используете Office.js из CDN, `isSetSupported` ваша надстройка может создавать исключения, если используется старая версия библиотеки, в которой не разопределен. Дополнительные сведения см. в Office [библиотеке API JavaScript](#use-the-latest-office-javascript-api-library).

Если надстройка зависит от метода, который не входит в набор требований, используйте проверку времени запуска, чтобы определить, поддерживается ли метод приложением Office, как показано в следующем примере кода. Список всех методов, не входящих в набор обязательных элементов, см. в статье [Наборы обязательных элементов для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md#methods-that-arent-part-of-a-requirement-set).

> [!NOTE]
> Рекомендуем ограничить использование этого типа проверки в среде выполнения в коде надстройки.

В следующем примере кода проверяется, поддерживает ли Office приложение`document.setSelectedDataAsync`.

```js
if (Office.context.document.setSelectedDataAsync)
{
    // Run code that uses `document.setSelectedDataAsync`.
}
```

### <a name="specify-requirements-in-a-versionoverrides-element"></a>Указание требований в элементе VersionOverrides

Элемент [VersionOverrides](../reference/manifest/versionoverrides.md) был добавлен в схему манифеста главным образом, но не только для поддержки функций, которые должны быть доступны сразу после установки надстройки, например команд надстроек (настраиваемые кнопки ленты и меню). Office должны знать об этих особенностях при размыве манифеста надстройки. 

Предположим, что надстройка использует одну из этих функций, но надстройка ценна и должна устанавливаться даже в Office версиях, которые не поддерживают эту функцию. В этом сценарии определите функцию с помощью элемента [Requirements](../reference/manifest/requirements.md) (и его [](../reference/manifest/sets.md) элементов [](../reference/manifest/methods.md) наборов и методов ребенка), который вы включаете в качестве ребенка самого элемента **VersionOverrides**`OfficeApp`, а не в качестве ребенка базового элемента. В результате этого Office разрешить установку надстройки, но Office будет игнорировать некоторые детские элементы элемента **VersionOverrides** в Office версиях, где функция не поддерживается.

В частности, игнорируются детские элементы **VersionOverrides** , переопределяющие элементы базового манифеста, такие как элемент **Hosts** , и вместо этого используются соответствующие элементы базового манифеста. Однако в **VersionOverrides** могут быть детские элементы, которые фактически реализуют дополнительные функции, а не переопределяют параметры в базовом манифесте. Два примера: и `WebApplicationInfo` `EquivalentAddins`. Эти части **VersionOverrides** не будут игнорироваться, если платформа и версия Office поддерживают соответствующую функцию.  

Сведения о потомковом элементе элемента **Requirements** см. в статье [Requirements element](#requirements-element) earlier in this article.

Ниже приведен пример.

```XML
<VersionOverrides ... >
   ...
   <Requirements>
      <Sets DefaultMinVersion="1.1">
         <Set Name="WordApi" MinVersion="1.2"/>
      </Sets>
   </Requirements>
   <Hosts>

      <!-- ALL MARKUP INSIDE THE HOSTS ELEMENT IS IGNORED WHEREVER WordApi 1.2 IS NOT SUPPORTED -->

      <Host xsi:type="Workbook">
         <!-- markup for custom add-in commands -->
      </Host>
   </Hosts>
</VersionOverrides>
```

> [!WARNING]
> Прежде чем использовать элемент **Requirements** в **VersionOverrides***, используйте* большую внимательность, так как на платформах и версиях, которые не поддерживают это требование, ни одна из команд надстройки не будет установлена *, даже* те, которые вызывают функциональность, которая не нуждается в этом требовании. Рассмотрим, например, надстройка, которая имеет две настраиваемые кнопки ленты. Один из них вызывает Office API JavaScript, доступные в наборе требований **ExcelApi 1.4** (и более поздней части). Другие вызовы API, доступные только в **ExcelApi 1.9** (и более поздней). Если вы поместите требование **для ExcelApi 1.9** в **VersionOverrides**, то если кнопка 1.9 не поддерживается, на ленте  не появится ни одна кнопка. Лучшей стратегией в этом сценарии было бы использование метода, описанного в проверках времени запуска для поддержки набора [методов и требований](#runtime-checks-for-method-and-requirement-set-support). Код, на который ссылается вторая кнопка, `isSetSupported` сначала используется для проверки поддержки **ExcelApi 1.9**. Если он не поддерживается, код дает пользователю сообщение о том, что эта функция надстройки недоступна в версии Office. 

> [!TIP]
> Нет смысла повторять элемент **Requirement** в **versionOverrides** , который уже отображается в базовом манифесте. Если требование указано в базовом манифесте, надстройка не может устанавливаться там, где это требование не поддерживается, поэтому Office даже не размыкает элемент **VersionOverrides**. 

## <a name="see-also"></a>См. также

- [XML-манифест надстройки Office](add-in-manifests.md)
- [Наборы обязательных элементов для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md)
- [Word-Add-in-Get-Set-EditOpen-XML ](https://github.com/OfficeDev/Word-Add-in-Get-Set-EditOpen-XML)
