---
title: Указание ведущих приложений Office и требований к API
description: Узнайте, как указать Office приложений и API для правильной работы надстройки.
ms.date: 05/19/2022
ms.localizationpriority: medium
ms.openlocfilehash: 60ad00c918b04b6f12ecb6eec6c40772448b2ab8
ms.sourcegitcommit: 4ca3334f3cefa34e6b391eb92a429a308229fe89
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2022
ms.locfileid: "65628049"
---
# <a name="specify-office-applications-and-api-requirements"></a>Указание приложений Office и требований API

Надстройка Office может зависеть от конкретного приложения Office (также называемого узлом Office) или от определенных членов API JavaScript Office (office.js). Например, надстройка может:

- работать в одном (например, Word или Excel) или нескольких приложениях Office;
- Используйте Office API JavaScript, доступные только в некоторых версиях Office. Например, версия однофакторной покупки Excel 2016 не поддерживает все API, связанные Excel, в Office JavaScript.

В таких ситуациях необходимо убедиться, что надстройка никогда не устанавливается в Office приложениях или Office версиях, в которых она не может работать.

Существуют также сценарии, в которых вы хотите контролировать, какие функции надстройки видны пользователям в зависимости от их Office и Office версии. Ниже приведены два примера.

- Ваша надстройка имеет функции, которые полезны как в Word, так и PowerPoint, такие как обработка текста, но она имеет некоторые дополнительные функции, которые имеют смысл только в PowerPoint, например функции управления слайдами. При работе надстройки в Word PowerPoint функции, которые доступны только для пользователей.
- У надстройки есть функция, которая требует использования метода API JavaScript Office, который поддерживается в некоторых версиях приложения Office, например подписки Excel, но не поддерживается в других, таких как однофакторная покупка Excel 2016. Но у надстройки есть и другие функции, которые требуют Office API JavaScript *, которые* поддерживаются в Excel 2016. В этом сценарии надстройку необходимо установить на Excel 2016, но функция, требуемая для неподдерживаемого метода, должна быть скрыта от пользователей Excel 2016.

Эта статья поможет вам разобраться, какие параметры следует выбрать для правильной работы надстройки и максимального охвата аудитории.

> [!NOTE]
> Общие сведения о том, Office надстройки в настоящее время поддерживаются, см. на странице Office клиентского приложения и платформы для Office [надстроек](/javascript/api/requirement-sets).

> [!TIP]
> Многие задачи, описанные в этой статье, выполняются полностью или частично при создании проекта надстройки с помощью средства, например [генератора Yeoman для надстроек Office](yeoman-generator-overview.md) или одного из шаблонов надстроек Office в Visual Studio. В таких случаях следует интерпретировать задачу как означающее, что необходимо убедиться, что она выполнена.

## <a name="use-the-latest-office-javascript-api-library"></a>Использование последней Office API JavaScript

Надстройка должна загрузить последнюю версию библиотеки API JavaScript Office из сети доставки содержимого (CDN). Для этого убедитесь `script` , что в первом HTML-файле надстройки есть следующий тег. Чтобы всегда ссылаться на последнюю версию файла Office.js, используйте `/1/` в URL-адресе сети доставки содержимого.

```HTML
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js" type="text/javascript"></script>
```

## <a name="specify-which-office-applications-can-host-your-add-in"></a>Укажите, Office приложения могут разместить надстройку

По умолчанию надстройку можно установить во всех Office приложениях, поддерживаемых указанным типом надстройки (почта, область задач или содержимое). Например, надстройку области задач можно установить по умолчанию в Access, Excel, OneNote, PowerPoint, Project и Word. 

Чтобы убедиться, что надстройка доступна для установки в подмножество Office приложениях, используйте элементы [Hosts](/javascript/api/manifest/hosts) и [Host](/javascript/api/manifest/host) в манифесте.

Например, в следующем объявлении **hosts и** **Host** указано, что надстройка может устанавливаться в любом выпуске Excel, который включает Excel в Интернете, Windows и iPad, но не может быть установлена в любом другом Office.

```xml
<Hosts>
  <Host Name="Workbook" />
</Hosts>
```

Элемент **Hosts** может содержать один или несколько элементов **Host** . Для каждого приложения **,** в котором должна быть Office надстройка, должен быть отдельный элемент Host. Атрибут `Name` является обязательным и может иметь одно из следующих значений.

| Имя          | Office клиентских приложений                     | Доступные типы надстроек |
|:--------------|:-----------------------------------------------|:-----------------------|
| Database      | Веб-приложения Access                                | Область задач              |
| Документ      | Word в Интернете, Windows, Mac, iPad            | Область задач              |
| Mailbox       | Outlook в Интернете, Windows, Mac, Android, iOS | Почта                   |
| Notebook      | OneNote в Интернете                             | Область задач, содержимое     |
| Presentation  | PowerPoint в Интернете, Windows, Mac, iPad      | Область задач, содержимое     |
| Проект       | Project для Windows                             | Область задач              |
| Книга      | Excel в Интернете, Windows, Mac, iPad           | Область задач, содержимое     |

> [!NOTE]
> Office приложения поддерживаются на разных платформах и выполняются на настольных компьютерах, веб-браузерах, планшетах и мобильных устройствах. Обычно нельзя указать, какую платформу можно использовать для запуска надстройки. Например, при указании `Workbook`Excel в Интернете и Windows можно использовать для запуска надстройки. Однако если вы укажете`Mailbox`, ваша надстройка не будет работать на мобильных Outlook, если вы не определите точку [расширения для мобильных устройств](/javascript/api/manifest/extensionpoint#mobilemessagereadcommandsurface).

> [!NOTE]
> Манифест надстройки не может применяться к нескольким типам: почте, области задач или контенту. Это означает, что если вы хотите, чтобы надстройку можно было установить в Outlook и в одном из других приложений Office, необходимо создать две надстройки:  одну с манифестом типа "Почта", а другую — с областью задач или манифестом типа контента.

> [!IMPORTANT]
> Больше не рекомендуется создавать и использовать веб-приложения и базы данных Access в SharePoint. В качестве альтернативы рекомендуем использовать [Microsoft PowerApps](https://powerapps.microsoft.com/) для создания бизнес-решений для Интернета и мобильных устройств без написания кода.

## <a name="specify-which-office-versions-and-platforms-can-host-your-add-in"></a>Укажите Office версий и платформ для размещения надстройки.

Вы не можете явно указать версии Office и сборки или платформы, на которых должна быть установлена надстройка, и не хотите, так как вам придется изменять манифест всякий раз, когда поддержка функций надстройки, используемых надстройки, распространяется на новую версию или платформу. Вместо этого укажите в манифесте API, необходимые надстройке. Office запрещает установку надстройки на сочетаниях версий Office и платформы, которые не поддерживают API, и гарантирует, что надстройка не будет отображаться в разделе "Мои надстройки **".**

> [!IMPORTANT]
> Используйте только базовый манифест, чтобы указать элементы API, которые должны иметь какие-либо значимые значения для надстройки. Если надстройка использует API для некоторых функций, но имеет другие полезные функции, которые не требуют API, следует разработать надстройку, чтобы она была установлена на платформе и Office версиях, которые не поддерживают API, но предоставляют меньше возможностей для этих сочетаний. Дополнительные сведения см. [в разделе "Конструктор для альтернативных возможностей"](#design-for-alternate-experiences).

### <a name="requirement-sets"></a>Наборы обязательных элементов

Чтобы упростить процесс указания API, необходимых надстройке, Office большинство API в *наборах обязательных элементов*. Интерфейсы API в общей объектной модели [API](understanding-the-javascript-api-for-office.md#api-models) группируются по поддерживаемой функции разработки. Например, все API, подключенные к привязкам таблиц, находятся в наборе обязательных элементов с именем TableBindings 1.1. API-интерфейсы [в объектных](understanding-the-javascript-api-for-office.md#api-models) моделях приложения группируются по моменту их выпуска для использования в рабочих надстройки.

Наборы обязательных элементов имеют версию. Например, API, поддерживающие [диалоговые окна](../develop/dialog-api-in-office-add-ins.md) , находятся в наборе обязательных элементов DialogApi 1.1. Когда были выпущены дополнительные API, которые обеспечивают обмен сообщениями из области задач в диалоговое окно, они были сгруппированные в DialogApi 1.2 вместе со всеми API в DialogApi 1.1. *Каждая версия набора обязательных элементов является надмножеством всех более ранних версий.*

Поддержка набора обязательных элементов зависит Office приложения, версии приложения Office и платформы, на которой оно выполняется. Например, DialogApi 1.2 не поддерживается в однофакторной покупке версий Office до Office 2021, но DialogApi 1.1 поддерживается во всех разовых версиях покупок до Office 2013. Вы хотите, чтобы надстройка устанавливались на всех сочетаниях платформы и Office версии, которая поддерживает API- интерфейсы, которые она использует, поэтому всегда следует указывать в манифесте минимальную версию каждого набора обязательных элементов, необходимых надстройке. Дополнительные сведения о том, как это сделать, см. далее в этой статье.

> [!TIP]
> Дополнительные сведения об управлении версиями набора обязательных элементов см. в Office о доступности наборов обязательных элементов[, а](office-versions-and-requirement-sets.md#office-requirement-sets-availability) полные списки наборов обязательных элементов и сведения об API в каждом из них начинаются с Office наборов обязательных элементов надстроек[.](/javascript/api/requirement-sets/common/office-add-in-requirement-sets) В справочных разделах по большинству Office.js API также указывается набор обязательных элементов, к которой они относятся (при наличии).

> [!NOTE]
> С некоторыми наборами требований также связаны элементы манифеста. Сведения о том, когда этот факт относится к дизайну надстройки, см. в разделе "Указание требований в элементе [VersionOverrides](#specify-requirements-in-a-versionoverrides-element) ".

#### <a name="apis-not-in-a-requirement-set"></a>API не в наборе обязательных элементов

Все API в конкретных моделях приложения находятся в наборах обязательных элементов, но некоторые из них в модели common API — нет. Существует также способ, с помощью которого можно указать один из этих API-интерфейсов без задаваемого значения в манифесте, если он требуется надстройке. Подробные сведения см. далее в этой статье.

### <a name="requirements-element"></a>Элемент Requirements

Используйте [элемент Requirements](/javascript/api/manifest/requirements) и его дочерние элементы [Sets](/javascript/api/manifest/sets) and [Methods](/javascript/api/manifest/methods), чтобы указать минимальные наборы обязательных элементов или элементы API, которые должны поддерживаться приложением Office для установки надстройки. 

Если приложение Office или платформа не поддерживает наборы обязательных элементов или элементы API, указанные в элементе **Requirements**, надстройка не будет работать в этом приложении или платформе и не будет отображаться в разделе "Мои надстройки **".**

> [!NOTE]
> Элемент **Requirements** является необязательным для всех надстроек, за исключением Outlook надстроек. Если атрибут `xsi:type` корневого `OfficeApp` `MailApp`элемента имеет значение, должен существовать элемент **Requirements**, указывающий минимальную версию набора обязательных элементов почтового ящика, требуемую надстройке. Дополнительные сведения см[. в Outlook наборах обязательных элементов API JavaScript](/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets).

В следующем примере кода показано, как настроить надстройку, которую можно установить во всех Office приложениях, поддерживающих следующее:

-  `TableBindings` набор обязательных элементов, который имеет минимальную версию 1.1.
-  `OOXML` набор обязательных элементов, который имеет минимальную версию 1.1.
-  `Document.getSelectedDataAsync` Метод.

```XML
<OfficeApp ... >
  ...
  <Requirements>
     <Sets DefaultMinVersion="1.1">
        <Set Name="TableBindings" MinVersion="1.1"/>
        <Set Name="OOXML" MinVersion="1.1"/>
     </Sets>
     <Methods>
        <Method Name="Document.getSelectedDataAsync"/>
     </Methods>
  </Requirements>
    ...
</OfficeApp>
```
Обратите внимание на следующие сведения об этом примере.

- Элемент **Requirements** содержит дочерние **элементы Sets** и **Methods** .
- Элемент **Sets** может содержать один или несколько **элементов Set** . `DefaultMinVersion` задает значение по умолчанию `MinVersion` для всех дочерних **элементов Set** .
- Элемент [Set](/javascript/api/manifest/set) задает набор обязательных элементов, Office приложение должно поддерживать установку надстройки. Атрибут `Name` указывает имя набора обязательных элементов. Указывает `MinVersion` минимальную версию набора обязательных элементов. `MinVersion` переопределяет значение атрибута `DefaultMinVersion` в родительских **наборах**.
- Элемент **Methods** может содержать один или несколько [элементов Method](/javascript/api/manifest/method) . Элемент **Methods** не следует использовать с надстройками Outlook.
- Элемент **Method** указывает отдельный метод, который Office приложение должно поддерживать для установки надстройки. Атрибут `Name` является обязательным и указывает имя метода, заданного его родительским объектом.

## <a name="design-for-alternate-experiences"></a>Проектирование для альтернативных возможностей

Возможности расширяемости, Office предоставляет платформа надстройки, можно разделить на три вида:

- Функции расширяемости, доступные сразу после установки надстройки. Этот тип функции можно использовать, настроив элемент [VersionOverrides](/javascript/api/manifest/versionoverrides) в манифесте. Примером такого типа функции являются команды [надстроек](../design/add-in-commands.md), которые являются настраиваемыми кнопками ленты и меню.
- Функции расширяемости, доступные только при запуске надстройки и реализуемые с Office.js API JavaScript; Например, [диалоговые окна](../develop/dialog-api-in-office-add-ins.md).
- Функции расширяемости, доступные только во время выполнения, но реализуемые с помощью Office.js JavaScript и конфигурации в **элементе VersionOverrides** . Примерами являются пользовательские [Excel](../excel/custom-functions-overview.md)[,](sso-in-office-add-ins.md) единый вход и [настраиваемые контекстные вкладки](../design/contextual-tabs.md).

Если надстройка использует определенную функцию расширяемости для некоторых функций, но имеет другие полезные функции, которые не требуют функции расширяемости, необходимо разработать надстройку, чтобы она была установлена на платформе и Office версиях, которые не поддерживают функцию расширяемости. Это может обеспечить ценный, неохемный опыт работы с этими сочетаниями. 

Эта структура реализуется по-разному в зависимости от способа реализации функции расширяемости: 

- Сведения о функциях, полностью реализованных с помощью JavaScript, см. в разделе ["Проверки среды выполнения для поддержки методов и наборов требований"](#runtime-checks-for-method-and-requirement-set-support).
- Сведения о функциях, для которых требуется настроить **элемент VersionOverrides** , см. в разделе "Указание требований [в элементе VersionOverrides"](#specify-requirements-in-a-versionoverrides-element).

### <a name="runtime-checks-for-method-and-requirement-set-support"></a>Проверки среды выполнения на наличие поддержки методов и наборов требований 

Во время выполнения проверяется, поддерживает ли пользователь Office набор обязательных элементов с помощью метода [isSetSupported](/javascript/api/office/office.requirementsetsupport#office-office-requirementsetsupport-issetsupported-member(1)). Передайте имя набора обязательных элементов и минимальную версию в качестве параметров. Если набор требований поддерживается, `isSetSupported` возвращает **значение true**. Ниже приводится пример кода.

```js
if (Office.context.requirements.isSetSupported('WordApi', '1.1'))
{
   // Code that uses API members from the WordApi 1.1 requirement set.
} else {
   // Provide diminished experience here. E.g., run alternate code when the user's Word is one-time purchase Word 2013 (which does not support WordApi 1.1).
}
```
Вот что нужно знать об этом коде:

- Первый параметр является обязательным. Это строка, представляющая имя набора обязательных элементов. Дополнительные сведения о доступных наборах обязательных элементов см. в статье [Наборы обязательных элементов для надстроек Office](/javascript/api/requirement-sets/common/office-add-in-requirement-sets).
- Второй параметр является необязательным. Это строка, указывав минимальную версию набора обязательных элементов, которую приложение Office `if` должно поддерживать для выполнения кода в инструкции (например, "**1.9**"). Если не используется, предполагается версия 1.1.

> [!WARNING]
> При вызове `isSetSupported` метода значение второго параметра (если указано) должно быть строкой, а не числом. Средство синтаксического анализа JavaScript не может различать числовые значения, такие как 1.1 и 1.10, в то время как для строковых значений, таких как "1.1" и "1.10".

В следующей таблице показаны имена наборов обязательных элементов для моделей API конкретного приложения.

|Приложение Office|RequirementSetName|
|---|---|
|Excel|ExcelApi|
|OneNote|OneNoteApi|
|Outlook|Mailbox|
|PowerPoint|PowerPointApi|
|Word|WordApi|

Ниже приведен пример использования метода с одним из стандартных наборов обязательных элементов модели API.

```js
if (Office.context.requirements.isSetSupported('CustomXmlParts'))
{
    // Run code that uses API members from the CustomXmlParts requirement set.
}
else
{
    // Run alternate code when the user's Word doesn't support the CustomXmlParts requirement set.
}
```

> [!NOTE] 
> Метод `isSetSupported` и наборы обязательных элементов для этих приложений доступны в последнем Office.js файле на CDN. Если вы не используете Office.js из CDN, `isSetSupported` надстройка может создавать исключения, если вы используете старую версию библиотеки, в которой не определено. Дополнительные сведения см. в статье ["Использование последней Office API JavaScript"](#use-the-latest-office-javascript-api-library).

Если надстройка зависит от метода, который не входит в набор обязательных элементов, используйте проверку среды выполнения, чтобы определить, поддерживается ли метод приложением Office, как показано в следующем примере кода. Список всех методов, не входящих в набор обязательных элементов, см. в статье [Наборы обязательных элементов для надстроек Office](/javascript/api/requirement-sets/common/office-add-in-requirement-sets#methods-that-arent-part-of-a-requirement-set).

> [!NOTE]
> Рекомендуем ограничить использование этого типа проверки в среде выполнения в коде надстройки.

В следующем примере кода проверяется, поддерживает ли Office приложение`document.setSelectedDataAsync`.

```js
if (Office.context.document.setSelectedDataAsync)
{
    // Run code that uses `document.setSelectedDataAsync`.
}
```

### <a name="specify-requirements-in-a-versionoverrides-element"></a>Указание требований в элементе VersionOverrides

Элемент [VersionOverrides](/javascript/api/manifest/versionoverrides) был добавлен в схему манифеста в основном, но не исключительно для поддержки функций, которые должны быть доступны сразу после установки надстройки, например команд надстройки (настраиваемые кнопки ленты и меню). Office должны знать об этих функциях при анализе манифеста надстройки. 

Предположим, что надстройка использует одну из этих функций, но она ценна и должна быть доступна для установки даже в Office версиях, которые не поддерживают эту функцию. В этом сценарии определите функцию с помощью элемента [Requirements](/javascript/api/manifest/requirements) (и его дочерних элементов [Sets](/javascript/api/manifest/sets) и [Methods](/javascript/api/manifest/methods)), который включается в качестве дочернего элемента **VersionOverrides**`OfficeApp`, а не как дочерний элемент базового элемента. Это означает, что Office позволит установить надстройку, но Office будет игнорировать некоторые дочерние элементы элемента **VersionOverrides** в Office версиях, где эта функция не поддерживается.

В частности, дочерние элементы **VersionOverrides** , переопределяющий элементы в базовом манифесте, такие как элемент **Hosts** , игнорируются, а вместо них используются соответствующие элементы базового манифеста. Однако в **versionOverrides** могут быть дочерние элементы, которые фактически реализуют дополнительные функции, а не переопределяют параметры в базовом манифесте. Два примера:`WebApplicationInfo` `EquivalentAddins` Эти части **VersionOverrides** не будут игнорироваться при условии, что платформа и версия Office поддерживают соответствующую функцию.  

Сведения о потомки элементов элемента **Requirements** см. в элементе [Requirements](#requirements-element) ранее в этой статье.

Ниже приведен пример.

```XML
<VersionOverrides ... >
   ...
   <Requirements>
      <Sets DefaultMinVersion="1.1">
         <Set Name="WordApi" MinVersion="1.2"/>
      </Sets>
   </Requirements>
   <Hosts>

      <!-- ALL MARKUP INSIDE THE HOSTS ELEMENT IS IGNORED WHEREVER WordApi 1.2 IS NOT SUPPORTED -->

      <Host xsi:type="Workbook">
         <!-- markup for custom add-in commands -->
      </Host>
   </Hosts>
</VersionOverrides>
```

> [!WARNING]
> Будьте внимательны перед использованием элемента **Requirements** в **VersionOverrides**, так как в сочетаниях платформ и версий *, которые* не поддерживают это требование, ни одна из команд надстройки не будет установлена *, даже* те, которые вызывают функции, которые не требуют этого требования. Рассмотрим, например, надстройку с двумя настраиваемыми кнопками ленты. Один из них вызывает Office JavaScript, доступные в наборе обязательных элементов **ExcelApi 1.4** (и более поздних версий). Другие вызовы API доступны только в **ExcelApi 1.9** (и более поздних версиях). Если вы поместили требование для **ExcelApi 1.9** в **VersionOverrides**, то если версия 1.9 не поддерживается, ни одна из  кнопок не будет отображаться на ленте. Лучшей стратегией в этом сценарии будет использование метода, описанного в проверках среды выполнения для поддержки [методов и наборов требований](#runtime-checks-for-method-and-requirement-set-support). Код, вызываемый второй кнопкой, `isSetSupported` сначала используется для проверки поддержки **ExcelApi 1.9**. Если он не поддерживается, код выдает пользователю сообщение о том, что эта функция надстройки недоступна в его версии Office. 

> [!TIP]
> Нет необходимости повторять элемент Requirement в **versionOverrides**, который уже отображается в базовом манифесте. Если требование указано в базовом манифесте, то надстройка не может установить там, где это требование не поддерживается, поэтому Office даже не анализирует элемент **VersionOverrides**. 

## <a name="see-also"></a>См. также

- [XML-манифест надстройки Office](add-in-manifests.md)
- [Наборы обязательных элементов для надстроек Office](/javascript/api/requirement-sets/common/office-add-in-requirement-sets)
- [Word-Add-in-Get-Set-EditOpen-XML ](https://github.com/OfficeDev/Word-Add-in-Get-Set-EditOpen-XML)
