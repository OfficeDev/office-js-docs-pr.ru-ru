---
title: Указание ведущих приложений Office и требований API
description: ''
ms.date: 12/04/2017
ms.openlocfilehash: ff6c0e4b4b2f8a517a62932722c34142ffdab609
ms.sourcegitcommit: c53f05bbd4abdfe1ee2e42fdd4f82b318b363ad7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/12/2018
ms.locfileid: "25505981"
---
# <a name="specify-office-hosts-and-api-requirements"></a>Указание ведущих приложений Office и требований API

Работа надстройки Office может зависеть от ведущего приложения Office, набора требований, элемента или версии API. Например, надстройка может:

- работать в одном (Word или Excel) или нескольких приложениях Office;
    
- использовать API JavaScript, доступные только в некоторых версиях Office. Например, вы можете использовать API-интерфейсы JavaScript для Excel в надстройке, которая работает в Excel 2016. 
    
- работать только в версиях Office, которые поддерживают элементы API, используемые вашей надстройкой.
    
Эта статья поможет вам разобраться, какие параметры следует выбрать для правильной работы надстройки и максимального охвата аудитории.

> [!NOTE]
> Общие сведения о том, на каких платформах поддерживаются надстройки Office, см. в [этой статье](../overview/office-add-in-availability.md). 

В таблице ниже перечислены основные понятия, рассматриваемые в этой статье.

|**Концепция**|**Описание**|
|:-----|:-----|
|Приложение Office, ведущее приложение Office или ведущее приложение|Приложение Office, используемое для запуска надстройки, например Word, Word Online, Excel и т. д.|
|Платформа|Платформа ведущего приложения Office, например Office Online или Office для iPad.|
|Набор требований|Именованная группа связанных элементов API. С помощью наборов требований надстройка определяет, поддерживает ли ведущее приложение Office элементы API, которые она использует. Проще проверять поддержку набора требований, а не отдельных элементов API. Поддержка набора требований зависит от ведущего приложения Office и его версии. <br >Наборы требований заданы в файле манифеста. Когда вы указываете наборы требований в манифесте, вы устанавливаете минимальный уровень поддержки API, который должно предоставить ведущее приложение Office для запуска вашей надстройки. Ведущие приложения Office, которые не поддерживают наборы требований, указанные в манифесте, не могут запускать вашу надстройку, и ваша надстройка не будет отображаться в <span class="ui">Мои надстройки</span>. Это ограничивает доступность вашей надстройки в коде с использованием проверок времени выполнения. Полный список наборов требований см. в разделе [Требования к надстройкам Office](https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/office-add-in-requirement-sets?view=office-js).|
|Проверка времени выполнения|Проверка во времени выполнения, которая позволяет определить, поддерживает ли ведущее приложение Office наборы требований или методы, которые использует надстройка. Чтобы запустить такую проверку, используйте оператор **if** с методом **isSetSupported**, наборами требований или именами методов, которые не входят в набор требований. Проверки во времени выполнения позволяют максимально расширить аудиторию надстройки. В отличие от наборов требований, такие проверки не позволяют задать минимальный уровень поддержки API, который требуется для запуска надстройки. Вместо этого с помощью оператора **if** вы определяете, поддерживается ли элемент API, и если это так, добавляете в надстройку дополнительные функции. Если вы используете проверки во времени выполнения, ваша надстройка всегда будет отображаться в разделе **Мои надстройки**.|

## <a name="before-you-begin"></a>Перед началом работы

Надстройка должна использовать последнюю версию схемы манифеста надстройки. Если вы используете проверки во времени выполнения, используйте последнюю версию библиотеки API JavaScript для Office (office.js).

### <a name="specify-the-latest-add-in-manifest-schema"></a>Выбор последней версии схема манифестов надстроек

Ваша надстройка должна использовать схему манифеста 1.1. Настройте элемент **OfficeApp** в манифесте надстройки указанным ниже образом.

```XML
<OfficeApp xmlns="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance" xsi:type="TaskPaneApp">
```

### <a name="specify-the-latest-javascript-api-for-office-library"></a>Выбор последней версии библиотеки API JavaScript для Office

Если вы используете проверки во времени выполнения, то вам необходимо ссылаться на последнюю версию библиотеки API JavaScript для Office из сети поставки содержимого. Для этого добавьте указанный ниже тег `script` в HTML-код. Чтобы всегда ссылаться на последнюю версию файла Office.js, используйте `/1/` в URL-адресе сети поставки содержимого.

```HTML
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/Office.js" type="text/javascript"></script>
```

## <a name="options-to-specify-office-hosts-or-api-requirements"></a>Параметры для задания ведущих приложений Office или требований к API

При указании ведущих приложений Office и требований к API необходимо учитывать несколько факторов. На следующей схеме показано, как выбрать правильный метод для надстройки.

![Выбор самого подходящего варианта указания ведущих приложений Office или элементов API для надстройки](../images/options-for-office-hosts.png)

- Если ваша надстройка работает в одном ведущем приложении Office, укажите элемент **Hosts** в манифесте. Дополнительные сведения см. в разделе [Задание элемента Hosts](#set-the-hosts-element).
    
- Чтобы задать минимальный набор требований или элементы API, которые должно поддерживать ведущее приложение Office для запуска надстройки, задайте элемент **Requirements** в манифесте. Дополнительные сведения см. в разделе [Задание элемента Requirements в манифесте](#set-the-requirements-element-in-the-manifest).
    
- Чтобы предоставить дополнительные функции, если определенные наборы требований или элементы API доступны в ведущем приложении Office, выполните проверку во времени выполнения для кода JavaScript надстройки. Например, если надстройка выполняется в Excel 2016, используйте элементы нового API JavaScript для Excel, чтобы предоставить дополнительные функции. Дополнительные сведения см. в разделе [Использование проверок во времени выполнения для кода JavaScript](#use-runtime-checks-in-your-javascript-code).
    
## <a name="set-the-hosts-element"></a>Задание элемента Hosts

Чтобы надстройка работала в одном ведущем приложении Office, используйте элементы **Hosts** и **Host** в манифесте. Если элемент **Hosts** не указан, надстройка будет работать во всех ведущих приложениях.

Например, указанное ниже объявление **Hosts** и **Host** указывает, что надстройка будет работать с любым выпуском Excel, включая Excel для Windows, Excel Online и Excel для iPad.

```xml
<Hosts>
  <Host Name="Workbook" />
</Hosts>
```

Элемент **Hosts** может содержать один или несколько элементов **Host**. Элемент **Host** указывает ведущее приложение Office, в котором может работать ваша надстройка. Обязательному атрибуту **Name** можно присвоить одно из указанных ниже значений.

| Имя          | Ведущие приложения Office                      |
|:--------------|:----------------------------------------------|
| Database      | Веб-приложения Access                               |
| Document      | Word для Windows, Mac, iPad и Word Online        |
| Mailbox       | Outlook для Windows, Mac, Outlook в Интернете и Outlook.com | 
| Presentation  | PowerPoint для Windows, Mac, iPad и PowerPoint Online  |
| Проект       | Проект                                       |
| Workbook      | Excel для Windows, Mac, iPad и Excel Online           |

> [!NOTE]
> Атрибут `Name` указывает приложение Office, в котором может запускаться ваша надстройка. Приложения Office поддерживаются на разных платформах и работают на настольных ПК, в веб-браузерах, на планшетах и мобильных устройствах. Нельзя указать платформу, на которой можно запускать надстройку. Например, если вы укажете `Mailbox`, то для запуска надстройки можно будет использовать и Outlook, и Outlook Web App. 


## <a name="set-the-requirements-element-in-the-manifest"></a>Указание элемента Requirements в манифесте

С помощью элемента **Requirements** можно задать минимальные наборы требований или элементы API, которые должно поддерживать ведущее приложение Office для запуска надстройки. В элементе **Requirements** можно указать как наборы требований, так и отдельные методы, используемые в надстройке. В версии 1.1 схемы манифестов надстроек элемент **Requirements** необязателен для всех надстроек, кроме надстроек Outlook.

> [!WARNING]
> Используйте элемент **Requirements**, только чтобы указать ключевые элементы API, которые должна использовать надстройка. Если платформа или ведущее приложение Office не поддерживают элементы API, указанные в элементе **Requirements**, надстройка не будет работать в этом ведущем приложении или на этой платформе, а также не будет отображаться в разделе **My Add-ins**. Рекомендуем сделать надстройку доступной на всех платформах ведущего приложения Office, например Excel для Windows, Excel Online и Excel для iPad. Чтобы надстройка была доступной во _всех_ приложениях Office и на всех платформах, используйте проверки во времени выполнения, а не элемент **Requirements**.

В примере кода ниже показана надстройка, которая загружается во всех ведущих приложениях Office, поддерживающих указанные ниже элементы.

-  Набор требований **TableBindings** 1.1 или более поздней версии.
    
-  Набор требований **OOXML** 1.1 или более поздней версии.
    
-  Метод **Document.getSelectedDataAsync**.

```XML
<Requirements>
   <Sets DefaultMinVersion="1.1">
      <Set Name="TableBindings" MinVersion="1.1"/>
      <Set Name="OOXML" MinVersion="1.1"/>
   </Sets>
   <Methods>
      <Method Name="Document.getSelectedDataAsync"/>
   </Methods>
</Requirements>
```

- Элемент **Requirements** содержит дочерние элементы **Sets** и **Methods**.
    
- Элемент **Sets** может содержать один или несколько элементов **Set**. Параметр **DefaultMinVersion** задает значение **MinVersion** по умолчанию для всех дочерних элементов **Set**.
    
- Элемент **Set** указывает требования, которые должно поддерживать ведущее приложение Office для запуска надстройки. Атрибут **Name** указывает имя набора требований. Параметр **MinVersion** указывает на минимальную версию набора требований. **MinVersion** переопределяет значение **DefaultMinVersion**. Для получения дополнительной информации о наборах требований и версиях наборов требований, к которым принадлежат ваши члены API, см. [Требования к надстройкам Office](https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/office-add-in-requirement-sets?view=office-js).
    
- Элемент **Methods** может содержать один или несколько элементов **Method**. Вы не можете использовать элемент **Methods** с надстройками Outlook.
    
- Элемент **Method** задает отдельный метод, который должно поддерживать ведущее приложение Office, в котором работает надстройка. Атрибут **Name** обязателен и указывает имя метода с его родительским объектом.
    

## <a name="use-runtime-checks-in-your-javascript-code"></a>Использование проверок во времени выполнения для кода JavaScript


Если ведущее приложение Office поддерживает определенные наборы требований, вы можете добавить в надстройку дополнительные функции. Например, если надстройка работает в Word 2016, вы можете использовать в ней новые API JavaScript для Word. Для этого используйте метод **isSetSupported** с именем набора требований. Во времени выполнения метод **isSetSupported** определяет, поддерживается ли набор требований ведущим приложением Office, в котором запущена надстройка. Если он поддерживается, то метод **isSetSupported** возвращает значение **true** и запускает дополнительный код, который использует элементы API из этого набора. Если приложение Office не поддерживает набор требований, метод **isSetSupported** возвращает значение **false**, и дополнительный код не запускается. В коде ниже показан синтаксис, который необходимо использовать с методом **isSetSupported**.


```js
if (Office.context.requirements.isSetSupported(RequirementSetName , VersionNumber))
{
   // Code that uses API members from RequirementSetName.
}

```


-  _RequirementSetName_ (обязательное) — это строка, представляющая имя набора требований. Дополнительные сведения о доступных наборах требований см. в статье [Наборы требований для надстроек Office](https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/office-add-in-requirement-sets?view=office-js).
    
-  _VersionNumber_ (необязательный параметр) — это версия набора требований.
    
В Excel 2016 или Word 2016 для наборов требований **ExcelAPI** или **WordAPI** используйте метод **isSetSupported**. Метод **isSetSupported**, а также наборы требований **ExcelAPI** и **WordAPI** доступны в последней версии файла Office.js в CDN. Если вы не используете файл Office.js из CDN, надстройка может создавать исключения, так как метод **isSetSupported** не будет определен. Дополнительные сведения см. в статье [Выбор последней версии библиотеки API JavaScript для Office](#specify-the-latest-javascript-api-for-office-library). 


> [!NOTE]
> Метод **isSetSupported** не работает в Outlook и Outlook Web App. Чтобы использовать проверку во времени выполнения в Outlook или Outlook Web App, используйте способ, описанный в разделе [Проверки во времени выполнения с использованием методов, не входящих в набор требований](#runtime-checks-using-methods-not-in-a-requirement-set).

В приведенном ниже примере кода показано, как функциональность надстройки может отличаться в ведущих приложениях Office, поддерживающих разные наборы требований или элементы API.




```js
if (Office.context.requirements.isSetSupported('WordApi', 1.1))
{
    // Run code that provides additional functionality using the JavaScript API for Word when the add-in runs in Word 2016.
}
else if (Office.context.requirements.isSetSupported('CustomXmlParts'))
{
      // Run code that uses API members from the CustomXmlParts requirement set.
}
else 
{
    // Run additional code when the Office host is not Word 2016, and when the Office host does not support the CustomXmlParts requirement set.
}

```


## <a name="runtime-checks-using-methods-not-in-a-requirement-set"></a>Проверки во времени выполнения с использованием методов, не входящих в набор требований


Некоторые элементы API не принадлежат к наборам требований. Это относится только к членам API, которые являются частью пространства имен [JavaScript API для Office](https://docs.microsoft.com/office/dev/add-ins/reference/javascript-api-for-office?view=office-js) (что-либо в рамках Office.), а не членов API, которые принадлежат API JavaScript для Word (что-либо в рамках Word. ) или пространства имен [Ссылка API JavaScript на надстройки Excel](https://docs.microsoft.com/office/dev/add-ins/reference/overview/excel-add-ins-reference-overview?view=office-js) (что-либо в рамках Excel). Когда ваша надстройка зависит от метода, который не является частью набора требований, вы можете использовать проверку времени выполнения, чтобы определить, поддерживается ли метод ведущим приложением Office, как показано в следующем примере кода. Полный список методов, которые не относятся к набору требований, см. [Наборы требований надстройки Office](https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/office-add-in-requirement-sets?view=office-js).


> [!NOTE]
> Рекомендуем ограничить использование этого типа проверки во времени выполнения в коде надстройки.

В примере кода ниже показано, как проверить, поддерживает ли ведущее приложение метод **document.setSelectedDataAsync**.




```js
if (Office.context.document.setSelectedDataAsync)
{
    // Run code that uses document.setSelectedDataAsync.
}
```


## <a name="see-also"></a>См. также

- [XML-манифест надстройки Office](add-in-manifests.md)
- [Наборы требований для надстроек Office](https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/office-add-in-requirement-sets?view=office-js)
- [Word-Add-in-Get-Set-EditOpen-XML](https://github.com/OfficeDev/Word-Add-in-Get-Set-EditOpen-XML)