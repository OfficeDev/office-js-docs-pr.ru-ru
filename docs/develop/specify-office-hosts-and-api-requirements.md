---
title: Указание ведущих приложений Office и требований к API
description: Сведения о том, как указать приложения Office и требования к API, чтобы надстройка работала должным образом.
ms.date: 08/24/2020
localization_priority: Normal
ms.openlocfilehash: 90ee7c3a5ad01252336608c02f995bbcbbe94212
ms.sourcegitcommit: 9609bd5b4982cdaa2ea7637709a78a45835ffb19
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2020
ms.locfileid: "47292631"
---
# <a name="specify-office-applications-and-api-requirements"></a>Указание приложений Office и требований к API

Надстройка Office может зависеть от конкретного приложения Office, набора требований, элемента API или версии API, чтобы работать должным образом. Например, надстройка может:

- работать в одном (например, Word или Excel) или нескольких приложениях Office;

- использовать API JavaScript, доступные только в некоторых версиях Office. Например, можно создать надстройку Excel 2016 на базе новых API JavaScript для Excel;

- работать только в версиях Office, которые поддерживают элементы API, используемые вашей надстройкой.

Эта статья поможет вам разобраться, какие параметры следует выбрать для правильной работы надстройки и максимального охвата аудитории.

> [!NOTE]
> Высокоуровневое представление о том, где в настоящее время поддерживаются надстройки Office, можно найти на странице " [клиентские приложения и платформы Office для надстроек Office](../overview/office-add-in-availability.md) ".

В таблице ниже перечислены основные понятия, рассматриваемые в этой статье.

|**Концепция**|**Описание**|
|:-----|:-----|
|Приложение Office, клиентское приложение Office|Приложение Office, используемое для запуска надстройки, например Word, Excel и т. д.|
|Платформа|Место запуска приложения Office, например в браузере или на iPad.|
|Набор обязательных элементов|Именованная группа связанных элементов API. В надстройках используются наборы требований, чтобы определить, поддерживает ли приложение Office элементы API, используемые вашей надстройкой. Проще проверять поддержку набора требований, а не отдельных элементов API. Поддержка набора требований зависит от приложения Office и версии приложения Office. <br >Наборы обязательных элементов указываются в файле манифеста. При указании наборов требований в манифесте устанавливается минимальный уровень поддержки API, который должен предоставляться приложением Office для запуска надстройки. Приложения Office, не поддерживающие наборы требований, указанные в манифесте, не могут запускать надстройку, и надстройка не будет отображаться в <span class="ui">папке "Мои</span>надстройки". Это ограничит область, в которой доступна ваша надстройка. в коде с помощью проверок в среде выполнения. Полный список наборов требований см. в статье [Наборы обязательных элементов для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md).|
|Проверка в среде выполнения|Тест, выполняемый во время выполнения, чтобы определить, поддерживает ли приложение Office, выполняющее надстройку, наборы требований или методы, используемые надстройкой. Для выполнения проверки во время выполнения используется оператор **If** с `isSetSupported` методом, наборами требований или именами методов, не входящими в набор требований. Проверки в среде выполнения позволяют максимально расширить аудиторию надстройки. В отличие от наборов требований, проверки среды выполнения не указывают минимальный уровень поддержки API, который должен предоставить приложение Office для запуска надстройки. Вместо этого используйте оператор **If** , чтобы определить, поддерживается ли элемент API. и если это так, добавляете в надстройку дополнительные функции. Если вы используете проверки в среде выполнения, ваша надстройка всегда будет отображаться в разделе **Мои надстройки**.|

## <a name="before-you-begin"></a>Подготовка

Надстройка должна использовать последнюю версию схемы манифеста надстройки. Если вы используете проверки среды выполнения в вашей надстройке, убедитесь, что вы используете последнюю библиотеку API JavaScript для Office (office.js).

### <a name="specify-the-latest-add-in-manifest-schema"></a>Выбор последней версии схема манифестов надстроек

Ваша надстройка должна использовать схему манифеста 1.1. Задайте `OfficeApp` элемент в манифесте надстройки следующим образом.

```XML
<OfficeApp xmlns="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="TaskPaneApp">
```

### <a name="specify-the-latest-office-javascript-api-library"></a>Указание последней версии библиотеки API JavaScript для Office

Если вы используете проверки среды выполнения, укажите самую последнюю версию библиотеки API JavaScript для Office из сети доставки содержимого (CDN). Для этого добавьте указанный ниже тег `script` в HTML-код. Чтобы всегда ссылаться на последнюю версию файла Office.js, используйте `/1/` в URL-адресе сети доставки содержимого.

```HTML
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js" type="text/javascript"></script>
```

## <a name="options-to-specify-office-applications-or-api-requirements"></a>Параметры для указания приложений Office или требований к API

При указании приложений Office или требований к API необходимо учитывать несколько факторов. На следующей схеме показано, как выбрать правильный метод для надстройки.

![Выбор оптимального варианта для надстройки при указании приложений Office или требований к API](../images/options-for-office-hosts.png)

- Если ваша надстройка работает в одном приложении Office, задайте `Hosts` элемент в манифесте. Дополнительные сведения см. в разделе [Задание элемента Hosts](#set-the-hosts-element).

- Чтобы задать минимальный набор требований или элементы API, которые приложение Office должно поддерживать для запуска надстройки, задайте `Requirements` элемент в манифесте. Дополнительные сведения см. [в разделе Set The требований element в манифесте](#set-the-requirements-element-in-the-manifest).

- Если вы хотите предоставить дополнительные функции, если конкретные наборы требований или элементы API доступны в приложении Office, выполните проверку кода JavaScript надстройки в среде выполнения. Например, если надстройка выполняется в Excel 2016, используйте элементы нового API JavaScript для Excel, чтобы предоставить дополнительные функции. Дополнительные сведения см. в разделе [Использование проверок в среде выполнения в коде JavaScript](#use-runtime-checks-in-your-javascript-code).

## <a name="set-the-hosts-element"></a>Задание элемента Hosts

Чтобы надстройка выполнялась в одном клиентском приложении Office, используйте `Hosts` `Host` элементы и в манифесте. Если вы не укажете `Hosts` элемент, надстройка будет запускаться во всех приложениях Office, поддерживаемых надстройками Office.

Например, следующее `Hosts` и `Host` объявление указывает, что надстройка будет работать с любым выпуском Excel, включающим Excel в Интернете, Windows и iPad.

```xml
<Hosts>
  <Host Name="Workbook" />
</Hosts>
```

`Hosts`Элемент может содержать один или несколько `Host` элементов. `Host`Элемент определяет приложение Office, необходимое для надстройки. `Name`Атрибут является обязательным и может иметь одно из следующих значений.

| Имя          | Клиентские приложения Office                      |
|:--------------|:----------------------------------------------|
| Database      | Веб-приложения Access                               |
| Документ      | Word в Интернете, Windows, Mac, iPad           |
| Почтовый ящик       | Outlook в Интернете, Windows, Mac, Android, iOS|
| Презентация  | PowerPoint в Интернете, Windows, Mac, iPad     |
| Проект       | Project для Windows                            |
| Рабочая книга      | Excel в Интернете, Windows, Mac, iPad          |

> [!NOTE]
> `Name`Атрибут указывает клиентское приложение Office, которое может запускать вашу надстройку. Приложения Office поддерживаются на различных платформах и запускаются на настольных компьютерах, веб-браузерах, планшетах и мобильных устройствах. Вам не удастся указать, какую платформу можно использовать для запуска надстройки. Например, если вы указали `Mailbox` , для запуска надстройки можно использовать как Outlook в Интернете, так и Windows.

> [!IMPORTANT]
> Больше не рекомендуется создавать и использовать веб-приложения и базы данных Access в SharePoint. В качестве альтернативы рекомендуем использовать [Microsoft PowerApps](https://powerapps.microsoft.com/) для создания бизнес-решений для Интернета и мобильных устройств без написания кода.

## <a name="set-the-requirements-element-in-the-manifest"></a>Указание элемента Requirements в манифесте

`Requirements`Элемент указывает минимальные наборы требований или элементы API, которые должны поддерживаться приложением Office для запуска надстройки. В `Requirements` элементе можно указать наборы требований и индивидуальные методы, используемые в надстройке. В схеме манифеста надстройки версии 1,1 `Requirements` элемент является необязательным для всех надстроек, кроме надстроек Outlook.

> [!WARNING]
> Используйте элемент только `Requirements` для указания критических наборов требований или элементов API, которые должна использовать надстройка. Если приложение или платформа Office не поддерживает наборы требований или элементы API, указанные в `Requirements` элементе, надстройка не будет выполняться в этом приложении или платформе и не будет отображаться в **папке "Мои**надстройки". Вместо этого мы рекомендуем сделать надстройку доступной на всех платформах приложения Office, таких как Excel в Интернете, Windows и iPad. Чтобы сделать надстройку доступной для  _всех_ приложений и платформ Office, используйте проверки среды выполнения вместо `Requirements` элемента.

В следующем примере кода показана надстройка, которая загружается во все клиентские приложения Office, которые поддерживают следующие компоненты:

-  `TableBindings` набор требований с минимальной версией "1,1".

-  `OOXML` набор требований с минимальной версией "1,1".

-  `Document.getSelectedDataAsync` WebMethod.

```XML
<Requirements>
   <Sets DefaultMinVersion="1.1">
      <Set Name="TableBindings" MinVersion="1.1"/>
      <Set Name="OOXML" MinVersion="1.1"/>
   </Sets>
   <Methods>
      <Method Name="Document.getSelectedDataAsync"/>
   </Methods>
</Requirements>
```

- `Requirements`Элемент содержит `Sets` `Methods` дочерние элементы.

- `Sets`Элемент может содержать один или несколько `Set` элементов. `DefaultMinVersion` задает значение по умолчанию `MinVersion` для всех дочерних `Set` элементов.

- `Set`Элемент указывает наборы требований, которые приложение Office должно поддерживать для запуска надстройки. `Name`Атрибут указывает имя набора требований. `MinVersion`Указывает минимальную версию набора обязательных элементов. `MinVersion` переопределяет значение `DefaultMinVersion` для получения дополнительных сведений о наборах требований и версиях набора требований, к которым относятся элементы API, ознакомьтесь со статьей " [наборы требований для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md)".

- `Methods`Элемент может содержать один или несколько `Method` элементов. Вы не можете использовать `Methods` элемент с надстройками Outlook.

- `Method`Элемент определяет отдельный метод, который должен поддерживаться в приложении Office, в котором работает надстройка. `Name`Атрибут является обязательным и указывает имя метода, дополненного его родительским объектом.

## <a name="use-runtime-checks-in-your-javascript-code"></a>Использование проверок в среде выполнения в коде JavaScript

Если приложение Office поддерживает определенные наборы обязательных элементов, вам может потребоваться предоставить дополнительные функции в надстройке. Например, если надстройка работает в Word 2016, вы можете использовать в ней API JavaScript для Word. Для этого используйте метод [isSetSupported](/javascript/api/office/office.requirementsetsupport#issetsupported-name--minversion-) с именем набора обязательных элементов. `isSetSupported` Определяет, будет ли приложение Office, в котором выполняется надстройка, поддерживать набор обязательных элементов во время выполнения. Если набор требований поддерживается, `isSetSupported` возвращает **значение true** и запускает дополнительный код, который использует элементы API из этого набора требований. Если приложение Office не поддерживает набор требований, `isSetSupported` возвращается **значение false** , а дополнительный код не запустится. В приведенном ниже коде показан синтаксис, используемый с `isSetSupported` .

```js
if (Office.context.requirements.isSetSupported(RequirementSetName, MinimumVersion))
{
   // Code that uses API members from RequirementSetName.
}

```

- _RequirementSetName_ (обязательный параметр) — это строка, представляющая имя набора обязательных элементов (например, "**ExcelApi**", "**Mailbox**" и т. д.). Дополнительные сведения о доступных наборах обязательных элементов см. в статье [Наборы обязательных элементов для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md).
- _MinimumVersion_ (необязательно) — это строка, указывающая версию набора обязательных элементов, которую должно поддерживать приложение Office, чтобы код в `if` операторе выполнялся (например, "**1,9**").

> [!WARNING]
> При вызове `isSetSupported` метода значение `MinimumVersion` параметра (если задано) должно быть строкой. Это обусловлено тем, что средство синтаксического анализа JavaScript не может различить числовые значения, например 1.1 и 1.10, но может различать строковые значения, например "1.1" и "1.10".
> Перегрузка оператора `number` не рекомендуется.

Используйте `isSetSupported` с `RequirementSetName` соответствующим приложением Office, как показано ниже.

|Приложение Office|RequirementSetName|
|---|---|
|Excel|ExcelApi|
|OneNote|OneNoteApi|
|Outlook|Mailbox|
|Word|WordApi|

`isSetSupported`Метод и наборы требований для этих приложений доступны в последнем Office.js файле в сети CDN. Если вы не используете Office.js из сети CDN, надстройка может создать исключения, так как `isSetSupported` она будет неопределенной. Дополнительные сведения см. [в статье определение последней версии библиотеки API JavaScript для Office](#specify-the-latest-office-javascript-api-library).

В приведенном ниже примере кода показано, как надстройка предоставляет различные функциональные возможности для разных приложений Office, которые могут поддерживать различные наборы требований или элементы API.

```js
if (Office.context.requirements.isSetSupported('WordApi', '1.1'))
{
    // Run code that provides additional functionality using the Word JavaScript API when the add-in runs in Word 2016 or later.
}
else if (Office.context.requirements.isSetSupported('CustomXmlParts'))
{
    // Run code that uses API members from the CustomXmlParts requirement set.
}
else
{
    // Run additional code when the Office application is not Word 2016 or later and does not support the CustomXmlParts requirement set.
}

```

## <a name="runtime-checks-using-methods-not-in-a-requirement-set"></a>Проверки в среде выполнения с использованием методов, не входящих в набор обязательных элементов

Некоторые элементы API не входят в наборы обязательных элементов. Это относится только к элементам API, которые входят в пространство имен [API JavaScript для Office](../reference/javascript-api-for-office.md) (как и в случае с `Office.` [API почтовых ящиков Outlook](/javascript/api/outlook)), но не к элементам API, принадлежащим к [API JavaScript для Word](../reference/overview/word-add-ins-reference-overview.md) (любые в `Word.` ), [API JavaScript для Excel](../reference/overview/excel-add-ins-reference-overview.md) (что-то в `Excel.` ) или пространствах [API](../reference/overview/onenote-add-ins-javascript-reference.md) JavaScript (любых элементов `OneNote.` ). Когда надстройка зависит от метода, который не является частью набора требований, можно использовать проверку среды выполнения, чтобы определить, поддерживается ли метод приложением Office, как показано в следующем примере кода. Список всех методов, не входящих в набор обязательных элементов, см. в статье [Наборы обязательных элементов для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md#methods-that-arent-part-of-a-requirement-set).

> [!NOTE]
> Рекомендуем ограничить использование этого типа проверки в среде выполнения в коде надстройки.

В следующем примере кода проверяется, поддерживает ли приложение Office `document.setSelectedDataAsync` .

```js
if (Office.context.document.setSelectedDataAsync)
{
    // Run code that uses `document.setSelectedDataAsync`.
}
```


## <a name="see-also"></a>См. также

- [XML-манифест надстройки Office](add-in-manifests.md)
- [Наборы обязательных элементов для надстроек Office](../reference/requirement-sets/office-add-in-requirement-sets.md)
- [Word-Add-in-Get-Set-EditOpen-XML ](https://github.com/OfficeDev/Word-Add-in-Get-Set-EditOpen-XML)
