---
title: Указание ведущих приложений Office и требований к API
description: ''
ms.date: 05/29/2019
localization_priority: Priority
ms.openlocfilehash: ccff7ba1896c9d1683f9fc9d67cdd79fe52da623
ms.sourcegitcommit: b299b8a5dfffb6102cb14b431bdde4861abfb47f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/30/2019
ms.locfileid: "34589148"
---
# <a name="specify-office-hosts-and-api-requirements"></a>Указание ведущих приложений Office и требований к API

Работа надстройки Office может зависеть от ведущего приложения Office, набора обязательных элементов, элемента или версии API. Например, надстройка может:

- работать в одном (например, Word или Excel) или нескольких приложениях Office;

- использовать API JavaScript, доступные только в некоторых версиях Office. Например, можно создать надстройку Excel 2016 на базе новых API JavaScript для Excel;

- работать только в версиях Office, которые поддерживают элементы API, используемые вашей надстройкой.

Эта статья поможет вам разобраться, какие параметры следует выбрать для правильной работы надстройки и максимального охвата аудитории.

> [!NOTE]
> Общие сведения о том, на каких платформах поддерживаются надстройки Office, см. в [этой статье](../overview/office-add-in-availability.md).

В таблице ниже перечислены основные понятия, рассматриваемые в этой статье.

|**Концепция**|**Описание**|
|:-----|:-----|
|Приложение Office, ведущее приложение Office или ведущее приложение|Приложение Office, используемое для запуска надстройки, например Word, Word Online, Excel и т. д.|
|Платформа|Платформа ведущего приложения Office, например Office Online или Office для iPad.|
|Набор обязательных элементов|Именованная группа связанных элементов API. С помощью наборов обязательных элементов надстройка определяет, поддерживает ли ведущее приложение Office элементы API, которые она использует. Проще проверять поддержку набора обязательных элементов, а не отдельных элементов API. Поддержка набора обязательных элементов зависит от ведущего приложения Office и его версии. <br >Наборы обязательных элементов указываются в файле манифеста. Задавая наборы обязательных элементов в манифесте, вы указываете, какой минимальный уровень поддержки API должно обеспечить ведущее приложение Office, чтобы можно было запустить надстройку. Надстройка не будет работать в ведущих приложениях Office, которые не поддерживают наборы обязательных элементов, указанные в манифесте, и не будет отображаться в разделе <span class="ui">Мои надстройки</span>. Это ограничивает доступность надстройки в коде с помощью проверок в среде выполнения. Полный список наборов требований см. в статье [Наборы обязательных элементов для надстроек Office](/office/dev/add-ins/reference/requirement-sets/office-add-in-requirement-sets).|
|Проверка в среде выполнения|Проверка в среде выполнения, которая позволяет определить, поддерживает ли ведущее приложение Office наборы обязательных элементов или методы, которые использует надстройка. Чтобы запустить такую проверку, используйте оператор **if** с методом **isSetSupported**, наборами обязательных элементов или именами методов, которые не входят в набор обязательных элементов. Проверки в среде выполнения позволяют максимально расширить аудиторию надстройки. В отличие от наборов обязательных элементов, такие проверки не позволяют задать минимальный уровень поддержки API, который требуется для запуска надстройки. Вместо этого с помощью оператора **if** вы определяете, поддерживается ли элемент API, и если это так, добавляете в надстройку дополнительные функции. Если вы используете проверки в среде выполнения, ваша надстройка всегда будет отображаться в разделе **Мои надстройки**.|

## <a name="before-you-begin"></a>Перед началом работы

Надстройка должна использовать последнюю версию схемы манифеста надстройки. Если вы используете проверки в среде выполнения, используйте последнюю версию библиотеки API JavaScript для Office (office.js).

### <a name="specify-the-latest-add-in-manifest-schema"></a>Выбор последней версии схема манифестов надстроек

Ваша надстройка должна использовать схему манифеста 1.1. Настройте элемент **OfficeApp** в манифесте надстройки указанным ниже образом.

```XML
<OfficeApp xmlns="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance" xsi:type="TaskPaneApp">
```

### <a name="specify-the-latest-javascript-api-for-office-library"></a>Выбор последней версии библиотеки API JavaScript для Office

Если вы используете проверки в среде выполнения, то вам необходимо ссылаться на последнюю версию библиотеки API JavaScript для Office из сети доставки содержимого. Для этого добавьте указанный ниже тег `script` в HTML-код. Чтобы всегда ссылаться на последнюю версию файла Office.js, используйте `/1/` в URL-адресе сети доставки содержимого.

```HTML
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/Office.js" type="text/javascript"></script>
```

## <a name="options-to-specify-office-hosts-or-api-requirements"></a>Параметры для задания ведущих приложений Office или требований к API

При указании ведущих приложений Office и требований к API необходимо учитывать несколько факторов. На следующей схеме показано, как выбрать правильный метод для надстройки.

![Выбор самого подходящего варианта указания ведущих приложений Office или элементов API для надстройки](../images/options-for-office-hosts.png)

- Если ваша надстройка работает в одном приложении Office, укажите элемент **Hosts** в манифесте. Дополнительные сведения см. в разделе [Задание элемента Hosts](#set-the-hosts-element).

- Чтобы задать минимальный набор обязательных элементов или элементы API, которые должно поддерживать ведущее приложение Office для запуска надстройки, задайте элемент **Requirements** в манифесте. Дополнительные сведения см. в разделе [Задание элемента Requirements в манифесте](#set-the-requirements-element-in-the-manifest).

- Чтобы предоставить дополнительные функции, если определенные наборы обязательных элементов или элементы API доступны в ведущем приложении Office, выполните проверку в среде выполнения для кода JavaScript надстройки. Например, если надстройка выполняется в Excel 2016, используйте элементы нового API JavaScript для Excel, чтобы предоставить дополнительные функции. Дополнительные сведения см. в разделе [Использование проверок в среде выполнения в коде JavaScript](#use-runtime-checks-in-your-javascript-code).

## <a name="set-the-hosts-element"></a>Задание элемента Hosts

Чтобы надстройка работала в одном ведущем приложении Office, используйте элементы **Hosts** и **Host** в манифесте. Если элемент **Hosts** не указан, надстройка будет работать во всех ведущих приложениях.

Например, указанное ниже объявление **Hosts** и **Host** указывает, что надстройка будет работать с любым выпуском Excel, включая Excel для Windows, Excel Online и Excel для iPad.

```xml
<Hosts>
  <Host Name="Workbook" />
</Hosts>
```

Элемент **Hosts** может содержать один или несколько элементов **Host**. Элемент **Host** указывает ведущее приложение Office, в котором может работать ваша надстройка. Обязательному атрибуту **Name** можно присвоить одно из указанных ниже значений.

| Имя          | Ведущие приложения Office                                                              |
|:--------------|:--------------------------------------------------------------------------------------|
| Database      | Веб-приложения Access                                                                       |
| Документ      | Word для Windows, Word для Mac, Word для iPad и Word Online                         |
| почтовый ящик.       | Outlook для Windows, Outlook для Mac, Outlook в Интернете и Outlook.com              |
| Presentation  | PowerPoint для Windows, PowerPoint для Mac, PowerPoint для iPad и PowerPoint Online |
| Project       | Project для Windows                                                                    |
| Workbook      | Excel для Windows, Excel для Mac, Excel для iPad и Excel Online                     |

> [!NOTE]
> Атрибут `Name` указывает приложение Office, в котором может запускаться ваша надстройка. Приложения Office поддерживаются на разных платформах и работают на настольных ПК, в веб-браузерах, на планшетах и мобильных устройствах. Нельзя указать платформу, на которой можно запускать надстройку. Например, если вы укажете `Mailbox`, то для запуска надстройки можно будет использовать и Outlook, и Outlook Web App.


## <a name="set-the-requirements-element-in-the-manifest"></a>Указание элемента Requirements в манифесте

С помощью элемента **Requirements** можно задать минимальные наборы обязательных элементов или элементы API, которые должно поддерживать ведущее приложение Office для запуска надстройки. В элементе **Requirements** можно указать как наборы обязательных элементов, так и отдельные методы, используемые в надстройке. В версии 1.1 схемы манифестов надстроек элемент **Requirements** необязателен для всех надстроек, кроме надстроек Outlook.

> [!WARNING]
> Используйте элемент **Requirements**, только чтобы указать ключевые элементы API, которые должна использовать надстройка. Если платформа или ведущее приложение Office не поддерживают элементы API, указанные в элементе **Requirements**, надстройка не будет работать в этом ведущем приложении или на этой платформе, а также не будет отображаться в разделе **Мои надстройки**. Рекомендуем сделать надстройку доступной на всех платформах ведущего приложения Office, например Excel для Windows, Excel Online и Excel для iPad. Чтобы надстройка была доступной во _всех_ приложениях Office и на всех платформах, используйте проверки в среде выполнения, а не элемент **Requirements**.

В примере кода ниже показана надстройка, которая загружается во всех ведущих приложениях Office, поддерживающих указанные ниже элементы.

-  Набор обязательных элементов **TableBindings** 1.1 или более поздней версии.

-  Набор обязательных элементов **OOXML** 1.1 или более поздней версии.

-  Метод **Document.getSelectedDataAsync**.

```XML
<Requirements>
   <Sets DefaultMinVersion="1.1">
      <Set Name="TableBindings" MinVersion="1.1"/>
      <Set Name="OOXML" MinVersion="1.1"/>
   </Sets>
   <Methods>
      <Method Name="Document.getSelectedDataAsync"/>
   </Methods>
</Requirements>
```

- Элемент **Requirements** содержит дочерние элементы **Sets** и **Methods**.

- Элемент **Sets** может содержать один или несколько элементов **Set**. Параметр **DefaultMinVersion** задает значение **MinVersion** по умолчанию для всех дочерних элементов **Set**.

- Элемент **Set** указывает наборы обязательных элементов, которые ведущее приложение Office должно поддерживать для запуска надстройки. Атрибут **Name** указывает имя набора обязательных элементов. Атрибут **MinVersion** указывает минимальную версию набора обязательных элементов. **MinVersion** переопределяет значение **DefaultMinVersion**. Дополнительные сведения о наборах обязательных элементов и их версиях, к которым принадлежат элементы API, см. в статье [Наборы обязательных элементов для надстроек Office](/office/dev/add-ins/reference/requirement-sets/office-add-in-requirement-sets).

- Элемент **Methods** может содержать один или несколько элементов **Method**. Элемент **Methods** не следует использовать с надстройками Outlook.

- Элемент **Method** задает отдельный метод, который должно поддерживать ведущее приложение Office, в котором работает надстройка. Атрибут **Name** обязателен и указывает имя метода с его родительским объектом.


## <a name="use-runtime-checks-in-your-javascript-code"></a>Использование проверок в среде выполнения в коде JavaScript


Если ведущее приложение Office поддерживает определенные наборы требований, вы можете добавить в надстройку дополнительные функции. Например, если надстройка работает в Word 2016, вы можете использовать в ней API JavaScript для Word. Для этого используйте метод [isSetSupported](/javascript/api/office/office.requirementsetsupport#issetsupported-name--minversion-) с именем набора обязательных элементов. В среде выполнения метод **isSetSupported** определяет, поддерживает ли приложение Office, в котором запускается надстройка, этот набор требований. Если он поддерживается, то метод **isSetSupported** возвращает значение **true** и запускает дополнительный код, который использует элементы API из этого набора. Если приложение Office не поддерживает набор требований, метод **isSetSupported** возвращает значение **false**, и дополнительный код не запускается. В коде ниже показан синтаксис, который необходимо использовать с методом **isSetSupported**.


```js
if (Office.context.requirements.isSetSupported(RequirementSetName, VersionNumber))
{
   // Code that uses API members from RequirementSetName.
}

```

-  _RequirementSetName_ (обязательный параметр) — это строка, представляющая имя набора обязательных элементов. Дополнительные сведения о доступных наборах обязательных элементов см. в статье [Наборы обязательных элементов для надстроек Office](/office/dev/add-ins/reference/requirement-sets/office-add-in-requirement-sets).
    
-  _VersionNumber_ (необязательный параметр) — это версия набора обязательных элементов.

Используйте метод **isSetSupported** с параметром **RequirementSetName**, связанным с ведущим приложением Office, как показано ниже.

|Ведущее приложение Office|RequirementSetName|
|---|---|
|Excel|ExcelApi|
|OneNote|OneNoteApi|
|Outlook|Mailbox|
|Word|WordApi|

Метод **isSetSupported** и наборы обязательных элементов для этих ведущих приложений доступны в последней версии файла Office.js, размещенного в сети доставки содержимого. Если вы не используете файл Office.js из CDN, надстройка может создавать исключения, так как метод **isSetSupported** не будет определен. Дополнительные сведения см. в статье [Выбор последней версии библиотеки API JavaScript для Office](#specify-the-latest-javascript-api-for-office-library).

В приведенном ниже примере кода показано, как функциональность надстройки может отличаться в ведущих приложениях Office, поддерживающих разные наборы обязательных элементов или элементы API.

```js
if (Office.context.requirements.isSetSupported('WordApi', 1.1))
{
    // Run code that provides additional functionality using the Word JavaScript API when the add-in runs in Word 2016 or later.
}
else if (Office.context.requirements.isSetSupported('CustomXmlParts'))
{
    // Run code that uses API members from the CustomXmlParts requirement set.
}
else
{
    // Run additional code when the Office host is not Word 2016 or later and does not support the CustomXmlParts requirement set.
}

```


## <a name="runtime-checks-using-methods-not-in-a-requirement-set"></a>Проверки в среде выполнения с использованием методов, не входящих в набор обязательных элементов

Некоторые элементы API не входят в наборы обязательных элементов. Это относится только к тем элементам API, которые входят в пространства имен [API JavaScript для Office](/office/dev/add-ins/reference/javascript-api-for-office) (все элементы в `Office.`, кроме [API почтовых ящиков для Outlook](/javascript/api/outlook)), но не относится к элементам API, принадлежащим к пространствам имен [API JavaScript для Word](/office/dev/add-ins/reference/overview/word-add-ins-reference-overview) (все элементы в `Word.`), [API JavaScript для Excel](/office/dev/add-ins/reference/overview/excel-add-ins-reference-overview) (все элементы в `Excel.`) или [API JavaScript для OneNote](/office/dev/add-ins/reference/overview/onenote-add-ins-javascript-reference) (все элементы в `OneNote.`). Если надстройка зависит от метода, не входящего в набор обязательных элементов, вы можете использовать проверку в среде выполнения, чтобы определить, поддерживается ли метод ведущим приложением Office, как показано в примере кода ниже. Список всех методов, не входящих в набор обязательных элементов, см. в статье [Наборы обязательных элементов для надстроек Office](/office/dev/add-ins/reference/requirement-sets/office-add-in-requirement-sets#methods-that-arent-part-of-a-requirement-set).

> [!NOTE]
> Рекомендуем ограничить использование этого типа проверки в среде выполнения в коде надстройки.

В примере кода ниже показано, как проверить, поддерживает ли ведущее приложение метод **document.setSelectedDataAsync**.

```js
if (Office.context.document.setSelectedDataAsync)
{
    // Run code that uses document.setSelectedDataAsync.
}
```


## <a name="see-also"></a>См. также

- [XML-манифест надстройки Office](add-in-manifests.md)
- [Наборы обязательных элементов для надстроек Office](/office/dev/add-ins/reference/requirement-sets/office-add-in-requirement-sets)
- [Word-Add-in-Get-Set-EditOpen-XML ](https://github.com/OfficeDev/Word-Add-in-Get-Set-EditOpen-XML)
