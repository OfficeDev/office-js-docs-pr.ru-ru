---
title: Авторизация в Microsoft Graph с помощью единого входа
description: Узнайте, как пользователи Office надстройки могут использовать один вход (SSO) для получения данных из Microsoft Graph.
ms.date: 02/09/2021
localization_priority: Normal
ms.openlocfilehash: 054f58cf4b89d6c11cf6e7beb831eafc4a075bad
ms.sourcegitcommit: ee9e92a968e4ad23f1e371f00d4888e4203ab772
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/23/2021
ms.locfileid: "53076485"
---
# <a name="authorize-to-microsoft-graph-with-sso"></a><span data-ttu-id="c6475-103">Авторизация в Microsoft Graph с помощью единого входа</span><span class="sxs-lookup"><span data-stu-id="c6475-103">Authorize to Microsoft Graph with SSO</span></span>

<span data-ttu-id="c6475-104">Пользователи входят в Office (в Интернете, на мобильных устройствах и настольных компьютерах), используя личную учетную запись Майкрософт, учетную запись Microsoft 365 для образования или рабочую учетную запись.</span><span class="sxs-lookup"><span data-stu-id="c6475-104">Users sign in to Office (online, mobile, and desktop platforms) using either their personal Microsoft account or their Microsoft 365 Education or work account.</span></span> <span data-ttu-id="c6475-105">Чтобы надстройка Office могла получить авторизованный доступ к [Microsoft Graph](https://developer.microsoft.com/graph/docs), лучше всего использовать учетные данные для входа пользователя в Office.</span><span class="sxs-lookup"><span data-stu-id="c6475-105">The best way for an Office Add-in to get authorized access to [Microsoft Graph](https://developer.microsoft.com/graph/docs) is to use the credentials from the user's Office sign on.</span></span> <span data-ttu-id="c6475-106">Это позволяет пользователям получить доступ к своим данным Microsoft Graph без необходимости повторного входа.</span><span class="sxs-lookup"><span data-stu-id="c6475-106">This enables them to access their Microsoft Graph data without needing to sign in a second time.</span></span>

> [!NOTE]
> <span data-ttu-id="c6475-107">API единого входа в настоящее время поддерживается для Word, Excel, Outlook и PowerPoint.</span><span class="sxs-lookup"><span data-stu-id="c6475-107">The Single Sign-on API is currently supported for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="c6475-108">Дополнительные сведения о текущей поддержке API единого входа см. в статье [Наборы обязательных элементов API идентификации](../reference/requirement-sets/identity-api-requirement-sets.md).</span><span class="sxs-lookup"><span data-stu-id="c6475-108">For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](../reference/requirement-sets/identity-api-requirement-sets.md).</span></span>
> <span data-ttu-id="c6475-109">Если вы работаете с надстройкой Outlook, обязательно включите современную проверку подлинности для клиента Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="c6475-109">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Microsoft 365 tenancy.</span></span> <span data-ttu-id="c6475-110">Сведения о том, как это сделать, см. в статье [Exchange Online: как включить в клиенте современную проверку подлинности](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6475-110">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="add-in-architecture-for-sso-and-microsoft-graph"></a><span data-ttu-id="c6475-111">Архитектура надстройки для единого входа и Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="c6475-111">Add-in architecture for SSO and Microsoft Graph</span></span>

<span data-ttu-id="c6475-112">Помимо страниц и кода JavaScript веб-приложения, в надстройке также должны размещаться (с тем же [полным доменном именем](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly)) один или несколько веб-API, которые будут получать маркер доступа и отправлять запросы к Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="c6475-112">In addition to hosting the pages and JavaScript of the web application, the add-in must also host, at the same [fully qualified domain name](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), one or more web APIs that will get an access token to Microsoft Graph and make requests to it.</span></span>

<span data-ttu-id="c6475-113">Манифест надстройки содержит разметку, которая указывает, как надстройка регистрируется в конечной точке Azure Active Directory (Azure AD) версии 2.0, а также задает необходимые надстройке разрешения для Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="c6475-113">The add-in manifest contains markup that specifies how the add-in is registered in the Azure Active Directory (Azure AD) v2.0 endpoint, and it specifies any permissions to Microsoft Graph that the add-in needs.</span></span>

### <a name="how-it-works-at-runtime"></a><span data-ttu-id="c6475-114">Принцип работы во время выполнения</span><span class="sxs-lookup"><span data-stu-id="c6475-114">How it works at runtime</span></span>

<span data-ttu-id="c6475-115">На приведенной ниже схеме показан процесс входа в систему и получения доступа к Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="c6475-115">The following diagram shows how the process of signing in and getting access to Microsoft Graph works.</span></span>

![Схема, показывающая процесс SSO.](../images/sso-access-to-microsoft-graph.png)

1. <span data-ttu-id="c6475-117">Код JavaScript надстройки вызывает новый API Office.js — [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span><span class="sxs-lookup"><span data-stu-id="c6475-117">In the add-in, JavaScript calls a new Office.js API [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span></span> <span data-ttu-id="c6475-118">Он указывает клиентскому приложению Office, что необходимо получить маркер доступа к надстройке.</span><span class="sxs-lookup"><span data-stu-id="c6475-118">This tells the Office client application to obtain an access token to the add-in.</span></span> <span data-ttu-id="c6475-119">(Далее он будет называться **маркером доступа к начальной загрузке**, поскольку в этом процессе он позже будет заменен вторым маркером.</span><span class="sxs-lookup"><span data-stu-id="c6475-119">(Hereafter, this is called the **bootstrap access token** because it is replaced with a second token later in the process.</span></span> <span data-ttu-id="c6475-120">Пример раскодированного маркера доступа к начальной загрузке см. в разделе [Пример маркера доступа](sso-in-office-add-ins.md#example-access-token)).</span><span class="sxs-lookup"><span data-stu-id="c6475-120">For an example of a decoded bootstrap access token, see [Example access token](sso-in-office-add-ins.md#example-access-token).)</span></span>
2. <span data-ttu-id="c6475-121">Если вход в Office не выполнен, в клиентском приложении открывается всплывающее окно, в котором пользователю предлагается войти.</span><span class="sxs-lookup"><span data-stu-id="c6475-121">If the user is not signed in, the Office client application opens a pop-up window for the user to sign in.</span></span>
3. <span data-ttu-id="c6475-122">Если пользователь запускает надстройку в первый раз, ему предлагается дать согласие.</span><span class="sxs-lookup"><span data-stu-id="c6475-122">If this is the first time the current user has used your add-in, he or she is prompted to consent.</span></span>
4. <span data-ttu-id="c6475-123">Клиентская Office запрашивает маркер  загрузки доступа из конечной точки Azure AD v2.0 для текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6475-123">The Office client application requests the **bootstrap access token** from the Azure AD v2.0 endpoint for the current user.</span></span>
5. <span data-ttu-id="c6475-124">Azure AD отправляет маркер загрузки в Office клиентского приложения.</span><span class="sxs-lookup"><span data-stu-id="c6475-124">Azure AD sends the bootstrap token to the Office client application.</span></span>
6. <span data-ttu-id="c6475-125">Клиентская Office отправляет маркер доступа  буттрап в надстройку как часть объекта результатов, возвращаемого `getAccessToken` вызовом.</span><span class="sxs-lookup"><span data-stu-id="c6475-125">The Office client application sends the **bootstrap access token** to the add-in as part of the result object returned by the `getAccessToken` call.</span></span>
7. <span data-ttu-id="c6475-126">Код JavaScript надстройки отправляет HTTP-запрос к веб-API с тем же полным доменным именем, что и у надстройки. Этот запрос включает **маркер доступа к начальной загрузке** в качестве подтверждения авторизации.</span><span class="sxs-lookup"><span data-stu-id="c6475-126">JavaScript in the add-in makes an HTTP request to a web API that is hosted at the same fully-qualified domain as the add-in, and it includes the **bootstrap access token** as authorization proof.</span></span>
8. <span data-ttu-id="c6475-127">Серверный код проверяет входящий **маркер доступа к начальной загрузке**.</span><span class="sxs-lookup"><span data-stu-id="c6475-127">Server-side code validates the incoming **bootstrap access token**.</span></span>
9. <span data-ttu-id="c6475-128">Серверный код использует поток "от имени" (определенный в [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) и daemon или серверном приложении для сценария Веб-API [Azure)](/azure/active-directory/develop/active-directory-authentication-scenarios)для получения маркера доступа для Microsoft Graph в обмен на маркер доступа bootstrap.</span><span class="sxs-lookup"><span data-stu-id="c6475-128">Server-side code uses the "on behalf of" flow (defined at [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) and the [daemon or server application to web API Azure scenario](/azure/active-directory/develop/active-directory-authentication-scenarios)) to obtain an access token for Microsoft Graph in exchange for the bootstrap access token.</span></span>
10. <span data-ttu-id="c6475-129">Azure AD возвращает надстройке маркер доступа в Microsoft Graph (и маркер обновления, если надстройка запрашивает разрешение *offline_access*).</span><span class="sxs-lookup"><span data-stu-id="c6475-129">Azure AD returns the access token to Microsoft Graph (and a refresh token, if the add-in requests *offline_access* permission) to the add-in.</span></span>
11. <span data-ttu-id="c6475-130">Серверный код кэширует маркер доступа в Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="c6475-130">Server-side code caches the access token to Microsoft Graph.</span></span>
12. <span data-ttu-id="c6475-131">Серверный код отправляет запросы к Microsoft Graph и включает маркер доступа в Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="c6475-131">Server-side code makes requests to Microsoft Graph and includes the access token to Microsoft Graph.</span></span>
13. <span data-ttu-id="c6475-132">Корпорация Graph возвращает данные в надстройку, которая может передавать их в пользовательский интерфейс надстройки.</span><span class="sxs-lookup"><span data-stu-id="c6475-132">Microsoft Graph returns data to the add-in, which can pass it on to the add-in's UI.</span></span>
14. <span data-ttu-id="c6475-133">Когда маркер доступа в Microsoft Graph истекает, серверный код может использовать свой маркер обновления, чтобы получить новый маркер доступа в Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="c6475-133">When the access token to Microsoft Graph expires, the server-side code can use its refresh token to get a new access token to Microsoft Graph.</span></span>

## <a name="develop-an-sso-add-in-that-accesses-microsoft-graph"></a><span data-ttu-id="c6475-134">Разработка надстройки с единым входом для Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="c6475-134">Develop an SSO add-in that accesses Microsoft Graph</span></span>

<span data-ttu-id="c6475-135">Надстройка с доступом в Microsoft Graph разрабатывается так же, как и любая другая надстройка с единым входом.</span><span class="sxs-lookup"><span data-stu-id="c6475-135">You develop an add-in that accesses Microsoft Graph just as you would any other add-in that uses SSO.</span></span> <span data-ttu-id="c6475-136">Подробное описание см. в статье [Включение единого входа для надстроек Office](../develop/sso-in-office-add-ins.md). Разница заключается в том, что у надстройки обязательно должен быть серверный веб-API, а также в использовании термина "маркер доступа к начальной загрузке" вместо термина "маркер доступа" из указанной статьи.</span><span class="sxs-lookup"><span data-stu-id="c6475-136">For a thorough description, see [Enable single sign-on for Office Add-ins](../develop/sso-in-office-add-ins.md). The difference is that it is mandatory that the add-in have a server-side Web API, and what's called the access token in that article is called the "bootstrap access token."</span></span>

<span data-ttu-id="c6475-137">В зависимости от языка и платформы могут быть доступны библиотеки, которые упростят создание серверного кода.</span><span class="sxs-lookup"><span data-stu-id="c6475-137">Depending on your language and framework, libraries might be available that will simplify the server-side code you have to write.</span></span> <span data-ttu-id="c6475-138">Ваш код должен выполнять следующее:</span><span class="sxs-lookup"><span data-stu-id="c6475-138">Your code should do the following:</span></span>

* <span data-ttu-id="c6475-139">Инициировать поток "от имени" с вызова конечной точки Azure AD v2.0, которая включает маркер доступа bootstrap, некоторые метаданные о пользователе и учетные данные надстройки (ее ID и секрет).</span><span class="sxs-lookup"><span data-stu-id="c6475-139">Initiate the "on behalf of" flow with a call to the Azure AD v2.0 endpoint that includes the bootstrap access token, some metadata about the user, and the credentials of the add-in (its ID and secret).</span></span>
* <span data-ttu-id="c6475-140">создать один или несколько методов веб-API, которые получают данные Microsoft Graph, передавая (возможно кэшированный) маркер доступа в Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="c6475-140">Create one or more Web API methods that get Microsoft Graph data by passing the (possibly cached) access token to Microsoft Graph.</span></span>
* <span data-ttu-id="c6475-141">при необходимости перед запуском потока проверять маркер доступа к начальной загрузке надстройки, полученный от созданного ранее обработчика маркеров.</span><span class="sxs-lookup"><span data-stu-id="c6475-141">Optionally, before initiating the flow, validate the add-in bootstrap access token that is received from the token handler you created earlier.</span></span> <span data-ttu-id="c6475-142">Дополнительные сведения см. в разделе [Проверка маркера доступа](sso-in-office-add-ins.md#validate-the-access-token);</span><span class="sxs-lookup"><span data-stu-id="c6475-142">For more information, see [Validate the access token](sso-in-office-add-ins.md#validate-the-access-token).</span></span> 
* <span data-ttu-id="c6475-143">при необходимости после завершения потока поместить в кэш возвращенный маркер доступа к Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="c6475-143">Optionally, after the flow completes, cache the returned access token to Microsoft Graph.</span></span> <span data-ttu-id="c6475-144">Это рекомендуется делать, если надстройка выполняет несколько вызовов в Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="c6475-144">You'll want to do this if the add-in makes more than one call to Microsoft Graph.</span></span> <span data-ttu-id="c6475-145">Дополнительные сведения об этом потоке см. в статье [Azure Active Directory версии 2.0 и поток "от имени" OAuth 2.0](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of);</span><span class="sxs-lookup"><span data-stu-id="c6475-145">For more information about this flow see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

> [!NOTE]
> <span data-ttu-id="c6475-146">Примеры раскодированных маркеров доступа в Microsoft Graph, которые были получены потоком "от имени", см. в статье [Azure Active Directory версии 2.0 и поток "от имени" OAuth 2.0](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="c6475-146">For examples of decoded access tokens for Microsoft Graph that have been obtained by the "on-behalf-of" flow, see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

<span data-ttu-id="c6475-147">Подробные пошаговые инструкции и сценарии см. в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="c6475-147">For examples of detailed walkthroughs and scenarios, see:</span></span>

* [<span data-ttu-id="c6475-148">Создание надстройки Office на платформе Node.js с использованием единого входа</span><span class="sxs-lookup"><span data-stu-id="c6475-148">Create a Node.js Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-nodejs.md)
* [<span data-ttu-id="c6475-149">Создание надстройки Office на платформе ASP.NET с использованием единого входа</span><span class="sxs-lookup"><span data-stu-id="c6475-149">Create an ASP.NET Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-aspnet.md)
* [<span data-ttu-id="c6475-150">Сценарий: реализация единого входа для службы в надстройке Outlook</span><span class="sxs-lookup"><span data-stu-id="c6475-150">Scenario: Implement single sign-on to your service in an Outlook add-in</span></span>](../outlook/implement-sso-in-outlook-add-in.md)

## <a name="distributing-sso-enabled-add-ins-in-microsoft-appsource"></a><span data-ttu-id="c6475-151">Распространение надстройок с поддержкой SSO в Microsoft AppSource</span><span class="sxs-lookup"><span data-stu-id="c6475-151">Distributing SSO-enabled add-ins in Microsoft AppSource</span></span>

<span data-ttu-id="c6475-152">Когда администратор Microsoft 365 получает надстройку из [AppSource,](https://appsource.microsoft.com)администратор может [](../publish/centralized-deployment.md) перераспределить ее путем централизованного развертывания и предоставления согласия администратора надстройке для доступа к microsoft Graph области.</span><span class="sxs-lookup"><span data-stu-id="c6475-152">When a Microsoft 365 admin acquires an add-in from [AppSource](https://appsource.microsoft.com), the admin can redistribute it by [centralized deployment](../publish/centralized-deployment.md) and grant admin consent to the add-in to access Microsoft Graph scopes.</span></span> <span data-ttu-id="c6475-153">Однако конечному пользователю также возможно приобрести надстройки непосредственно из AppSource, в этом случае пользователь должен предоставить согласие на надстройки.</span><span class="sxs-lookup"><span data-stu-id="c6475-153">It's also possible, however, for the end user to acquire the add-in directly from AppSource, in which case the user must grant consent to the add-in.</span></span> <span data-ttu-id="c6475-154">Это может создать потенциальную проблему производительности, для которой мы предоставили решение.</span><span class="sxs-lookup"><span data-stu-id="c6475-154">This can create a potential performance problem for which we've provided a solution.</span></span>

<span data-ttu-id="c6475-155">Если код передает параметр в вызове , например , Office может вызвать пользователя на согласие, если Azure AD сообщает Office что согласие еще не было предоставлено `allowConsentPrompt` `getAccessToken` надстройки. `OfficeRuntime.auth.getAccessToken( { allowConsentPrompt: true } );`</span><span class="sxs-lookup"><span data-stu-id="c6475-155">If your code passes the `allowConsentPrompt` option in the call of `getAccessToken`, like `OfficeRuntime.auth.getAccessToken( { allowConsentPrompt: true } );`, then Office can prompt the user for consent if Azure AD reports to Office that consent has not yet been granted to the add-in.</span></span> <span data-ttu-id="c6475-156">Однако по соображениям безопасности Office только побудить пользователя дать согласие на область Azure `profile` AD.</span><span class="sxs-lookup"><span data-stu-id="c6475-156">However, for security reasons, Office can only prompt the user to consent to the Azure AD `profile` scope.</span></span> <span data-ttu-id="c6475-157">*Office не может подсказок для согласия* на какие-либо microsoft Graph области, даже `User.Read` не .</span><span class="sxs-lookup"><span data-stu-id="c6475-157">*Office cannot prompt for consent to any Microsoft Graph scopes*, not even `User.Read`.</span></span> <span data-ttu-id="c6475-158">Это означает, что если пользователь дает согласие на запрос, Office возвращает маркер bootstrap.</span><span class="sxs-lookup"><span data-stu-id="c6475-158">This means that if the user grants consent on the prompt, Office will return a bootstrap token.</span></span> <span data-ttu-id="c6475-159">Но попытка обмена маркера загрузки для маркера доступа в Microsoft Graph не увенчается ошибкой AADSTS65001, что означает, что согласие (для microsoft Graph области) не было предоставлено.</span><span class="sxs-lookup"><span data-stu-id="c6475-159">But the attempt to exchange the bootstrap token for an access token to Microsoft Graph will fail with error AADSTS65001, which means consent (to Microsoft Graph scopes) has not been granted.</span></span>

<span data-ttu-id="c6475-160">Ваш код может и должен обрабатывать эту ошибку, возвращаясь к альтернативной системе проверки подлинности, которая будет побуждать пользователя к согласию на microsoft Graph области.</span><span class="sxs-lookup"><span data-stu-id="c6475-160">Your code can, and should, handle this error by falling back to an alternate system of authentication, which will prompt the user for consent to Microsoft Graph scopes.</span></span> <span data-ttu-id="c6475-161">(В примерах кода см. создание надстройки [Node.js Office,](create-sso-office-add-ins-nodejs.md) использующей [](create-sso-office-add-ins-aspnet.md) один вход и создайте надстройку ASP.NET Office, которая использует один вход и примеры, на которые они ссылались.) Но для всего процесса требуется несколько поездок в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c6475-161">(For code examples, see [Create a Node.js Office Add-in that uses single sign-on](create-sso-office-add-ins-nodejs.md) and [Create an ASP.NET Office Add-in that uses single sign-on](create-sso-office-add-ins-aspnet.md) and the samples they link to.) But the entire process requires multiple round trips to Azure AD.</span></span> <span data-ttu-id="c6475-162">Вы можете избежать этого штрафа за производительность, включив параметр в вызов `forMSGraphAccess` `getAccessToken` ; например, `OfficeRuntime.auth.getAccessToken( { forMSGraphAccess: true } )` .</span><span class="sxs-lookup"><span data-stu-id="c6475-162">You can avoid this performance penalty by including the `forMSGraphAccess` option in the call of `getAccessToken`; for example, `OfficeRuntime.auth.getAccessToken( { forMSGraphAccess: true } )`.</span></span>  <span data-ttu-id="c6475-163">Это сигнализирует Office, что вашей надстройки нужны microsoft Graph области.</span><span class="sxs-lookup"><span data-stu-id="c6475-163">This signals to Office that your add-in needs Microsoft Graph scopes.</span></span> <span data-ttu-id="c6475-164">Office Azure AD, чтобы убедиться, что Graph microsoft Graph области уже предоставлены надстройки.</span><span class="sxs-lookup"><span data-stu-id="c6475-164">Office will ask Azure AD to verify that consent to Microsoft Graph scopes has already been granted to the add-in.</span></span> <span data-ttu-id="c6475-165">Если он есть, маркер загрузки будет возвращен.</span><span class="sxs-lookup"><span data-stu-id="c6475-165">If it has, the bootstrap token will be returned.</span></span> <span data-ttu-id="c6475-166">Если этого не сделать, вызов будет возвращать `getAccessToken` ошибку 13012.</span><span class="sxs-lookup"><span data-stu-id="c6475-166">If it hasn't, then the call of `getAccessToken` will return error 13012.</span></span> <span data-ttu-id="c6475-167">Ваш код может справиться с этой ошибкой, сразу же возвращаясь к альтернативной системе проверки подлинности, не делая обреченной попытки обмена маркерами с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c6475-167">Your code can handle this error by falling back to an alternate system of authentication immediately, without making a doomed attempt to exchange tokens with Azure AD.</span></span>

<span data-ttu-id="c6475-168">В качестве наилучшей практики всегда передайте, когда надстройка будет распространяться в AppSource и нуждается в `forMSGraphAccess` `getAccessToken` microsoft Graph области.</span><span class="sxs-lookup"><span data-stu-id="c6475-168">As a best practice, always pass `forMSGraphAccess` to `getAccessToken` when your add-in will be distributed in AppSource and needs Microsoft Graph scopes.</span></span>

> [!TIP]
> <span data-ttu-id="c6475-169">Если вы разрабатываете надстройку Outlook, которая использует SSO, и вы  ее побок для тестирования, Office всегда возвращает ошибку 13012, когда передается, даже если согласие администратора было `forMSGraphAccess` `getAccessToken` предоставлено.</span><span class="sxs-lookup"><span data-stu-id="c6475-169">If you develop an Outlook add-in that uses SSO and you sideload it for testing, Office will *always* return error 13012 when `forMSGraphAccess` is passed to `getAccessToken` even if administrator consent has been granted.</span></span> <span data-ttu-id="c6475-170">По этой причине при разработке надстройки Outlook `forMSGraphAccess` комментарии. </span><span class="sxs-lookup"><span data-stu-id="c6475-170">For this reason, you should comment out the `forMSGraphAccess` option **when developing** an Outlook add-in.</span></span> <span data-ttu-id="c6475-171">Не забудьте отостановить параметр при развертывании для производства.</span><span class="sxs-lookup"><span data-stu-id="c6475-171">Be sure to uncomment the option when you deploy for production.</span></span> <span data-ttu-id="c6475-172">Фиктивный 13012 происходит только при загрузке Outlook.</span><span class="sxs-lookup"><span data-stu-id="c6475-172">The bogus 13012 only happens when you are sideloading in Outlook.</span></span>
