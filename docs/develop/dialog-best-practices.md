---
title: Рекомендации и правила Office dialog API
description: Содержит правила и рекомендации для API диалогового Office, такие как рекомендации для одностраничного приложения (SPA).
ms.date: 05/19/2022
ms.localizationpriority: medium
ms.openlocfilehash: c4594bc8636bd40b4b2511e3faa4fd879c5b2f10
ms.sourcegitcommit: 4ca3334f3cefa34e6b391eb92a429a308229fe89
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2022
ms.locfileid: "65628056"
---
# <a name="best-practices-and-rules-for-the-office-dialog-api"></a>Рекомендации и правила Office dialog API

В этой статье приводятся правила, руководства и рекомендации по API диалогового Office, включая рекомендации по проектированию пользовательского интерфейса диалогового окна и использованию API в одностраничных приложениях (SPA).

> [!NOTE]
> В этой статье предполагается, что вы знакомы с основами использования API диалогового Office, как описано в разделе "Использование [API](dialog-api-in-office-add-ins.md) диалогового окна Office" в надстройки Office.
> 
> См. [также об обработке ошибок и событий с помощью Office окна](dialog-handle-errors-events.md).

## <a name="rules-and-gotchas"></a>Правила и подсказки

- В диалоговом окне можно перейти только по URL-адресам HTTPS, а не ПО HTTP.
- URL-адрес, передаваемый [методу displayDialogAsync](/javascript/api/office/office.ui) , должен находиться в том же домене, что и сама надстройка. Он не может быть поддоменом. Но страница, передаваемая на нее, может перенаправляться на страницу в другом домене.
- В окне узла, которое может быть областью задач или файлом функции без [](/javascript/api/manifest/functionfile) пользовательского интерфейса команды надстройки, одновременно может быть открыто только одно диалоговое окно.
- В диалоговом окне можно вызвать только два Office API:
  - Функция [messageParent](/javascript/api/office/office.ui#office-office-ui-messageparent-member(1)) .
  - `Office.context.requirements.isSetSupported`(Дополнительные сведения см. в [Office приложениях и требованиях К API](specify-office-hosts-and-api-requirements.md).)
- Функция [messageParent](/javascript/api/office/office.ui#office-office-ui-messageparent-member(1)) обычно должна вызываться со страницы в том же домене, что и сама надстройка, но это необязательно. Дополнительные сведения см. в разделе [Междоменные сообщения в основной среде выполнения](dialog-api-in-office-add-ins.md#cross-domain-messaging-to-the-host-runtime).

## <a name="best-practices"></a>Рекомендации

### <a name="avoid-overusing-dialog-boxes"></a>Избегайте чрезмерного использования диалоговых окон

Поскольку перекрывающиеся элементы пользовательского интерфейса не приветствуются, избегайте открытия диалогового окна на панели задач, если это не требуется в сценарий. При планировании контактной зоны помните, что в области задач можно использовать вкладки. Пример области задач с вкладками см. в Excel [надстройки JavaScript SalesTracker](https://github.com/OfficeDev/Excel-Add-in-JavaScript-SalesTracker).

### <a name="design-a-dialog-box-ui"></a>Проектирование пользовательского интерфейса диалогового окна

Рекомендации по проектированию диалоговых окон см. в Office [надстроек](../develop/dialog-api-in-office-add-ins.md).

### <a name="handle-pop-up-blockers-with-office-on-the-web"></a>Обработка блокирования всплывающих элементов с помощью Office в Интернете

Попытка отобразить диалоговое окно при использовании Office в Интернете может привести к блоку всплывающих окон браузера. В этом случае Office в Интернете откроет запрос, аналогичный приведенному ниже.

![Снимок экрана: запрос с кратким описанием и кнопками "Разрешить и игнорировать", которые надстройка может создать, чтобы избежать блокирования всплывающих элементов в браузере](../images/dialog-prompt-before-open.png)

Если пользователь **нажмет кнопку "** Разрешить", Office откроется диалоговое окно. Если пользователь **нажмет "Пропустить**", запрос закроется, а Office диалоговое окно не откроется. Вместо этого метод `displayDialogAsync` возвращает ошибку 12009. Код должен перехватывать эту ошибку и предоставлять альтернативный интерфейс, который не требует диалогового окна, или отображать сообщение пользователю о том, что надстройка требует, чтобы он разрешал диалоговое окно. (Дополнительные сведения о 12009 см. в разделе ["Ошибки из displayDialogAsync](dialog-handle-errors-events.md#errors-from-displaydialogasync).)

Если по какой-либо причине вы хотите отключить эту функцию, код должен отказаться. Он выполняет этот запрос с [объектом DialogOptions](/javascript/api/office/office.dialogoptions) , который передается методу `displayDialogAsync` . В частности, объект должен включать .`promptBeforeOpen: false` Если этот параметр имеет значение false, Office в Интернете пользователю не будет предложено разрешить надстройке открывать диалоговое окно, и Office не откроется.

### <a name="do-not-use-the-_host_info-value"></a>Не используйте значение \_hostinfo\_

Office автоматически добавляет параметр запроса `_host_info` в URL-адрес, который передается `displayDialogAsync`. Он добавляется после пользовательских параметров запроса, если они есть. Он не добавляется к последующим URL-адресам, на которые выполняется переход в диалоговом окне. Корпорация Майкрософт может изменить содержимое этого значения или полностью удалить его, чтобы код не считываю его. Это же значение добавляется в хранилище сеансов диалогового окна (то есть свойство [Window.sessionStorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) ). *Ваш код не должен ни считывать это значение, ни записывать в него данные*.

### <a name="open-another-dialog-immediately-after-closing-one"></a>Открытие другого диалогового окна сразу после закрытия одного из них

На заданной хост-странице не может быть открыто несколько диалогов, поэтому код должен вызвать [Dialog.close](/javascript/api/office/office.dialog#office-office-dialog-close-member(1)) `displayDialogAsync` в открытом диалоговом окне перед вызовом другого диалогового окна. Метод `close` является асинхронным. По этой причине при `displayDialogAsync` `close`вызове сразу после вызова первого диалогового окна может не быть полностью закрыто, Office пытается открыть второй. В этом случае Office возвращает ошибку [12007](dialog-handle-errors-events.md#12007): "Не удалось выполнить операцию, так как у этой надстройки уже есть активный диалог".

Метод `close` не принимает параметр обратного вызова и не возвращает объект Promise `await` `then` , поэтому его нельзя ожидать с помощью ключевого слова или метода. По этой причине мы рекомендуем использовать следующий метод, если необходимо открыть новое диалоговое окно сразу после закрытия диалогового окна: `displayDialogAsync` `12007`инкапсулируйте код, чтобы открыть новое диалоговое окно в методе, и разработать метод для рекурсивного вызова, если возвращается вызов. Ниже приведен пример.

```javascript
function openFirstDialog() {
  Office.context.ui.displayDialogAsync("https://MyDomain/firstDialog.html", { width: 50, height: 50},
     (result) => {
      if(result.status === Office.AsyncResultStatus.Succeeded) {
        const dialog = result.value;
        dialog.close();
        openSecondDialog();
      }
      else {
         // Handle errors
      }
    }
  );
}
 
function openSecondDialog() {
  Office.context.ui.displayDialogAsync("https://MyDomain/secondDialog.html", { width: 50, height: 50},
    (result) => {
      if(result.status === Office.AsyncResultStatus.Failed) {
        if (result.error.code === 12007) {
          openSecondDialog(); // Recursive call
        }
        else {
         // Handle other errors
        }
      }
    }
  );
}
```

Кроме того, можно принудительно приостановить код перед попыткой открыть второе диалоговое окно с помощью [метода setTimeout](https://www.w3schools.com/jsref/met_win_settimeout.asp) . Ниже приведен пример.

```javascript
function openFirstDialog() {
  Office.context.ui.displayDialogAsync("https://MyDomain/firstDialog.html", { width: 50, height: 50},
     (result) => {
      if(result.status === Office.AsyncResultStatus.Succeeded) {
        const dialog = result.value;
        dialog.close();
        setTimeout(() => { 
          Office.context.ui.displayDialogAsync("https://MyDomain/secondDialog.html", { width: 50, height: 50},
             (result) => { /* callback body */ }
          );
        }, 1000);
      }
      else {
         // Handle errors
      }
    }
  );
}
```

### <a name="best-practices-for-using-the-office-dialog-api-in-an-spa"></a>Рекомендации по использованию API Office диалогового окна в spa

Если надстройка использует маршрутизацию на стороне клиента, как это обычно используют одностраничные приложения (SPA), вы можете передать URL-адрес маршрута методу [displayDialogAsync](/javascript/api/office/office.ui) вместо URL-адреса отдельной HTML-страницы. *Мы не рекомендуем делать это по приведенным ниже причинам.*

> [!NOTE]
> Эта статья не относится к *маршрутизации* на стороне сервера, например в веб-приложении на основе Express.

#### <a name="problems-with-spas-and-the-office-dialog-api"></a>Проблемы с одностраничных приложениями и API Office диалогового окна

Диалоговое Office находится в новом окне с собственным экземпляром ядра JavaScript и, следовательно, собственным полным контекстом выполнения. При передаче маршрута базовая страница и весь код ее инициализации и начальной загрузки снова выполняются в этом новом контексте, а для всех переменных в диалоговом окне задается начальное значение. Таким образом, этот метод скачивает и запускает второй экземпляр приложения в окне поля, что частично не позволяет использовать одностраничное приложение. Кроме того, код, который изменяет переменные в окне диалогового окна, не изменяет версию области задач тех же переменных. Аналогично, в окне диалогового окна есть собственное хранилище сеансов (свойство [Window.sessionStorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) ), недоступное из кода в области задач. Диалоговое окно и страница узла `displayDialogAsync` , на которой был вызван вызов, выглядят на сервере как два разных клиента. (Напоминания о том, что такое страница узла, см. в разделе "Открытие [диалогового окна" на странице узла](dialog-api-in-office-add-ins.md#open-a-dialog-box-from-a-host-page).)

Таким образом, если вы передали `displayDialogAsync` маршрут методу, у вас не будет одностраничного приложения. У вас будет два экземпляра одного и *того же одностраничного приложения*. Кроме того, большая часть кода в экземпляре области задач никогда не будет использоваться в этом экземпляре, а большая часть кода в экземпляре диалогового окна никогда не будет использоваться в этом экземпляре. Это соответствует применению двух одностраничных приложений в одном пакете.

#### <a name="microsoft-recommendations"></a>Рекомендации Майкрософт

Вместо передачи клиентского маршрута `displayDialogAsync` методу рекомендуется выполнить одно из следующих действий:

* Если код, который необходимо выполнить в диалоговом окне, достаточно сложный, явно создайте два разных одностраничных приложения. то есть иметь два одностраничных приложения в разных папках одного домена. В диалоговом окне запускается одно ОДНОстраничные приложения, а в другом — на хост-странице диалогового окна, где `displayDialogAsync` был вызван. 
* В большинстве сценариев в диалоговом окне требуется только простая логика. В таких случаях проект значительно упростит размещение одной HTML-страницы с внедренным кодом JavaScript или ссылкой на нее в домене spa. Передайте URL-адрес страницы в метод `displayDialogAsync`. Это означает, что вы отрекались от литеральной идеи одностраничного приложения. При использовании API диалогового Office у вас нет ни одного экземпляра одностраничного приложения.
