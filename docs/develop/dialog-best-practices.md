---
title: Рекомендации и правила Office dialog API
description: Содержит правила и рекомендации для API диалоговых окон Office, такие как рекомендации для одностраничного приложения (SPA)
ms.date: 01/29/2020
localization_priority: Normal
ms.openlocfilehash: e684c56768cd2ca7c9b14788206c925808c90b63
ms.sourcegitcommit: 4079903c3cc45b7d8c041509a44e9fc38da399b1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/11/2020
ms.locfileid: "42596601"
---
# <a name="best-practices-and-rules-for-the-office-dialog-api"></a>Рекомендации и правила Office dialog API

В этой статье представлены правила, проблемы и рекомендации для API диалоговых окон Office, в том числе рекомендации по разработке пользовательского интерфейса диалогового окна и использованию API в приложении с одной страницей (SPA)

> [!NOTE]
> В этой статье предсказано, что вы знакомы с основами использования API диалоговых окон Office, описанных в статье [Использование API диалоговых окон Office в](dialog-api-in-office-add-ins.md)надстройках Office.
> 
> [В диалоговом окне Office доступны также методы обработки ошибок и событий](dialog-handle-errors-events.md).

## <a name="rules-and-gotchas"></a>Правила и подсказки

- Диалоговое окно может только перемещаться по URL-адресам HTTPS, а не HTTP.
- URL-адрес, передаваемый в метод [displayDialogAsync](/javascript/api/office/office.ui) , должен находиться в том же домене, что и сама надстройка. Он не может быть поддоменом. Но страница, которая передается на нее, может выполнять перенаправление на страницу в другом домене.
- Ведущее окно, которое может быть областью задач или [файлом функции](../reference/manifest/functionfile.md) без пользовательского интерфейса команды надстройки, может одновременно открыть только одно диалоговое окно.
- В диалоговом окне можно вызывать только два интерфейса API Office:
  - Функция [messageParent](/javascript/api/office/office.ui#messageparent-message-) .
  - `Office.context.requirements.isSetSupported`(Дополнительные сведения см. в разделе [Указание ведущих приложений Office и требований к API](specify-office-hosts-and-api-requirements.md).)
- Функцию [messageParent](/javascript/api/office/office.ui#messageparent-message-) можно вызвать только со страницы в том же домене, что и сама надстройка.

## <a name="best-practices"></a>Рекомендации

### <a name="avoid-overusing-dialog-boxes"></a>Избегайте переиспользования диалоговых окон

Поскольку перекрывающиеся элементы пользовательского интерфейса не приветствуются, избегайте открытия диалогового окна на панели задач, если это не требуется в сценарий. При планировании контактной зоны помните, что в области задач можно использовать вкладки. Например, как в [надстройке JavaScript SalesTracker для Excel](https://github.com/OfficeDev/Excel-Add-in-JavaScript-SalesTracker).

### <a name="designing-a-dialog-box-ui"></a>Разработка пользовательского интерфейса диалогового окна

Рекомендации по проектированию диалоговых окон можно найти [в диалоговых окнах](../design/dialog-boxes.md)надстройки Office.

### <a name="handling-pop-up-blockers-with-office-on-the-web"></a>Обработка блокировщиков всплывающих окон с помощью Office в Интернете

Попытка отобразить диалоговое окно при использовании Office в Интернете может привести к блокированию диалогового окна в браузере. В Office в Интернете есть функция, которая позволяет диалоговым окнам надстройки быть исключением для блокирования всплывающих окон в браузере. Когда код вызывает `displayDialogAsync` метод, Office в Интернете откроет приглашение, аналогичное следующему:

![Сообщение о том, что надстройка может быть создана для предотвращения блокирования всплывающих окон в браузере.](../images/dialog-prompt-before-open.png)

Если пользователь выбрал параметр " **Разрешить**", откроется диалоговое окно Office. Если пользователь выберет **Ignore**, запрос закроется, а диалоговое окно Office не откроется. Вместо этого `displayDialogAsync` метод возвращает ошибку 12009. Код должен перехватывать эту ошибку и либо предоставлять альтернативный интерфейс, не требующий диалога, либо отображать сообщение для пользователя, в котором надстройка должна разрешить диалоговое окно. (Подробнее о 12009 можно узнать [в статье ошибки из displayDialogAsync](dialog-handle-errors-events.md#errors-from-displaydialogasync).)

Если по какой либо причине вы хотите отключить эту функцию, ваш код должен отказаться от использования. Он отправляет этот запрос с помощью объекта [диалогоптионс](/javascript/api/office/office.dialogoptions) , который передается `displayDialogAsync` в метод. В частности, объект должен включать `promptBeforeOpen: false`. Если этому параметру присвоено значение false, Office в Интернете не будет предлагать пользователю разрешить надстройку открыть диалоговое окно, а диалоговое окно Office не откроется.

### <a name="do-not-use-the-_host_info-value"></a>Не используйте значение info \_host\_

Office автоматически добавляет параметр запроса `_host_info` в URL-адрес, который передается `displayDialogAsync`. Он добавляется после настраиваемых параметров запроса, если таковые имеются. Он не добавляется к последующим URL-адресам, на которые переходит диалоговое окно. Корпорация Майкрософт может изменить содержимое этого значения или полностью удалить его, чтобы код не читал его. То же значение добавляется в сеансовое хранилище диалогового окна. *Ваш код не должен ни считывать это значение, ни записывать в него данные*.

### <a name="best-practices-for-using-the-office-dialog-api-in-an-spa"></a>Рекомендации по использованию API диалоговых окон Office в SPA

Если ваша надстройка использует клиентскую маршрутизацию, как правило, для одностраничных приложений (SPA), можно передать URL-адрес маршрута методу [displayDialogAsync](/javascript/api/office/office.ui) , а не URL-адрес отдельной страницы HTML. *Мы рекомендуем сделать это по причинам, приведенным ниже.*

> [!NOTE]
> Эта статья не относится к маршрутизации на *стороне сервера* , например, в веб-приложении на основе Express.

#### <a name="problems-with-spas-and-the-office-dialog-api"></a>Проблемы с SPA и API диалоговых окон Office

Диалоговое окно Office находится в новом окне с собственным экземпляром механизма JavaScript, поэтому он является полным контекстом выполнения. Если вы передаете маршрут, Базовая страница и код инициализации и начальной загрузки снова выполняются в этом новом контексте, а все переменные задаются начальными значениями в диалоговом окне. Поэтому этот метод загружает и запускает второй экземпляр приложения в окне Box, что частично противоречит назначению SPA. Кроме того, код, изменяющий переменные в диалоговом окне, не изменяет версию области задач для тех же переменных. Аналогично, окно диалога имеет собственное хранилище сеанса, которое недоступно из кода в области задач. Диалоговое окно и страница хоста, на `displayDialogAsync` которой она была вызвана, выглядят как два разных клиента для вашего сервера. (Напоминание о странице ведущего приложения можно узнать в разделе [Открытие диалогового окна на странице узла](dialog-api-in-office-add-ins.md#open-a-dialog-box-from-a-host-page).)

Таким образом, если вы передали маршрут к `displayDialogAsync` методу, у вас не будет бесусловного смысла; у вас будут *два экземпляра одного и того же Spa*. Кроме того, значительная часть кода в экземпляре области задач никогда не использовалась в этом экземпляре, и большинство кода в экземпляре диалогового окна никогда не использовались в этом экземпляре. Это соответствует применению двух одностраничных приложений в одном пакете.

#### <a name="microsoft-recommendations"></a>Рекомендации корпорации Майкрософт

Вместо того чтобы передавать в `displayDialogAsync` метод клиентский маршрут, рекомендуется выполнить одно из следующих действий:

* Если код, который требуется выполнить в диалоговом окне, достаточно сложен, создайте два разных Spa явным образом; то есть два Spa в разных папках одного домена. Один SPA выполняется в диалоговом окне, а другой — на главной странице диалогового окна, `displayDialogAsync` где было вызвано. 
* В большинстве сценариев в диалоговом окне требуется только простая логика. В таких случаях ваш проект будет значительно упрощен, разместив одну HTML-страницу с внедренным или упоминаемым JavaScript в домене вашего SPA. Передайте URL-адрес страницы в метод `displayDialogAsync`. Это означает, что вы отклоняете от литеральной идеи одностраничного приложения; При использовании API диалоговых окон Office на самом деле не существует единого экземпляра SPA.
