---
title: Рекомендации и правила Office dialog API
description: Содержит правила и рекомендации для API диалоговых окон Office, такие как рекомендации для одностраничного приложения (SPA)
ms.date: 01/29/2020
localization_priority: Normal
ms.openlocfilehash: 5e0854137b27d8b8ae33fff8943421cc0c488abe
ms.sourcegitcommit: 9609bd5b4982cdaa2ea7637709a78a45835ffb19
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2020
ms.locfileid: "47292759"
---
# <a name="best-practices-and-rules-for-the-office-dialog-api"></a><span data-ttu-id="14273-103">Рекомендации и правила Office dialog API</span><span class="sxs-lookup"><span data-stu-id="14273-103">Best practices and rules for the Office dialog API</span></span>

<span data-ttu-id="14273-104">В этой статье представлены правила, проблемы и рекомендации для API диалоговых окон Office, в том числе рекомендации по разработке пользовательского интерфейса диалогового окна и использованию API в приложении с одной страницей (SPA)</span><span class="sxs-lookup"><span data-stu-id="14273-104">This article provides rules, gotchas, and best practices for the Office dialog API, including best practices for designing the UI of a dialog and using the API with in a single-page application (SPA)</span></span>

> [!NOTE]
> <span data-ttu-id="14273-105">В этой статье предсказано, что вы знакомы с основами использования API диалоговых окон Office, описанных в статье [Использование API диалоговых окон Office в](dialog-api-in-office-add-ins.md)надстройках Office.</span><span class="sxs-lookup"><span data-stu-id="14273-105">This article presupposes that you are familiar with the basics of using the Office dialog API as described in [Use the Office dialog API in your Office Add-ins](dialog-api-in-office-add-ins.md).</span></span>
> 
> <span data-ttu-id="14273-106">[В диалоговом окне Office доступны также методы обработки ошибок и событий](dialog-handle-errors-events.md).</span><span class="sxs-lookup"><span data-stu-id="14273-106">See also [Handling errors and events with the Office dialog box](dialog-handle-errors-events.md).</span></span>

## <a name="rules-and-gotchas"></a><span data-ttu-id="14273-107">Правила и подсказки</span><span class="sxs-lookup"><span data-stu-id="14273-107">Rules and gotchas</span></span>

- <span data-ttu-id="14273-108">Диалоговое окно может только перемещаться по URL-адресам HTTPS, а не HTTP.</span><span class="sxs-lookup"><span data-stu-id="14273-108">The dialog box can only navigate to HTTPS URLs, not HTTP.</span></span>
- <span data-ttu-id="14273-109">URL-адрес, передаваемый в метод [displayDialogAsync](/javascript/api/office/office.ui) , должен находиться в том же домене, что и сама надстройка.</span><span class="sxs-lookup"><span data-stu-id="14273-109">The URL passed to the [displayDialogAsync](/javascript/api/office/office.ui) method must be in the exact same domain as the add-in itself.</span></span> <span data-ttu-id="14273-110">Он не может быть поддоменом.</span><span class="sxs-lookup"><span data-stu-id="14273-110">It cannot be a subdomain.</span></span> <span data-ttu-id="14273-111">Но страница, которая передается на нее, может выполнять перенаправление на страницу в другом домене.</span><span class="sxs-lookup"><span data-stu-id="14273-111">But the page that is passed to it can redirect to a page in another domain.</span></span>
- <span data-ttu-id="14273-112">Ведущее окно, которое может быть областью задач или [файлом функции](../reference/manifest/functionfile.md) без пользовательского интерфейса команды надстройки, может одновременно открыть только одно диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="14273-112">A host window, which can be a task pane or the UI-less [function file](../reference/manifest/functionfile.md) of an add-in command, can have only one dialog box open at a time.</span></span>
- <span data-ttu-id="14273-113">В диалоговом окне можно вызывать только два интерфейса API Office:</span><span class="sxs-lookup"><span data-stu-id="14273-113">Only two Office APIs can be called in the dialog box:</span></span>
  - <span data-ttu-id="14273-114">Функция [messageParent](/javascript/api/office/office.ui#messageparent-message-) .</span><span class="sxs-lookup"><span data-stu-id="14273-114">The [messageParent](/javascript/api/office/office.ui#messageparent-message-) function.</span></span>
  - <span data-ttu-id="14273-115">`Office.context.requirements.isSetSupported` (Дополнительные сведения см. в разделе [Указание приложений Office и требований к API](specify-office-hosts-and-api-requirements.md).)</span><span class="sxs-lookup"><span data-stu-id="14273-115">`Office.context.requirements.isSetSupported` (For more information, see [Specify Office applications and API requirements](specify-office-hosts-and-api-requirements.md).)</span></span>
- <span data-ttu-id="14273-116">Функцию [messageParent](/javascript/api/office/office.ui#messageparent-message-) можно вызвать только со страницы в том же домене, что и сама надстройка.</span><span class="sxs-lookup"><span data-stu-id="14273-116">The [messageParent](/javascript/api/office/office.ui#messageparent-message-) function can only be called from a page in the exact same domain as the add-in itself.</span></span>

## <a name="best-practices"></a><span data-ttu-id="14273-117">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="14273-117">Best practices</span></span>

### <a name="avoid-overusing-dialog-boxes"></a><span data-ttu-id="14273-118">Избегайте переиспользования диалоговых окон</span><span class="sxs-lookup"><span data-stu-id="14273-118">Avoid overusing dialog boxes</span></span>

<span data-ttu-id="14273-119">Поскольку перекрывающиеся элементы пользовательского интерфейса не приветствуются, избегайте открытия диалогового окна на панели задач, если это не требуется в сценарий.</span><span class="sxs-lookup"><span data-stu-id="14273-119">Because overlapping UI elements are discouraged, avoid opening a dialog box from a task pane unless your scenario requires it.</span></span> <span data-ttu-id="14273-120">При планировании контактной зоны помните, что в области задач можно использовать вкладки.</span><span class="sxs-lookup"><span data-stu-id="14273-120">When you consider how to use the surface area of a task pane, note that task panes can be tabbed.</span></span> <span data-ttu-id="14273-121">Например, как в [надстройке JavaScript SalesTracker для Excel](https://github.com/OfficeDev/Excel-Add-in-JavaScript-SalesTracker).</span><span class="sxs-lookup"><span data-stu-id="14273-121">For an example, see the [Excel Add-in JavaScript SalesTracker](https://github.com/OfficeDev/Excel-Add-in-JavaScript-SalesTracker) sample.</span></span>

### <a name="designing-a-dialog-box-ui"></a><span data-ttu-id="14273-122">Разработка пользовательского интерфейса диалогового окна</span><span class="sxs-lookup"><span data-stu-id="14273-122">Designing a dialog box UI</span></span>

<span data-ttu-id="14273-123">Рекомендации по проектированию диалоговых окон можно найти [в диалоговых окнах](../design/dialog-boxes.md)надстройки Office.</span><span class="sxs-lookup"><span data-stu-id="14273-123">For best practices in dialog box design, see [Dialog boxes in Office Add-ins](../design/dialog-boxes.md).</span></span>

### <a name="handling-pop-up-blockers-with-office-on-the-web"></a><span data-ttu-id="14273-124">Обработка блокировщиков всплывающих окон с помощью Office в Интернете</span><span class="sxs-lookup"><span data-stu-id="14273-124">Handling pop-up blockers with Office on the web</span></span>

<span data-ttu-id="14273-125">Попытка отобразить диалоговое окно при использовании Office в Интернете может привести к блокированию диалогового окна в браузере.</span><span class="sxs-lookup"><span data-stu-id="14273-125">Attempting to display a dialog box while using Office on the web may cause the browser's pop-up blocker to block the dialog box.</span></span> <span data-ttu-id="14273-126">В Office в Интернете есть функция, которая позволяет диалоговым окнам надстройки быть исключением для блокирования всплывающих окон в браузере.</span><span class="sxs-lookup"><span data-stu-id="14273-126">Office on the web has a feature that enables your add-in's dialog boxes to be an exception to the browser's pop-up blocker.</span></span> <span data-ttu-id="14273-127">Когда код вызывает `displayDialogAsync` метод, Office в Интернете откроет приглашение, аналогичное следующему:</span><span class="sxs-lookup"><span data-stu-id="14273-127">When your code calls the `displayDialogAsync` method, then Office on the web will open a prompt similar to the following.</span></span>

![Сообщение о том, что надстройка может быть создана для предотвращения блокирования всплывающих окон в браузере.](../images/dialog-prompt-before-open.png)

<span data-ttu-id="14273-129">Если пользователь выбрал параметр " **Разрешить**", откроется диалоговое окно Office.</span><span class="sxs-lookup"><span data-stu-id="14273-129">If the user chooses **Allow**, the Office dialog box opens.</span></span> <span data-ttu-id="14273-130">Если пользователь выберет **Ignore**, запрос закроется, а диалоговое окно Office не откроется.</span><span class="sxs-lookup"><span data-stu-id="14273-130">If the user chooses **Ignore**, the prompt closes and the Office dialog box does not open.</span></span> <span data-ttu-id="14273-131">Вместо этого `displayDialogAsync` метод возвращает ошибку 12009.</span><span class="sxs-lookup"><span data-stu-id="14273-131">Instead, the `displayDialogAsync` method returns error 12009.</span></span> <span data-ttu-id="14273-132">Код должен перехватывать эту ошибку и либо предоставлять альтернативный интерфейс, не требующий диалога, либо отображать сообщение для пользователя, в котором надстройка должна разрешить диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="14273-132">Your code should catch this error and either provide an alternate experience that does not require a dialog, or display a message to the user advising that the add-in requires them to allow the dialog.</span></span> <span data-ttu-id="14273-133">(Подробнее о 12009 можно узнать [в статье ошибки из displayDialogAsync](dialog-handle-errors-events.md#errors-from-displaydialogasync).)</span><span class="sxs-lookup"><span data-stu-id="14273-133">(For more about 12009, see [Errors from displayDialogAsync](dialog-handle-errors-events.md#errors-from-displaydialogasync).)</span></span>

<span data-ttu-id="14273-134">Если по какой либо причине вы хотите отключить эту функцию, ваш код должен отказаться от использования. Он отправляет этот запрос с помощью объекта [диалогоптионс](/javascript/api/office/office.dialogoptions) , который передается в `displayDialogAsync` метод.</span><span class="sxs-lookup"><span data-stu-id="14273-134">If, for any reason, you want to turn off this feature, then your code must opt out. It makes this request with the [DialogOptions](/javascript/api/office/office.dialogoptions) object that is passed to the `displayDialogAsync` method.</span></span> <span data-ttu-id="14273-135">В частности, объект должен включать `promptBeforeOpen: false` .</span><span class="sxs-lookup"><span data-stu-id="14273-135">Specifically, the object should include `promptBeforeOpen: false`.</span></span> <span data-ttu-id="14273-136">Если этому параметру присвоено значение false, Office в Интернете не будет предлагать пользователю разрешить надстройку открыть диалоговое окно, а диалоговое окно Office не откроется.</span><span class="sxs-lookup"><span data-stu-id="14273-136">When this option is set to false, Office on the web will not prompt the user to allow the add-in open a dialog, and the Office dialog will not open.</span></span>

### <a name="do-not-use-the-_host_info-value"></a><span data-ttu-id="14273-137">Не используйте \_ \_ значение info Host</span><span class="sxs-lookup"><span data-stu-id="14273-137">Do not use the \_host\_info value</span></span>

<span data-ttu-id="14273-138">Office автоматически добавляет параметр запроса `_host_info` в URL-адрес, который передается `displayDialogAsync`.</span><span class="sxs-lookup"><span data-stu-id="14273-138">Office automatically adds a query parameter called `_host_info` to the URL that is passed to `displayDialogAsync`.</span></span> <span data-ttu-id="14273-139">Он добавляется после настраиваемых параметров запроса, если таковые имеются.</span><span class="sxs-lookup"><span data-stu-id="14273-139">It is appended after your custom query parameters, if any.</span></span> <span data-ttu-id="14273-140">Он не добавляется к последующим URL-адресам, на которые переходит диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="14273-140">It is not appended to any subsequent URLs that the dialog box navigates to.</span></span> <span data-ttu-id="14273-141">Корпорация Майкрософт может изменить содержимое этого значения или полностью удалить его, чтобы код не читал его.</span><span class="sxs-lookup"><span data-stu-id="14273-141">Microsoft may change the content of this value, or remove it entirely, so your code should not read it.</span></span> <span data-ttu-id="14273-142">То же значение добавляется в сеансовое хранилище диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="14273-142">The same value is added to the dialog box's session storage.</span></span> <span data-ttu-id="14273-143">*Ваш код не должен ни считывать это значение, ни записывать в него данные*.</span><span class="sxs-lookup"><span data-stu-id="14273-143">Again, *your code should neither read nor write to this value*.</span></span>

### <a name="best-practices-for-using-the-office-dialog-api-in-an-spa"></a><span data-ttu-id="14273-144">Рекомендации по использованию API диалоговых окон Office в SPA</span><span class="sxs-lookup"><span data-stu-id="14273-144">Best practices for using the Office dialog API in an SPA</span></span>

<span data-ttu-id="14273-145">Если ваша надстройка использует клиентскую маршрутизацию, как правило, для одностраничных приложений (SPA), можно передать URL-адрес маршрута методу [displayDialogAsync](/javascript/api/office/office.ui) , а не URL-адрес отдельной страницы HTML.</span><span class="sxs-lookup"><span data-stu-id="14273-145">If your add-in uses client-side routing, as single-page applications (SPAs) typically do, you have the option to pass the URL of a route to the [displayDialogAsync](/javascript/api/office/office.ui) method instead of the URL of a separate HTML page.</span></span> <span data-ttu-id="14273-146">*Мы рекомендуем сделать это по причинам, приведенным ниже.*</span><span class="sxs-lookup"><span data-stu-id="14273-146">*We recommend against doing so for the reasons given below.*</span></span>

> [!NOTE]
> <span data-ttu-id="14273-147">Эта статья не относится к маршрутизации на *стороне сервера* , например, в веб-приложении на основе Express.</span><span class="sxs-lookup"><span data-stu-id="14273-147">This article is not relevant to *server-side* routing, such as in an Express-based web application.</span></span>

#### <a name="problems-with-spas-and-the-office-dialog-api"></a><span data-ttu-id="14273-148">Проблемы с SPA и API диалоговых окон Office</span><span class="sxs-lookup"><span data-stu-id="14273-148">Problems with SPAs and the Office dialog API</span></span>

<span data-ttu-id="14273-149">Диалоговое окно Office находится в новом окне с собственным экземпляром механизма JavaScript, поэтому он является полным контекстом выполнения.</span><span class="sxs-lookup"><span data-stu-id="14273-149">The Office dialog box is in a new window with its own instance of the JavaScript engine, and hence it's own complete execution context.</span></span> <span data-ttu-id="14273-150">Если вы передаете маршрут, Базовая страница и код инициализации и начальной загрузки снова выполняются в этом новом контексте, а все переменные задаются начальными значениями в диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="14273-150">If you pass a route, your base page and all its initialization and bootstrapping code run again in this new context, and any variables are set to their initial values in the dialog box.</span></span> <span data-ttu-id="14273-151">Поэтому этот метод загружает и запускает второй экземпляр приложения в окне Box, что частично противоречит назначению SPA.</span><span class="sxs-lookup"><span data-stu-id="14273-151">So this technique downloads and launches a second instance of your application in the  box window, which partially defeats the purpose of an SPA.</span></span> <span data-ttu-id="14273-152">Кроме того, код, изменяющий переменные в диалоговом окне, не изменяет версию области задач для тех же переменных.</span><span class="sxs-lookup"><span data-stu-id="14273-152">In addition, code that changes variables in the dialog box window does not change the task pane version of the same variables.</span></span> <span data-ttu-id="14273-153">Аналогично, окно диалога имеет собственное хранилище сеанса, которое недоступно из кода в области задач.</span><span class="sxs-lookup"><span data-stu-id="14273-153">Similarly, the dialog box window has its own session storage, which is not accessible from code in the task pane.</span></span> <span data-ttu-id="14273-154">Диалоговое окно и страница хоста, на которой `displayDialogAsync` она была вызвана, выглядят как два разных клиента для вашего сервера.</span><span class="sxs-lookup"><span data-stu-id="14273-154">The dialog box and the host page on which `displayDialogAsync` was called look like two different clients to your server.</span></span> <span data-ttu-id="14273-155">(Напоминание о странице ведущего приложения можно узнать в разделе [Открытие диалогового окна на странице узла](dialog-api-in-office-add-ins.md#open-a-dialog-box-from-a-host-page).)</span><span class="sxs-lookup"><span data-stu-id="14273-155">(For a reminder of what a host page is, see [Open a dialog box from a host page](dialog-api-in-office-add-ins.md#open-a-dialog-box-from-a-host-page).)</span></span>

<span data-ttu-id="14273-156">Таким образом, если вы передали маршрут к методу, у вас не было бесусловного `displayDialogAsync` использования, то у вас будет *два экземпляра с одинаковым Spa*.</span><span class="sxs-lookup"><span data-stu-id="14273-156">So, if you passed a route to the `displayDialogAsync` method, you wouldn't really have an SPA; you'd have *two instances of the same SPA*.</span></span> <span data-ttu-id="14273-157">Кроме того, значительная часть кода в экземпляре области задач никогда не использовалась в этом экземпляре, и большинство кода в экземпляре диалогового окна никогда не использовались в этом экземпляре.</span><span class="sxs-lookup"><span data-stu-id="14273-157">Moreover, much of the code in the task pane instance would never be used in that instance and much of the code in the dialog box instance would never be used in that instance.</span></span> <span data-ttu-id="14273-158">Это соответствует применению двух одностраничных приложений в одном пакете.</span><span class="sxs-lookup"><span data-stu-id="14273-158">It would be like having two SPAs in the same bundle.</span></span>

#### <a name="microsoft-recommendations"></a><span data-ttu-id="14273-159">Рекомендации корпорации Майкрософт</span><span class="sxs-lookup"><span data-stu-id="14273-159">Microsoft recommendations</span></span>

<span data-ttu-id="14273-160">Вместо того чтобы передавать в метод клиентский маршрут `displayDialogAsync` , рекомендуется выполнить одно из следующих действий:</span><span class="sxs-lookup"><span data-stu-id="14273-160">Instead of passing a client-side route to the `displayDialogAsync` method, we recommend that you do one of the following:</span></span>

* <span data-ttu-id="14273-161">Если код, который требуется выполнить в диалоговом окне, достаточно сложен, создайте два разных Spa явным образом; то есть два Spa в разных папках одного домена.</span><span class="sxs-lookup"><span data-stu-id="14273-161">If the code that you want to run in the dialog box is sufficiently complex, create two different SPAs explicitly; that is, have two SPAs in different folders of the same domain.</span></span> <span data-ttu-id="14273-162">Один SPA выполняется в диалоговом окне, а другой — на главной странице диалогового окна, где `displayDialogAsync` было вызвано.</span><span class="sxs-lookup"><span data-stu-id="14273-162">One SPA runs in the dialog box and the other in the dialog box's host page where `displayDialogAsync` was called.</span></span> 
* <span data-ttu-id="14273-163">В большинстве сценариев в диалоговом окне требуется только простая логика.</span><span class="sxs-lookup"><span data-stu-id="14273-163">In most scenarios, only simple logic is needed in the dialog box.</span></span> <span data-ttu-id="14273-164">В таких случаях ваш проект будет значительно упрощен, разместив одну HTML-страницу с внедренным или упоминаемым JavaScript в домене вашего SPA.</span><span class="sxs-lookup"><span data-stu-id="14273-164">In such cases, your project will be greatly simplified by hosting a single HTML page, with embedded or referenced JavaScript, in the domain of your SPA.</span></span> <span data-ttu-id="14273-165">Передайте URL-адрес страницы в метод `displayDialogAsync`.</span><span class="sxs-lookup"><span data-stu-id="14273-165">Pass the URL of the page to the `displayDialogAsync` method.</span></span> <span data-ttu-id="14273-166">Это означает, что вы отклоняете от литеральной идеи одностраничного приложения; При использовании API диалоговых окон Office на самом деле не существует единого экземпляра SPA.</span><span class="sxs-lookup"><span data-stu-id="14273-166">While this means that you are deviating from the literal idea of a single-page app; you don't really have a single instance of an SPA when you are using the Office dialog API.</span></span>
