---
ms.date: 01/21/2020
ms.prod: non-product-specific
description: Руководство по обмену кодом между надстройкой VSTO и надстройкой Office.
title: Руководство. Обмен кодом между надстройкой VSTO и надстройкой Office с использованием общей библиотеки кода
localization_priority: Priority
ms.openlocfilehash: 87f34c04ce3ac475c82fbb2673d0a4b3e95f04a2
ms.sourcegitcommit: 5d29801180f6939ec10efb778d2311be67d8b9f1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2020
ms.locfileid: "42324745"
---
# <a name="tutorial-share-code-between-both-a-vsto-add-in-and-an-office-add-in-with-a-shared-code-library"></a>Руководство. Обмен кодом между надстройкой VSTO и надстройкой Office с помощью общей библиотеки кода

Надстройки набора средств Visual Studio для Office (VSTO) отлично подходят для расширения возможностей Office с предоставлением решений для вашей компании и других пользователей. Они используются уже давно, и существуют тысячи решений, созданных с помощью VSTO. Однако они работают только в Office для Windows. На компьютерах Mac, мобильных платформах и в Интернете невозможно запустить надстройки VSTO.

Надстройки Office используют HTML, JavaScript и другие веб-технологии для создания решений Office для всех платформ. Перенос существующей надстройки VSTO в надстройку Office — это отличный способ обеспечить доступность решения на всех платформах.

Вам может потребоваться сохранить как надстройку VSTO, так и новую надстройку Office с одинаковыми функциями. Это позволяет продолжать обслуживание клиентов, использующих надстройку VSTO в Office для Windows. Кроме того, это позволяет предоставлять те же функции в надстройке Office для клиентов на любых платформах. Вы также можете [убедиться, что надстройка Office совместима с существующей надстройкой VSTO](../develop/make-office-add-in-compatible-with-existing-com-add-in.md).

Но лучше не переписывать весь код из надстройки VSTO для надстройки Office. В этом руководстве показано, как избежать переписывания кода с использованием общей библиотеки кода для обеих надстроек.

## <a name="shared-code-library"></a>Общая библиотека кода

В этом руководстве вы ознакомитесь с действиями по определению общего кода и обмен им между надстройкой VSTO и современной надстройкой Office. В нем используется простейший пример надстройки VSTO, чтобы вы могли сосредоточиться на навыках и методах, необходимых для работы с собственными надстройками VSTO.

На следующей схеме показано, как общая библиотека кода используется для миграции. Распространенный код перерабатывается в новую общую библиотеку кода. Код может оставаться на исходном языке, например C# или VB. Это означает, что вы можете продолжить использование кода в существующей надстройке VSTO, создав ссылку на проект. При создании надстройки Office она также будет использовать общую библиотеку кода, вызывая ее с помощью API REST.

![Схема надстройки VSTO и надстройки Office с использованием общей библиотеки кода](../images/vsto-migration-shared-code-library.png)

Навыки и методы, рассматриваемые в этом руководстве:

- Создание общей библиотеки классов путем преобразования кода в библиотеку классов .NET.
- Создание оболочки API REST с использованием ASP.NET Core для общей библиотеки классов.
- Вызов API REST из надстройки Office для доступа к общему коду.

## <a name="prerequisites"></a>Предварительные требования

Чтобы настроить среду разработки:

1. Установите [Visual Studio 2019](https://visualstudio.microsoft.com/downloads/).
2. Установите следующие рабочие нагрузки:
    - ASP.NET и веб-разработка.
    - Кроссплатформенная разработка .NET Core.
    - Разработка для SharePoint или Office.
    - Следующие **отдельные** компоненты.
        - Набор средств Visual Studio для Office (VSTO).
        - Среда выполнения .NET Core 3.0.

Кроме того, необходимо следующее:

- Учетная запись Office 365. Вы можете присоединиться к [программе для разработчиков Office 365](https://aka.ms/devprogramsignup), включающей бесплатную подписку на Office 365 сроком на 1 год.
- Клиент Microsoft Azure. Пробную подписку можно получить на сайте [Microsoft Azure](https://account.windowsazure.com/SignUp).

## <a name="the-cell-analyzer-vsto-add-in"></a>Надстройка VSTO для анализа ячеек

В этом руководстве используется решение PnP [общей библиотеки надстройки VSTO для надстройки Office](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/VSTO-shared-code-migration). В папке **/start** содержится решение надстройки VSTO, которое нужно перенести. Целью является перенос надстройки VSTO в современную надстройку Office с помощью общего кода, когда это возможно.

> [!NOTE]
> В примере используется C#, но вы можете применить представленные в этом руководстве методы для надстройки VSTO, написанной на любом языке .NET.

1. Скачайте решение PnP [общей библиотеки надстройки VSTO для надстройки Office](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/VSTO-shared-code-migration) в рабочую папку на своем компьютере.
2. Запустите Visual Studio 2019 и откройте решение **/start/Cell-Analyzer.sln**.
3. В меню **Отладка** выберите команду **Начать отладку**.
3. В **обозревателе решений** щелкните правой кнопкой мыши проект **Cell-Analyzer** и выберите пункт **Свойства**.
4. В свойствах выберите категорию **Подписывание**.
5. Установите флажок **Подписать манифесты ClickOnce** и нажмите кнопку **Создать тестовый сертификат**.
6. В диалоговом окне **Создание тестового сертификата** введите и подтвердите пароль. Затем нажмите кнопку **OK**.

Надстройка является настраиваемой областью задач для Excel. Вы можете выделить любую ячейку с текстом и нажать кнопку **Показать Юникод**. Надстройка отобразит список всех символов в тексте вместе с соответствующим номером Юникода.

![Снимок экрана: надстройка VSTO для анализа ячеек, запущенная в Excel](../images/pnp-cell-analyzer-vsto-add-in.png)

## <a name="analyze-types-of-code-in-the-vsto-add-in"></a>Анализ типов кода в надстройке VSTO

Первым применяемым методом является анализ надстройки, с которой можно поделиться частями кода. Обычно проект разделяется на три типа кода.

### <a name="ui-code"></a>Код пользовательского интерфейса

Код пользовательского интерфейса взаимодействует с пользователем. В VSTO код пользовательского интерфейса работает через Windows Forms. Надстройки Office используют HTML, CSS и JavaScript для пользовательского интерфейса. Из-за этих различий невозможно поделиться кодом пользовательского интерфейса с надстройкой Office. Пользовательский интерфейс требуется воссоздать в JavaScript.

### <a name="document-code"></a>Код документов

В VSTO код взаимодействует с документом через объекты .NET, такие как `Microsoft.Office.Interop.Excel.Range`. Но надстройки Office используют библиотеку Office.js. Они похожи, но не идентичны. Таким образом, вы не сможете поделиться кодом взаимодействия с документом с надстройкой Office.

### <a name="logic-code"></a>Код логики

Бизнес-логика, алгоритмы, вспомогательные функции и аналогичный код часто являются основой надстройки VSTO. Этот код работает независимо от пользовательского интерфейса и кода документов с целью выполнения анализа, подключения к серверным службам, выполнения вычислений и т. д. Этим кодом можно поделиться, чтобы не переписывать его в JavaScript.

Рассмотрим надстройку VSTO. В коде ниже каждый раздел определен как код ДОКУМЕНТА, ПОЛЬЗОВАТЕЛЬСКОГО ИНТЕРФЕЙСА или АЛГОРИТМА.

```csharp
// *** UI CODE ***
private void btnUnicode_Click(object sender, EventArgs e)
{
    // *** DOCUMENT CODE ***
    Microsoft.Office.Interop.Excel.Range rangeCell;
    rangeCell = Globals.ThisAddIn.Application.ActiveCell;

    string cellValue = "";

    if (null != rangeCell.Value)
    {
        cellValue = rangeCell.Value.ToString();
    }

    // *** ALGORITHM CODE ***
    //convert string to Unicode listing
    string result = "";
    foreach (char c in cellValue)
    {
        int unicode = c;

        result += $"{c}: {unicode}\r\n";
    }
    
    // *** UI CODE ***
    //Output the result
    txtResult.Text = result;
}
```

С помощью этого подхода вы можете увидеть, что один раздел кода можно предоставить для надстройки Office. Следующий код потребуется преобразовать в отдельную библиотеку классов.

```csharp
// *** ALGORITHM CODE ***
//convert string to Unicode listing
string result = "";
foreach (char c in cellValue)
{
    int unicode = c;

    result += $"{c}: {unicode}\r\n";
}
```

## <a name="create-a-shared-class-library"></a>Создание общей библиотеки классов

Надстройки VSTO создаются в Visual Studio в виде проектов .NET, поэтому мы будем по возможности использовать .NET, чтобы не усложнять процесс. Наш следующий метод заключается в создании библиотеки классов и преобразовании общего кода в библиотеку классов.

1. Если вы этого еще не сделали, запустите Visual Studio 2019 и откройте решение **/start/Cell-Analyzer.sln**.
2. Щелкните решение правой кнопкой мыши в **обозревателе решений** и выберите пункты **Добавить > Создать проект**.
3. В диалоговом окне **Добавить новый проект** выберите **Библиотека классов (.NET Framework)** и нажмите кнопку **Далее**.
    > [!NOTE]
    > Не используйте библиотеку классов .NET Core, так как она не будет работать с проектом VSTO.
4. В диалоговом окне **Настроить новый проект** настройте следующие поля.
    - Укажите в поле **Имя проекта** значение **CellAnalyzerSharedLibrary**.
    - Оставьте в поле **Расположение** значение по умолчанию.
    - Присвойте параметру **Платформа** значение **4.7.2**.
5. Нажмите кнопку **Создать**.
6. После создания проекта измените имя файла **Class1.cs** на **CellOperations.cs**. Появится запрос на переименование класса. Измените имя класса, чтобы оно соответствовало имени файла.
7. Добавьте следующий код в класс `CellOperations`, чтобы создать метод `GetUnicodeFromText`.

```csharp
public class CellOperations
{
    static public string GetUnicodeFromText(string value)
    {
        string result = "";
        foreach (char c in value)
        {
            int unicode = c;

            result += $"{c}: {unicode}\r\n";
        }
        return result;
    }
}
```

### <a name="use-the-shared-class-library-in-the-vsto-add-in"></a>Использование общей библиотеки классов в надстройке VSTO

Чтобы использовать библиотеку классов, требуется обновить надстройку VSTO. Важно, что надстройка VSTO и надстройка Office используют одну общую библиотеку классов, благодаря чему будущие исправления ошибок и возможности создаются в одном расположении.

1. В **обозревателе решений** щелкните правой кнопкой мыши проект **Cell-Analyzer** и выберите пункт **Добавить ссылку**.
2. Выберите **CellAnalyzerSharedLibrary** и нажмите кнопку **ОК**.
3. В **обозревателе решений** разверните проект **Cell-Analyzer**, щелкните правой кнопкой мыши файл **CellAnalyzerPane.cs** и выберите пункт **Просмотреть код**.
4. В методе `btnUnicode_Click` удалите следующие строки кода.
    
    ```csharp
    //Convert to Unicode listing
    string result = "";
    foreach (char c in cellValue)
    {
      int unicode = c;
      result += $"{c}: {unicode}\r\n";
    }
    ```
    
5. Обновите строку кода под комментарием `//Output the result` следующим образом:
    
    ```csharp
    //Output the result
    txtResult.Text = CellAnalyzerSharedLibrary.CellOperations.GetUnicodeFromText(cellValue);
    ```
    
6. В меню **Отладка** выберите команду **Начать отладку**. Настраиваемая область задач должна работать правильно. Введите текст в ячейке и проверьте, можно ли преобразовать его в список Юникод в надстройке.

## <a name="create-a-rest-api-wrapper"></a>Создание оболочки API REST

Надстройка VSTO может использовать общую библиотеку классов напрямую, так как они обе являются проектами .NET. Однако надстройка Office не сможет использовать .NET, так как она использует JavaScript. Затем требуется создать оболочку API REST. Это позволяет надстройке Office вызывать API REST, который затем передает вызов в общую библиотеку классов.

1. В **обозревателе решений** щелкните правой кнопкой мыши проект **Cell-Analyzer** и выберите **Добавить > Создать проект**.
2. В диалоговом окне **Добавить новый проект** выберите **Веб-приложение ASP.NET Core** и нажмите кнопку **Далее**.
3. В диалоговом окне **Настроить новый проект** настройте следующие поля:
    - Укажите в поле **Имя проекта** значение **CellAnalyzerRESTAPI**.
    - В поле **Расположение** оставьте значение по умолчанию.
4. Нажмите кнопку **Создать**.
5. В диалоговом окне **Создание веб-приложения ASP.NET Core** выберите **ASP.NET Core 3.1** для версии и выберите **API** в списке проектов.
6. Оставьте для всех остальных полей значения по умолчанию и нажмите кнопку **Создать**.
7. После создания проекта разверните проект **CellAnalyzerRESTAPI** в **обозревателе решений**.
8. Щелкните правой кнопкой мыши пункт **Зависимости** и выберите команду **Добавить ссылку**.
9. Выберите **CellAnalyzerSharedLibrary** и нажмите кнопку **ОК**.
10. Щелкните правой кнопкой мыши папку **Контроллеры** и выберите пункты **Добавить > Контроллер**.
11. В диалоговом окне **Добавить новый шаблонный элемент** выберите **Контроллер API — пустой** и нажмите **Добавить**.
12. В диалоговом окне **Добавление пустого контроллера API** присвойте контроллеру имя **AnalyzeUnicodeController** и нажмите **Добавить**.
13. Откройте файл **AnalyzeUnicodeController.cs** и добавьте следующий код в качестве метода для класса `AnalyzeUnicodeController`.
    
    ```csharp
    [HttpGet]
    public ActionResult<string> AnalyzeUnicode(string value)
    {
      if (value == null)
      {
        return BadRequest();
      }
      return CellAnalyzerSharedLibrary.CellOperations.GetUnicodeFromText(value);
    }
    ```
    
14. Щелкните правой кнопкой мыши проект **CellAnalyzerRESTAPI** и выберите команду **Назначить автозагружаемым проектом**.
15. В меню **Отладка** выберите команду **Начать отладку**.
16. Запустится браузер. Чтобы проверить, работает ли API REST, введите следующий URL-адрес: `https://localhost:<ssl port number>/api/analyzeunicode?value=test`. Вы можете повторно использовать номер порта из URL-адреса в браузере, который запущен приложением Visual Studio. Должна возвратиться строка со значениями Юникода для каждого символа.

## <a name="create-the-office-add-in"></a>Создание надстройки Office

Когда вы создаете надстройку Office, она вызывает API REST. Но сначала требуется получить номер порта сервера API REST и сохранить его для последующего использования.

### <a name="save-the-ssl-port-number"></a>Сохранение номера порта SSL

1. Если вы этого еще не сделали, запустите Visual Studio 2019 и откройте решение **/start/Cell-Analyzer.sln**.
2. В проекте **CellAnalyzerRESTAPI** разверните пункт **Свойства** и откройте файл **launchSettings.json**.
3. Найдите строку кода со значением **sslPort**, скопируйте номер порта и сохраните его в другом месте.

### <a name="add-the-office-add-in-project"></a>Добавление проекта надстройки Office

Для удобства храните весь код в одном решении. Добавьте проект надстройки Office в существующее решение Visual Studio. Но если вы знакомы с [генератором Yeoman для надстроек Office](https://github.com/OfficeDev/generator-office) и Visual Studio Code, для создания проекта вы также можете запустить `yo office`. Действия очень похожи.

1. В **обозревателе решений** щелкните правой кнопкой мыши решение **Cell-Analyzer** и выберите **Добавить > Создать проект**.
2. В диалоговом окне **Добавить новый проект** выберите **Веб-надстройка Excel** и нажмите кнопку **Далее**.
3. В диалоговом окне **Настроить новый проект** настройте следующие поля:
    - Укажите в поле **Имя проекта** значение **CellAnalyzerOfficeAddin**.
    - Оставьте в поле **Расположение** значение по умолчанию.
    - Присвойте параметру **Платформа** значение **4.7.2** или укажите более позднюю версию.
4. Нажмите кнопку **Создать**.
5. В диалоговом окне **Выбор типа надстройки** выберите **Добавить новые функции в Excel** и нажмите **Готово**.

Будут созданы два проекта:
- **CellAnalyzerOfficeAddin**. Этот проект настраивает XML-файлы манифеста, описывающего надстройку, чтобы приложение Office могло правильно ее загрузить. Он содержит идентификатор, имя, описание и другие сведения о надстройке.
- **CellAnalyzerOfficeAddinWeb**. Этот проект содержит веб-ресурсы для надстройки, например HTML, CSS и скрипты. Он также настраивает экземпляр IIS Express для размещения надстройки в виде веб-приложения.

### <a name="add-ui-and-functionality-to-the-office-add-in"></a>Добавление пользовательского интерфейса и функций в надстройку Office

1. В **обозревателе решений** разверните проект **CellAnalyzerOfficeAddinWeb**.
2. Откройте файл **Home.html** и замените содержимое `<body>` указанным ниже HTML-кодом.
    
    ```html
    <button id="btnShowUnicode" onclick="showUnicode()">Show Unicode</button>
    <p>Result:</p>
    <div id="txtResult"></div>
    ```
    
3. Откройте файл **Home.js** и замените все содержимое указанным ниже кодом. 
    
    ```js
    (function () {
      "use strict";
      // The initialize function must be run each time a new page is loaded.
      Office.initialize = function (reason) {
        $(document).ready(function () {
        });
      };
    })();
    
    function showUnicode() {
      Excel.run(function (ctx) {
        const range = ctx.workbook.getSelectedRange();
        range.load("values");
        return ctx.sync(range).then(function (range) {
          const url = "https://localhost:<ssl port number>/api/analyzeunicode?value=" + range.values[0][0];
          $.ajax({
            type: "GET",
            url: url,
            success: function (data) {
              let htmlData = data.replace(/\r\n/g, '<br>');
              $("#txtResult").html(htmlData);
            },
            error: function (data) {
                $("#txtResult").html("error occurred in ajax call.");
            }
          });
        });
      });
    }
    ```
    
4. В приведенном выше коде введите номер **sslPort**, сохраненный ранее из файла **launchSettings.json**.

В приведенном выше коде возвращаемая строка будет обрабатываться для замены возврата каретки и перевода строки на HTML-теги `<br>`. Иногда могут возникать ситуации, когда возвращаемое значение, подходящее для .NET в надстройке VSTO, потребуется изменить в надстройке Office для правильной работы. В этом случае API REST и общая библиотека классов отвечают только за возвращение строки. За правильное форматирование возвращаемых значений для представления отвечает метод `showUnicode()`.

### <a name="allow-cors-from-the-office-add-in"></a>Разрешение CORS из надстройки Office

Библиотеке Office.js требуется CORS для исходящих вызовов, например для создаваемых из вызова `ajax` к серверу API REST. Выполните следующие действия, чтобы разрешить вызовы из надстройки Office в API REST.

1. В **обозревателе решений** выберите проект **CellAnalyzerOfficeAddinWeb**.
2. В меню **Вид** выберите пункт **Окно свойств** (если это окно еще не отображается).
3. В окне свойств скопируйте значение свойства **URL-адрес SSL** и сохраните его в другом месте. Это URL-адрес, который требуется разрешить в CORS.
4. В проекте **CellAnalyzerRESTAPI** откройте файл **Startup.cs**.
5. Добавьте следующий код в начале метода `ConfigureServices`. Не забудьте подставить URL-адрес SSL, скопированный ранее для вызова `builder.WithOrigins`.
    
    ```csharp
    services.AddCors(options =>
    {
      options.AddPolicy(MyAllowSpecificOrigins,
      builder =>
      {
        builder.WithOrigins("<your URL SSL>")
        .AllowAnyMethod()
        .AllowAnyHeader();
      });
    });
    ```
    
    > [!NOTE]
    > Оставьте `/` в конце URL-адреса, если вы используете его в методе `builder.WithOrigins`. Он должен выглядеть примерно так: `https://localhost:44000`. В противном случае возникнет ошибка CORS во время выполнения.
    
6. Добавьте в класс `Startup` следующее поле:
    
    ```csharp
    readonly string MyAllowSpecificOrigins = "_myAllowSpecificOrigins";
    ```
    
7. Добавьте следующий код в метод `configure` непосредственно перед строкой кода для `app.UseEndpoints`.
    
    ```csharp
    app.UseCors(MyAllowSpecificOrigins);
    ```

По завершении ваш класс `Startup` должен выглядеть примерно как в следующем коде (ваш URL-адрес localhost может отличаться):

```csharp
public class Startup
{
  public Startup(IConfiguration configuration)
    {
      Configuration = configuration;
    }

    readonly string MyAllowSpecificOrigins = "_myAllowSpecificOrigins";

    public IConfiguration Configuration { get; }

    // NOTE: The following code configures CORS for the localhost:44397 port.
    // This is for development purposes. In production code you should update this to 
    // use the appropriate allowed domains.
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddCors(options =>
        {
            options.AddPolicy(MyAllowSpecificOrigins,
            builder =>
            {
                builder.WithOrigins("https://localhost:44397")
                .AllowAnyMethod()
                .AllowAnyHeader();
            });
        });
        services.AddControllers();
    }

    // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
    public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
    {
        if (env.IsDevelopment())
        {
            app.UseDeveloperExceptionPage();
        }
            
        app.UseHttpsRedirection();

        app.UseRouting();

        app.UseAuthorization();

        app.UseCors(MyAllowSpecificOrigins);

        app.UseEndpoints(endpoints =>
        {
            endpoints.MapControllers();
        });
    }
}
```

### <a name="run-the-add-in"></a>Запуск надстройки

1. В **обозревателе решений** щелкните правой кнопкой мыши верхний узел **Решение "Cell-Analyzer"** и выберите **Назначить запускаемые проекты**.
2. В диалоговом окне **Страницы свойств решения "Cell-Analyzer"** выберите **Несколько запускаемых проектов**.
3. Присвойте свойству **Действие** значение **Запуск** для каждого из следующих проектов.
    
    - CellAnalyzerRESTAPI
    - CellAnalyzerOfficeAddin
    - CellAnalyzerOfficeAddinWeb
    
4. Нажмите кнопку **OK**.
5. В меню **Отладка** выберите команду **Начать отладку**.

Запустится приложение Excel, которое загрузит неопубликованную надстройку Office. Вы можете проверить, правильно ли работает служба API REST localhost, введя в ячейку текстовое значение и нажав кнопку **Показать Юникод** в надстройке Office. Она вызовет API REST и отобразит значения Юникода для текстовых символов.

## <a name="publish-to-an-azure-app-service"></a>Публикация в службе приложений Azure

В конечном итоге рекомендуется опубликовать проект API REST в облаке. В следующих действиях показано, как опубликовать проект **CellAnalyzerRESTAPI** в службе приложений Microsoft Azure. Сведения о способе получения учетной записи Azure см. в разделе [Предварительные требования](#prerequisites).

1. В **обозревателе решений** щелкните правой кнопкой мыши проект **CellAnalyzerRESTAPI** и выберите пункт **Опубликовать**.
2. В диалоговом окне **Выберите целевой объект публикации** нажмите кнопку **Создать** и выберите вариант **Создать профиль**.
3. В диалоговом окне **Служба приложений** выберите нужную учетную запись, если она еще не выбрана.
4. Полям в диалоговом окне **Служба приложений** будут присвоены значения по умолчанию для вашей учетной записи. Обычно параметры по умолчанию подходят, но их можно изменить, если вы предпочитаете другие параметры.
5. В диалоговом окне **Служба приложений** нажмите **Создать**.
6. На странице **Опубликовать** отобразится новый профиль. Нажмите кнопку **Опубликовать**, чтобы создать и развернуть код в службе приложений.

Теперь можно протестировать службу. Откройте браузер и введите URL-адрес, непосредственно ведущий в новую службу. Например, используйте `https://<myappservice>.azurewebsites.net/api/analyzeunicode?value=test`, где *myappservice* — уникальное имя, созданное вами для новой службы приложений.

### <a name="use-the-azure-app-service-from-the-office-add-in"></a>Использование службы приложений Azure из надстройки Office

Завершающим этапом является обновление кода в надстройке Office, чтобы использовать службу приложений Azure, а не localhost.

1. В **обозревателе решений** разверните проект **CellAnalyzerOfficeAddinWeb** и откройте файл **Home.js**.
2. Измените константу `url`, чтобы использовать URL-адрес для службы приложения Azure, как показано в следующей строке кода. Замените `<myappservice>` на уникальное имя, созданное вами для новой службы приложений.
    ```JavaScript
    const url = "https://<myappservice>.azurewebsites.net/api/analyzeunicode?value=" + range.values[0][0];
    ```
3. В **обозревателе решений** щелкните правой кнопкой мыши верхний узел **Решение "Cell-Analyzer"** и выберите **Назначить запускаемые проекты**.
4. В диалоговом окне **Страницы свойств решения "Cell-Analyzer"** выберите **Несколько запускаемых проектов**.
5. Разрешите действие **Запуск** для каждого из следующих проектов:
    - CellAnalyzerOfficeAddinWeb
    - CellAnalyzerOfficeAddin
6. Нажмите кнопку **OK**.
7. В меню **Отладка** выберите команду **Начать отладку**.

Запустится приложение Excel, которое загрузит неопубликованную надстройку Office. Чтобы проверить правильность работы службы приложений, введите текстовое значение в ячейку и нажмите **Показать Юникод** в надстройке Office. Она должна вызвать службу и отобразить значения Юникода для текстовых символов.

## <a name="conclusion"></a>Заключение

В этом руководстве вы узнали, как создать надстройку Office, использующую общий код с исходной надстройкой VSTO. Вы узнали, как использовать код VSTO в Office для Windows и надстройку Office в Office на других платформах. Вы преобразовали код C# VSTO в общую библиотеку и развернули ее для службы приложений Azure. Вы создали надстройку Office, использующую общую библиотеку, чтобы не требовалось переписывать код в JavaScript.
