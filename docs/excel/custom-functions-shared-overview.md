---
ms.date: 02/13/2020
description: Узнайте, как запускать пользовательские функции, кнопки ленты и код области задач в одной и той же среде выполнения JavaScript для координации сценариев в вашей надстройке.
title: Запуск кода надстройки в общей среде выполнения JavaScript (предварительная версия)
localization_priority: Priority
ms.openlocfilehash: d9d73a5ae2ff1da09d1a5fd7d02514cb28be0e2d
ms.sourcegitcommit: dd6d00202f6466c27418247dad7bd136555a6036
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/26/2020
ms.locfileid: "42284161"
---
# <a name="overview-run-your-add-in-code-in-a-shared-javascript-runtime-preview"></a><span data-ttu-id="97585-103">Обзор: запуск кода надстройки в общей среде выполнения JavaScript (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="97585-103">Overview: Run your add-in code in a shared JavaScript runtime (preview)</span></span>

[!include[Running custom functions in shared JavaScript runtime note](../includes/excel-shared-runtime-preview-note.md)]

<span data-ttu-id="97585-104">При запуске Excel на компьютере с Windows или на Mac надстройка запустит код для кнопок ленты, пользовательских функций и области задач в отдельных средах выполнения JavaScript.</span><span class="sxs-lookup"><span data-stu-id="97585-104">When running Excel on Windows or Mac, your add-in will run code for ribbon buttons, custom functions, and the task pane in separate JavaScript runtime environments.</span></span> <span data-ttu-id="97585-105">Из-за этого возникают ограничения, например невозможность удобно предоставлять общий доступ к глобальным данным и отсутствие доступа ко всей функциональности CORS для пользовательской функции.</span><span class="sxs-lookup"><span data-stu-id="97585-105">This creates limitations such as not being able to easily share global data, and not being able to access all CORS functionality from a custom function.</span></span>

<span data-ttu-id="97585-106">Тем не менее, можно настроить надстройку Excel так, чтобы обеспечить общий доступ к коду в одной и той же среде выполнения JavaScript (то есть в общей среде выполнения).</span><span class="sxs-lookup"><span data-stu-id="97585-106">However, you can configure your Excel add-in to share code in the same JavaScript runtime (also referred to as a shared runtime).</span></span> <span data-ttu-id="97585-107">За счет этого повышается скоординированность работы надстройки и упрощается доступ к DOM панели задач и CORS из всех компонентов надстройки.</span><span class="sxs-lookup"><span data-stu-id="97585-107">This enables better coordination across your add-in and access to the task pane DOM and CORS from all parts of your add-in.</span></span>

<span data-ttu-id="97585-108">При настройке общей среды выполнения становятся возможными следующие сценарии:</span><span class="sxs-lookup"><span data-stu-id="97585-108">Configuring a shared runtime enables the following scenarios:</span></span>

- <span data-ttu-id="97585-109">У вашей настройки будет общая модель DOM, доступная для ленты, области задач и пользовательских функций.</span><span class="sxs-lookup"><span data-stu-id="97585-109">Your add-in will have a shared DOM that the ribbon, task pane, and custom functions can all access.</span></span>
- <span data-ttu-id="97585-110">У ваших пользовательских функций будет полная поддержка CORS.</span><span class="sxs-lookup"><span data-stu-id="97585-110">Your custom functions will have full CORS support.</span></span>
- <span data-ttu-id="97585-111">Пользовательские функции могут вызывать API Office.js для чтения данных из электронной таблицы.</span><span class="sxs-lookup"><span data-stu-id="97585-111">Your custom functions can call Office.js APIs to read spreadsheet document data.</span></span>
- <span data-ttu-id="97585-112">Надстройка может выполнять код сразу после открытия документа.</span><span class="sxs-lookup"><span data-stu-id="97585-112">Your add-in can run code as soon as the document is opened.</span></span>
- <span data-ttu-id="97585-113">Надстройка может продолжать выполнять код после закрытия области задач.</span><span class="sxs-lookup"><span data-stu-id="97585-113">Your add-in can continue running code after the task pane is closed.</span></span>

<span data-ttu-id="97585-114">При выполнении пользовательских функций в общей среде выполнения с областью задач эта среда будет выполняться в экземпляре браузера на различных платформах, как описано в статье [Браузеры, используемые надстройками Office](../concepts/browsers-used-by-office-web-add-ins.md). Кроме того, все кнопки, отображаемые вашей надстройкой Excel на ленте, будут выполняться в этой же общей среде выполнения.</span><span class="sxs-lookup"><span data-stu-id="97585-114">When you run custom functions in a shared runtime with the task pane, it will run in a browser instance on different platforms as explained in [Browsers used by Office Add-ins](../concepts/browsers-used-by-office-web-add-ins.md). Additionally, any buttons that your Excel add-in displays on the ribbon will run in the same shared runtime.</span></span> <span data-ttu-id="97585-115">На следующем рисунке показано, как пользовательские функции, пользовательский интерфейс ленты и код области задач будут запускаться в одной и той же среде выполнения JavaScript.</span><span class="sxs-lookup"><span data-stu-id="97585-115">The following image shows how custom functions, the ribbon UI, and the task pane code will all run in the same JavaScript runtime.</span></span>

![Пользовательские функции, работающие в общей среде выполнения вместе с кнопками ленты и областью задач в Excel](../images/custom-functions-in-browser-runtime.png)

## <a name="differences-when-running-custom-functions-in-a-shared-runtime"></a><span data-ttu-id="97585-117">Отличия при выполнении пользовательских функций в общей среде выполнения</span><span class="sxs-lookup"><span data-stu-id="97585-117">Differences when running custom functions in a shared runtime</span></span>

<span data-ttu-id="97585-118">При настройке проекта надстройки Excel выполнения пользовательских функций в общей среде выполнения существует ряд отличий по сравнению с использованием пользовательской среды выполнения функций.</span><span class="sxs-lookup"><span data-stu-id="97585-118">When you configure your Excel add-in project to run custom functions in a shared runtime, there are a few differences from using the custom function runtime.</span></span>

### <a name="storage"></a><span data-ttu-id="97585-119">Хранение</span><span class="sxs-lookup"><span data-stu-id="97585-119">Storage</span></span>

<span data-ttu-id="97585-120">Вам больше не нужно использовать API **Storage** для обмена данными между областью задач, пользовательскими функциями и пользовательским интерфейсом ленты.</span><span class="sxs-lookup"><span data-stu-id="97585-120">You no longer need to use the **Storage** API to share data between the task pane, custom functions or ribbon UI.</span></span> <span data-ttu-id="97585-121">Можно помещать глобальные переменные в объект **window** или использовать ваш собственный предпочитаемый подход по управлению состояниями.</span><span class="sxs-lookup"><span data-stu-id="97585-121">You can put global variables in the **window** object, or use your own preferred state management approach.</span></span>

### <a name="authentication"></a><span data-ttu-id="97585-122">Проверка подлинности</span><span class="sxs-lookup"><span data-stu-id="97585-122">Authentication</span></span>

<span data-ttu-id="97585-123">При получении маркеров в процессе проверки подлинности вам не нужно использовать API **Storage**, чтобы предоставлять доступ к этим маркерам для области задач, пользовательских функций и пользовательского интерфейса ленты.</span><span class="sxs-lookup"><span data-stu-id="97585-123">When you receive tokens as part of authentication, you don't need to use the **Storage** API to share them between the task pane, custom functions and ribbon UI.</span></span> <span data-ttu-id="97585-124">Можно использовать вашу собственную предпочитаемую методику хранения и расположение хранилища для доступа к ним, например `localStorage`.</span><span class="sxs-lookup"><span data-stu-id="97585-124">You can use your own preferred storage technique and storage location to share them, such as `localStorage`.</span></span>

### <a name="dialog-api"></a><span data-ttu-id="97585-125">API Dialog</span><span class="sxs-lookup"><span data-stu-id="97585-125">Dialog API</span></span>

<span data-ttu-id="97585-126">Больше не нужно использовать API **OfficeRuntime.Dialog** для отображения диалогового окна из пользовательской функции.</span><span class="sxs-lookup"><span data-stu-id="97585-126">You no longer need to use the **OfficeRuntime.Dialog** API to display a dialog from a custom function.</span></span> <span data-ttu-id="97585-127">Можно использовать один и тот же [API Dialog ](../develop/dialog-api-in-office-add-ins.md) для пользовательских функций, кнопок ленты и области задач.</span><span class="sxs-lookup"><span data-stu-id="97585-127">You can use the same [Dialog API](../develop/dialog-api-in-office-add-ins.md) for custom functions, ribbon buttons, and the task pane.</span></span>

### <a name="debugging"></a><span data-ttu-id="97585-128">Отладка</span><span class="sxs-lookup"><span data-stu-id="97585-128">Debugging</span></span>

<span data-ttu-id="97585-129">В настоящее время при использовании общей среды выполнения невозможно использовать Visual Studio Code для отладки пользовательских функций в Excel под управлением Windows.</span><span class="sxs-lookup"><span data-stu-id="97585-129">When using a shared runtime, you can't use Visual Studio Code to debug custom functions in Excel on Windows at this time.</span></span> <span data-ttu-id="97585-130">Потребуется использовать средства разработчика.</span><span class="sxs-lookup"><span data-stu-id="97585-130">You'll need to use developer tools.</span></span> <span data-ttu-id="97585-131">Дополнительные сведения см. в статье [Отладка надстроек с помощью средств разработчика в Windows 10](../testing/debug-add-ins-using-f12-developer-tools-on-windows-10.md).</span><span class="sxs-lookup"><span data-stu-id="97585-131">For more information, see [Debug add-ins using developer tools on Windows 10](../testing/debug-add-ins-using-f12-developer-tools-on-windows-10.md).</span></span>

## <a name="get-started"></a><span data-ttu-id="97585-132">Начало работы</span><span class="sxs-lookup"><span data-stu-id="97585-132">Get Started</span></span>

<span data-ttu-id="97585-133">Сведения о настройке проекта надстройки Excel для запуска пользовательских функций в общей среде выполнения см. в статье [Настройка надстройки Excel для использования общей среды выполнения JavaScript (предварительная версия)](configure-your-add-in-to-use-a-shared-runtime.md).</span><span class="sxs-lookup"><span data-stu-id="97585-133">To configure your Excel add-in project to run custom functions in a shared runtime, see [Configure your Excel add-in to use a shared JavaScript runtime (preview)](configure-your-add-in-to-use-a-shared-runtime.md).</span></span>

## <a name="give-us-feedback"></a><span data-ttu-id="97585-134">Отправьте нам отзыв</span><span class="sxs-lookup"><span data-stu-id="97585-134">Give us feedback</span></span>

<span data-ttu-id="97585-135">Мы будем рады услышать ваши отзывы об этой функции.</span><span class="sxs-lookup"><span data-stu-id="97585-135">We'd love to hear your feedback on this feature.</span></span> <span data-ttu-id="97585-136">Если вы обнаружите какие-либо ошибки или проблемы, если у вас есть запросы относительно этой функции, сообщите нам, создав проблему GitHub в [репозитории office-js](https://github.com/OfficeDev/office-js).</span><span class="sxs-lookup"><span data-stu-id="97585-136">If you find any bugs, issues, or have requests on this feature, please let us know by creating a GitHub issue in the [office-js repo](https://github.com/OfficeDev/office-js).</span></span>

## <a name="see-also"></a><span data-ttu-id="97585-137">См. также</span><span class="sxs-lookup"><span data-stu-id="97585-137">See also</span></span>

<span data-ttu-id="97585-138">Список статей, посвященных общей среде выполнения</span><span class="sxs-lookup"><span data-stu-id="97585-138">List of related articles for shared runtime</span></span>
- [<span data-ttu-id="97585-139">Учебное руководство: обмен данными и событиями между пользовательскими функциями Excel и областью задач (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="97585-139">Tutorial: Share data and events between Excel custom functions and the task pane (preview)</span></span>](../tutorials/share-data-and-events-between-custom-functions-and-the-task-pane-tutorial.md)
- [<span data-ttu-id="97585-140">Вызов API Excel из пользовательской функции (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="97585-140">Call Excel APIs from your custom function (preview)</span></span>](call-excel-apis-from-custom-function.md)