---
ms.date: 02/13/2020
description: Узнайте, как запускать пользовательские функции, кнопки ленты и код области задач в одной и той же среде выполнения JavaScript для координации сценариев в вашей надстройке.
title: Запуск кода надстройки в общей среде выполнения JavaScript (предварительная версия)
localization_priority: Priority
ms.openlocfilehash: d9d73a5ae2ff1da09d1a5fd7d02514cb28be0e2d
ms.sourcegitcommit: dd6d00202f6466c27418247dad7bd136555a6036
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/26/2020
ms.locfileid: "42284161"
---
# <a name="overview-run-your-add-in-code-in-a-shared-javascript-runtime-preview"></a>Обзор: запуск кода надстройки в общей среде выполнения JavaScript (предварительная версия)

[!include[Running custom functions in shared JavaScript runtime note](../includes/excel-shared-runtime-preview-note.md)]

При запуске Excel на компьютере с Windows или на Mac надстройка запустит код для кнопок ленты, пользовательских функций и области задач в отдельных средах выполнения JavaScript. Из-за этого возникают ограничения, например невозможность удобно предоставлять общий доступ к глобальным данным и отсутствие доступа ко всей функциональности CORS для пользовательской функции.

Тем не менее, можно настроить надстройку Excel так, чтобы обеспечить общий доступ к коду в одной и той же среде выполнения JavaScript (то есть в общей среде выполнения). За счет этого повышается скоординированность работы надстройки и упрощается доступ к DOM панели задач и CORS из всех компонентов надстройки.

При настройке общей среды выполнения становятся возможными следующие сценарии:

- У вашей настройки будет общая модель DOM, доступная для ленты, области задач и пользовательских функций.
- У ваших пользовательских функций будет полная поддержка CORS.
- Пользовательские функции могут вызывать API Office.js для чтения данных из электронной таблицы.
- Надстройка может выполнять код сразу после открытия документа.
- Надстройка может продолжать выполнять код после закрытия области задач.

При выполнении пользовательских функций в общей среде выполнения с областью задач эта среда будет выполняться в экземпляре браузера на различных платформах, как описано в статье [Браузеры, используемые надстройками Office](../concepts/browsers-used-by-office-web-add-ins.md). Кроме того, все кнопки, отображаемые вашей надстройкой Excel на ленте, будут выполняться в этой же общей среде выполнения. На следующем рисунке показано, как пользовательские функции, пользовательский интерфейс ленты и код области задач будут запускаться в одной и той же среде выполнения JavaScript.

![Пользовательские функции, работающие в общей среде выполнения вместе с кнопками ленты и областью задач в Excel](../images/custom-functions-in-browser-runtime.png)

## <a name="differences-when-running-custom-functions-in-a-shared-runtime"></a>Отличия при выполнении пользовательских функций в общей среде выполнения

При настройке проекта надстройки Excel выполнения пользовательских функций в общей среде выполнения существует ряд отличий по сравнению с использованием пользовательской среды выполнения функций.

### <a name="storage"></a>Хранение

Вам больше не нужно использовать API **Storage** для обмена данными между областью задач, пользовательскими функциями и пользовательским интерфейсом ленты. Можно помещать глобальные переменные в объект **window** или использовать ваш собственный предпочитаемый подход по управлению состояниями.

### <a name="authentication"></a>Проверка подлинности

При получении маркеров в процессе проверки подлинности вам не нужно использовать API **Storage**, чтобы предоставлять доступ к этим маркерам для области задач, пользовательских функций и пользовательского интерфейса ленты. Можно использовать вашу собственную предпочитаемую методику хранения и расположение хранилища для доступа к ним, например `localStorage`.

### <a name="dialog-api"></a>API Dialog

Больше не нужно использовать API **OfficeRuntime.Dialog** для отображения диалогового окна из пользовательской функции. Можно использовать один и тот же [API Dialog ](../develop/dialog-api-in-office-add-ins.md) для пользовательских функций, кнопок ленты и области задач.

### <a name="debugging"></a>Отладка

В настоящее время при использовании общей среды выполнения невозможно использовать Visual Studio Code для отладки пользовательских функций в Excel под управлением Windows. Потребуется использовать средства разработчика. Дополнительные сведения см. в статье [Отладка надстроек с помощью средств разработчика в Windows 10](../testing/debug-add-ins-using-f12-developer-tools-on-windows-10.md).

## <a name="get-started"></a>Начало работы

Сведения о настройке проекта надстройки Excel для запуска пользовательских функций в общей среде выполнения см. в статье [Настройка надстройки Excel для использования общей среды выполнения JavaScript (предварительная версия)](configure-your-add-in-to-use-a-shared-runtime.md).

## <a name="give-us-feedback"></a>Отправьте нам отзыв

Мы будем рады услышать ваши отзывы об этой функции. Если вы обнаружите какие-либо ошибки или проблемы, если у вас есть запросы относительно этой функции, сообщите нам, создав проблему GitHub в [репозитории office-js](https://github.com/OfficeDev/office-js).

## <a name="see-also"></a>См. также

Список статей, посвященных общей среде выполнения
- [Учебное руководство: обмен данными и событиями между пользовательскими функциями Excel и областью задач (предварительная версия)](../tutorials/share-data-and-events-between-custom-functions-and-the-task-pane-tutorial.md)
- [Вызов API Excel из пользовательской функции (предварительная версия)](call-excel-apis-from-custom-function.md)