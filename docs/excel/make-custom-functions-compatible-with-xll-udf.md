---
title: Обеспечение совместимости пользовательских функций с пользовательскими функциями XLL
description: Обеспечение совместимости с пользовательскими функциями XLL в Excel, которые имеют эквивалентные функциональные возможности для пользовательских функций
ms.date: 04/22/2019
localization_priority: Normal
ms.openlocfilehash: 09914e040c1721dd8b9e91952e5814e7a6b914e5
ms.sourcegitcommit: 7462409209264dc7f8f89f3808a7a6249fcd739e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/26/2019
ms.locfileid: "33356913"
---
# <a name="make-your-custom-functions-compatible-with-xll-user-defined-functions"></a>Обеспечение совместимости пользовательских функций с пользовательскими функциями XLL

Если у вас есть XLL-модули Excel, вы можете создавать эквивалентные пользовательские функции в надстройке Office, чтобы расширить функциональные возможности решения на другие платформы, такие как Online или macOS. Однако у надстроек Office не все функции, доступные в XLL. В зависимости от того, какие функции использует ваше решение, XLL может оказаться более эффективным, чем пользовательские функции надстроек Office в Excel для Windows.

Вы можете настроить надстройку Office, чтобы если на компьютере пользователя уже установлен эквивалентный XLL-модуль, Excel запускает XLL, а не пользовательские функции надстройки Office. XLL называется эквивалентным, так как Excel будет беспрепятственно переходить между XLL и пользовательскими функциями надстройки Office в зависимости от того, какая из них установлена в Windows.

[!include[Excel custom functions note](../includes/excel-custom-functions-note.md)]

## <a name="specify-equivalent-xll-in-the-manifest"></a>Указание эквивалентного XLL в манифесте

Чтобы обеспечить совместимость с существующим XLL, определите эквивалентный XLL в манифесте надстройки Office. После этого Excel будет использовать функции XLL, а не пользовательские функции надстроек Office при работе в Windows.

Чтобы задать для настраиваемых функций эквивалентный XLL, укажите значение `FileName` XLL. Когда пользователь открывает книгу с функциями XLL, Excel преобразует функции в совместимые функции. Затем книга использует XLL при открытии в Excel для Windows, и она будет использовать пользовательские функции из надстройки Office при открытии в Интернете или в macOS.

В приведенном ниже примере показано, как указать как надстройку COM, так и XLL в качестве эквивалента. Как правило, для полноты указывается и то, и другое, в этом примере показана как в контексте. Они определяются по их `ProgID` и `FileName` соответственно. Более подробную информацию о совместимости надстроек COM можно узнать в статье [Создание надстройки Office, совместимой с существующей надстройкОЙ com](../develop/make-office-add-in-compatible-with-existing-com-add-in.md).

```xml
<VersionOverrides>
...
<EquivalentAddins>
  <EquivalentAddin>
    <ProgID>ContosoCOMAddin</ProgID>
    <Type>COM</Type>
  </EquivalentAddin>

  <EquivalentAddin>
    <FileName>contosofunctions.xll</FileName>
    <Type>XLL</Type>
  </EquivalentAddin>
<EquivalentAddins>
...
</VersionOverrides>
```

> [!NOTE]
> Если надстройка объявляет свои собственные функции поддерживаемыми XLL-МОДУЛЯми, изменение манифеста в дальнейшем может привести к повреждению книги пользователя, так как он изменит формат файла.

## <a name="office-add-in-updates"></a>Обновления для надстроек Office

Когда вы укажете эквивалентный XLL для надстройки Office, Excel прекратит обработку обновлений для надстройки Office. Пользователь должен удалить XLL, чтобы получить последние обновления для надстройки Office.

## <a name="custom-function-behavior-for-xll-compatible-functions"></a>Поведение настраиваемой функции для функций, совместимых с XLL

При открытии электронной таблицы, содержащей функции XLL, для которых также есть эквивалентная надстройка, функции XLL преобразуются в настраиваемые функции, совместимые с XLL-МОДУЛЯми. При следующем сохранении они записываются в файл в совместимом режиме, чтобы они работали с пользовательскими функциями XLL и Office (если на других платформах).

В следующей таблице сравниваются функции в пользовательских функциях XLL, пользовательских функциях, совместимых с XLL, и пользовательских функциях надстроек Office.

|         |Определяемая пользователем функция XLL |Настраиваемые функции, совместимые с XLL |Пользовательская функция надстройки Office |
|---------|---------|---------|---------|
| Поддерживаемые платформы | Windows | Windows, macOS, Excel Online | Windows, macOS, Excel Online |
| Поддерживаемые форматы файлов | XLSX, XLSB, XLSM, XLS | XLSX, XLSB, XLSM | XLSX, XLSB, XLSM |
| Автозаполнение формул | Нет | Да | Да |
| Подписка с потоковой передачей | Возможно, с помощью обратного вызова Кслфртд и XLL. | Да | Да |
| Локализация функций | Нет | Нет. Имя и идентификатор должны быть согласованы с имеющимися функциями XLL. | Да |
| Переменные функции | Да | Да | Да |
| Поддержка многопоточного пересчета | Да | Да | Да |
| Поведение расчетов | Нет ПОЛЬЗОВАТЕЛЬСКОГО интерфейса. В процессе вычисления Excel может не отвечать. | Пользователи увидят #BUSY! до тех пор, пока не будет возвращен результат. | Пользователи увидят #BUSY! до тех пор, пока не будет возвращен результат. |
| Наборы требований | Недоступно | Только CustomFunctions 1,1 | CustomFunctions 1,1 и более поздние версии |

## <a name="see-also"></a>См. также

- [Обеспечение совместимости надстройки Office с существующей надстройкой COM](../develop/make-office-add-in-compatible-with-existing-com-add-in.md)
- [Рекомендации по пользовательским функциям](custom-functions-best-practices.md)
- [Журнал изменений пользовательских функций](custom-functions-changelog.md)
- [Руководство по настраиваемым функциям в Excel](../tutorials/excel-tutorial-create-custom-functions.md)