---
title: Расширение пользовательских функций с помощью пользовательских функций XLL
description: Обеспечение совместимости с пользовательскими функциями XLL в Excel, которые имеют эквивалентные функциональные возможности для пользовательских функций
ms.date: 04/29/2020
localization_priority: Normal
ms.openlocfilehash: 82f4dba3bd82743efd84a2fe88c893042c061461
ms.sourcegitcommit: 54e2892c0c26b9ad1e4dba8aba48fea39f853b6c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/18/2020
ms.locfileid: "44275772"
---
# <a name="extend-custom-functions-with-xll-user-defined-functions"></a>Расширение пользовательских функций с помощью пользовательских функций XLL

Если у вас есть XLL-модули Excel, вы можете создавать эквивалентные пользовательские функции в надстройке Excel, чтобы расширить возможности решения до других платформ, таких как Online или Mac. Тем не менее, надстройки Excel не обладают всеми функциями, доступными в XLL. В зависимости от того, какие функции использует ваше решение, XLL может оказаться более эффективным, чем пользовательские функции надстроек Excel в Excel для Windows.

> [!NOTE]
> Совместимость надстроек COM и XLL UDF поддерживается на следующих платформах при подключении к подписке Office 365:
> - Excel в Интернете
> - Excel в Windows (версия 1904 или более поздняя)
> - Excel на Mac (версия 13,329 или более поздняя)
> 
> Чтобы использовать надстройку COM и совместимость UDF для XLL в Excel в Интернете, войдите в систему с помощью подписки на Office 365 или [учетной записи Майкрософт](https://account.microsoft.com/account). Если у вас еще нет подписки на Office 365, вы можете 90 бесплатно ознакомиться с реневабленой подпиской на Office 365, дополнив присоединение к [программе для разработчиков office 365](https://developer.microsoft.com/office/dev-program).

## <a name="specify-equivalent-xll-in-the-manifest"></a>Указание эквивалентного XLL в манифесте

Чтобы обеспечить совместимость с существующим XLL, определите эквивалентный XLL в манифесте надстройки Excel. После этого Excel будет использовать функции XLL, а не пользовательские функции надстройки Excel при работе в Windows.

Чтобы задать для настраиваемых функций эквивалентный XLL, укажите значение `FileName` XLL. Когда пользователь открывает книгу с функциями XLL, Excel преобразует функции в совместимые функции. Затем книга использует XLL при открытии в Excel для Windows, и она будет использовать пользовательские функции надстройки Excel при открытии в Интернете или на компьютере Mac.

В приведенном ниже примере показано, как указать как надстройку COM, так и XLL в качестве эквивалента. Часто вы задаете и то, и другое. Для полноты в этом примере отображаются как в контексте, так и в. Они определяются по их `ProgId` и `FileName` соответственно. `EquivalentAddins`Элемент должен быть расположен сразу перед закрывающим `VersionOverrides` тегом. Более подробную информацию о совместимости надстроек COM можно узнать в статье [Создание надстройки Excel, совместимой с существующей надстройкой COM](../develop/make-office-add-in-compatible-with-existing-com-add-in.md).

```xml
<VersionOverrides>
  ...
  <EquivalentAddins>
    <EquivalentAddin>
      <ProgId>ContosoCOMAddin</ProgId>
      <Type>COM</Type>
    </EquivalentAddin>

    <EquivalentAddin>
      <FileName>contosofunctions.xll</FileName>
      <Type>XLL</Type>
    </EquivalentAddin>
  <EquivalentAddins>
</VersionOverrides>
```

> [!NOTE]
> Если надстройка объявляет свои собственные функции поддерживаемыми XLL-модулями, изменение манифеста в дальнейшем может привести к повреждению книги пользователя, так как он изменит формат файла.

## <a name="custom-function-behavior-for-xll-compatible-functions"></a>Поведение настраиваемой функции для функций, совместимых с XLL

Функции XLL для надстройки преобразуются в настраиваемые функции, совместимые с XLL, при открытии электронной таблицы и наличии эквивалентной надстройки. При следующем сохранении функции XLL записываются в файл в совместимом режиме, чтобы они работали с настраиваемыми функциями XLL и Excel (если на других платформах).

В следующей таблице сравниваются функции в пользовательских функциях XLL, пользовательских функциях, совместимых с XLL, и пользовательские функции надстройки Excel.

|         |Определяемая пользователем функция XLL |Настраиваемые функции, совместимые с XLL |Пользовательская функция надстройки Excel |
|---------|---------|---------|---------|
| Поддерживаемые платформы | Windows | Windows, macOS, веб-браузер | Windows, macOS, веб-браузер |
| Поддерживаемые форматы файлов | XLSX, XLSB, XLSM, XLS | XLSX, XLSB, XLSM | XLSX, XLSB, XLSM |
| Автозаполнение формул | Нет | Да | Да |
| Подписка с потоковой передачей | Возможно, с помощью обратного вызова Кслфртд и XLL. | Нет | Да |
| Локализация функций | Нет | Нет. Имя и идентификатор должны быть согласованы с имеющимися функциями XLL. | Да |
| Переменные функции | Да | Да | Да |
| Поддержка многопоточного пересчета | Да | Да | Да |
| Поведение расчетов | Нет пользовательского интерфейса. В процессе вычисления Excel может не отвечать. | Пользователи увидят #BUSY! до тех пор, пока не будет возвращен результат. | Пользователи увидят #BUSY! до тех пор, пока не будет возвращен результат. |
| Наборы обязательных элементов | Н/Д | CustomFunctions 1,1 и более поздние версии | CustomFunctions 1,1 и более поздние версии |

## <a name="see-also"></a>См. также

- [Обеспечение совместимости надстройки Excel с существующей надстройкой COM](../develop/make-office-add-in-compatible-with-existing-com-add-in.md)
- [Руководство по пользовательским функциям в Excel](../tutorials/excel-tutorial-create-custom-functions.md)
