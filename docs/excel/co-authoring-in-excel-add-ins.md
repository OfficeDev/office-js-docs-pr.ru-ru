---
title: Совместное редактирование в надстройках Excel
description: 'Узнайте, как совместно Excel книги, хранимой в OneDrive, OneDrive для бизнеса или SharePoint Online.'
ms.date: 07/08/2021
ms.localizationpriority: medium
---


# <a name="coauthoring-in-excel-add-ins"></a>Совместное редактирование в надстройках Excel  

Благодаря функции [совместного редактирования](https://support.microsoft.com/office/7152aa8b-b791-414c-a3bb-3024e46fb104) несколько человек могут работать вместе и редактировать одну и ту же книгу Excel одновременно. Все соавторы книги могут видеть изменения, внесенные и сохраненные другими соавторами. Чтобы книги Excel можно было совместно редактировать, они должны храниться в OneDrive, OneDrive для бизнеса или SharePoint Online.

> [!IMPORTANT]
> В Excel для Microsoft 365 вы заметите AutoSave в верхнем левом углу. Если автосохранение включено, соавторы видят внесенные вами изменения в режиме реального времени. Учтите влияние такого поведения на макет вашей надстройки Excel. Пользователи могут выключить автосохранение с помощью переключателя в левом верхнем углу окна Excel.

## <a name="coauthoring-overview"></a>Общие сведения о совместном редактировании

Когда вы меняете содержимое книги, Excel автоматически синхронизирует эти изменения для всех соавторов. Вносить изменения в содержимое книги могут не только соавторы, но и код в надстройке Excel. Например, если следующий код JavaScript выполняется в Office надстройки, значение диапазона устанавливается в Contoso.

```js
range.values = [['Contoso']];
```

После того как книга со значением "Contoso" синхронизируется для всех соавторов, новое значение диапазона будет доступно всем пользователям и надстройкам, выполняемым в той же книге.

Функция совместного редактирования синхронизирует содержимое только общей книги. Значения, скопированные из книги в переменные JavaScript в надстройке Excel, не синхронизируются. Например, если надстройка хранит значение ячейки (например, "Contoso") в переменной JavaScript, а соавтор заменяет его на "Пример", после синхронизации все соавторы увидят в ячейке значение "Пример". Но для ячейки в переменной JavaScript по-прежнему будет задано значение "Contoso". Кроме того, когда несколько соавторов используют одну и ту же надстройку, у каждого соавтора есть своя, не синхронизированная с остальными, копия переменной. Перед работой с переменными, использующими содержимое книги, убедитесь, что все значения в книге обновлены.

## <a name="use-events-to-manage-the-in-memory-state-of-your-add-in"></a>Использование событий для управления состоянием надстройки в памяти

Надстройки Excel могут читать содержимое книги (из скрытых листов и объекта параметра), а затем хранить его в таких структурах данных как переменные. После того как исходные значения скопированы в любую из структур данных, соавторы могут обновить исходное содержание книги. Это означает, что теперь скопированные значения в структурах данных не синхронизируются с содержимым книги. При создании надстроек необходимо учитывать это разделение содержания книги и значений, хранящихся в структурах данных.

Например, вы можете создать надстройку контента, которая отображает пользовательские визуализации. Состояние ваших пользовательских визуализаций может быть сохранено в скрытом листе. Если соавторы используют ту же книгу, может произойти следующий сценарий.

- Пользователь A открывает документ, и пользовательские визуализации отображаются в книге. Пользовательские визуализации читают данные из скрытого листа (например, задан синий цвет визуализации).
- Пользователь Б открывает тот же документ, начинает изменять пользовательские визуализации и в качестве цвета для них задает оранжевый. Оранжевый цвет сохраняется в скрытом листе.
- Скрытый лист пользователя А обновляется с учетом оранжевого цвета.
- Специальные элементы визуализации пользователя А по-прежнему синие.

Чтобы специальные элементы визуализации пользователя А соответствовали изменениям, внесенным соавторами на скрытом листе, используйте событие [BindingDataChanged](/javascript/api/office/office.bindingdatachangedeventargs). Это обеспечит отражение изменений, внесенных соавторами в содержимое книги, в вашей надстройке.

## <a name="caveats-to-using-events-with-coauthoring"></a>Предостережения, касающиеся использования событий для совместного редактирования

Как описано выше, в некоторых сценариях применение  триггеров события для всех соавторов обеспечивает улучшенное взаимодействие с пользователем. Однако, имейте ввиду, что в ряде сценариев такое поведение может привести к неудобствам в работе пользователей.

Например, обычно в сценариях проверки данных пользовательский интерфейс отображается в ответ на события. Событие [BindingDataChanged](/javascript/api/office/office.bindingdatachangedeventargs), описанное в предыдущем разделе, выполняется когда локальный пользователь или соавтор (удаленный) изменяет содержимое книги в пределах привязки. Если обработник `BindingDataChanged` события отображает пользовательский интерфейс, пользователи увидят пользовательский интерфейс, не связанный с изменениями, которые они работали в книге, что приводит к плохому пользовательскому интерфейсу. Избегайте отображения пользовательского интерфейса при использовании событий в вашей надстройке.

## <a name="avoid-table-row-coauthoring-conflicts"></a>Избегайте конфликтов совместной с строкой таблицы

Известно, что вызовы [`TableRowCollection.add`](/javascript/api/excel/excel.tablerowcollection#excel-excel-tablerowcollection-add-member(1)) в API могут вызывать конфликты соавторов. Мы не рекомендуем использовать API, если предполагается, что надстройка будет работать, пока другие пользователи редактируют книгу надстройки (в частности, если они редактируют таблицу или какой-либо диапазон под таблицей). Следующие рекомендации должны `TableRowCollection.add` помочь вам избежать проблем с методом (и не запускать желтый Excel показывает, что просит пользователей обновиться).

1. Используйте [`Range.values`](/javascript/api/excel/excel.range#excel-excel-range-values-member) вместо [`TableRowCollection.add`](/javascript/api/excel/excel.tablerowcollection#excel-excel-tablerowcollection-add-member(1)). Настройка значений `Range` непосредственно под таблицей автоматически расширяет таблицу. В противном случае добавление строк таблицы через `Table` API приводит к конфликту слияния для совместной работы пользователей.
1. Правила [проверки данных](https://support.microsoft.com/office/29fecbcc-d1b9-42c1-9d76-eff3ce5f7249) не должны применяться к ячейкам под таблицей, если проверка данных не применяется во всем столбце.
1. Если в таблице есть данные, надстройка должна обработать их перед установкой значения диапазона. Использование [`Range.insert`](/javascript/api/excel/excel.range#excel-excel-range-insert-member(1)) для вставки пустой строки перемещает данные и делает пространство для расширяемой таблицы. В противном случае вы рискуете переписать ячейки под таблицей.
1. Вы не можете добавить пустую строку в таблицу с `Range.values`. Таблица автоматически расширяется только в том случае, если данные присутствуют в ячейках непосредственно под таблицей. Чтобы добавить пустую строку таблицы, используйте временные данные или скрытые столбцы.

## <a name="see-also"></a>См. также

- [О совместном редактировании в Excel (VBA)](/office/vba/excel/concepts/about-coauthoring-in-excel)
- [Как автосохранение влияет на надстройки и макросы (VBA)](/office/vba/library-reference/concepts/how-autosave-impacts-addins-and-macros)
