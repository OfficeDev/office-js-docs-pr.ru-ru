---
ms.date: 1/29/2019
description: Проверка подлинности пользователей с помощью пользовательских функций в Excel.
title: Проверка подлинности для пользовательских функций
ms.openlocfilehash: 0e42dbc93cb545660a8dbaae5bdb48724f3b7376
ms.sourcegitcommit: 33dcf099c6b3d249811580d67ee9b790c0fdccfb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2019
ms.locfileid: "29745423"
---
# <a name="authentication"></a><span data-ttu-id="45e87-103">Аутентификация</span><span class="sxs-lookup"><span data-stu-id="45e87-103">Authentication</span></span>

<span data-ttu-id="45e87-104">В некоторых случаях пользовательской функции требуется проверка подлинности пользователя для доступа к защищенным ресурсам.</span><span class="sxs-lookup"><span data-stu-id="45e87-104">In some scenarios your custom function will need to authenticate the user in order to access protected resources.</span></span> <span data-ttu-id="45e87-105">Хотя пользовательские функции не требует определенного метода проверки подлинности, следует иметь в виду, что пользовательские функции выполняется в отдельной среды выполнения из области задач и другие элементы пользовательского интерфейса добавьте в.</span><span class="sxs-lookup"><span data-stu-id="45e87-105">While custom functions doesn't require a specific method of authentication, you should be aware that custom functions runs in a separate runtime from the task pane and other UI elements of your add-in.</span></span> <span data-ttu-id="45e87-106">Таким образом, необходимые для передачи данных туда и обратно между двумя время работы с помощью `AsyncStorage` объект и API диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="45e87-106">Because of this, you'll need to pass data back and forth between the two runtimes using the `AsyncStorage` object and the Dialog API.</span></span>
  
## <a name="asyncstorage-object"></a><span data-ttu-id="45e87-107">Объект AsyncStorage</span><span class="sxs-lookup"><span data-stu-id="45e87-107">AsyncStorage object</span></span>

<span data-ttu-id="45e87-108">Среда выполнения пользовательских функций не имеет `localStorage` объекта в окне глобальные может обычно хранения данных.</span><span class="sxs-lookup"><span data-stu-id="45e87-108">The custom functions runtime doesn't have a `localStorage` object available on the global window, where you might typically store data.</span></span> <span data-ttu-id="45e87-109">Вместо этого следует обмена данными между пользовательских функций и областей задач с помощью [OfficeRuntime.AsyncStorage](https://docs.microsoft.com/javascript/api/office-runtime/officeruntime.asyncstorage) для задания и получения данных.</span><span class="sxs-lookup"><span data-stu-id="45e87-109">Instead, you should share data between custom functions and task panes, by using [OfficeRuntime.AsyncStorage](https://docs.microsoft.com/javascript/api/office-runtime/officeruntime.asyncstorage) to set and get data.</span></span> 

<span data-ttu-id="45e87-110">Кроме того, есть преимущество, используя `AsyncStorage`; безопасный изолированной среде используются, чтобы данных становится недоступной для других надстроек.</span><span class="sxs-lookup"><span data-stu-id="45e87-110">Additionally, there is a benefit to using `AsyncStorage`; it uses a secure sandbox environment so that your data cannot be accessed by other add-ins.</span></span>  

### <a name="suggested-usage"></a><span data-ttu-id="45e87-111">Предлагаемые об использовании</span><span class="sxs-lookup"><span data-stu-id="45e87-111">Suggested usage</span></span>

<span data-ttu-id="45e87-112">При необходимости для проверки подлинности из области задач или пользовательской функции, проверьте AsyncStorage для просмотра, если маркер доступа уже был получен.</span><span class="sxs-lookup"><span data-stu-id="45e87-112">When you need to authenticate either from the task pane or a custom function, check AsyncStorage to see if the access token was already acquired.</span></span> <span data-ttu-id="45e87-113">Если нет, используйте диалоговое окно API для проверки подлинности пользователя, получить маркер доступа и затем сохраните маркер в AsyncStorage для использования в будущем.</span><span class="sxs-lookup"><span data-stu-id="45e87-113">If not, use the dialog API to authenticate the user, retrieve the access token, and then store the token in AsyncStorage for future use.</span></span>

## <a name="dialog-api"></a><span data-ttu-id="45e87-114">Диалоговое окно API</span><span class="sxs-lookup"><span data-stu-id="45e87-114">Dialog API</span></span>

<span data-ttu-id="45e87-115">Если маркер не существует, следует использовать API диалоговое окно запрашивать у пользователя для входа в.</span><span class="sxs-lookup"><span data-stu-id="45e87-115">If a token doesn't exist, you should use the Dialog API to ask the user to sign in.</span></span> <span data-ttu-id="45e87-116">После пользователь вводит свои учетные данные, полученные маркер доступа могут храниться в `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="45e87-116">After a user enters their credentials, the resulting access token can be stored in `AsyncStorage`.</span></span>

> [!NOTE]
> <span data-ttu-id="45e87-117">Среда выполнения настраиваемых функций использует объект диалогового окна, несколько отличается от объекта диалоговое окно в среде выполнения областей задач.</span><span class="sxs-lookup"><span data-stu-id="45e87-117">The custom functions runtime uses a Dialog object that is slightly different from the Dialog object in the runtime used by task panes.</span></span> <span data-ttu-id="45e87-118">Они в случае оба называется «API диалоговое окно», но использовать `Officeruntime.Dialog` для проверки подлинности пользователей в среде выполнения пользовательских функций.</span><span class="sxs-lookup"><span data-stu-id="45e87-118">They're both referred to as the "Dialog API", but use `Officeruntime.Dialog` to authenticate users in the custom functions runtime.</span></span>

<span data-ttu-id="45e87-119">Сведения о том, как использовать `OfficeRuntime.Dialog`, см. [среда выполнения пользовательских функций](https://docs.microsoft.com/en-us/office/dev/add-ins/excel/custom-functions-runtime?view=office-js#displaying-a-dialog-box).</span><span class="sxs-lookup"><span data-stu-id="45e87-119">For information on how to use the `OfficeRuntime.Dialog`, see [Custom Functions runtime](https://docs.microsoft.com/en-us/office/dev/add-ins/excel/custom-functions-runtime?view=office-js#displaying-a-dialog-box).</span></span>

<span data-ttu-id="45e87-120">Формирования представления весь процесс проверки подлинности в целом, могут быть полезным подумать об области задач и элементы пользовательского интерфейса для надстройки и пользовательские функции части надстройки в качестве отдельной сущности, которые могут взаимодействовать друг с другом через `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="45e87-120">When envisioning the entire authentication process as a whole, it might be helpful to think of the task pane and UI elements of your add-in and the custom functions portions of your add-in as separate entities which can communicate with each other through `AsyncStorage`.</span></span>

<span data-ttu-id="45e87-121">Ниже описаны данного процесса.</span><span class="sxs-lookup"><span data-stu-id="45e87-121">The following diagram outlines this basic process.</span></span> <span data-ttu-id="45e87-122">Обратите внимание на то, что пунктирная линия указывает, что во время отдельные действия, пользовательских функций и надстройки в области задач обе части надстройки в целом.</span><span class="sxs-lookup"><span data-stu-id="45e87-122">Note that the dotted line indicates that while they perform separate actions, custom functions and your add-in's task pane are both parts of your add-in as a whole.</span></span>

1. <span data-ttu-id="45e87-123">Заключать вызов пользовательской функции из ячейки в книге Excel.</span><span class="sxs-lookup"><span data-stu-id="45e87-123">You issue a custom function call from a cell in an Excel workbook.</span></span>
2. <span data-ttu-id="45e87-124">Пользовательская функция использует `Officeruntime.Dialog` передавать учетные данные пользователя для веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="45e87-124">The custom function uses `Officeruntime.Dialog` to pass your user credentials to a website.</span></span>
3. <span data-ttu-id="45e87-125">В этом веб-сайте, командлет возвращает маркер доступа к пользовательской функции.</span><span class="sxs-lookup"><span data-stu-id="45e87-125">This website then returns an access token to the custom function.</span></span>
4. <span data-ttu-id="45e87-126">Пользовательская функция затем задает этот маркер доступа `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="45e87-126">Your custom function then sets this access token to the `AsyncStorage`.</span></span>
5. <span data-ttu-id="45e87-127">Надстройка в области задач обращается к маркер из `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="45e87-127">Your add-in's task pane accesses the token from `AsyncStorage`.</span></span>

<span data-ttu-id="45e87-128">![Схема пользовательских функций, OfficeRuntime и совместная работа областей задач.] (../images/Authdiagram.png "Схема проверки подлинности.")</span><span class="sxs-lookup"><span data-stu-id="45e87-128">![Diagram of custom functions, OfficeRuntime, and task panes working together.](../images/Authdiagram.png "Authentication diagram.")</span></span>

## <a name="general-guidance"></a><span data-ttu-id="45e87-129">Общие рекомендации</span><span class="sxs-lookup"><span data-stu-id="45e87-129">General guidance</span></span>

<span data-ttu-id="45e87-130">Надстройки Office, веб- и можно использовать любой способ проверки подлинности web.</span><span class="sxs-lookup"><span data-stu-id="45e87-130">Office Add-ins are web-based and you can use any web authentication technique.</span></span> <span data-ttu-id="45e87-131">Нет определенного шаблона или метод, необходимо выполнить для реализации собственного проверки подлинности с помощью пользовательских функций.</span><span class="sxs-lookup"><span data-stu-id="45e87-131">There is no particular pattern or method you must follow to implement your own authentication with custom functions.</span></span> <span data-ttu-id="45e87-132">Вы можете обратитесь к документации о различных шаблонов проверки подлинности, начиная с [этой статьей о авторизации с помощью внешних служб](https://docs.microsoft.com/en-us/office/dev/add-ins/develop/auth-external-add-ins?view=office-js).</span><span class="sxs-lookup"><span data-stu-id="45e87-132">You may wish to consult the documentation about various authentication patterns, starting with [this article about authorizing via external services](https://docs.microsoft.com/en-us/office/dev/add-ins/develop/auth-external-add-ins?view=office-js).</span></span>  

<span data-ttu-id="45e87-133">Избегайте использования в следующих расположениях для хранения данных при разработке пользовательских функций.</span><span class="sxs-lookup"><span data-stu-id="45e87-133">Avoid using the following locations to store data when developing custom functions:</span></span>  

- <span data-ttu-id="45e87-134">`localStorage`: Пользовательские функции не имеют доступ к глобальным `window` объекта и поэтому не имеют доступа к данным, хранящимся в `localStorage`.</span><span class="sxs-lookup"><span data-stu-id="45e87-134">`localStorage`: Custom functions do not have access to the global `window` object and therefore have no access to data     stored in `localStorage`.</span></span>
- <span data-ttu-id="45e87-135">`Office.context.document.settings`: Это расположение не является безопасным и кем-либо с помощью надстройки можно извлечь сведения.</span><span class="sxs-lookup"><span data-stu-id="45e87-135">`Office.context.document.settings`:  This location is not secure and information can be extracted by anyone using the     add-in.</span></span>

## <a name="see-also"></a><span data-ttu-id="45e87-136">См. также</span><span class="sxs-lookup"><span data-stu-id="45e87-136">See also</span></span>

* [<span data-ttu-id="45e87-137">Метаданные пользовательских функций</span><span class="sxs-lookup"><span data-stu-id="45e87-137">Custom functions metadata</span></span>](custom-functions-json.md)
* [<span data-ttu-id="45e87-138">Среда выполнения для пользовательских функций Excel</span><span class="sxs-lookup"><span data-stu-id="45e87-138">Runtime for Excel custom functions</span></span>](custom-functions-runtime.md)
* [<span data-ttu-id="45e87-139">Рекомендации по настраиваемым функциям</span><span class="sxs-lookup"><span data-stu-id="45e87-139">Custom functions best practices</span></span>](custom-functions-best-practices.md)
* [<span data-ttu-id="45e87-140">Руководство по настраиваемым функциям в Excel</span><span class="sxs-lookup"><span data-stu-id="45e87-140">Excel custom functions tutorial</span></span>](excel-tutorial-custom-functions.md)
