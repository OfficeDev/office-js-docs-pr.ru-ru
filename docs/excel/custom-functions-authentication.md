---
ms.date: 1/29/2019
description: Проверка подлинности пользователей с помощью пользовательских функций в Excel.
title: Проверка подлинности для пользовательских функций
ms.openlocfilehash: 0e42dbc93cb545660a8dbaae5bdb48724f3b7376
ms.sourcegitcommit: 33dcf099c6b3d249811580d67ee9b790c0fdccfb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2019
ms.locfileid: "29745423"
---
# <a name="authentication"></a>Аутентификация

В некоторых случаях пользовательской функции требуется проверка подлинности пользователя для доступа к защищенным ресурсам. Хотя пользовательские функции не требует определенного метода проверки подлинности, следует иметь в виду, что пользовательские функции выполняется в отдельной среды выполнения из области задач и другие элементы пользовательского интерфейса добавьте в. Таким образом, необходимые для передачи данных туда и обратно между двумя время работы с помощью `AsyncStorage` объект и API диалогового окна.
  
## <a name="asyncstorage-object"></a>Объект AsyncStorage

Среда выполнения пользовательских функций не имеет `localStorage` объекта в окне глобальные может обычно хранения данных. Вместо этого следует обмена данными между пользовательских функций и областей задач с помощью [OfficeRuntime.AsyncStorage](https://docs.microsoft.com/javascript/api/office-runtime/officeruntime.asyncstorage) для задания и получения данных. 

Кроме того, есть преимущество, используя `AsyncStorage`; безопасный изолированной среде используются, чтобы данных становится недоступной для других надстроек.  

### <a name="suggested-usage"></a>Предлагаемые об использовании

При необходимости для проверки подлинности из области задач или пользовательской функции, проверьте AsyncStorage для просмотра, если маркер доступа уже был получен. Если нет, используйте диалоговое окно API для проверки подлинности пользователя, получить маркер доступа и затем сохраните маркер в AsyncStorage для использования в будущем.

## <a name="dialog-api"></a>Диалоговое окно API

Если маркер не существует, следует использовать API диалоговое окно запрашивать у пользователя для входа в. После пользователь вводит свои учетные данные, полученные маркер доступа могут храниться в `AsyncStorage`.

> [!NOTE]
> Среда выполнения настраиваемых функций использует объект диалогового окна, несколько отличается от объекта диалоговое окно в среде выполнения областей задач. Они в случае оба называется «API диалоговое окно», но использовать `Officeruntime.Dialog` для проверки подлинности пользователей в среде выполнения пользовательских функций.

Сведения о том, как использовать `OfficeRuntime.Dialog`, см. [среда выполнения пользовательских функций](https://docs.microsoft.com/en-us/office/dev/add-ins/excel/custom-functions-runtime?view=office-js#displaying-a-dialog-box).

Формирования представления весь процесс проверки подлинности в целом, могут быть полезным подумать об области задач и элементы пользовательского интерфейса для надстройки и пользовательские функции части надстройки в качестве отдельной сущности, которые могут взаимодействовать друг с другом через `AsyncStorage`.

Ниже описаны данного процесса. Обратите внимание на то, что пунктирная линия указывает, что во время отдельные действия, пользовательских функций и надстройки в области задач обе части надстройки в целом.

1. Заключать вызов пользовательской функции из ячейки в книге Excel.
2. Пользовательская функция использует `Officeruntime.Dialog` передавать учетные данные пользователя для веб-сайта.
3. В этом веб-сайте, командлет возвращает маркер доступа к пользовательской функции.
4. Пользовательская функция затем задает этот маркер доступа `AsyncStorage`.
5. Надстройка в области задач обращается к маркер из `AsyncStorage`.

![Схема пользовательских функций, OfficeRuntime и совместная работа областей задач.] (../images/Authdiagram.png "Схема проверки подлинности.")

## <a name="general-guidance"></a>Общие рекомендации

Надстройки Office, веб- и можно использовать любой способ проверки подлинности web. Нет определенного шаблона или метод, необходимо выполнить для реализации собственного проверки подлинности с помощью пользовательских функций. Вы можете обратитесь к документации о различных шаблонов проверки подлинности, начиная с [этой статьей о авторизации с помощью внешних служб](https://docs.microsoft.com/en-us/office/dev/add-ins/develop/auth-external-add-ins?view=office-js).  

Избегайте использования в следующих расположениях для хранения данных при разработке пользовательских функций.  

- `localStorage`: Пользовательские функции не имеют доступ к глобальным `window` объекта и поэтому не имеют доступа к данным, хранящимся в `localStorage`.
- `Office.context.document.settings`: Это расположение не является безопасным и кем-либо с помощью надстройки можно извлечь сведения.

## <a name="see-also"></a>См. также

* [Метаданные пользовательских функций](custom-functions-json.md)
* [Среда выполнения для пользовательских функций Excel](custom-functions-runtime.md)
* [Рекомендации по настраиваемым функциям](custom-functions-best-practices.md)
* [Руководство по настраиваемым функциям в Excel](excel-tutorial-custom-functions.md)
