---
ms.date: 07/10/2019
description: Отладка пользовательских функций в Excel.
title: Отладка пользовательских функций
localization_priority: Normal
ms.openlocfilehash: 4abd5f3da58c35485004b17f92b334b133cabd27
ms.sourcegitcommit: fa4e81fcf41b1c39d5516edf078f3ffdbd4a3997
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/17/2020
ms.locfileid: "42719310"
---
# <a name="custom-functions-debugging"></a>Отладка пользовательских функций

Отладка настраиваемых функций может осуществляться несколькими способами, в зависимости от используемой платформы.

[!include[Excel custom functions note](../includes/excel-custom-functions-note.md)]

В Windows:
- [Отладчик Excel для настольных ПК и Visual Studio Code (VS Code)](#use-the-vs-code-debugger-for-excel-desktop)
- [Приложение Excel в отладчике кода для Интернета и VS](#use-the-vs-code-debugger-for-excel-in-microsoft-edge)
- [Excel в веб-средствах и веб-браузерах](#use-the-browser-developer-tools-to-debug-custom-functions-in-excel-on-the-web)
- [Командная строка](#use-the-command-line-tools-to-debug)

На компьютерах Mac:
- [Excel в веб-средствах и веб-браузерах](#use-the-browser-developer-tools-to-debug-custom-functions-in-excel-on-the-web)
- [Командная строка](#use-the-command-line-tools-to-debug)

> [!NOTE]
> Для простоты в этой статье показана Отладка в контексте использования Visual Studio Code для редактирования, запуска задач и в некоторых случаях использования представления отладки. Если вы используете другой редактор или средство командной строки, ознакомьтесь с [инструкциями по использованию командной строки](#commands-for-building-and-running-your-add-in) в конце этой статьи.

## <a name="requirements"></a>Requirements

Перед началом отладки следует использовать [генератор Yeoman для надстроек Office](https://github.com/OfficeDev/generator-office) , чтобы создать проект пользовательских функций. Руководство по созданию проекта пользовательских функций представлено в [руководстве Custom functions](../tutorials/excel-tutorial-create-custom-functions.md).

## <a name="use-the-vs-code-debugger-for-excel-desktop"></a>Использование отладчика кода VS для классической версии Excel

Вы можете использовать код VS для отладки настраиваемых функций в Office Excel на настольном компьютере.

> [!NOTE]
> Отладка на рабочем столе для Mac недоступна, но ее можно получить [с помощью средств браузера и командной строки для отладки Excel в Интернете](#use-the-command-line-tools-to-debug)).

### <a name="run-your-add-in-from-vs-code"></a>Запуск надстройки из кода VS

1. Откройте корневую папку проекта "пользовательские функции" в [VS Code](https://code.visualstudio.com/).
2. Выберите пункт **терминал > выполнить задачу** и введите или выберите **Контрольное значение**. В этом случае будут отслеживаться и перестраиваться все изменения файлов.
3. Выберите пункт **терминал > выполнить задачу** и введите или выберите **сервер разработки**.

### <a name="start-the-vs-code-debugger"></a>Запуск отладчика кода VS

4. Нажмите кнопку **просмотр > Отладка** или введите **CTRL + SHIFT + D** , чтобы переключиться в представление отладки.
5. В разделе Параметры отладки выберите пункт **Рабочий стол Excel**.
6. Нажмите **клавишу F5** (или выберите **Debug-> начать отладку** в меню), чтобы начать отладку. Откроется новая книга Excel с уже неопубликованные и готовым к использованию надстройкой.

### <a name="start-debugging"></a>Начало отладки

1. В коде VS откройте файл сценария исходного кода (**functions. js** или **functions. TS**).
2. [Задайте точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции.
3. В книге Excel введите формулу, использующую пользовательскую функцию.

При этом выполнение будет остановлено в строке кода, в которой вы задаете точку останова. Теперь вы можете выполнить отладку кода, задать контрольные значения и использовать любые необходимые возможности отладки кода VS.

## <a name="use-the-vs-code-debugger-for-excel-in-microsoft-edge"></a>Использование отладчика кода VS для Excel в Microsoft Edge

Вы можете использовать код VS для отладки настраиваемых функций в Excel в браузере Microsoft Edge. Чтобы использовать код VS с Microsoft EDGE, необходимо установить [отладчик для расширения Microsoft Edge](https://marketplace.visualstudio.com/items?itemName=msjsdiag.debugger-for-edge) .

### <a name="run-your-add-in-from-vs-code"></a>Запуск надстройки из кода VS

1. Откройте корневую папку проекта "пользовательские функции" в [VS Code](https://code.visualstudio.com/).
2. Выберите пункт **терминал > выполнить задачу** и введите или выберите **Контрольное значение**. В этом случае будут отслеживаться и перестраиваться все изменения файлов.
3. Выберите пункт **терминал > выполнить задачу** и введите или выберите **сервер разработки**.

### <a name="start-the-vs-code-debugger"></a>Запуск отладчика кода VS

4. Нажмите кнопку **просмотр > Отладка** или введите **CTRL + SHIFT + D** , чтобы переключиться в представление отладки.
5. В разделе Параметры отладки выберите **Office Online (Microsoft EDGE)**.
6. Откройте Excel в браузере Microsoft EDGE и создайте новую книгу.
7. Выберите **общий доступ** на ленте и скопируйте ссылку на URL-адрес этой новой книги.
8. Нажмите **клавишу F5** (или выберите **Отладка > начать отладку** из меню), чтобы начать отладку. Появится запрос, в котором будет предложен URL-адрес документа.
9. Вставьте URL-адрес книги и нажмите клавишу ВВОД.

### <a name="sideload-your-add-in"></a>Загрузка неопубликованной надстройки

1. Перейдите на вкладку **Вставка** на ленте и **в разделе надстройки выберите надстройки** **Office**.
2. В диалоговом окне **надстройки Office** откройте вкладку **Мои** надстройки, выберите **Управление моими**надстройками, а затем **отправьте надстройку**.
    
    ![Диалоговое окно "Надстройки Office" с раскрывающимся меню в правом верхнем углу, в котором выделен пункт "Управление моими надстройками", а под ним — раскрывающийся список с пунктом "Отправить надстройку"](../images/office-add-ins-my-account.png)

3. **Найдите** файл манифеста надстройки и нажмите кнопку **Отправить**.
    
    ![Диалоговое окно отправки надстройки с кнопками "Обзор", "Отправить" и "Отмена"](../images/upload-add-in.png)


### <a name="set-breakpoints"></a>Задание точек останова
1. В коде VS откройте файл сценария исходного кода (**functions. js** или **functions. TS**).
2. [Задайте точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции.
3. В книге Excel введите формулу, использующую пользовательскую функцию.

## <a name="use-the-browser-developer-tools-to-debug-custom-functions-in-excel-on-the-web"></a>Использование средств разработчика браузера для отладки настраиваемых функций в Excel в Интернете

Средства разработчика браузера можно использовать для отладки настраиваемых функций в Excel в Интернете. Следующие действия работают как для Windows, так и для macOS.

### <a name="run-your-add-in-from-visual-studio-code"></a>Запуск надстройки из Visual Studio Code

1. Откройте корневую папку проекта пользовательских функций в [Visual Studio Code (VS Code)](https://code.visualstudio.com/).
2. Выберите пункт **терминал > выполнить задачу** и введите или выберите **Контрольное значение**. В этом случае будут отслеживаться и перестраиваться все изменения файлов.
3. Выберите пункт **терминал > выполнить задачу** и введите или выберите **сервер разработки**.

### <a name="sideload-your-add-in"></a>Загрузка неопубликованной надстройки

1. Откройте [Microsoft Office в Интернете](https://office.live.com/).
2. Откройте новую книгу Excel.
3. Откройте вкладку **Вставка** на ленте и в разделе **надстройки** выберите надстройки **Office**.
4. В диалоговом окне **надстройки Office** откройте вкладку **Мои** надстройки, выберите **Управление моими**надстройками, а затем **отправьте надстройку**.
    
    ![Диалоговое окно "Надстройки Office" с раскрывающимся меню в правом верхнем углу, в котором выделен пункт "Управление моими надстройками", а под ним — раскрывающийся список с пунктом "Отправить надстройку"](../images/office-add-ins-my-account.png)

5. **Найдите** файл манифеста надстройки и выберите **Отправить**.
    
    ![Диалоговое окно отправки надстройки с кнопками "Обзор", "Отправить" и "Отмена"](../images/upload-add-in.png)

> [!NOTE]
> После неопубликованные документа оно остается неопубликованные при каждом открытии документа.

### <a name="start-debugging"></a>Начало отладки

1. Откройте Инструменты разработчика в браузере. Для Chrome и большинства браузеров F12 откроет средства разработчика.
2. В средствах разработчика откройте файл скрипта исходного кода с помощью **команд Cmd + P** или **CTRL + p** (**functions. js** или **functions. TS**).
3. [Задайте точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции. 

Если вам нужно изменить код, вы можете внести изменения в код VS и сохранить изменения. Обновите браузер, чтобы увидеть загруженные изменения.

## <a name="use-the-command-line-tools-to-debug"></a>Использование средств командной строки для отладки

Если вы не используете код VS, для запуска надстройки можно использовать командную строку (например, bash или PowerShell). Для отладки кода в Excel в Интернете необходимо использовать инструменты разработчика браузера. Вы не можете выполнить отладку классической версии Excel с помощью командной строки.

1. В командной строке выполняется `npm run watch` Поиск и перестроение при возникновении изменений кода.
2. Откройте второе окно командной строки (первый из них будет заблокирован при запуске контрольного значения).

3. Если вы хотите запустить надстройку в классической версии Excel, выполните следующую команду:
    
    `npm run start:desktop`
    
    Если вы предпочитаете запустить надстройку в Excel в Интернете, выполните следующую команду:
    
    `npm run start:web`
    
    Для Excel в Интернете вам также потребуется Загрузка неопубликованных надстройку. Выполните действия, описанные в [Загрузка неопубликованных надстройки](#sideload-your-add-in) , чтобы Загрузка неопубликованных надстройку. Затем перейдите к следующему разделу, чтобы начать отладку.
    
4. Откройте Инструменты разработчика в браузере. Для Chrome и большинства браузеров F12 откроет средства разработчика.
5. В средствах разработчика откройте файл сценария исходного кода (**functions. js** или **functions. TS**). Код настраиваемых функций может располагаться около конца файла.
6. В исходном коде пользовательской функции примените точку останова, выбрав строку кода.

Если необходимо изменить код, который можно внести в Visual Studio, и сохранить изменения. Обновите браузер, чтобы увидеть загруженные изменения.

### <a name="commands-for-building-and-running-your-add-in"></a>Команды для построения и запуска надстройки

Доступно несколько задач сборки:
- `npm run watch`: сборки для разработки и автоматически перестраивается при сохранении исходного файла
- `npm run build-dev`: сборки для разработки один раз
- `npm run build`: сборки для производства
- `npm run dev-server`: запускает веб-сервер, используемый для разработки

Для запуска отладки на рабочем столе или в сети можно использовать следующие задачи.
- `npm run start:desktop`: Запускает Excel на настольном компьютере и сиделоадс надстройку.
- `npm run start:web`: Запуск Excel в Интернете и сиделоадс надстройки.
- `npm run stop`: Остановка Excel и отладка.

## <a name="next-steps"></a>Дальнейшие действия
Узнайте о [методиках проверки подлинности в пользовательских функциях](custom-functions-authentication.md). Или просмотрите [уникальную архитектуру пользовательской функции](custom-functions-architecture.md).

## <a name="see-also"></a>См. также

* [Устранение неполадок пользовательских функций](custom-functions-troubleshooting.md)
* [Обработка ошибок в пользовательских функциях Excel](custom-functions-errors.md)
* [Создание пользовательских функций, совместимых с функциями XLL, определенными пользователями](make-custom-functions-compatible-with-xll-udf.md)
* [Создание пользовательских функций в Excel](custom-functions-overview.md)
