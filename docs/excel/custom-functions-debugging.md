---
ms.date: 03/13/2019
description: Отладка пользовательских функций в Excel.
title: Отладка пользовательских функций (Предварительная версия)
localization_priority: Normal
ms.openlocfilehash: 08563ef630ebc457219c4c622328b84d13e6acab
ms.sourcegitcommit: 6d375518c119d09c8d3fb5f0cc4583ba5b20ac03
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "31914391"
---
# <a name="custom-functions-debugging-preview"></a>Отладка пользовательских функций (Предварительная версия)

Отладка настраиваемых функций может осуществляться несколькими способами, в зависимости от используемой платформы.

В Windows:
- [Отладчик Excel для наСтольных ПК и Visual Studio Code (VS Code)](#use-the-vs-code-debugger-for-excel-desktop)
- [Microsoft Excel Online и отладчик кода VS](#use-the-vs-code-debugger-for-excel-online-in-microsoft-edge)
- [Средства Excel Online и браузера](#use-the-browser-developer-tools-to-debug-custom-functions-in-excel-online)
- [Командная строка](#use-the-command-line-tools-to-debug)

На компьютерах Mac:
- [Средства Excel Online и браузера](#use-the-browser-developer-tools-to-debug-custom-functions-in-excel-online)
- [Командная строка](#use-the-command-line-tools-to-debug)

[!include[Excel custom functions note](../includes/excel-custom-functions-note.md)]

> [!NOTE]
> Для простоты в этой статье показана Отладка в контексте использования Visual Studio Code для редактирования, запуска задач и в некоторых случаях использования представления отладки. Если вы используете другой редактор или средство командной строки, ознакомьтесь с инструкциями по использованию [командной строки](#use-the-command-line-tools-to-debug) в конце этой статьи.

## <a name="requirements"></a>Требования

Перед началом отладки необходимо создать проект надстройки настраиваемых функций с помощью генератора Yo Office и убедиться, что у вас есть доверенные самозаверяющие сертификаты для вашего проекта. Инструкции по созданию проекта представлены в [руководстве Custom functions](../tutorials/excel-tutorial-create-custom-functions.md). Инструкции по доверенным сертификатам можно узнать в статье [Добавление самозаверяющих сертификатов в качестве доверенных корневых сертификатов](https://github.com/OfficeDev/generator-office/blob/master/src/docs/ssl.md).

## <a name="use-the-vs-code-debugger-for-excel-desktop"></a>Использование отладчика кода VS для классической версии Excel

Вы можете использовать код VS для отладки настраиваемых функций в Office Excel на настольном компьютере.

> [!NOTE]
> Отладка на рабочем столе для Mac недоступна, но ее можно [использовать с помощью средств браузера для отладки Excel Online](#use-the-browser-developer-tools-to-debug-custom-functions-in-excel-online).

### <a name="run-your-add-in-from-vs-code"></a>Запуск надстройки из кода VS

1. Откройте корневую папку проекта "пользовательские функции" в [VS Code](https://code.visualstudio.com/).
2. Выберите пункт **терминал _Гт_ запуск задачи** и введите или выберите **Контрольное значение**. В этом случае будут отслеживаться и перестраиваться все изменения файлов.
3. Выберите пункт **терминал _Гт_ запуск задачи** и введите или выберите **сервер разработки**. 

### <a name="start-the-vs-code-debugger"></a>Запуск отладчика кода VS

4. Выберите **Просмотр _Гт_ отладки** или введите **CTRL + SHIFT + D** , чтобы переключиться в представление отладки.
5. В разделе Параметры отладки выберите пункт **Рабочий стол Excel**.
6. Чтобы начать отладку, нажмите **клавишу F5** (или выберите **Отладка — _гт_ начать отладку** в меню). Откроется новая книга Excel с уже неопубликованные и готовым к использованию надстройкой.

### <a name="start-debugging"></a>Начало отладки

1. В коде VS откройте файл сценария исходного кода (functions. js или functions. TS).
2. [Задайте точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции.
3. В книге Excel введите формулу, использующую пользовательскую функцию.

При этом выполнение будет остановлено в строке кода, в которой вы задаете точку останова. Теперь вы можете выполнить отладку кода, задать контрольные значения и использовать любые необходимые возможности отладки кода VS.

## <a name="use-the-vs-code-debugger-for-excel-online-in-microsoft-edge"></a>Использование отладчика кода VS для Excel Online в Microsoft Edge

Вы можете использовать код VS для отладки настраиваемых функций в Excel Online в браузере Microsoft Edge. Чтобы использовать код VS с Microsoft EDGE, необходимо установить [отладчик для расширения Microsoft Edge](https://marketplace.visualstudio.com/items?itemName=msjsdiag.debugger-for-edge) .

### <a name="run-your-add-in-from-vs-code"></a>Запуск надстройки из кода VS

1. Откройте корневую папку проекта "пользовательские функции" в [VS Code](https://code.visualstudio.com/).
2. Выберите пункт **терминал _Гт_ запуск задачи** и введите или выберите **Контрольное значение**. В этом случае будут отслеживаться и перестраиваться все изменения файлов.
3. Выберите пункт **терминал _Гт_ запуск задачи** и введите или выберите **сервер разработки**. 

### <a name="start-the-vs-code-debugger"></a>Запуск отладчика кода VS

4. Выберите **Просмотр _Гт_ отладки** или введите **CTRL + SHIFT + D** , чтобы переключиться в представление отладки.
5. В разделе Параметры отладки выберите **Office Online (EDGE)**.
6. Откройте Excel Online с помощью браузера Microsoft EDGE, откройте Excel Online и создайте новую книгу.
7. Выберите **общий доступ** на ленте и скопируйте ссылку на URL-адрес этой новой книги.
8. Нажмите **клавишу F5** (или выберите **Отладка _гт_ начать отладку** в меню), чтобы начать отладку. Появится запрос, в котором будет предложен URL-адрес документа.
9. Вставьте URL-адрес книги и нажмите клавишу ВВОД.

### <a name="sideload-your-add-in"></a>Загрузка неопубликованной надстройки   

1. Перейдите на вкладку **Вставка** на ленте и в разделе надстройки выберите надстройки **Office**. ****
2. В диалоговом окне **Надстройки Office** откройте вкладку **МОИ НАДСТРОЙКИ** и выберите **Управление моими надстройками** > **Отправить надстройку**.
    
    ![Диалоговое окно "Надстройки Office" с раскрывающимся меню в правом верхнем углу, в котором выделен пункт "Управление моими надстройками", а под ним — раскрывающийся список с пунктом "Отправить надстройку"](../images/office-add-ins-my-account.png)

3.  **Найдите** файл манифеста надстройки и нажмите кнопку **Отправить**.
    
    ![Диалоговое окно отправки надстройки с кнопками "Обзор", "Отправить" и "Отмена"](../images/upload-add-in.png)


### <a name="set-breakpoints"></a>Задание точек останова
1. В коде VS откройте файл сценария исходного кода (functions. js или functions. TS).
2. [Задайте точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции.
3. В книге Excel введите формулу, использующую пользовательскую функцию.

## <a name="use-the-browser-developer-tools-to-debug-custom-functions-in-excel-online"></a>Использование средств разработчика браузера для отладки настраиваемых функций в Excel Online

Средства разработчика браузера можно использовать для отладки настраиваемых функций в Excel Online. Следующие действия работают как для Windows, так и для macOS.

### <a name="run-your-add-in-from-visual-studio-code"></a>Запуск надстройки из Visual Studio Code

1. Откройте корневую папку проекта пользовательских функций в [Visual Studio Code (VS Code)](https://code.visualstudio.com/).
2. Выберите пункт **терминал _Гт_ запуск задачи** и введите или выберите **Контрольное значение**. В этом случае будут отслеживаться и перестраиваться все изменения файлов.
3. Выберите пункт **терминал _Гт_ запуск задачи** и введите или выберите **сервер разработки**. 

### <a name="sideload-your-add-in"></a>Загрузка неопубликованной надстройки   

1. Откройте [Microsoft Office Online](https://office.live.com/).
2. Откройте новую книгу Excel.
3. Откройте вкладку  **Вставка** на ленте и в разделе **Надстройки** выберите **Надстройки Office**.
4. В диалоговом окне **Надстройки Office** откройте вкладку **МОИ НАДСТРОЙКИ** и выберите **Управление моими надстройками** > **Отправить надстройку**.
    
    ![Диалоговое окно "Надстройки Office" с раскрывающимся меню в правом верхнем углу, в котором выделен пункт "Управление моими надстройками", а под ним — раскрывающийся список с пунктом "Отправить надстройку"](../images/office-add-ins-my-account.png)

5.  **Найдите** файл манифеста надстройки и выберите **Отправить**.
    
    ![Диалоговое окно отправки надстройки с кнопками "Обзор", "Отправить" и "Отмена"](../images/upload-add-in.png)

> [!NOTE]
> После неопубликованные документа оно остается неопубликованные при каждом открытии документа.

### <a name="start-debugging"></a>Начало отладки

1. Откройте Инструменты разработчика в браузере. Для Chrome и большинства браузеров F12 откроет средства разработчика.
2. В средствах разработчика откройте файл скрипта исходного кода с помощью **команд Cmd + P** или **CTRL + p** (functions. js или functions. TS).
3. [Задайте точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции. 

Если вам нужно изменить код, вы можете внести изменения в код VS и сохранить изменения. Обновите браузер, чтобы увидеть загруженные изменения.

## <a name="use-the-command-line-tools-to-debug"></a>Использование средств командной строки для отладки

Если вы не используете код VS, для запуска надстройки можно использовать командную строку (например, bash или PowerShell). Для отладки кода в Excel Online необходимо использовать инструменты разработчика браузера. Вы не можете выполнить отладку классической версии Excel с помощью командной строки.

1. В командной строке выполняется `npm run watch` Поиск и перестроение при возникновении изменений кода.
2. Откройте второе окно командной строки (первый из них будет заблокирован при запуске контрольного значения).

3. Если вы хотите запустить надстройку в классической версии Excel, выполните следующую команду:
    
    `npm run start desktop`
    
    Если вы предпочитаете запустить надстройку в Excel Online, выполните следующую команду
    
    `npm run start web`
    
    Для Excel Online также потребуется Загрузка неопубликованных надстройку. Выполните действия, описанные в [Загрузка неопубликованных надстройки](#sideload-your-add-in) , чтобы Загрузка неопубликованных надстройку. Затем перейдите к следующему разделу, чтобы начать отладку.
    
4. Откройте Инструменты разработчика в браузере. Для Chrome и большинства браузеров F12 откроет средства разработчика.
5. В средствах разработчика откройте файл сценария исходного кода (functions. js или functions. TS). Код настраиваемых функций может располагаться около конца файла.
6. В исходном коде пользовательской функции примените точку останова, выбрав строку кода.

Если необходимо изменить код, который можно внести в Visual Studio, и сохранить изменения. Обновите браузер, чтобы увидеть загруженные изменения.

### <a name="commands-for-building-and-running-your-add-in"></a>Команды для построения и запуска надстройки

Доступно несколько задач сборки:
- `npm run watch`: сборки для разработки и автоматически перестраивается при сохранении исходного файла
- `npm run build-dev`: сборки для разработки один раз
- `npm run build`: сборки для производства
- `npm run dev-server`: запускает веб-сервер, используемый для разработки

Для запуска отладки на рабочем столе или в сети можно использовать следующие задачи.
- `npm run start desktop`: Запускает Excel на настольном компьютере и сиделоадс надстройку.
- `npm run start web`: Запуск Excel Online и сиделоадс надстройки.
- `npm run stop`: Остановка Excel и отладка.

## <a name="see-also"></a>См. также

* [Метаданные пользовательских функций](custom-functions-json.md)
* [Среда выполнения для пользовательских функций Excel](custom-functions-runtime.md)
* [Рекомендации по пользовательским функциям](custom-functions-best-practices.md)
* [Журнал изменений пользовательских функций](custom-functions-changelog.md)
* [Руководство по настраиваемым функциям в Excel](../tutorials/excel-tutorial-create-custom-functions.md)
