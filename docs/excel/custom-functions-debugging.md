---
title: Отладка пользовательских функций
description: Узнайте, как выполнять отладку Excel пользовательских функций, не использующих общую среду выполнения.
ms.date: 06/15/2022
ms.localizationpriority: medium
ms.openlocfilehash: 1c53d73a0356d4f5f9af9bebbb6c34b99dbeb395
ms.sourcegitcommit: d8fbe472b35c758753e5d2e4b905a5973e4f7b52
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/25/2022
ms.locfileid: "66229689"
---
# <a name="custom-functions-debugging"></a>Отладка пользовательских функций

В этой статье рассматривается отладка только для пользовательских функций, **которые не используют [общую среду выполнения](../develop/configure-your-add-in-to-use-a-shared-runtime.md)**. Сведения об отладке надстроек пользовательских функций, использующих общую среду выполнения, см. в разделе "Настройка надстройки Office для использования общей среды выполнения [JavaScript: отладка"](../develop/configure-your-add-in-to-use-a-shared-runtime.md#debug).

[!include[Excel custom functions note](../includes/excel-custom-functions-note.md)]

[!include[Shared runtime note](../includes/shared-runtime-note.md)]

## <a name="requirements"></a>Требования

Этот процесс отладки работает только для пользовательских функций **, которые не используют общую среду выполнения**. Пользовательская функция, которая не использует общую среду выполнения, — это  проект надстройки пользовательских функций Excel, созданный с помощью генератора [Yeoman](../develop/yeoman-generator-overview.md) для Office надстроек.

Этот процесс отладки не работает с проектами, созданными с помощью проекта надстройки Office, содержащей параметр только манифеста в генераторе Yeoman. Скрипты, на которые ссылается далее в этой статье, не устанавливаются с этим параметром. Чтобы выполнить отладку надстройки, созданной с помощью этого параметра, ознакомьтесь с инструкциями, приведенными в одной из этих статей.

- [Отладка надстроек с помощью средств разработчика в Microsoft Edge (на основе Chromium)](../testing/debug-add-ins-using-devtools-edge-chromium.md)
- [Отладка надстроек с помощью средств разработчика в Internet Explorer](../testing/debug-add-ins-using-f12-tools-ie.md)
- [Отладка надстроек Office на Mac](../testing/debug-office-add-ins-on-ipad-and-mac.md)

Используйте следующие ссылки привязки, чтобы просмотреть разделы этой статьи, относящиеся к вашему сценарию отладки.

На Windows:

- [Excel desktop и Visual Studio Code (VS Code)](#use-the-vs-code-debugger-for-excel-desktop)
- [Excel в Интернете и VS Code отладчика](#use-the-vs-code-debugger-for-excel-in-microsoft-edge)
- [Excel в Интернете и средства браузера](#use-the-browser-developer-tools-to-debug-custom-functions-in-excel-on-the-web)
- [Командная строка](#use-the-command-line-tools-to-debug)

На Компьютере Mac:

- [Excel в Интернете и средства браузера](#use-the-browser-developer-tools-to-debug-custom-functions-in-excel-on-the-web)
- [Командная строка](#use-the-command-line-tools-to-debug)

> [!NOTE]
> Для простоты в этой статье показана отладка в контексте использования Visual Studio Code для редактирования, выполнения задач и в некоторых случаях использования представления отладки. Если вы используете другой редактор или средство командной строки, см. [](#commands-for-building-and-running-your-add-in) инструкции командной строки в конце этой статьи.

## <a name="use-the-vs-code-debugger-for-excel-desktop"></a>Использование отладчика VS Code для Excel Desktop

Вы можете использовать VS Code для отладки пользовательских функций, которые не используют общую среду выполнения Office Excel на рабочем столе.

> [!IMPORTANT]
> Существует известная проблема со следующими шагами отладки. Эти действия работают для проекта, установленного с параметром проекта надстройки **настраиваемых** функций Excel в генераторе Yeoman с **TypeScript**, выбранным в качестве типа скрипта, но шаги не работают для проекта, установленного с **JavaScript**, выбранным в качестве типа скрипта. Дополнительные сведения см. в статье о проблеме [OfficeDev/office-js-docs-pr No 3355](https://github.com/OfficeDev/office-js-docs-pr/issues/3355).

> [!NOTE]
> Отладка компьютеров для Mac недоступна, но ее можно выполнить с помощью средств браузера и командной строки для отладки [Excel в Интернете.](#use-the-command-line-tools-to-debug)

### <a name="run-your-add-in-from-vs-code"></a>Запуск надстройки из VS Code

1. Откройте корневую папку проекта пользовательских функций [в VS Code](https://code.visualstudio.com/).
1. Выберите **терминал > выполнить задачу и** введите или выберите " **Контрольные значения"**. Это позволит отслеживать и перестраивать любые изменения файлов.
1. Выберите **терминал > выполнить задачу и** введите или выберите **Dev Server**.

### <a name="start-the-vs-code-debugger"></a>Запуск VS Code отладчика

1. Выберите **команду ">" или** введите **клавиши CTRL+SHIFT+D,** чтобы переключиться в режим отладки.
1. From the **Run and Debug** drop-down menu, choose **Excel Desktop (Custom Functions)**.

    :::image type="content" source="../images/custom-functions-run-and-debug-menu.jpg" alt-text="Снимок экрана: Excel Desktop (Пользовательские функции) в раскрывающемся меню &quot;Запуск и отладка&quot;.":::

1. Чтобы **начать отладку** , нажмите клавишу F5 (или > **->** начать отладку в меню). Откроется новая Excel, в которую надстройка уже загружена и готова к использованию.

### <a name="start-debugging"></a>Начало отладки

1. В VS Code откройте файл скрипта исходного кода (**functions.js** **functions.ts**).
2. [Установите точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции.
3. В Excel введите формулу, использующую пользовательскую функцию.

На этом этапе выполнение остановится в строке кода, в которой задается точка останова. Теперь вы можете выполнять пошаговые инструкции по коду, задавать контрольные значения и использовать VS Code отладки.

## <a name="use-the-vs-code-debugger-for-excel-in-microsoft-edge"></a>Используйте отладчик VS Code для Excel в Microsoft Edge

Вы можете использовать VS Code для отладки пользовательских функций, которые не используют общую среду выполнения Excel в Microsoft Edge браузере. Чтобы использовать VS Code с Microsoft Edge, необходимо установить расширение [Microsoft Edge DevTools для Visual Studio Code](/microsoft-edge/visual-studio-code/microsoft-edge-devtools-extension).

### <a name="run-your-add-in-from-vs-code"></a>Запуск надстройки из VS Code

1. Откройте корневую папку проекта пользовательских функций [в VS Code](https://code.visualstudio.com/).
1. Выберите **терминал > выполнить задачу и** введите или выберите " **Контрольные значения"**. Это позволит отслеживать и перестраивать любые изменения файлов.
1. Выберите **терминал > выполнить задачу и** введите или выберите **Dev Server**.

### <a name="start-the-vs-code-debugger"></a>Запуск VS Code отладчика

1. Выберите **команду ">" или** введите **клавиши CTRL+SHIFT+D,** чтобы переключиться в режим отладки.
1. В параметрах отладки выберите Office **Online (Edge Chromium)**.
1. Откройте Excel в Microsoft Edge браузере и создайте новую книгу.
1. Выберите **"Поделиться** " на ленте и скопируйте ссылку на URL-адрес новой книги.
1. Нажмите **клавишу F5** (или > **запустить** отладку из меню), чтобы начать отладку. Появится запрос с запросом URL-адреса документа.
1. Вставьте URL-адрес книги и нажмите клавишу ВВОД.

### <a name="sideload-your-add-in"></a>Загрузка неопубликованной надстройки

1. Выберите **вкладку "** Вставка" на ленте  и в разделе "Надстройки **" Office надстройки**.
2. В **диалоговом Office** надстройки выберите вкладку **"** МОИ НАДСТРОЙКИ", выберите "Управление моими надстройками" и "Отправить мои надстройки **"**.
  
    ![Диалоговое Office надстроек с раскрывающимся списком в правом верхнем углу с текстом "Управление надстройки" и раскрывающимся списком под ним с параметром "Отправить мою надстройку".](../images/office-add-ins-my-account.png)

3. **Перейдите** к файлу манифеста надстройки и выберите "Отправить **"**.
  
    ![Диалоговое окно отправки надстройки с кнопками "Обзор", "Отправить" и "Отмена"](../images/upload-add-in.png)

### <a name="set-breakpoints"></a>Задание точек останова

1. В VS Code откройте файл скрипта исходного кода (**functions.js** **functions.ts**).
2. [Установите точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции.
3. В Excel введите формулу, использующую пользовательскую функцию.

## <a name="use-the-browser-developer-tools-to-debug-custom-functions-in-excel-on-the-web"></a>Использование средств разработчика браузера для отладки пользовательских функций в Excel в Интернете

Средства разработчика браузера можно использовать для отладки пользовательских функций, которые не используют общую среду выполнения в Excel в Интернете. Следующие шаги работают как для Windows, так и для macOS.

### <a name="run-your-add-in-from-visual-studio-code"></a>Запуск надстройки из Visual Studio Code

1. Откройте корневую папку проекта пользовательских функций [в Visual Studio Code (VS Code)](https://code.visualstudio.com/).
2. Выберите **терминал > выполнить задачу и** введите или выберите " **Контрольные значения"**. Это позволит отслеживать и перестраивать любые изменения файлов.
3. Выберите **терминал > выполнить задачу и** введите или выберите **Dev Server**.

### <a name="sideload-your-add-in"></a>Загрузка неопубликованной надстройки

1. Откройте [Office в Интернете](https://office.live.com/).
2. Откройте новую Excel книге.
3. Откройте **вкладку "** Вставка" на ленте и  в разделе "Надстройки" выберите Office **надстройки**.
4. В **диалоговом Office** надстройки выберите вкладку **"** МОИ НАДСТРОЙКИ", выберите "Управление моими надстройками" и "Отправить мои надстройки **"**.
  
    ![Диалоговое Office надстроек с раскрывающимся списком в правом верхнем углу с текстом "Управление надстройки" и раскрывающимся списком под ним с параметром "Отправить мою надстройку".](../images/office-add-ins-my-account.png)

5. **Найдите** файл манифеста надстройки и выберите **Отправить**.
  
    ![Диалоговое окно отправки надстройки с кнопками "Обзор", "Отправить" и "Отмена"](../images/upload-add-in.png)

> [!NOTE]
> После загрузки неопубликованного документа он будет оставаться загруженным при каждом открытии документа.

### <a name="start-debugging"></a>Начало отладки

1. Откройте средства разработчика в браузере. Для Chrome и большинства браузеров F12 откроет средства разработчика.
2. В средствах разработчика откройте файл скрипта исходного кода, используя **cmd+P** или **CTRL+P** (**functions.js** **functions.ts**).
3. [Установите точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции. 

Если необходимо изменить код, можно внести изменения в VS Code сохранить изменения. Обновите браузер, чтобы увидеть загруженные изменения.

## <a name="use-the-command-line-tools-to-debug"></a>Использование средств командной строки для отладки

Если вы не используете VS Code, для запуска надстройки можно использовать командную строку (например, bash или PowerShell). Вам потребуется использовать средства разработчика браузера для отладки кода в Excel в Интернете. Нельзя выполнить отладку классических версий Excel с помощью командной строки.

1. Выполните командную строку, `npm run watch` чтобы отслеживать и перестраивать изменения кода.
2. Откройте второе окно командной строки (первое из них будет заблокировано при запуске контрольных значений).

3. Если вы хотите запустить надстройку в настольной версии Excel, выполните следующую команду.
  
    `npm run start:desktop`
  
    Или если вы предпочитаете запустить надстройку в Excel в Интернете выполните следующую команду.
  
    `npm run start:web -- --document {url}`(где `{url}` НАХОДИТСЯ URL-адрес Excel в OneDrive или SharePoint)
  
    Если надстройка не загружена неопубликованным документом, выполните действия, описанные в разделе "Загрузка неопубликоваемой надстройки", чтобы загрузить неопубликованную надстройку.[](#sideload-your-add-in) Затем перейдите к следующему разделу, чтобы начать отладку.
  
4. Откройте средства разработчика в браузере. Для Chrome и большинства браузеров F12 откроет средства разработчика.
5. В средствах разработчика откройте файл скрипта исходного кода (**functions.js** **functions.ts**). Код пользовательских функций может находиться в конце файла.
6. В исходном коде пользовательской функции примените точку останова, выбрав строку кода.

Если вам нужно изменить код, можно внести изменения в Visual Studio и сохранить изменения. Обновите браузер, чтобы увидеть загруженные изменения.

### <a name="commands-for-building-and-running-your-add-in"></a>Команды для сборки и запуска надстройки

Доступно несколько задач сборки.

- `npm run watch`: сборки для разработки и автоматическое перестроение при сохранении исходного файла
- `npm run build-dev`: сборки для разработки один раз
- `npm run build`: сборки для рабочей среды
- `npm run dev-server`: запускает веб-сервер, используемый для разработки.

Для запуска отладки на рабочем столе или в сети можно использовать следующие задачи.

- `npm run start:desktop`: запускает Excel на рабочем столе и загрузку неопубликоваемой надстройки.
- `npm run start:web -- --document {url}`(где `{url}` url-адрес файла Excel в OneDrive или SharePoint): запускает Excel в Интернете и загрузку неопубликоваемой надстройки.
- `npm run stop`: останавливает Excel и отладку.

## <a name="next-steps"></a>Дальнейшие действия

Сведения о [проверке подлинности для пользовательских функций без общей среды выполнения](custom-functions-authentication.md).

## <a name="see-also"></a>См. также

* [Устранение неполадок с пользовательскими функциями](custom-functions-troubleshooting.md)
* [Обработка ошибок в пользовательских функциях Excel](custom-functions-errors.md)
* [Создание пользовательских функций в Excel](custom-functions-overview.md)
