---
title: Отладка пользовательских функций в не общей среде выполнения
description: Узнайте, как выполнять отладку пользовательских функций Excel, которые не используют общую среду выполнения.
ms.date: 07/11/2022
ms.localizationpriority: medium
ms.openlocfilehash: 4e9a1c7c521838b65d2df8d75e8eea5643b0a80b
ms.sourcegitcommit: 9bb790f6264f7206396b32a677a9133ab4854d4e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2022
ms.locfileid: "66797640"
---
# <a name="custom-functions-debugging"></a>Отладка пользовательских функций

В этой статье рассматривается отладка только для пользовательских функций, **которые не используют [общую среду выполнения](../develop/configure-your-add-in-to-use-a-shared-runtime.md)**. Сведения об отладке надстроек пользовательских функций, использующих общую среду выполнения, см. в разделе "Настройка надстройки Office для использования общей среды выполнения [JavaScript: отладка"](../develop/configure-your-add-in-to-use-a-shared-runtime.md#debug).

[!include[Excel custom functions note](../includes/excel-custom-functions-note.md)]

[!include[Shared runtime note](../includes/shared-runtime-note.md)]

> [!TIP]
> Этот процесс отладки не работает с проектами, созданными с помощью проекта надстройки Office, содержащего параметр **"** Только манифест" в генераторе Yeoman. Скрипты, на которые ссылается далее в этой статье, не устанавливаются с этим параметром. Инструкции по отладке надстройки, созданной с помощью этого параметра, см. в следующих статьях.
>
> - [Отладка надстроек с помощью средств разработчика в Microsoft Edge (на основе Chromium)](../testing/debug-add-ins-using-devtools-edge-chromium.md)
> - [Отладка надстроек с помощью средств разработчика в Internet Explorer](../testing/debug-add-ins-using-f12-tools-ie.md)
> - [Отладка надстроек Office на Mac](../testing/debug-office-add-ins-on-ipad-and-mac.md)

Процесс отладки пользовательской функции для надстроек, которые не используют общую среду выполнения, зависит от целевой платформы (Windows, Mac или Интернета), независимо от того, используете ли вы Visual Studio Code или другую интегрированную среду разработки, а также операционную систему компьютера разработки. Используйте ссылки в следующей таблице, чтобы просмотреть разделы этой статьи, относящиеся к вашему сценарию отладки. В этой таблице "CF-NSR" относится к пользовательским функциям в среде выполнения, которая не является общей.

| **Целевая платформа** | **Visual Studio Code** | **Другая интегрированная среда разработки** |
|--------------|-------------|-------------|
| Excel для Windows | [Использование отладчика VS Code для Excel в Windows](#use-the-vs-code-debugger-for-excel-on-windows) | Отладка CF-NSR за пределами VS Code не поддерживается. Отладка Excel в Интернете. |
| Excel в Интернете | Компьютер разработки Windows: [использование отладчика VS Code для Excel в Microsoft Edge](#use-the-vs-code-debugger-for-excel-in-microsoft-edge)</br>Компьютер разработки Для Mac или Windows: [использование VS Code и средств разработки браузера](#use-the-browser-developer-tools-to-debug-custom-functions-in-excel-on-the-web) | [Использование средств командной строки](#use-the-command-line-tools-to-debug)|
| Excel для Mac |  Отладка VS Code CF-NSR не поддерживается. Отладка Excel в Интернете. | [Использование средств командной строки](#use-the-command-line-tools-to-debug)|

> [!NOTE]
> В этой статье в основном показана отладка в контексте использования Visual Studio Code для редактирования, выполнения задач и использования представления отладки. Если вы используете другой редактор или средство командной строки, см. [](#commands-for-building-and-running-your-add-in) раздел "Команды для создания и запуска надстройки" в конце этой статьи.

## <a name="use-the-vs-code-debugger-for-excel-on-windows"></a>Использование отладчика VS Code для Excel в Windows

Vs Code можно использовать для отладки пользовательских функций, которые не используют общую среду выполнения в Office Excel на рабочем столе.

> [!IMPORTANT]
> Существует известная проблема со следующими шагами отладки. Шаги работают для проекта, установленного с параметром надстройки пользовательских функций **Excel** в генераторе Yeoman с **TypeScript** , выбранным в качестве типа скрипта, но шаги не работают для проекта, установленного с **JavaScript** , выбранным в качестве типа скрипта. Дополнительные сведения см. в статье о проблеме [OfficeDev/office-js-docs-pr No 3355](https://github.com/OfficeDev/office-js-docs-pr/issues/3355).

### <a name="run-your-add-in-from-vs-code"></a>Запуск надстройки из VS Code

1. Откройте корневую папку проекта пользовательских функций в [VS Code](https://code.visualstudio.com/).
1. Выберите **терминал > выполнить задачу и** введите или выберите " **Контрольные значения"**. Это позволит отслеживать и перестраивать любые изменения файлов.
1. Выберите **терминал > выполнить задачу и** введите или выберите **Dev Server**.

### <a name="start-the-vs-code-debugger"></a>Запуск отладчика VS Code

1. Выберите **команду ">" или** введите **клавиши CTRL+SHIFT+D,** чтобы переключиться в режим отладки.
1. В **раскрывающемся меню "Запуск и отладка** " выберите "Рабочий стол **Excel (пользовательские функции)"**.

    :::image type="content" source="../images/custom-functions-run-and-debug-menu.jpg" alt-text="Снимок экрана: рабочий стол Excel (пользовательские функции) в раскрывающемся меню &quot;Запуск и отладка&quot;.":::

1. Чтобы **начать отладку** , нажмите клавишу F5 (или > **->** начать отладку в меню). Откроется новая книга Excel с уже загруженной и готовой к использованию надстройке.

### <a name="start-debugging"></a>Начало отладки

1. В VS Code откройте файл скрипта исходного кода (**functions.js** **functions.ts**).
2. [Установите точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции.
3. В книге Excel введите формулу, использующую пользовательскую функцию.

На этом этапе выполнение остановится в строке кода, в которой задается точка останова. Теперь вы можете выполнять пошаговые инструкции по коду, устанавливать контрольные значения и использовать все необходимые функции отладки VS Code.

## <a name="use-the-vs-code-debugger-for-excel-in-microsoft-edge"></a>Использование отладчика VS Code для Excel в Microsoft Edge

Vs Code можно использовать для отладки пользовательских функций, которые не используют общую среду выполнения в Excel в браузере Microsoft Edge. Чтобы использовать VS Code с Microsoft Edge, необходимо установить расширение [Microsoft Edge DevTools для Visual Studio Code](/microsoft-edge/visual-studio-code/microsoft-edge-devtools-extension).

### <a name="run-your-add-in-from-vs-code"></a>Запуск надстройки из VS Code

1. Откройте корневую папку проекта пользовательских функций в [VS Code](https://code.visualstudio.com/).
1. Выберите **терминал > выполнить задачу и** введите или выберите " **Контрольные значения"**. Это позволит отслеживать и перестраивать любые изменения файлов.
1. Выберите **терминал > выполнить задачу и** введите или выберите **Dev Server**.

### <a name="start-the-vs-code-debugger"></a>Запуск отладчика VS Code

1. Выберите **команду ">" или** введите **клавиши CTRL+SHIFT+D,** чтобы переключиться в режим отладки.
1. В списке параметров отладки выберите **Office Online (edge Chromium)**.
1. Откройте Excel в браузере Microsoft Edge и создайте новую книгу.
1. Выберите **"Поделиться** " на ленте и скопируйте ссылку на URL-адрес новой книги.
1. Нажмите **клавишу F5** (или > **запустить** отладку из меню), чтобы начать отладку. Появится запрос с запросом URL-адреса документа.
1. Вставьте URL-адрес книги и нажмите клавишу ВВОД.

### <a name="sideload-your-add-in"></a>Загрузка неопубликованной надстройки

1. Выберите **вкладку "** Вставка" на ленте  и в разделе "Надстройки" выберите **надстройки Office**.
2. В **диалоговом** окне "Надстройки Office" откройте вкладку "МОИ НАДСТРОЙКИ", выберите "Управление моими надстройками" и "Отправить **мои надстройки"**.
  
    ![Диалоговое окно надстроек Office с раскрывающимся списком в правом верхнем углу с текстом "Управление надстройки" и раскрывающимся списком под ним с параметром "Отправить мою надстройку".](../images/office-add-ins-my-account.png)

3. **Перейдите** к файлу манифеста надстройки и выберите "Отправить **"**.
  
    ![Диалоговое окно отправки надстройки с кнопками "Обзор", "Отправить" и "Отмена"](../images/upload-add-in.png)

### <a name="set-breakpoints"></a>Задание точек останова

1. В VS Code откройте файл скрипта исходного кода (**functions.js** **functions.ts**).
2. [Установите точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции.
3. В книге Excel введите формулу, использующую пользовательскую функцию.

## <a name="use-the-browser-developer-tools-to-debug-custom-functions-in-excel-on-the-web"></a>Использование средств разработчика браузера для отладки пользовательских функций в Excel в Интернете

Средства разработчика браузера можно использовать для отладки пользовательских функций, которые не используют общую среду выполнения в Excel в Интернете. Следующие действия работают как для Windows, так и для macOS.

### <a name="run-your-add-in-from-visual-studio-code"></a>Запуск надстройки из Visual Studio Code

1. Откройте корневую папку проекта пользовательских функций [в Visual Studio Code (VS Code).](https://code.visualstudio.com/)
2. Выберите **терминал > выполнить задачу и** введите или выберите " **Контрольные значения"**. Это позволит отслеживать и перестраивать любые изменения файлов.
3. Выберите **терминал > выполнить задачу и** введите или выберите **Dev Server**.

### <a name="sideload-your-add-in"></a>Загрузка неопубликованной надстройки

1. Откройте [Office в Интернете](https://office.live.com/).
2. Откройте новую книгу Excel.
3. Откройте **вкладку "** Вставка" на ленте и  в разделе "Надстройки" выберите **надстройки Office**.
4. В **диалоговом** окне "Надстройки Office" откройте вкладку "МОИ НАДСТРОЙКИ", выберите "Управление моими надстройками" и "Отправить **мои надстройки"**.
  
    ![Диалоговое окно надстроек Office с раскрывающимся списком в правом верхнем углу с текстом "Управление надстройки" и раскрывающимся списком под ним с параметром "Отправить мою надстройку".](../images/office-add-ins-my-account.png)

5. **Найдите** файл манифеста надстройки и выберите **Отправить**.
  
    ![Диалоговое окно отправки надстройки с кнопками "Обзор", "Отправить" и "Отмена"](../images/upload-add-in.png)

> [!NOTE]
> После загрузки неопубликованного документа он будет оставаться загруженным при каждом открытии документа.

### <a name="start-debugging"></a>Начало отладки

1. Откройте средства разработчика в браузере. Для Chrome и большинства браузеров F12 откроет средства разработчика.
2. В средствах разработчика откройте файл скрипта исходного кода, используя **cmd+P** или **CTRL+P** (**functions.js** **functions.ts**).
3. [Установите точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции. 

Если необходимо изменить код, можно внести изменения в VS Code и сохранить изменения. Обновите браузер, чтобы увидеть загруженные изменения.

## <a name="use-the-command-line-tools-to-debug"></a>Использование средств командной строки для отладки

Если вы не используете VS Code, для запуска надстройки можно использовать командную строку (например, bash или PowerShell). Вам потребуется использовать средства разработчика браузера для отладки кода в Excel в Интернете. Вы не можете выполнить отладку классической версии Excel с помощью командной строки.

1. Выполните командную строку, `npm run watch` чтобы отслеживать и перестраивать изменения кода.
2. Откройте второе окно командной строки (первое из них будет заблокировано при запуске контрольных значений).

3. Если вы хотите запустить надстройку в классической версии Excel, выполните следующую команду.
  
    `npm run start:desktop`
  
    Или если вы предпочитаете запустить надстройку в Excel в Интернете выполните следующую команду.
  
    `npm run start:web -- --document {url}` (где `{url}` находится URL-адрес файла Excel в OneDrive или SharePoint)
  
    Если надстройка не загружена неопубликованным документом, выполните [](#sideload-your-add-in) действия, описанные в разделе "Загрузка неопубликоваемой надстройки", чтобы загрузить неопубликованную надстройку. Затем перейдите к следующему разделу, чтобы начать отладку.
  
4. Откройте средства разработчика в браузере. Для Chrome и большинства браузеров F12 откроет средства разработчика.
5. В средствах разработчика откройте файл скрипта исходного кода (**functions.js** **functions.ts**). Код пользовательских функций может находиться в конце файла.
6. В исходном коде пользовательской функции примените точку останова, выбрав строку кода.

Если необходимо изменить код, можно внести изменения в Visual Studio и сохранить изменения. Обновите браузер, чтобы увидеть загруженные изменения.

### <a name="commands-for-building-and-running-your-add-in"></a>Команды для сборки и запуска надстройки

Доступно несколько задач сборки.

- `npm run watch`: сборки для разработки и автоматическое перестроение при сохранении исходного файла
- `npm run build-dev`: сборки для разработки один раз
- `npm run build`: сборки для рабочей среды
- `npm run dev-server`: запускает веб-сервер, используемый для разработки.

Для запуска отладки на рабочем столе или в сети можно использовать следующие задачи.

- `npm run start:desktop`: запускает Excel на рабочем столе и загрузка неопубликоваемой надстройки.
- `npm run start:web -- --document {url}`(где `{url}` находится URL-адрес файла Excel в OneDrive или SharePoint): запускает Excel в Интернете и загрузку неопубликоваемой надстройки.
- `npm run stop`: останавливает Excel и отладку.

## <a name="next-steps"></a>Дальнейшие действия

Сведения о [проверке подлинности для пользовательских функций без общей среды выполнения](custom-functions-authentication.md).

## <a name="see-also"></a>См. также

* [Устранение неполадок с пользовательскими функциями](custom-functions-troubleshooting.md)
* [Обработка ошибок в пользовательских функциях Excel](custom-functions-errors.md)
* [Создание пользовательских функций в Excel](custom-functions-overview.md)
