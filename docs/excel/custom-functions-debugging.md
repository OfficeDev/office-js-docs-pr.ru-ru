---
title: Отладка пользовательских функций без пользовательского интерфейса
description: Узнайте, как выполнять отладку пользовательских функций Excel, которые не используют область задач.
ms.date: 05/31/2022
ms.localizationpriority: medium
ms.openlocfilehash: 1268aa07d160970fda12f8fccbe88e0427b246fc
ms.sourcegitcommit: 81f6018ac9731ff73e36d30f5ff10df21504c093
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2022
ms.locfileid: "65891930"
---
# <a name="ui-less-custom-functions-debugging"></a>Отладка пользовательских функций без пользовательского интерфейса

В этой статье рассматривается отладка только  для пользовательских функций, которые не используют область задач или другие элементы пользовательского интерфейса (пользовательские функции без пользовательского интерфейса).

[!include[Excel custom functions note](../includes/excel-custom-functions-note.md)]

[!include[Shared runtime note](../includes/shared-runtime-note.md)]

В Windows:

- [Отладчик Excel Desktop и Visual Studio Code (VS Code)](#use-the-vs-code-debugger-for-excel-desktop)
- [Excel в Интернете и отладчик VS Code](#use-the-vs-code-debugger-for-excel-in-microsoft-edge)
- [Средства Excel в Интернете и браузере](#use-the-browser-developer-tools-to-debug-custom-functions-in-excel-on-the-web)
- [Командная строка](#use-the-command-line-tools-to-debug)

На Компьютере Mac:

- [Средства Excel в Интернете и браузере](#use-the-browser-developer-tools-to-debug-custom-functions-in-excel-on-the-web)
- [Командная строка](#use-the-command-line-tools-to-debug)

> [!NOTE]
> Для простоты в этой статье показана отладка в контексте использования Visual Studio Code для редактирования, выполнения задач и в некоторых случаях использования представления отладки. Если вы используете другой редактор или средство командной строки, см. [](#commands-for-building-and-running-your-add-in) инструкции командной строки в конце этой статьи.

## <a name="requirements"></a>Требования

Этот процесс отладки работает **только** для пользовательских функций без пользовательского интерфейса, которые не используют область задач или другие элементы пользовательского интерфейса. Чтобы создать пользовательскую функцию без пользовательского интерфейса, выполните действия, описанные в руководстве по созданию пользовательских функций в [Excel](../tutorials/excel-tutorial-create-custom-functions.md) , а затем удалите все элементы области задач и пользовательского интерфейса, установленные генератором [Yeoman](../develop/yeoman-generator-overview.md) для надстроек Office.

Обратите внимание, что этот процесс отладки несовместим с проектами пользовательских функций с использованием общей [среды выполнения](../develop/configure-your-add-in-to-use-a-shared-runtime.md).

Этот процесс отладки не работает с проектами, созданными с помощью проекта надстройки Office, содержащего параметр **"** Только манифест" в генераторе Yeoman. Скрипты, на которые ссылается далее в этой статье, не устанавливаются с этим параметром. Чтобы выполнить отладку надстройки, созданной с помощью этого параметра, ознакомьтесь с инструкциями, приведенными в одной из этих статей. 

- [Отладка надстроек с помощью средств разработчика в Microsoft Edge (на основе Chromium)](../testing/debug-add-ins-using-devtools-edge-chromium.md)
- [Отладка надстроек с помощью средств разработчика в Internet Explorer](../testing/debug-add-ins-using-f12-tools-ie.md)
- [Отладка надстроек Office на Mac](../testing/debug-office-add-ins-on-ipad-and-mac.md)

## <a name="use-the-vs-code-debugger-for-excel-desktop"></a>Использование отладчика VS Code для классического приложения Excel

Vs Code можно использовать для отладки пользовательских функций без пользовательского интерфейса в Office Excel на рабочем столе.

> [!NOTE]
> Отладка компьютеров для Mac недоступна, но ее можно выполнить с помощью средств браузера и командной строки для отладки [Excel в Интернете](#use-the-command-line-tools-to-debug).

### <a name="run-your-add-in-from-vs-code"></a>Запуск надстройки из VS Code

1. Откройте корневую папку проекта пользовательских функций в [VS Code](https://code.visualstudio.com/).
1. Выберите **терминал > выполнить задачу и** введите или выберите " **Контрольные значения"**. Это позволит отслеживать и перестраивать любые изменения файлов.
1. Выберите **терминал > выполнить задачу и** введите или выберите **Dev Server**.

### <a name="start-the-vs-code-debugger"></a>Запуск отладчика VS Code

1. Выберите **команду ">" или** введите **клавиши CTRL+SHIFT+D,** чтобы переключиться в режим отладки.
1. В раскрывающемся меню "Запуск" выберите " **Рабочий стол Excel (пользовательские функции)"**.
1. Чтобы **начать отладку** , нажмите клавишу F5 (или > **->** начать отладку в меню). Откроется новая книга Excel с уже загруженной и готовой к использованию надстройке.

### <a name="start-debugging"></a>Начало отладки

1. В VS Code откройте файл скрипта исходного кода (**functions.js** **functions.ts**).
2. [Установите точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции.
3. В книге Excel введите формулу, использующую пользовательскую функцию.

На этом этапе выполнение остановится в строке кода, в которой задается точка останова. Теперь вы можете выполнять пошаговые инструкции по коду, устанавливать контрольные значения и использовать все необходимые функции отладки VS Code.

## <a name="use-the-vs-code-debugger-for-excel-in-microsoft-edge"></a>Использование отладчика VS Code для Excel в Microsoft Edge

Vs Code можно использовать для отладки пользовательских функций без пользовательского интерфейса в Excel в браузере Microsoft Edge. Чтобы использовать VS Code с Microsoft Edge, необходимо установить расширение [Microsoft Edge DevTools для Visual Studio Code](/microsoft-edge/visual-studio-code/microsoft-edge-devtools-extension).

### <a name="run-your-add-in-from-vs-code"></a>Запуск надстройки из VS Code

1. Откройте корневую папку проекта пользовательских функций в [VS Code](https://code.visualstudio.com/).
2. Выберите **терминал > выполнить задачу и** введите или выберите " **Контрольные значения"**. Это позволит отслеживать и перестраивать любые изменения файлов.
3. Выберите **терминал > выполнить задачу и** введите или выберите **Dev Server**.

### <a name="start-the-vs-code-debugger"></a>Запуск отладчика VS Code

1. Выберите **команду ">" или** введите **клавиши CTRL+SHIFT+D,** чтобы переключиться в режим отладки.
1. В списке параметров отладки выберите **Office Online (Edge Chromium).**
1. Откройте Excel в браузере Microsoft Edge и создайте новую книгу.
1. Выберите **"Поделиться** " на ленте и скопируйте ссылку на URL-адрес новой книги.
1. Нажмите **клавишу F5** (или > **запустить** отладку из меню), чтобы начать отладку. Появится запрос с запросом URL-адреса документа.
1. Вставьте URL-адрес книги и нажмите клавишу ВВОД.

### <a name="sideload-your-add-in"></a>Загрузка неопубликованной надстройки

1. Выберите **вкладку "** Вставка" на ленте  и в разделе "Надстройки" выберите **надстройки Office**.
2. В **диалоговом** окне "Надстройки Office" откройте вкладку "МОИ НАДСТРОЙКИ", выберите "Управление моими надстройками" и "Отправить **мои надстройки"**.
  
    ![Диалоговое окно надстроек Office с раскрывающимся списком в правом верхнем углу с текстом "Управление надстройки" и раскрывающимся списком под ним с параметром "Отправить мою надстройку".](../images/office-add-ins-my-account.png)

3. **Перейдите** к файлу манифеста надстройки и выберите "Отправить **"**.
  
    ![Диалоговое окно отправки надстройки с кнопками "Обзор", "Отправить" и "Отмена"](../images/upload-add-in.png)

### <a name="set-breakpoints"></a>Задание точек останова

1. В VS Code откройте файл скрипта исходного кода (**functions.js** **functions.ts**).
2. [Установите точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции.
3. В книге Excel введите формулу, использующую пользовательскую функцию.

## <a name="use-the-browser-developer-tools-to-debug-custom-functions-in-excel-on-the-web"></a>Использование средств разработчика браузера для отладки пользовательских функций в Excel в Интернете

Вы можете использовать средства разработчика браузера для отладки пользовательских функций без пользовательского интерфейса в Excel в Интернете. Следующие действия работают как для Windows, так и для macOS.

### <a name="run-your-add-in-from-visual-studio-code"></a>Запуск надстройки из Visual Studio Code

1. Откройте корневую папку проекта пользовательских функций в [Visual Studio Code (VS Code).](https://code.visualstudio.com/)
2. Выберите **терминал > выполнить задачу и** введите или выберите " **Контрольные значения"**. Это позволит отслеживать и перестраивать любые изменения файлов.
3. Выберите **терминал > выполнить задачу и** введите или выберите **Dev Server**.

### <a name="sideload-your-add-in"></a>Загрузка неопубликованной надстройки

1. Откройте [Office в Интернете](https://office.live.com/).
2. Откройте новую книгу Excel.
3. Откройте **вкладку "** Вставка" на ленте и  в разделе "Надстройки" выберите **надстройки Office**.
4. В **диалоговом** окне "Надстройки Office" откройте вкладку "МОИ НАДСТРОЙКИ", выберите "Управление моими надстройками" и "Отправить **мои надстройки"**.
  
    ![Диалоговое окно надстроек Office с раскрывающимся списком в правом верхнем углу с текстом "Управление надстройки" и раскрывающимся списком под ним с параметром "Отправить мою надстройку".](../images/office-add-ins-my-account.png)

5. **Найдите** файл манифеста надстройки и выберите **Отправить**.
  
    ![Диалоговое окно отправки надстройки с кнопками "Обзор", "Отправить" и "Отмена"](../images/upload-add-in.png)

> [!NOTE]
> После загрузки неопубликованного документа он будет оставаться загруженным при каждом открытии документа.

### <a name="start-debugging"></a>Начало отладки

1. Откройте средства разработчика в браузере. Для Chrome и большинства браузеров F12 откроет средства разработчика.
2. В средствах разработчика откройте файл скрипта исходного кода, используя **cmd+P** или **CTRL+P** (**functions.js** **functions.ts**).
3. [Установите точку останова](https://code.visualstudio.com/Docs/editor/debugging#_breakpoints) в исходном коде пользовательской функции. 

Если необходимо изменить код, можно внести изменения в VS Code и сохранить изменения. Обновите браузер, чтобы увидеть загруженные изменения.

## <a name="use-the-command-line-tools-to-debug"></a>Использование средств командной строки для отладки

Если вы не используете VS Code, для запуска надстройки можно использовать командную строку (например, bash или PowerShell). Вам потребуется использовать средства разработчика браузера для отладки кода в Excel в Интернете. Вы не можете выполнить отладку классической версии Excel с помощью командной строки.

1. Выполните командную строку, `npm run watch` чтобы отслеживать и перестраивать изменения кода.
2. Откройте второе окно командной строки (первое из них будет заблокировано при запуске контрольных значений).

3. Если вы хотите запустить надстройку в классической версии Excel, выполните следующую команду.
  
    `npm run start:desktop`
  
    Если вы предпочитаете запустить надстройку в Excel в Интернете, выполните следующую команду.
  
    `npm run start:web -- --document {url}` (где `{url}` находится URL-адрес файла Excel в OneDrive или SharePoint)
  
    Если надстройка не загружена неопубликованным документом, выполните действия, описанные в разделе "Загрузка неопубликоваемой надстройки", чтобы загрузить неопубликованную надстройку.[](#sideload-your-add-in) Затем перейдите к следующему разделу, чтобы начать отладку.
  
4. Откройте средства разработчика в браузере. Для Chrome и большинства браузеров F12 откроет средства разработчика.
5. В средствах разработчика откройте файл скрипта исходного кода (**functions.js** **functions.ts**). Код пользовательских функций может находиться в конце файла.
6. В исходном коде пользовательской функции примените точку останова, выбрав строку кода.

Если необходимо изменить код, можно внести изменения в Visual Studio и сохранить изменения. Обновите браузер, чтобы увидеть загруженные изменения.

### <a name="commands-for-building-and-running-your-add-in"></a>Команды для сборки и запуска надстройки

Доступно несколько задач сборки.

- `npm run watch`: сборки для разработки и автоматическое перестроение при сохранении исходного файла
- `npm run build-dev`: сборки для разработки один раз
- `npm run build`: сборки для рабочей среды
- `npm run dev-server`: запускает веб-сервер, используемый для разработки.

Для запуска отладки на рабочем столе или в сети можно использовать следующие задачи.

- `npm run start:desktop`: запускает Excel на рабочем столе и загрузка неопубликоваемой надстройки.
- `npm run start:web -- --document {url}` (где `{url}` находится URL-адрес файла Excel в OneDrive или SharePoint): запускает Excel в Интернете и загрузка неопубликоваемой надстройки.
- `npm run stop`: останавливает Excel и отладку.

## <a name="next-steps"></a>Дальнейшие действия

Сведения о [методиках проверки подлинности для пользовательских функций без пользовательского интерфейса](custom-functions-authentication.md).

## <a name="see-also"></a>См. также

* [Устранение неполадок с пользовательскими функциями](custom-functions-troubleshooting.md)
* [Обработка ошибок в пользовательских функциях Excel](custom-functions-errors.md)
* [Создание пользовательских функций в Excel](custom-functions-overview.md)
