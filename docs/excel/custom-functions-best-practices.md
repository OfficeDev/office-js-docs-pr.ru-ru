---
ms.date: 10/17/2018
description: Рекомендации и рекомендуемые шаблоны для настраиваемых функций Excel.
title: Рекомендации по настраиваемым функциям
ms.openlocfilehash: 10ba29966c1e991ca23674ce3e5da88de2772e00
ms.sourcegitcommit: a6d6348075c1abed76d2146ddfc099b0151fe403
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2018
ms.locfileid: "25640003"
---
# <a name="custom-functions-best-practices-preview"></a>Рекомендации по настраиваемым функциям (предварительная версия)

В этой статье приводятся рекомендации по разработке настраиваемых функций в Excel.

[!include[Excel custom functions note](../includes/excel-custom-functions-note.md)]

## <a name="error-handling"></a>Обработка ошибок

При построении надстройки, который определяет настраиваемые функции, не забудьте включить логику обработки ошибок, возникающих в среде выполнения, для учетной записи. Обработка ошибок для настраиваемых функций в целом совпадает с [обработкой ошибок для API JavaScript Excel](excel-add-ins-error-handling.md). В следующем образце кода `.catch` будут обработаны все ошибки, возникшие ранее в коде.

```js
function getComment(x) {
  let url = "https://www.contoso.com/comments/" + x;
  return fetch(url)
    .then(function (data) {
      return data.json();
    })
    .then((json) => {
      return json.body;
    })
    .catch(function (error) {
      throw error;
    })
}
```

## <a name="debugging"></a>Отладка

На данный момент наилучшим способом отладки настраиваемых функций Excel является [загрузка неопубликованных](../testing/sideload-office-add-ins-for-testing.md) надстроек в **Excel Online**. После этого отладку настраиваемых функций можно выполнить с помощью [входящего в состав веб-обозревателя средства отладки, вызываемого при нажатии на F12](../testing/debug-add-ins-in-office-online.md), используемого в сочетании со следующими методами:

- Используйте операторы `console.log` в коде настраиваемых функций для отправки выходных данных в консоль в режиме реального времени.

- Используйте `debugger;` операторы в коде настраиваемых функций для указания точек останова, в которых выполнение будет приостановлено, если открыто окно F12. Например, если следующая функция выполняется при открытом окне F12, то ее выполнение будет приостановлено при достижении оператора `debugger;` , что позволит вручную проверить значения параметров до возврата данных функцией. `debugger;` Оператор не оказывает влияния в Excel Online, когда не открыто окно F12. На данный момент `debugger;` оператор не оказывает никакого влияния в Excel для Windows.

    ```js
    function add(first, second){
      debugger;
      return first + second;
    }
    ```

Если надстройку не удалось зарегистрировать, [проверьте правильность настройки сертификатов SSL](https://github.com/OfficeDev/generator-office/blob/master/src/docs/ssl.md) для веб-сервера, на котором размещено приложение надстройки.

При тестировании надстройки в классическом приложении Office 2016 можно включить [регистрацию времени выполнения](../testing/troubleshoot-manifest.md#use-runtime-logging-to-debug-your-add-in) для отладки проблем, связанных с XML-файлом манифеста надстройки, а также использовать несколько условий установки и выполнения.

## <a name="mapping-function-names-to-json-metadata"></a>Сопоставление имен функций с метаданными JSON

Как описано в статье [Обзор настраиваемых функций](custom-functions-overview.md) , проект настраиваемых функций должен включать в себя файл метаданных JSON, который содержит информацию, необходимую Excel для регистрации настраиваемых функций и их предоставления конечным пользователям. Кроме того, в файле JavaScript, которым определяются настраиваемые функции, должна содержаться информация о том, какие объекты функции в файле метаданных JSON соответствуют каждой из настраиваемых функций в файле JavaScript.

Например, приведенный ниже пример кода определяет настраиваемую функцию `add` и указывает, какая функция `add` соответствует объекту в файле метаданных JSON, где значение свойства `id` равно **ADD**.

```js
function add(first, second){
  return first + second;
}

CustomFunctionMappings.ADD = add;
```

При создании настраиваемых функций в файле JavaScript и указании соответствующей информации в файле метаданных JSON принимайте во внимание следующие рекомендации.

* В файле JavaScript укажите имена функций в camelCase. Примером может служить запись имени функции `addTenToInput` в camelCase: первое слово в имени начинается со строчной буквы нижнего регистра, а все последующие — с прописной буквы.

* В файле метаданных JSON укажите прописными буквами значение каждого свойства`name`. Свойство `name`определяет имя функции, которое конечные пользователи видят в Excel. Использование прописных букв для имен всех настраиваемых функций позволяет сформировать согласованное представление в Excel для конечных пользователей, при котором все имена встроенных функций показываются прописными буквами.

* В файле метаданных JSON укажите прописными буквами значение каждого свойства `id`. Такой подход позволяет четко обозначить, какая часть оператора `CustomFunctionMappings` в коде JavaScript соответствует свойству `id` в файле метаданных JSON (при условии, что для имени функции используется camelCase в соответствии с приведенными выше рекомендациями).

* Убедитесь в том, что в файле метаданных JSON значение каждого из свойств `id` содержит только буквы, цифры и точки. 

* Убедитесь в том, что в файле метаданных JSON значение каждого из свойств `id` является уникальным для этого файла. При этом в файле метаданных не должно быть двух объектов функции, имеющих одинаковое значение `id`. Кроме того, не указывайте в файле метаданных два значения `id`, различающиеся только регистром. Например, не используйте для определения одного объекта функции значение `id` равное **add**, а для определения другого — значение `id` равное **ADD**.

* Не изменяйте значение свойства  `id` в файле метаданных JSON после его сопоставления с соответствующим именем функции JavaScript. Имя функции, отображаемое в Excel для конечных пользователей, можно изменить, обновив свойство `name` в файле метаданных JSON, но не следует ни при каких обстоятельствах изменять значение свойства `id` после его установки.

* В файле JavaScript укажите все сопоставления настраиваемых функций для одного и того же расположения. Так, к примеру, в приведенном далее примере кода определяются две настраиваемые функции, а затем указывается информация о сопоставлении для обеих функций.

    ```js
    function add(first, second){
      return first + second;
    }

    function increment(incrementBy, callback) {
      var result = 0;
      var timer = setInterval(function() {
        result += incrementBy;
        callback.setResult(result);
      }, 1000);

      callback.onCanceled = function() {
        clearInterval(timer);
      };
    }

    // map `id` values in the JSON metadata file to JavaScript function names
    CustomFunctionMappings.ADD = add;
    CustomFunctionMappings.INCREMENT = increment;
    ```

    В следующем примере показаны метаданные JSON, соответствующие функциям, определенным в этом примере кода JavaScript.

    ```json
    {
      "$schema": "https://developer.microsoft.com/en-us/json-schemas/office-js/custom-functions.schema.json",
      "functions": [
        {
          "id": "ADD",
          "name": "ADD",
          ...
        },
        {
          "id": "INCREMENT",
          "name": "INCREMENT",
          ...
        }
      ]
    }
    ```

## <a name="additional-considerations"></a>Дополнительные рекомендации

Чтобы создать надстройку, которая будет работать на нескольких платформах (для одного из основных клиентов надстроек Office), вы не должны запрашивать доступ к модели DOM в настраиваемых функциях или использовать библиотеки, такие как jQuery, которые полагаются на DOM. В Excel для Windows настраиваемые функции, использующие [среду выполнения JavaScripte](custom-functions-runtime.md), не могут получить доступ к DOM.

## <a name="see-also"></a>См. также

* [Создание настраиваемых функций в Excel](custom-functions-overview.md)
* [Настраиваемые функции метаданных](custom-functions-json.md)
* [Среда выполнения для настраиваемых функций Excel](custom-functions-runtime.md)
* [Руководство по настраиваемых функциях Excel](excel-tutorial-custom-functions.md)
