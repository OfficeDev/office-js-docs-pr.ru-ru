---
ms.date: 05/03/2019
description: Использование тегов JSDOC для динамического создания метаданных JSON пользовательских функций.
title: Автоматическое генерирование метаданных JSON для пользовательских функций
localization_priority: Priority
ms.openlocfilehash: df1c0114597e2aa98a15db48c515469fb9db6cd9
ms.sourcegitcommit: ff73cc04e5718765fcbe74181505a974db69c3f5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "33628090"
---
# <a name="autogenerate-json-metadata-for-custom-functions"></a>Автоматическое генерирование метаданных JSON для пользовательских функций

Если пользовательская функция Excel написана в JavaScript или TypeScript, теги JSDoc используются для предоставления дополнительной информации о пользовательской функции. Теги JSDoc используются при сборке для создания [файла метаданных JSON](custom-functions-json.md). Использование тегов JSDoc освобождает вас от необходимости редактировать файл метаданных JSON вручную.

[!include[Excel custom functions note](../includes/excel-custom-functions-note.md)]

Добавьте тег `@customfunction` в примечаниях к коду для функции JavaScript или TypeScript, чтобы пометить ее как пользовательскую.

Типы параметров функции можно получить с помощью тега [@param](#param) в JavaScript или из раздела [Тип функции](https://www.typescriptlang.org/docs/handbook/functions.html) в TypeScript. Дополнительную информацию см. в теге [@param](#param) и разделе [Типы](#types).

## <a name="jsdoc-tags"></a>Теги JSDoc
Ниже приведены теги JSDoc, которые поддерживаются в пользовательских функциях Excel:
* [@cancelable](#cancelable)
* [@customfunction](#customfunction) id name
* [@helpurl](#helpurl) url
* [@param](#param) _{type}_ name description
* [@requiresAddress](#requiresAddress)
* [@returns](#returns) _{type}_
* [@streaming](#streaming)
* [@volatile](#volatile)

---
### <a name="cancelable"></a>@cancelable
<a id="cancelable"/>

При отмене функции указывает, что пользовательская функция стремится к выполнению действия.

В качестве типа последнего параметра функции должно быть указано `CustomFunctions.CancelableInvocation`. Функция может назначить функцию свойству `oncanceled`, чтобы обозначить действия для выполнения в случае отмены функции.

Если тип последнего параметра функции `CustomFunctions.CancelableInvocation`, он будет рассматриваться как `@cancelable`, даже если тег отсутствует.

Функция не может содержать одновременно теги `@cancelable` и `@streaming`.

---
### <a name="customfunction"></a>@customfunction
<a id="customfunction"/>

Синтаксис: @customfunction _id_ _name_

Укажите этот тег, чтобы рассматривать функцию JavaScript или TypeScript как пользовательскую функцию Excel.

Этот тег необходим, чтобы создать метаданные для пользовательской функции.

Кроме того, требуется вызов функции `CustomFunctions.associate("id", functionName);`

#### <a name="id"></a>id

Идентификатор используется как инвариантный идентификатор для пользовательских функций, которые хранятся в документе. Его не следует менять.

* Если идентификатор не указан, название функции JavaScript или TypeScript преобразуется в верхний регистр, а недопустимые символы удаляются.
* Идентификатор должен быть уникальным для всех пользовательских функций.
* Допустимые символы: A–Z, a–z, 0–9 и точки (.).

#### <a name="name"></a>name

Предоставляет отображаемое имя для пользовательской функции.

* Если имя не указано, идентификатор тоже используется как имя.
* Допустимые символы: буквы [буквенные символы Юникод](https://www.unicode.org/reports/tr44/tr44-22.html#Alphabetic), числа, точки (.) и подчеркивания (\_).
* Имя должно начинаться с буквы.
* Максимальная длина: 128 символов.

---
### <a name="helpurl"></a>@helpurl
<a id="helpurl"/>

Синтаксис: @helpurl _url_

Предоставленный _url_-адрес отображается в Excel.

---
### <a name="param"></a>@param
<a id="param"/>

#### <a name="javascript"></a>JavaScript

Синтаксис JavaScript: @param {type} name _description_

* `{type}` должен указывать информацию о типе в фигурных скобках. Дополнительную информацию о типах, которые могут использоваться, см. в разделе [Типы](##types). Необязательно: если тип не указан, будет использоваться тип `any`.
* `name` указывает, к какому параметру относится тег @param. Обязательно.
* `description` предоставляет описание, которое отображается в Excel для параметра функции. Необязательно.

Чтобы обозначить параметр пользовательской функции как необязательный:
* Поместите имя параметра в квадратные скобки. Пример: `@param {string} [text] Optional text`.

> [!NOTE]
> Значение по умолчанию для дополнительных параметров — `null`.

#### <a name="typescript"></a>TypeScript

Синтаксис TypeScript: @param name _description_

* `name` указывает, к какому параметру относится тег @param. Обязательно.
* `description` предоставляет описание, которое отображается в Excel для параметра функции. Необязательно.

Дополнительную информацию о типах параметров функций, которые могут использоваться, см. в разделе [Типы](##types).

Чтобы обозначить параметр пользовательской функции как необязательный, выполните одно из указанных ниже действий.
* Используйте необязательный параметр. Пример: `function f(text?: string)`
* Задайте для параметра значение по умолчанию. Пример: `function f(text: string = "abc")`

Подробное описание @param см. в [JSDoc](https://usejsdoc.org/tags-param.html)

> [!NOTE]
> Значение по умолчанию для дополнительных параметров — `null`.

---
### <a name="requiresaddress"></a>@requiresAddress
<a id="requiresAddress"/>

Указывает, что следует предоставлять адрес ячейки, в которой вычисляется функция. 

Тип последнего параметра функции должен быть `CustomFunctions.Invocation` или производной от него. При вызове функции свойство `address` будет содержать адрес.

---
### <a name="returns"></a>@returns
<a id="returns"/>

Синтаксис: @returns {_type_}

Предоставляет тип для возвращаемого значения.

Если `{type}` не указан, будет использоваться информация о типе TypeScript. Если информация о типе отсутствует, будет использоваться тип `any`.

---
### <a name="streaming"></a>@streaming
<a id="streaming"/>

Используется для обозначения того, что пользовательская функция является потоковой передачей функции. 

Тип последнего параметра должен быть `CustomFunctions.StreamingInvocation<ResultType>`.
Функция должна вернуть значение `void`.

Потоковые передачи функций непосредственно не возвращают значения, для этого необходимо вызывать `setResult(result: ResultType)` с помощью последнего параметра.

Исключения, которые возникают при потоковой передаче функций, игнорируются. `setResult()` при вызове может вернуть ошибку в качестве результата.

Потоковые передачи функций невозможно пометить как [@volatile](#volatile).

---
### <a name="volatile"></a>@volatile
<a id="volatile"/>

Переменные функции — это такие функции, чей результат не остается неизменным в каждый период времени, даже если они не содержат аргументов или их аргументы не меняются. Excel повторно проводит вычисления в ячейках, которые содержат переменные функции, вместе со всеми зависимыми функциями при каждом вычислении. По этой причине чрезмерное использование переменных функций может замедлить пересчет, поэтому используйте их умеренно.

Потоковые передачи функций не могут быть переменными.

---

## <a name="types"></a>Типы

Указывая тип параметра, Excel преобразует значения в этот тип, прежде чем вызывать функцию. Если указан тип `any`, преобразование выполняться не будет.

### <a name="value-types"></a>Типы значений

Одно значение может быть представлено с помощью одного из приведенных ниже типов: `boolean`, `number`, `string`.

### <a name="matrix-type"></a>Тип "матрица"

Используйте тип двумерного массива, чтобы параметр или возвращаемое значение представляли собой матрицу значений. Например, тип `number[][]` указывает на матрицу чисел. `string[][]` указывает на матрицу строк. 

### <a name="error-type"></a>Тип "ошибка"

Функция непотоковой передачи может указывать на ошибку, возвращая тип "Ошибка".

Функция потоковой передачи может указывать на ошибку, вызывая метод setResult() типа "Ошибка".

### <a name="promise"></a>Обещание

Функция может вернуть тип "Обещание", который задаст значение, когда обещание будет разрешено. В случае отклонения обещания возникнет ошибка.

### <a name="other-types"></a>Другие типы

Любой другой тип будет рассматриваться как ошибка.

## <a name="next-steps"></a>Дальнейшие действия
Узнайте о [соглашениях именования для пользовательских функций](custom-functions-naming.md). Или же узнайте, как [локализовать свои функции](custom-functions-localize.md), для чего нужно [записать файл JSON вручную](custom-functions-json.md).

## <a name="see-also"></a>Дополнительные ресурсы

* [Метаданные пользовательских функций](custom-functions-json.md)
* [Рекомендации по пользовательским функциям](custom-functions-best-practices.md)
* [Создание пользовательских функций в Excel](custom-functions-overview.md)
