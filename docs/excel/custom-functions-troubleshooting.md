---
ms.date: 01/08/2020
description: Устранение распространенных проблем с пользовательскими функциями Excel.
title: Устранение проблем в пользовательских функциях
localization_priority: Normal
ms.openlocfilehash: d9f912b1cd98b04c6d0e207c79491313dc794719
ms.sourcegitcommit: d28392721958555d6edea48cea000470bd27fcf7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/13/2021
ms.locfileid: "49839840"
---
# <a name="troubleshoot-custom-functions"></a>Устранение проблем в пользовательских функциях

При разработке пользовательских функций могут возникать ошибки в продукте при создании и тестировании функций.

[!include[Excel custom functions note](../includes/excel-custom-functions-note.md)]

Для устранения проблем можно [включить ведение журнала в среде выполнения для регистрации ошибок](#enable-runtime-logging) и ознакомиться с [собственными сообщениями об ошибках Excel](#check-for-excel-error-messages). Проверьте также на наличие распространенных ошибок, например [оставление неразрешенных обещаний](#ensure-promises-return).

## <a name="enable-runtime-logging"></a>Включение ведения журнала в среде выполнения

Если вы тестируете надстройку в Office для Windows, следует [включить ведение журнала среды выполнения](../testing/runtime-logging.md). Ведение журнала в среде выполнения отправляет операторы `console.log` в отдельный файл журнала, созданный для выявления проблем. Операторы охватывают разнообразные ошибки, включая относящиеся к XML-файлу манифеста надстройки, условиям среды выполнения или установке пользовательских функций. Дополнительные сведения о ведении журнала среды выполнения см. в статье [Отладка надстройки с помощью журнала среды выполнения](../testing/runtime-logging.md).

### <a name="check-for-excel-error-messages"></a>Проверка наличия сообщений об ошибках Excel

В Excel есть несколько встроенных сообщений об ошибках, возвращаемых в ячейку при возникновении ошибки вычислений. Для пользовательских функций используются только следующие сообщения об ошибках: `#NULL!`, `#DIV/0!`, `#VALUE!`, `#REF!`, `#NAME?`, `#NUM!`, `#N/A` и `#BUSY!`.

В общем случае такие ошибки уже будут вам знакомы после работы в Excel. Есть только несколько исключений, специфических для пользовательских функций:

- Ошибка `#NAME` обычно означает проблему с регистрацией функции.
- Ошибка `#N/A` может также указывать на то, что зарегистрированную функцию не удалось выполнить. Как правило, так происходит из-за отсутствия команды `CustomFunctions.associate`.
- Ошибка `#VALUE` обычно связана с файлом сценария функций.
- Ошибка `#REF!` может указывать на то, что имя функции совпадает с именем другой функции, которая уже есть в надстройке.

## <a name="clear-the-office-cache"></a>Очистка кэша Office

Office помещает сведения о пользовательских функциях в кэш. Иногда при разработке и многократной повторной загрузке надстройки с пользовательскими функциями изменения могут не отображаться. Это можно исправить, очистив кэш Office. Дополнительные сведения см. в статье [Очистка кэша Office](../testing/clear-cache.md).

## <a name="common-problems-and-solutions"></a>Распространенные проблемы и решения

### <a name="cant-open-add-in-from-localhost-use-a-local-loopback-exception"></a>Не удается открыть надстройку из узла localhost: используйте исключение локального замыкания на себя

Если отображается ошибка "Не удается открыть эту надстройку из localhost", необходимо включить исключение локального замыкания на себя. Подробные сведения о том, как это сделать, см. в [этой статье службы поддержки Майкрософт](https://support.microsoft.com/help/4490419/local-loopback-exemption-does-not-work).

### <a name="runtime-logging-reports-typeerror-network-request-failed-on-excel-on-windows"></a>В журнале среды выполнения возникает сообщение об ошибке "TypeError: сетевой запрос не выполнен" в Excel для Windows

Если в вашем [журнале среды выполнения](custom-functions-troubleshooting.md#enable-runtime-logging) отображается ошибка "TypeError: сетевой запрос не выполнен" при вызове сервера localhost, требуется включить исключение локального замыкания на себя. Дополнительные сведения о том, как это сделать, см. в разделе *Вариант 2* [этой статьи от службы поддержки Майкрософт](https://support.microsoft.com/help/4490419/local-loopback-exemption-does-not-work).

### <a name="ensure-promises-return"></a>Проверка возвращения обещаний

Если Excel ожидает завершения выполнения пользовательской функции, выводится сообщение #BUSY! в ячейке. Если код пользовательской функции возвращает обещание, но это обещание не возвращает результат, Excel продолжит отображать сообщение `#BUSY!`. Проверьте свои функции, чтобы убедиться, что все обещания правильно возвращают результат в ячейку.

### <a name="error-the-dev-server-is-already-running-on-port-3000"></a>Ошибка: сервер разработки уже работает на порту 3000

Иногда во время работы `npm start` отображается ошибка с сообщением о том, что сервер разработки уже работает на порту 3000 (или на любом другом порту, который используется надстройкой). Можно остановить сервер разработки, выполнив `npm stop` или закрыв окно Node.js. В некоторых случаях для остановки работы сервера разработчика может занять несколько минут.

### <a name="my-functions-wont-load-associate-functions"></a>Мои функции не загружаются: свяжите функции

Если вы не зарегистрировали JSON и создали собственные метаданные JSON, может появиться сообщение об ошибке `#VALUE!` или уведомление о том, что надстройку не удается загрузить. Это обычно означает, что необходимо связать каждую пользовательскую функцию с ее свойством `id`, указанным в [файле метаданных JSON](custom-functions-json.md). Это выполняется с помощью метода `CustomFunctions.associate()`. Обычно вызов этого метода выполняется после каждой функции или в конце файла скрипта. Если пользовательская функция не связана, она не будет работать.

В примере ниже показана функция добавления, за которой следует имя функции `add`, связанное с соответствующим идентификатором JSON `ADD`.

```js
/**
 * Add two numbers.
 * @customfunction
 * @param {number} first First number.
 * @param {number} second Second number.
 * @returns {number} The sum of the two numbers.
 */
function add(first, second) {
  return first + second;
}

CustomFunctions.associate("ADD", add);
```

Дополнительные сведения об этом процессе см. в теме "Связывание имен функций [с метаданными JSON".](../excel/custom-functions-json.md#associating-function-names-with-json-metadata)

## <a name="known-issues"></a>Известные проблемы

Известные проблемы отслеживаются и сообщаются в репозитории [пользовательских функций Excel на GitHub.](https://github.com/OfficeDev/Excel-Custom-Functions/issues)

## <a name="reporting-feedback"></a>Обратная связь

Если у вас возникают проблемы, не описанные в этой статье, сообщите нам. Сообщить о проблемах можно двумя способами.

### <a name="in-excel-on-windows-or-mac"></a>В Excel для Windows или Mac

При использовании Excel для Windows или Mac можно отправить отзыв группе расширяемости Office непосредственно из Excel. Для этого выберите **Файл -> Отзыв -> Отправить нахмуренный смайлик**. Отправка нахмуренного смайлика предоставит необходимые журналы для понимания проблемы, на которую вы указываете.

### <a name="in-github"></a>В GitHub

Вы можете сообщить о возникшей проблеме либо с помощью функции отзыва о содержимом внизу любой страницы с документацией или [сообщить о новой проблеме непосредственно в репозитории пользовательских функций](https://github.com/OfficeDev/Excel-Custom-Functions/issues).

## <a name="next-steps"></a>Дальнейшие действия
Узнайте, как [создавать пользовательские функции, совместимые с функциями XLL, определенными пользователями](make-custom-functions-compatible-with-xll-udf.md).

## <a name="see-also"></a>Дополнительные ресурсы

* [Автоматическое генерирование метаданных JSON для пользовательских функций](custom-functions-json-autogeneration.md)
* [Создание пользовательских функций в Excel](custom-functions-overview.md)
