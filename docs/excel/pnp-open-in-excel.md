---
title: Откройте Excel с веб-страницы и внедрите надстройку Office
description: Откройте Excel с веб-страницы и внедрите надстройку Office.
ms.date: 09/15/2020
localization_priority: Normal
ms.openlocfilehash: 49df253c714f3ad84d2523b87e7df894b9027355
ms.sourcegitcommit: ea03e4ea2e8537d5f6d52477816209f6c1a6579c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/21/2020
ms.locfileid: "48166931"
---
# <a name="open-excel-from-your-web-page-and-embed-your-office-add-in"></a><span data-ttu-id="bc119-103">Откройте Excel с веб-страницы и внедрите надстройку Office</span><span class="sxs-lookup"><span data-stu-id="bc119-103">Open Excel from your web page and embed your Office Add-in</span></span>

:::image type="content" source="../images/pnp-open-in-excel.png" alt-text="Изображение кнопки Excel на веб-странице Открытие нового документа Excel с внедренным и автоматическим открытием надстройки.":::

<span data-ttu-id="bc119-105">Расширьте веб-приложение SaaS таким образом, чтобы пользователи могли открывать свои данные из веб-страницы непосредственно в Microsoft Excel.</span><span class="sxs-lookup"><span data-stu-id="bc119-105">Extend your SaaS web application so that your customers can open their data from a web page directly to Microsoft Excel.</span></span> <span data-ttu-id="bc119-106">Распространенным сценарием является то, что клиенты будут работать с данными в веб-приложении.</span><span class="sxs-lookup"><span data-stu-id="bc119-106">A common scenario is that customers will be working with data in your web application.</span></span> <span data-ttu-id="bc119-107">Затем они захотите скопировать данные в документ Excel.</span><span class="sxs-lookup"><span data-stu-id="bc119-107">Then they’ll want to copy the data into an Excel document.</span></span> <span data-ttu-id="bc119-108">Например, может потребоваться выполнить дополнительный анализ с помощью Excel.</span><span class="sxs-lookup"><span data-stu-id="bc119-108">For example, they may want to perform additional analysis using Excel.</span></span> <span data-ttu-id="bc119-109">Как правило, клиент должен экспортировать данные в файл, например CSV-файл, а затем импортировать эти данные в Excel.</span><span class="sxs-lookup"><span data-stu-id="bc119-109">Typically, the customer is required to export the data to a file, such as a .csv file, and then import that data into Excel.</span></span> <span data-ttu-id="bc119-110">Кроме того, необходимо вручную добавить надстройку Office в документ.</span><span class="sxs-lookup"><span data-stu-id="bc119-110">They also have to manually add your Office Add-in to the document.</span></span>

<span data-ttu-id="bc119-111">Уменьшите число шагов на одну нажатую кнопку на веб-странице, которая создает и открывает документ Excel.</span><span class="sxs-lookup"><span data-stu-id="bc119-111">Reduce the number of steps to a single button click on your web page that generates and opens the Excel document.</span></span> <span data-ttu-id="bc119-112">Вы также можете внедрить надстройку Office в документ и отображать ее при открытии документа.</span><span class="sxs-lookup"><span data-stu-id="bc119-112">You can also embed your Office Add-in inside the document and display it when the document opens.</span></span> <span data-ttu-id="bc119-113">Это гарантирует, что у клиента по-прежнему есть доступ к функциям приложений.</span><span class="sxs-lookup"><span data-stu-id="bc119-113">This ensures the customer still has access to your application features.</span></span> <span data-ttu-id="bc119-114">Когда откроется документ, данные, выбранные клиентом, и надстройка Office уже доступны для продолжения работы.</span><span class="sxs-lookup"><span data-stu-id="bc119-114">When the document opens, the data the customer selected, and your Office Add-in is already available for them to continue working.</span></span>

<span data-ttu-id="bc119-115">В этой статье показаны код и методы реализации этого сценария в собственном веб-приложении SaaS.</span><span class="sxs-lookup"><span data-stu-id="bc119-115">This article shows you code and techniques for implementing this scenario in your own SaaS web application.</span></span>

## <a name="create-a-new-excel-document-and-embed-an-office-add-in"></a><span data-ttu-id="bc119-116">Создание нового документа Excel и внедрение надстройки Office</span><span class="sxs-lookup"><span data-stu-id="bc119-116">Create a new Excel document and embed an Office Add-in</span></span>

<span data-ttu-id="bc119-117">Для начала рассмотрим создание документа Excel на веб-странице и внедрение надстройки в документ.</span><span class="sxs-lookup"><span data-stu-id="bc119-117">First, let’s learn how to create an Excel document from a web page, and embed an add-in into the document.</span></span> <span data-ttu-id="bc119-118">В [примере кода надстройки Office OOXML embed](https://github.com/OfficeDev/Office-OOXML-EmbedAddin) показано, как внедрить [надстройку "Лаборатория скриптов](https://appsource.microsoft.com/product/office/wa104380862) " в новый документ Office.</span><span class="sxs-lookup"><span data-stu-id="bc119-118">The [Office OOXML Embed Add-in code sample](https://github.com/OfficeDev/Office-OOXML-EmbedAddin) shows how to embed the [Script Lab add-in](https://appsource.microsoft.com/product/office/wa104380862) into a new Office document.</span></span> <span data-ttu-id="bc119-119">Несмотря на то, что пример работает с любым документом Office, в этой статье мы будем сосредоточиться на таблицах Excel.</span><span class="sxs-lookup"><span data-stu-id="bc119-119">Although the sample works with any Office document, we’ll just focus on Excel spreadsheets in this article.</span></span> <span data-ttu-id="bc119-120">Выполните указанные ниже действия, чтобы создать и запустить пример.</span><span class="sxs-lookup"><span data-stu-id="bc119-120">Use the following steps to build and run the sample.</span></span>

1. <span data-ttu-id="bc119-121">Извлеките пример кода из  https://github.com/OfficeDev/Office-OOXML-EmbedAddin/archive/master.zip папки на вашем компьютере.</span><span class="sxs-lookup"><span data-stu-id="bc119-121">Extract the sample code from  https://github.com/OfficeDev/Office-OOXML-EmbedAddin/archive/master.zip into a folder on your computer.</span></span>
2. <span data-ttu-id="bc119-122">Чтобы создать и запустить пример, выполните действия, описанные в разделе " **использование проекта** " файла readme.</span><span class="sxs-lookup"><span data-stu-id="bc119-122">To build and run the sample, follow the steps in the **To use the project** section of the readme.</span></span>
3. <span data-ttu-id="bc119-123">При запуске примера отображается веб-страница, подобная показанной на следующем снимке экрана.</span><span class="sxs-lookup"><span data-stu-id="bc119-123">When you run the sample it will display a web page similar to the following screen shot.</span></span> <span data-ttu-id="bc119-124">С помощью веб-страницы создайте новый документ Excel, содержащий Lab script при открытии.</span><span class="sxs-lookup"><span data-stu-id="bc119-124">Use the web page to create a new Excel document that contains Script Lab when it opens.</span></span>
:::image type="content" source="../images/embed-script-lab-sample-ui.png" alt-text="Снимок экрана веб-страницы, отображаемой в образце сценария embed для выбора файла Excel и встраивания в него надстройки "Лаборатория скриптов".":::

### <a name="how-the-sample-works"></a><span data-ttu-id="bc119-126">Принцип работы примера</span><span class="sxs-lookup"><span data-stu-id="bc119-126">How the sample works</span></span>

<span data-ttu-id="bc119-127">В примере кода используется пакет SDK OOXML для внедрения надстройки Script Lab в документ Excel, который вы выбираете.</span><span class="sxs-lookup"><span data-stu-id="bc119-127">The sample code uses the OOXML SDK to embed the Script Lab add-in to the Excel document that you choose.</span></span> <span data-ttu-id="bc119-128">Приведенные ниже сведения берутся из [раздела " **код** ](https://github.com/OfficeDev/Office-OOXML-EmbedAddin/blob/master/README.md) " в файле readme.</span><span class="sxs-lookup"><span data-stu-id="bc119-128">The following Information is taken from the [**About the code** section](https://github.com/OfficeDev/Office-OOXML-EmbedAddin/blob/master/README.md) in the readme file.</span></span>

<span data-ttu-id="bc119-129">**Home.aspx.CS**файла:</span><span class="sxs-lookup"><span data-stu-id="bc119-129">The file **Home.aspx.cs**:</span></span>

- <span data-ttu-id="bc119-130">Предоставляет обработчики событий кнопки и базовую обработку пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="bc119-130">Provides the button event handlers and basic UI manipulation.</span></span>
- <span data-ttu-id="bc119-131">Использует стандартные методы ASP.NET для отправки и загрузки файла.</span><span class="sxs-lookup"><span data-stu-id="bc119-131">Uses standard ASP.NET techniques to upload and download the file.</span></span>
- <span data-ttu-id="bc119-132">Использует расширение файла загруженного файла (XLSX, DOCX или PPTX) для определения типа файла.</span><span class="sxs-lookup"><span data-stu-id="bc119-132">Uses the file name extension of the uploaded file (xlsx, docx, or pptx) to determine the type of file.</span></span> <span data-ttu-id="bc119-133">Это необходимо сделать с самого начала работы, так как в пакет SDK Open XML обычно есть разные интерфейсы API для каждого типа файлов.</span><span class="sxs-lookup"><span data-stu-id="bc119-133">This needs to be done at the outset because the Open XML SDK generally has distinct APIs for each type of file.</span></span>
- <span data-ttu-id="bc119-134">Вызывает **уксмлхелпер** для проверки файла и вызовов в **Аддинембеддер** для внедрения лаборатории скриптов в файл и установки автоматического открытия.</span><span class="sxs-lookup"><span data-stu-id="bc119-134">Calls into the **OOXMLHelper** to validate the file and calls into the **AddInEmbedder** to embed Script Lab in the file and set to automatically open.</span></span>

<span data-ttu-id="bc119-135">**AddInEmbedder.CS**файла:</span><span class="sxs-lookup"><span data-stu-id="bc119-135">The file **AddInEmbedder.cs**:</span></span>

- <span data-ttu-id="bc119-136">Предоставляет основную бизнес-логику, в данном примере, способ внедрения лаборатории скриптов.</span><span class="sxs-lookup"><span data-stu-id="bc119-136">Provides the main business logic, which in this sample is a method that embeds Script Lab.</span></span>
- <span data-ttu-id="bc119-137">Выполняет вызовы в модуль поддержки OOXML на основе типа файла.</span><span class="sxs-lookup"><span data-stu-id="bc119-137">Makes calls into the OOXML helper based on the type of the file.</span></span>

<span data-ttu-id="bc119-138">**OOXMLHelper.CS**файла:</span><span class="sxs-lookup"><span data-stu-id="bc119-138">The file **OOXMLHelper.cs**:</span></span>

- <span data-ttu-id="bc119-139">Предоставляет все подробные операции OOXML.</span><span class="sxs-lookup"><span data-stu-id="bc119-139">Provides all the detailed OOXML manipulation.</span></span>
- <span data-ttu-id="bc119-140">Использует стандартную методику для проверки файла Office, который просто вызывает метод **Document. Open** для него.</span><span class="sxs-lookup"><span data-stu-id="bc119-140">Uses a standard technique for validating the Office file, which is simply to call the **Document.Open** method on it.</span></span> <span data-ttu-id="bc119-141">Если файл является недопустимым, метод выдает исключение.</span><span class="sxs-lookup"><span data-stu-id="bc119-141">If the file is invalid, the method throws an exception.</span></span>
- <span data-ttu-id="bc119-142">Содержит код, который был создан с помощью средств повышения производительности SDK Open XML 2,5, которые доступны по ссылке для [Open xml 2,5 SDK](/office/open-xml/open-xml-sdk).</span><span class="sxs-lookup"><span data-stu-id="bc119-142">Contains mainly code that was generated by the Open XML 2.5 SDK Productivity Tools which are available at the link for the [Open XML 2.5 SDK](/office/open-xml/open-xml-sdk).</span></span>

<span data-ttu-id="bc119-143">Метод **GenerateWebExtensionPart1Content** в файле **OOXMLHelper.CS** задает ссылку на идентификатор лаборатории скриптов в Microsoft AppSource:</span><span class="sxs-lookup"><span data-stu-id="bc119-143">The **GenerateWebExtensionPart1Content** method in the **OOXMLHelper.cs** file sets the reference to the ID of Script Lab in Microsoft AppSource:</span></span>

```csharp
We.WebExtensionStoreReference webExtensionStoreReference1 = new We.WebExtensionStoreReference() { Id = "wa104380862", Version = "1.1.0.0", Store = "en-US", StoreType = "OMEX" };
```

- <span data-ttu-id="bc119-144">Значение **флажок** — "ОМЕКС", псевдоним для Microsoft AppSource.</span><span class="sxs-lookup"><span data-stu-id="bc119-144">The **StoreType** value is "OMEX", an alias for Microsoft AppSource.</span></span>
- <span data-ttu-id="bc119-145">Значение **Store** — "en-US" в разделе Microsoft AppSource Culture для сценария Lab.</span><span class="sxs-lookup"><span data-stu-id="bc119-145">The **Store** value is "en-US" found in the Microsoft AppSource culture section for Script Lab.</span></span>
- <span data-ttu-id="bc119-146">Значение **ID** — это идентификатор ресурса Microsoft AppSource для лаборатории сценариев.</span><span class="sxs-lookup"><span data-stu-id="bc119-146">The **Id** value is the Microsoft AppSource asset ID for Script Lab.</span></span>

<span data-ttu-id="bc119-147">Если вы настраиваете надстройку из каталога общих папок для автоматического открытия, будут использоваться разные значения:</span><span class="sxs-lookup"><span data-stu-id="bc119-147">If you are setting up an add-in from a file share catalog for auto-open, you will use different values:</span></span>

<span data-ttu-id="bc119-148">Значение **флажок** — "FileSystem".</span><span class="sxs-lookup"><span data-stu-id="bc119-148">The **StoreType** value is "FileSystem".</span></span>

- <span data-ttu-id="bc119-149">Значение **Store** — это URL-адрес сетевой папки; Например, " \\ \\ MyComputer \\ мишаредфолдер".</span><span class="sxs-lookup"><span data-stu-id="bc119-149">The **Store** value is the URL of the network share; for example, "\\\\MyComputer\\MySharedFolder".</span></span> <span data-ttu-id="bc119-150">Это должен быть точный URL-адрес, который отображается в качестве адреса доверенного каталога общего доступа в центре управления безопасностью Office.</span><span class="sxs-lookup"><span data-stu-id="bc119-150">This should be the exact URL that appears as the share's Trusted Catalog Address in the Office Trust Center.</span></span>
- <span data-ttu-id="bc119-151">Значение **ID** — идентификатор приложения в манифесте надстроек.</span><span class="sxs-lookup"><span data-stu-id="bc119-151">The **Id** value is the app ID in the add-ins manifest.</span></span>
> [!NOTE]
> <span data-ttu-id="bc119-152">Дополнительные сведения о альтернативных значениях для этих атрибутов: [автоматически открывать область задач с документом](../develop/automatically-open-a-task-pane-with-a-document.md).</span><span class="sxs-lookup"><span data-stu-id="bc119-152">For more information about alternative values for these attributes, see [Automatically open a task pane with a document](../develop/automatically-open-a-task-pane-with-a-document.md).</span></span>

## <a name="use-the-fluent-ui"></a><span data-ttu-id="bc119-153">Использование пользовательского интерфейса Fluent</span><span class="sxs-lookup"><span data-stu-id="bc119-153">Use the Fluent UI</span></span>

:::image type="content" source="../images/fluent-ui-wxp.png" alt-text="Значки пользовательского интерфейса Fluent для Word, Excel и PowerPoint.":::

<span data-ttu-id="bc119-155">Рекомендуется использовать пользовательский интерфейс Fluent, чтобы пользователи могли переходить между продуктами корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="bc119-155">A best practice is to use the Fluent UI to help your users transition between Microsoft products.</span></span> <span data-ttu-id="bc119-156">Следует всегда использовать значок Office, чтобы указать, какое приложение Office будет запущено на веб-странице.</span><span class="sxs-lookup"><span data-stu-id="bc119-156">You should always use an Office icon to indicate which Office application will be launched from your web page.</span></span> <span data-ttu-id="bc119-157">Давайте изменим пример кода, чтобы использовать значок Excel, чтобы указать, что приложение Excel запускается.</span><span class="sxs-lookup"><span data-stu-id="bc119-157">Let’s modify the sample code to use the Excel icon to indicate that it launches the Excel application.</span></span>

1. <span data-ttu-id="bc119-158">Откройте пример в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="bc119-158">Open the sample in Visual Studio.</span></span>
1. <span data-ttu-id="bc119-159">Откройте страницу **Home. aspx** .</span><span class="sxs-lookup"><span data-stu-id="bc119-159">Open the **Home.aspx** page.</span></span>
1. <span data-ttu-id="bc119-160">Найдите следующий код, который является кнопкой загрузки в форме:</span><span class="sxs-lookup"><span data-stu-id="bc119-160">Find following code that is the download button on the form:</span></span>
    ```html
    <asp:Button ID="btnDownload" runat="server" Text="Download" OnClick="btnDownload_Click" /> 
    ```
1. <span data-ttu-id="bc119-161">Замените код кнопки следующим тегом изображения.</span><span class="sxs-lookup"><span data-stu-id="bc119-161">Replace the button code with the following image tag.</span></span>
    ```html
    <asp:Image  src="https://static2.sharepointonline.com/files/fabric/assets/brand-icons/product/svg/excel_48x1.svg" width="48" height="48" ID="btnDownload" runat="server" OnClick="btnDownload_Click" AlternateText="Open in Microsoft Excel" role="button" ImageUrl=""/>  
    ```
1. <span data-ttu-id="bc119-162">Нажмите клавишу **F5** (или **Отладка > начать отладку**).</span><span class="sxs-lookup"><span data-stu-id="bc119-162">Press **F5** (or **Debug > Start Debugging**).</span></span> <span data-ttu-id="bc119-163">Вы увидите значок, который появится при загрузке домашней страницы.</span><span class="sxs-lookup"><span data-stu-id="bc119-163">You'll see the icon appear when the home page loads.</span></span>

<span data-ttu-id="bc119-164">Для получения дополнительных сведений просмотрите [значки фирменной символики Office](https://developer.microsoft.com/fluentui#/styles/web/office-brand-icons) на портале разработчика Fluent в Fluent в пользовательском интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="bc119-164">For more information, see [Office Brand Icons](https://developer.microsoft.com/fluentui#/styles/web/office-brand-icons) on the Fluent UI developer portal.</span></span>  

## <a name="upload-the-excel-document-to-microsoft-onedrive"></a><span data-ttu-id="bc119-165">Отправка документа Excel в Microsoft OneDrive</span><span class="sxs-lookup"><span data-stu-id="bc119-165">Upload the Excel document to Microsoft OneDrive</span></span>

<span data-ttu-id="bc119-166">Мы рекомендуем отправлять новые документы в OneDrive, если ваш клиент использует OneDrive.</span><span class="sxs-lookup"><span data-stu-id="bc119-166">We recommend uploading new documents to OneDrive if your customer uses OneDrive.</span></span> <span data-ttu-id="bc119-167">Это упрощает поиск и работу с документами.</span><span class="sxs-lookup"><span data-stu-id="bc119-167">This makes it easier for them to find and work with the documents.</span></span> <span data-ttu-id="bc119-168">Давайте создадим новый пример кода и посмотрим, как можно использовать пакет SDK Microsoft Graph для отправки нового документа Excel в OneDrive.</span><span class="sxs-lookup"><span data-stu-id="bc119-168">Let’s create a new code sample and see how you can use the Microsoft Graph SDK to upload a new Excel document to OneDrive.</span></span>

### <a name="use-a-quick-start-to-build-a-new-microsoft-graph-web-application"></a><span data-ttu-id="bc119-169">Использование быстрого запуска для создания нового веб-приложения Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="bc119-169">Use a quick-start to build a new Microsoft Graph web application</span></span>

1. <span data-ttu-id="bc119-170">Перейдите к разделу [https://developer.microsoft.com/graph/quick-start](https://developer.microsoft.com/graph/quick-start) и следуйте инструкциям, чтобы создать и открыть краткий пример кода, взаимодействующего со службами Office 365.</span><span class="sxs-lookup"><span data-stu-id="bc119-170">Go to [https://developer.microsoft.com/graph/quick-start](https://developer.microsoft.com/graph/quick-start) and follow the steps to create and open a quick start code sample that interacts with Office 365 services.</span></span>
1. <span data-ttu-id="bc119-171">На **шаге 1: выберите язык или платформу**, выберите **ASP.NET MVC**.</span><span class="sxs-lookup"><span data-stu-id="bc119-171">In **step 1: Pick you language or platform**, choose **ASP.NET MVC**.</span></span> <span data-ttu-id="bc119-172">Несмотря на то, что действия, описанные в этой процедуре, используют параметр MVC ASP.NET, шаги следуют шаблону, который применяется к любому языку или платформе.</span><span class="sxs-lookup"><span data-stu-id="bc119-172">Although the steps in this procedure use the ASP.NET MVC option, the steps follow a pattern that apply to any language or platform.</span></span>
1. <span data-ttu-id="bc119-173">В **шаге 2: получение идентификатора и секрета приложения**выберите пункт **Получение идентификатора и секрета приложения**.</span><span class="sxs-lookup"><span data-stu-id="bc119-173">In **step 2: Get an app ID and secret**, choose **Get an app ID and secret**.</span></span>
1. <span data-ttu-id="bc119-174">Войдите в свою учетную запись Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="bc119-174">Sign in to your Microsoft 365 account.</span></span>  
1. <span data-ttu-id="bc119-175">**Сохраните секрет приложения на веб-** странице, чтобы сохранить секрет приложения в файл, в котором его можно извлечь и использовать позже.</span><span class="sxs-lookup"><span data-stu-id="bc119-175">On the **Please save your app secret** web page, save the app secret to a file location where you can retrieve and use it later.</span></span>
1. <span data-ttu-id="bc119-176">Выберите все **Готово, вернитесь на краткий старт**.</span><span class="sxs-lookup"><span data-stu-id="bc119-176">Choose **Got it, take me back to the quick start**.</span></span>
1. <span data-ttu-id="bc119-177">В **шаге 2: регистрация выполнена успешно!**</span><span class="sxs-lookup"><span data-stu-id="bc119-177">In **step 2: Registration Successful!**</span></span> <span data-ttu-id="bc119-178">Введите созданный секрет приложения.</span><span class="sxs-lookup"><span data-stu-id="bc119-178">Enter the generated app secret.</span></span>
1. <span data-ttu-id="bc119-179">На **шаге 3: начните программировать**, а затем **Скачайте пример кода на основе SDK**.</span><span class="sxs-lookup"><span data-stu-id="bc119-179">In **step 3: Start coding**, choose **Download the SDK-based code sample**.</span></span>
1. <span data-ttu-id="bc119-180">Извлеките папку ZIP для скачивания в локальную папку.</span><span class="sxs-lookup"><span data-stu-id="bc119-180">Extract the download zip folder into a local folder.</span></span>  
1. <span data-ttu-id="bc119-181">Откройте файл граф-туториал. sln в Visual Studio 2019.</span><span class="sxs-lookup"><span data-stu-id="bc119-181">Open the graph-tutorial.sln file in Visual Studio 2019.</span></span>
1. <span data-ttu-id="bc119-182">Создайте и запустите решение и убедитесь, что оно работает правильно.</span><span class="sxs-lookup"><span data-stu-id="bc119-182">Build and run the solution and confirm it is working correctly.</span></span> <span data-ttu-id="bc119-183">Вы можете просматривать календарь Microsoft 365 с помощью веб-страницы календаря.</span><span class="sxs-lookup"><span data-stu-id="bc119-183">You should be able to use the calendar web page to view your Microsoft 365 calendar.</span></span>

### <a name="upload-a-file-to-onedrive"></a><span data-ttu-id="bc119-184">Отправка файла в OneDrive</span><span class="sxs-lookup"><span data-stu-id="bc119-184">Upload a file to OneDrive</span></span>

1. <span data-ttu-id="bc119-185">Откройте решение **граф-туториал. sln** в Visual Studio 2019 и откройте файл **PrivateSettings.config** .</span><span class="sxs-lookup"><span data-stu-id="bc119-185">Open the **graph-tutorial.sln** solution in Visual Studio 2019, and open the **PrivateSettings.config** file.</span></span>
1. <span data-ttu-id="bc119-186">Добавьте новый файл scope **. ReadWrite**   в раздел **Ida: аппскопес** , чтобы он выглядел следующим образом:</span><span class="sxs-lookup"><span data-stu-id="bc119-186">Add a new scope **Files.ReadWrite** to the **ida:AppScopes** key so that it looks like the following code:</span></span>
    ```xml
    <add key="ida:AppScopes" value="User.Read Calendars.Read Files.ReadWrite " />
    ```
1. <span data-ttu-id="bc119-187">Откройте файл **index. cshtml** .</span><span class="sxs-lookup"><span data-stu-id="bc119-187">Open the **Index.cshtml** file.</span></span>
1. <span data-ttu-id="bc119-188">Вставьте следующий код ActionLink, чтобы создать кнопку для отправки файла в OneDrive.</span><span class="sxs-lookup"><span data-stu-id="bc119-188">Insert the following ActionLink code to create a button to upload a file to OneDrive.</span></span>
    ```razor
    @if (Request.IsAuthenticated)
    {
        <h4>Welcome @ViewBag.User.DisplayName!</h4>
        <p>Use the navigation bar at the top of the page to get started.</p>
        @Html.ActionLink("Click here to create a new file on OneDrive", "CreateOneDriveFile", "Home", new { area = "" }, new { @class = "btn btn-primary btn-large" })
    }
    ```
1. <span data-ttu-id="bc119-189">Откройте файл **HomeController.CS** .</span><span class="sxs-lookup"><span data-stu-id="bc119-189">Open the **HomeController.cs** file.</span></span>
1. <span data-ttu-id="bc119-190">Вставьте следующий код, чтобы обработать запрос из ссылки Action (действие).</span><span class="sxs-lookup"><span data-stu-id="bc119-190">Insert the following code to handle the request from the action link.</span></span>
    ```csharp
    public void CreateOneDriveFile()
        {
            using (var stream = new System.IO.MemoryStream(System.Text.Encoding.UTF8.GetBytes("The contents of the file goes here.")))
            {
                var client = graph_tutorial.Helpers.GraphHelper.UploadFile("/test.txt", stream);
            }
        }
    ```
1. <span data-ttu-id="bc119-191">Откройте файл **GraphHelper.CS** .</span><span class="sxs-lookup"><span data-stu-id="bc119-191">Open the **GraphHelper.cs** file.</span></span>
1. <span data-ttu-id="bc119-192">Вставьте следующий код, чтобы вызвать API Microsoft Graph, чтобы создать новый файл в OneDrive.</span><span class="sxs-lookup"><span data-stu-id="bc119-192">Insert the following code to call the Microsoft Graph API to create a new file on OneDrive.</span></span>
    ```csharp
    public static async Task UploadFile(string fileName, System.IO.MemoryStream stream)
        {
           var graphClient = GetAuthenticatedClient();
            await graphClient.Me
                .Drive
                .Root
                .ItemWithPath(fileName)
                .Content
                .Request()
                .PutAsync<DriveItem>(stream);
            return;
        }
    ```
1. <span data-ttu-id="bc119-193">Нажмите клавишу **F5** (или **Отладка > начать отладку**).</span><span class="sxs-lookup"><span data-stu-id="bc119-193">Press **F5** (or **Debug > Start Debugging**).</span></span> <span data-ttu-id="bc119-194">Запустится веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="bc119-194">The web application will start.</span></span>
1. <span data-ttu-id="bc119-195">Выберите **щелкните здесь, чтобы выполнить вход**, и войдите.</span><span class="sxs-lookup"><span data-stu-id="bc119-195">Choose **Click here to sign in**, and sign in.</span></span>
1. <span data-ttu-id="bc119-196">Выберите **ссылку Щелкните здесь, чтобы создать файл в OneDrive**.</span><span class="sxs-lookup"><span data-stu-id="bc119-196">Choose **Click here to create a new file on OneDrive**.</span></span>
1. <span data-ttu-id="bc119-197">Откройте новую вкладку браузера и войдите в свою учетную запись OneDrive.</span><span class="sxs-lookup"><span data-stu-id="bc119-197">Open a new browser tab and sign in to your OneDrive account.</span></span> <span data-ttu-id="bc119-198">Вы увидите файл test.txt в корневой папке.</span><span class="sxs-lookup"><span data-stu-id="bc119-198">You'll see the test.txt file in the root folder.</span></span>

<span data-ttu-id="bc119-199">Теперь, когда вы узнали, как отправить файл в OneDrive, вы можете повторно использовать этот код для загрузки созданного документа Excel.</span><span class="sxs-lookup"><span data-stu-id="bc119-199">Now that you've learned how to upload a file to OneDrive, you can reuse this code to upload any Excel document that you create.</span></span>

## <a name="additional-considerations-for-your-solution"></a><span data-ttu-id="bc119-200">Дополнительные рекомендации по решению</span><span class="sxs-lookup"><span data-stu-id="bc119-200">Additional considerations for your solution</span></span>

<span data-ttu-id="bc119-201">В терминах технологий и подходов для всех решений используется разный подход.</span><span class="sxs-lookup"><span data-stu-id="bc119-201">Everyone’s solution is different in terms of technologies and approaches.</span></span> <span data-ttu-id="bc119-202">Ниже приведены рекомендации по планированию изменения решения для открытия документов и внедрения надстройки Office.</span><span class="sxs-lookup"><span data-stu-id="bc119-202">The following considerations will help you plan how to modify your solution to open documents and embed your Office Add-in.</span></span>

### <a name="create-a-new-excel-spreadsheet-from-the-web-page"></a><span data-ttu-id="bc119-203">Создание новой таблицы Excel на веб-странице</span><span class="sxs-lookup"><span data-stu-id="bc119-203">Create a new Excel spreadsheet from the web page</span></span>

<span data-ttu-id="bc119-204">В этом примере изменяется существующий документ Excel.</span><span class="sxs-lookup"><span data-stu-id="bc119-204">The sample modifies an existing Excel document.</span></span> <span data-ttu-id="bc119-205">Более распространенный сценарий состоит в том, что вы создадите новую электронную таблицу Excel на веб-странице.</span><span class="sxs-lookup"><span data-stu-id="bc119-205">A more common scenario is that you’ll create a new Excel spreadsheet from your web page.</span></span> <span data-ttu-id="bc119-206">Дополнительные сведения о том, как создать новую электронную таблицу для **создания электронной таблицы** , можно найти, указав имя файла.</span><span class="sxs-lookup"><span data-stu-id="bc119-206">You can find additional details on how to create a new spreadsheet in **Create a spreadsheet document** by providing a file name.</span></span> <span data-ttu-id="bc119-207">В этой статье показано, как создать файл локально, но вы также можете создать файл в потоке с помощью перегрузки метода SpreadsheetDocument. Create.</span><span class="sxs-lookup"><span data-stu-id="bc119-207">This article shows how to create the file locally, but you can also create the file in a stream by using an overload on the SpreadsheetDocument.Create method.</span></span>

### <a name="read-custom-properties-when-your-add-in-starts"></a><span data-ttu-id="bc119-208">Чтение настраиваемых свойств при запуске надстройки</span><span class="sxs-lookup"><span data-stu-id="bc119-208">Read custom properties when your add-in starts</span></span>

<span data-ttu-id="bc119-209">В примере кода показано, как сохранить идентификатор фрагмента в новом документе Excel с помощью пакета SDK для OOXML.</span><span class="sxs-lookup"><span data-stu-id="bc119-209">The code sample stores a snippet ID in the new Excel document using the OOXML SDK.</span></span> <span data-ttu-id="bc119-210">В лабораториях сценария считывается идентификатор фрагмента из документа Excel, после чего он отображается в коде фрагмента кода при его открытии.</span><span class="sxs-lookup"><span data-stu-id="bc119-210">Script Lab reads the snippet ID from the Excel document and then displays that snippet code when it opens.</span></span> <span data-ttu-id="bc119-211">Может потребоваться отправить настраиваемые свойства собственной надстройке (например, строке запроса или временному маркеру проверки подлинности). В статье **Сохранение состояния и параметров надстройки** приведены подробные сведения о том, как считывать настраиваемые свойства при запуске надстройки.</span><span class="sxs-lookup"><span data-stu-id="bc119-211">You may need to send custom properties to your own add-in (such as a query string, or temporary authentication token.) See **Persisting add-in state and settings** for complete details on how to read custom properties when your add-in starts.</span></span>

### <a name="initialize-the-excel-document-with-data"></a><span data-ttu-id="bc119-212">Инициализация документа Excel с помощью данных</span><span class="sxs-lookup"><span data-stu-id="bc119-212">Initialize the Excel document with data</span></span>

<span data-ttu-id="bc119-213">Как правило, когда клиент открывает документ Excel с веб-сайта, он ожидает, что документ содержит какие-либо данные из веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="bc119-213">Typically, when the customer opens up an Excel document from your web site, they expect the document to contain some data from the web site.</span></span> <span data-ttu-id="bc119-214">Существует несколько способов записи данных в документ.</span><span class="sxs-lookup"><span data-stu-id="bc119-214">There are a couple of ways to write data into the document.</span></span>

- <span data-ttu-id="bc119-215">**Используйте пакет SDK OOXML для записи данных**.</span><span class="sxs-lookup"><span data-stu-id="bc119-215">**Use the OOXML SDK to write the data**.</span></span> <span data-ttu-id="bc119-216">Вы можете использовать пакет SDK для непосредственной записи данных в документ.</span><span class="sxs-lookup"><span data-stu-id="bc119-216">You can use the SDK to directly write any data into the document.</span></span> <span data-ttu-id="bc119-217">Этот подход полезен, если вы хотите, чтобы данные были доступны для мгновенного открытия документа.</span><span class="sxs-lookup"><span data-stu-id="bc119-217">This approach is useful if you want the data to be available the instant the document is opened.</span></span>
- <span data-ttu-id="bc119-218">**Передайте настраиваемое свойство запроса в надстройку Office**.</span><span class="sxs-lookup"><span data-stu-id="bc119-218">**Pass a custom query property to your Office add-in**.</span></span> <span data-ttu-id="bc119-219">При создании документа вы внедряет настраиваемое свойство для надстройки Office, содержащее строку запроса, которая извлекает все необходимые данные.</span><span class="sxs-lookup"><span data-stu-id="bc119-219">When you generate the document, you embed a custom property for the Office add-in that contains a query string that retrieves all the required data.</span></span> <span data-ttu-id="bc119-220">Когда откроется надстройка, она получает запрос, запускает запрос и использует API Office JS для вставки результата запроса в документ.</span><span class="sxs-lookup"><span data-stu-id="bc119-220">When your add-in opens, it retrieves the query, runs the query, and uses the Office JS API to insert the result of the query into the document.</span></span>

### <a name="working-with-the-ooxml-sdk"></a><span data-ttu-id="bc119-221">Работа с пакетом SDK для OOXML</span><span class="sxs-lookup"><span data-stu-id="bc119-221">Working with the OOXML SDK</span></span>

<span data-ttu-id="bc119-222">Пакет SDK для OOXML основан на .NET.</span><span class="sxs-lookup"><span data-stu-id="bc119-222">The OOXML SDK is based on .NET.</span></span> <span data-ttu-id="bc119-223">Если ваше веб-приложение не является .NET, вам необходимо найти альтернативный способ работы с OOXML.</span><span class="sxs-lookup"><span data-stu-id="bc119-223">If your web application does not .NET, you’ll need to look for an alternative way to work with OOXML.</span></span>

<span data-ttu-id="bc119-224">Пакет SDK OOXML для JavaScript доступен на странице [Open XML SDK для JavaScript](https://archive.codeplex.com/?p=openxmlsdkjs).</span><span class="sxs-lookup"><span data-stu-id="bc119-224">There is a JavaScript version of the OOXML SDK available at [Open XML SDK for JavaScript](https://archive.codeplex.com/?p=openxmlsdkjs).</span></span>

<span data-ttu-id="bc119-225">Вы можете поместить код OOXML в функцию Azure, чтобы отделить код .NET от остальной части веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="bc119-225">You can place the OOXML code in an Azure function to separate the .NET code from the rest of your web application.</span></span> <span data-ttu-id="bc119-226">Затем вызовите функцию Azure (для создания документа Excel) из веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="bc119-226">Then call the Azure function (to generate the Excel document) from your Web application.</span></span> <span data-ttu-id="bc119-227">Дополнительные сведения о функциях Azure приведены [в статье Введение в функции Azure](https://docs.microsoft.com/azure/azure-functions/functions-overview).</span><span class="sxs-lookup"><span data-stu-id="bc119-227">For more information on Azure functions, see [An introduction to Azure Functions](https://docs.microsoft.com/azure/azure-functions/functions-overview).</span></span>

### <a name="simplify-authentication"></a><span data-ttu-id="bc119-228">Упрощение проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="bc119-228">Simplify authentication</span></span>

<span data-ttu-id="bc119-229">Как правило, клиент проходит проверку подлинности и выполняет вход при работе в веб-приложении.</span><span class="sxs-lookup"><span data-stu-id="bc119-229">Usually the customer will be authenticated and signed in when working in your web application.</span></span> <span data-ttu-id="bc119-230">Рекомендуется не допустить вход в систему при открытии документа, чтобы их не требовалось было снова выполнить вход, чтобы использовать надстройку Office.</span><span class="sxs-lookup"><span data-stu-id="bc119-230">A best practice is to allow them to stay signed in when they open the document so they are not required to sign in again to use your Office Add-in.</span></span> <span data-ttu-id="bc119-231">Для этого лучше всего передается маркер проверки подлинности с кратковременной проверкой подлинности.</span><span class="sxs-lookup"><span data-stu-id="bc119-231">A good way to handle this is pass a short-lived authentication token to the add-in.</span></span>

1. <span data-ttu-id="bc119-232">Используйте пакет SDK OOXML для сохранения маркера проверки подлинности в качестве настраиваемого свойства в документе.</span><span class="sxs-lookup"><span data-stu-id="bc119-232">Use the OOXML SDK to save the authentication token as a custom property in the document.</span></span>
1. <span data-ttu-id="bc119-233">Считывание маркера из документа при запуске надстройки.</span><span class="sxs-lookup"><span data-stu-id="bc119-233">Read the token from the document when the add-in starts.</span></span>
1. <span data-ttu-id="bc119-234">После этого надстройка может подключаться к службам, не требуя дополнительных действий с проверкой подлинности от клиента.</span><span class="sxs-lookup"><span data-stu-id="bc119-234">The add-in can then connect to your services without requiring any additional authentication steps from the customer.</span></span>

> [!WARNING]
> <span data-ttu-id="bc119-235">Встраивание маркера проверки подлинности в документ представляет угрозу безопасности, в результате которой неавторизованный пользователь может получить маркер.</span><span class="sxs-lookup"><span data-stu-id="bc119-235">Embedding an authentication token in the document poses a security risk where an unauthorized user could obtain the token.</span></span> <span data-ttu-id="bc119-236">Рекомендуем использовать маркер проверки подлинности кратковременной проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="bc119-236">We recommend you use a short-lived authentication token.</span></span> <span data-ttu-id="bc119-237">Когда надстройка использует маркер с коротким временем существования, он должен сразу запросить новый маркер проверки подлинности, не сохраненный в документе.</span><span class="sxs-lookup"><span data-stu-id="bc119-237">When the add-in uses the short-lived token, it should immediately request a new authentication token that is not saved in the document.</span></span>

## <a name="see-also"></a><span data-ttu-id="bc119-238">См. также</span><span class="sxs-lookup"><span data-stu-id="bc119-238">See also</span></span>

- [<span data-ttu-id="bc119-239">Добро пожаловать на страницу пакета SDK 2.5 Open XML для Office</span><span class="sxs-lookup"><span data-stu-id="bc119-239">Welcome to the Open XML SDK 2.5 for Office</span></span>](/office/open-xml/open-xml-sdk)
- [<span data-ttu-id="bc119-240">Автоматическое открытие области задач с документом</span><span class="sxs-lookup"><span data-stu-id="bc119-240">Automatically open a task pane with a document</span></span>](../develop/automatically-open-a-task-pane-with-a-document.md)
- [<span data-ttu-id="bc119-241">Persisting add-in state and settings</span><span class="sxs-lookup"><span data-stu-id="bc119-241">Persisting add-in state and settings</span></span>](../develop/persisting-add-in-state-and-settings.md)
- [<span data-ttu-id="bc119-242">Создайте документ электронной таблицы, указав имя файла</span><span class="sxs-lookup"><span data-stu-id="bc119-242">Create a spreadsheet document by providing a file name</span></span>](/office/open-xml/how-to-create-a-spreadsheet-document-by-providing-a-file-name)
