---
ms.date: 07/10/2019
description: Сведения о среде выполнения пользовательских функций Excel.
title: Архитектура пользовательских функций
localization_priority: Normal
ms.openlocfilehash: ced62f7efb826862eee8079a66fa657ea466e4b3
ms.sourcegitcommit: d15bca2c12732f8599be2ec4b2adc7c254552f52
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2020
ms.locfileid: "41950356"
---
# <a name="custom-functions-architecture"></a>Архитектура пользовательских функций

 У пользовательских функций есть своя уникальная среда выполнения, отдающая приоритет выполнению вычислений. В этой статье рассматриваются различия между средой выполнения пользовательских функций и браузерным модулем JavaScript, обеспечивающим работу большинства других частей надстройки.

[!include[Excel custom functions note](../includes/excel-custom-functions-note.md)]

## <a name="custom-functions-runtime"></a>Среда выполнения пользовательских функций

Веб-надстройка Office может взаимодействовать с пользователем как область задач или область контента и может включать команды и пользовательские функции. Все эти части запускаются в среде выполнения модуля браузера, за исключением пользовательских функций. Пользовательские функции запускаются в отдельной среде выполнения пользовательских функций для оптимизации скорости вычислений.

Обратите внимание, что при создании проекта с использованием [Генератора Yeoman для надстроек Office](https://www.npmjs.com/package/generator-office) среда выполнения пользовательских функций загружается с помощью файла сценария custom-functions.js, ссылка на который содержится в файле **functions.html**. Файл **functions.html** служит только для загрузки среды выполнения и не должен использоваться в качестве области задач для надстройки.

В таблице ниже указаны различия между средой выполнения пользовательских функций и средой выполнения модуля браузера:

| Среда выполнения пользовательских функций  | Среда выполнения модуля браузера    |
|------------------------------------------------------------------ |-------------------------------------------------------------------------------------------------------------- |
| Поддерживает возвращение значения из ячейки    | Поддерживает API Office.js и элементы пользовательского интерфейса   |
| Не содержит объект`localStorage`, вместо него используется объект `OfficeRuntime.storage`.     | Содержит объект `localStorage`, может при необходимости использовать объект `OfficeRuntime.storage`.     |
| Не поддерживает взаимодействие с DOM или библиотеками загрузки, зависящими от DOM, например jQuery.    | Поддерживает взаимодействие с DOM и библиотеками загрузки, зависящими от DOM. |

## <a name="browser-engine-runtime"></a>Среда выполнения модуля браузера

Область задач, контентная надстройка и команды выполняются в среде выполнения модуля браузера.

Среда выполнения модуля браузера поддерживает использование API Office.js. Имейте в виду, что любые API для Excel, например API, позволяющие управлять таблицами Excel, запускаются в среде выполнения модуля браузера, но недоступны напрямую из среды выполнения пользовательских функций.

## <a name="communicate-between-runtimes"></a>Взаимодействие между средами выполнения

Код пользовательских функций не может напрямую взаимодействовать с кодом в других частях веб-надстройки, например в области задач, так как они находятся в разных средах выполнения. Но в некоторых случаях может потребоваться обмен данными, например передача маркера.

Объект `OfficeRuntime.storage` можно использовать для хранения данных из пользовательских функций и получения данных из кода области задач. Дополнительные сведения о хранении и совместном использовании данных см. в разделе [Состояние сохранения и совместного использования](custom-functions-save-state.md).

Просмотреть пример кода можно с помощью объекта `storage` в этом [репозитории Github](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Excel-custom-functions/AsyncStorage), содержащем рекомендации для разработчиков.
Другие общие сведения об объекте `storage` см. в статье [Среда выполнения пользовательских функций](./custom-functions-runtime.md).

Объект `storage` также может быть удобен для проверки подлинности. Дополнительные сведения см. в статье [Проверка подлинности пользовательских функций](custom-functions-authentication.md).

## <a name="next-steps"></a>Дальнейшие действия
Узнайте подробнее о том, [как использовать пользовательские функции](custom-functions-runtime.md).

## <a name="see-also"></a>См. также

* [Среда выполнения для пользовательских функций Excel](custom-functions-runtime.md)
* [Получение и обработка данных с помощью пользовательских функций](custom-functions-web-reqs.md)
* [Метаданные пользовательских функций](custom-functions-json.md)
* [Руководство по пользовательским функциям в Excel](../tutorials/excel-tutorial-create-custom-functions.md)
