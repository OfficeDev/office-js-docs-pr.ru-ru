---
ms.date: 03/20/2019
description: Сведения о среде выполнения пользовательских функций Excel.
title: Архитектура пользовательских функций (предварительная версия)
localization_priority: Priority
ms.openlocfilehash: b3f3d6c5eda51639a734c6d0f162c596f0c1e41b
ms.sourcegitcommit: 9e7b4daa8d76c710b9d9dd4ae2e3c45e8fe07127
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/24/2019
ms.locfileid: "32448604"
---
# <a name="custom-functions-architecture"></a>Архитектура пользовательских функций

 У пользовательских функций есть своя уникальная среда выполнения, отдающая приоритет выполнению вычислений. В этой статье рассматриваются различия между средой выполнения пользовательских функций и браузерным модулем JavaScript, обеспечивающим работу большинства других частей надстройки.

## <a name="custom-functions-runtime"></a>Среда выполнения пользовательских функций

Веб-надстройка Office может взаимодействовать с пользователем как область задач или область контента и может включать команды и пользовательские функции. Все эти части запускаются в среде выполнения модуля браузера, за исключением пользовательских функций. Пользовательские функции запускаются в отдельной среде выполнения пользовательских функций для оптимизации скорости вычислений.

Обратите внимание, что если используется [генератор Yeoman для надстроек Office](https://www.npmjs.com/package/generator-office) для создания проекта, среда выполнения пользовательских функций загружается с помощью файла скрипта custom-functions.js, на который указывает ссылка в файле functions.html. Файл functions.html служит только для загрузки среды выполнения и не должен использоваться в качестве области задач для надстройки.

В таблице ниже указаны различия между средой выполнения пользовательских функций и средой выполнения модуля браузера:

| Среда выполнения пользовательских функций  | Среда выполнения модуля браузера    |
|------------------------------------------------------------------ |-------------------------------------------------------------------------------------------------------------- |
| Поддерживает возвращение значения из ячейки    | Поддерживает API Office.js и элементы пользовательского интерфейса   |
| Не содержит объекта `localStorage`, вместо него используется `AsyncStorage`  | Содержит объект `localStorage`, может при необходимости использовать объект `AsyncStorage`   |
| Не поддерживает взаимодействие с DOM или библиотеками загрузки, зависящими от DOM, например jQuery.    | Поддерживает взаимодействие с DOM и библиотеками загрузки, зависящими от DOM. |


## <a name="browser-engine-runtime"></a>Среда выполнения модуля браузера

Область задач, контентная надстройка и команды выполняются в среде выполнения модуля браузера.

Среда выполнения модуля браузера поддерживает использование API Office.js. Имейте в виду, что любые API для Excel, например API, позволяющие управлять таблицами Excel, запускаются в среде выполнения модуля браузера, но недоступны напрямую из среды выполнения пользовательских функций.

## <a name="communicate-between-runtimes"></a>Взаимодействие между средами выполнения

Код пользовательских функций не может напрямую взаимодействовать с кодом в других частях веб-надстройки, например в области задач, так как они находятся в разных средах выполнения. Но в некоторых случаях может потребоваться обмен данными, например передача маркера.

Объект `AsyncStorage` можно использовать для хранения данных из пользовательских функций и получения данных из кода области задач. Дополнительные сведения о хранении и совместном использовании данных см. в разделе [Состояние сохранения и совместного использования](custom-functions-overview.md#saving-and-sharing-state).

Просмотреть пример кода можно с помощью `AsyncStorage` в этом [репозитории Github](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Excel-custom-functions/AsyncStorage), предназначенном для рекомендаций.
Общие сведения о `AsyncStorage` см. в статье [Среда выполнения пользовательских функций](./custom-functions-runtime.md).

Объект `AsyncStorage` также может быть удобен для проверки подлинности. Дополнительные сведения см. в статье [Проверка подлинности пользовательских функций](custom-functions-authentication.md).

## <a name="see-also"></a>См. также

* [Среда выполнения для пользовательских функций Excel](custom-functions-runtime.md)
* [Рекомендации по пользовательским функциям](custom-functions-best-practices.md)
* [Метаданные пользовательских функций](custom-functions-json.md)
* [Журнал изменений пользовательских функций](custom-functions-changelog.md)
* [Руководство по настраиваемым функциям в Excel](../tutorials/excel-tutorial-create-custom-functions.md)
