---
ms.date: 07/10/2019
description: Сведения о среде выполнения пользовательских функций Excel.
title: Архитектура пользовательских функций
localization_priority: Priority
ms.openlocfilehash: abe4f847069b3bb9d3813b4520bf8eb078a40c18
ms.sourcegitcommit: bb44c9694f88cde32ffbb642689130db44456964
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/17/2019
ms.locfileid: "35771465"
---
# <a name="custom-functions-architecture"></a><span data-ttu-id="34220-103">Архитектура пользовательских функций</span><span class="sxs-lookup"><span data-stu-id="34220-103">Custom functions architecture</span></span>

 <span data-ttu-id="34220-104">У пользовательских функций есть своя уникальная среда выполнения, отдающая приоритет выполнению вычислений.</span><span class="sxs-lookup"><span data-stu-id="34220-104">Custom functions are with their own unique runtime that prioritizes execution of calculations.</span></span> <span data-ttu-id="34220-105">В этой статье рассматриваются различия между средой выполнения пользовательских функций и браузерным модулем JavaScript, обеспечивающим работу большинства других частей надстройки.</span><span class="sxs-lookup"><span data-stu-id="34220-105">This article will cover the differences between the custom functions runtime and the browser-based JavaScript engine which powers most other parts of your add-in.</span></span>

[!include[Excel custom functions note](../includes/excel-custom-functions-note.md)]

## <a name="custom-functions-runtime"></a><span data-ttu-id="34220-106">Среда выполнения пользовательских функций</span><span class="sxs-lookup"><span data-stu-id="34220-106">Custom functions runtime</span></span>

<span data-ttu-id="34220-107">Веб-надстройка Office может взаимодействовать с пользователем как область задач или область контента и может включать команды и пользовательские функции.</span><span class="sxs-lookup"><span data-stu-id="34220-107">An Office Web Add-in can interact with the user as a task pane, or a content pane, and can include commands and custom functions.</span></span> <span data-ttu-id="34220-108">Все эти части запускаются в среде выполнения модуля браузера, за исключением пользовательских функций.</span><span class="sxs-lookup"><span data-stu-id="34220-108">All of these parts run in a browser engine runtime except for custom functions.</span></span> <span data-ttu-id="34220-109">Пользовательские функции запускаются в отдельной среде выполнения пользовательских функций для оптимизации скорости вычислений.</span><span class="sxs-lookup"><span data-stu-id="34220-109">Custom functions run in a separate custom functions runtime to optimize for calculation speed.</span></span>

<span data-ttu-id="34220-110">Обратите внимание, что при создании проекта с использованием [Генератора Yeoman для надстроек Office](https://www.npmjs.com/package/generator-office) среда выполнения пользовательских функций загружается с помощью файла сценария custom-functions.js, ссылка на который содержится в файле **functions.html**.</span><span class="sxs-lookup"><span data-stu-id="34220-110">Note that if you're using the [Yeoman generator for Office Add-ins](https://www.npmjs.com/package/generator-office) to generate your project, the custom functions runtime will load through the custom-functions.js script file referenced in the functions.html file.</span></span> <span data-ttu-id="34220-111">Файл **functions.html** служит только для загрузки среды выполнения и не должен использоваться в качестве области задач для надстройки.</span><span class="sxs-lookup"><span data-stu-id="34220-111">The functions.html serves only to load the runtime and shouldn't be used as the task pane for your add-in.</span></span>

<span data-ttu-id="34220-112">В таблице ниже указаны различия между средой выполнения пользовательских функций и средой выполнения модуля браузера:</span><span class="sxs-lookup"><span data-stu-id="34220-112">The following table highlights the differences between the custom functions runtime and the browser engine runtime:</span></span>

| <span data-ttu-id="34220-113">Среда выполнения пользовательских функций</span><span class="sxs-lookup"><span data-stu-id="34220-113">Custom functions runtime</span></span>  | <span data-ttu-id="34220-114">Среда выполнения модуля браузера</span><span class="sxs-lookup"><span data-stu-id="34220-114">Browser engine runtime</span></span>    |
|------------------------------------------------------------------ |-------------------------------------------------------------------------------------------------------------- |
| <span data-ttu-id="34220-115">Поддерживает возвращение значения из ячейки</span><span class="sxs-lookup"><span data-stu-id="34220-115">Supports returning a value from a cell</span></span>    | <span data-ttu-id="34220-116">Поддерживает API Office.js и элементы пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="34220-116">Supports Office.js APIs and UI elements</span></span>   |
| <span data-ttu-id="34220-117">Не содержит объект`localStorage`, вместо него используется объект `OfficeRuntime.storage`.</span><span class="sxs-lookup"><span data-stu-id="34220-117">Does not have `localStorage` object, instead uses `OfficeRuntime.storage`</span></span>     | <span data-ttu-id="34220-118">Содержит объект `localStorage`, может при необходимости использовать объект `OfficeRuntime.storage`.</span><span class="sxs-lookup"><span data-stu-id="34220-118">Has `localStorage` object, can optionally use `OfficeRuntime.storage` object</span></span>     |
| <span data-ttu-id="34220-119">Не поддерживает взаимодействие с DOM или библиотеками загрузки, зависящими от DOM, например jQuery.</span><span class="sxs-lookup"><span data-stu-id="34220-119">Does not support interacting with the DOM, or loading libraries that depend on the DOM such as jQuery.</span></span>    | <span data-ttu-id="34220-120">Поддерживает взаимодействие с DOM и библиотеками загрузки, зависящими от DOM.</span><span class="sxs-lookup"><span data-stu-id="34220-120">Supports interacting with the DOM and loading libraries that depend on the DOM.</span></span> |

## <a name="browser-engine-runtime"></a><span data-ttu-id="34220-121">Среда выполнения модуля браузера</span><span class="sxs-lookup"><span data-stu-id="34220-121">Browser engine runtime</span></span>

<span data-ttu-id="34220-122">Область задач, контентная надстройка и команды выполняются в среде выполнения модуля браузера.</span><span class="sxs-lookup"><span data-stu-id="34220-122">The task pane, content add-in, and commands run in a browser engine runtime.</span></span>

<span data-ttu-id="34220-123">Среда выполнения модуля браузера поддерживает использование API Office.js.</span><span class="sxs-lookup"><span data-stu-id="34220-123">The browser engine runtime supports the Office.js APIs.</span></span> <span data-ttu-id="34220-124">Имейте в виду, что любые API для Excel, например API, позволяющие управлять таблицами Excel, запускаются в среде выполнения модуля браузера, но недоступны напрямую из среды выполнения пользовательских функций.</span><span class="sxs-lookup"><span data-stu-id="34220-124">Keep in mind that any of the Excel APIs, such as APIs which allow you to manipulate Excel tables, run on the browser engine runtime, but aren't directly accessible from the custom functions runtime.</span></span>

## <a name="communicate-between-runtimes"></a><span data-ttu-id="34220-125">Взаимодействие между средами выполнения</span><span class="sxs-lookup"><span data-stu-id="34220-125">Communicate between runtimes</span></span>

<span data-ttu-id="34220-126">Код пользовательских функций не может напрямую взаимодействовать с кодом в других частях веб-надстройки, например в области задач, так как они находятся в разных средах выполнения.</span><span class="sxs-lookup"><span data-stu-id="34220-126">Your custom functions code cannot directly interact with code in other parts of your web add-in, like the task pane because they are in different runtimes.</span></span> <span data-ttu-id="34220-127">Но в некоторых случаях может потребоваться обмен данными, например передача маркера.</span><span class="sxs-lookup"><span data-stu-id="34220-127">But in some scenarios you may need to share data, such as passing a token.</span></span>

<span data-ttu-id="34220-128">Объект `OfficeRuntime.storage` можно использовать для хранения данных из пользовательских функций и получения данных из кода области задач.</span><span class="sxs-lookup"><span data-stu-id="34220-128">`OfficeRuntime.storage` can be used to store data from your custom functions and get data from your task pane code.</span></span> <span data-ttu-id="34220-129">Дополнительные сведения о хранении и совместном использовании данных см. в разделе [Состояние сохранения и совместного использования](custom-functions-save-state.md).</span><span class="sxs-lookup"><span data-stu-id="34220-129">For more information about storing and sharing data, see [Saving and sharing state](custom-functions-save-state.md).</span></span>

<span data-ttu-id="34220-130">Просмотреть пример кода можно с помощью объекта `storage` в этом [репозитории Github](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Excel-custom-functions/AsyncStorage), содержащем рекомендации для разработчиков.</span><span class="sxs-lookup"><span data-stu-id="34220-130">You can see a code sample using `storage` in this [Github repository](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Excel-custom-functions/AsyncStorage) dedicated to patterns and practices.</span></span>
<span data-ttu-id="34220-131">Другие общие сведения об объекте `storage` см. в статье [Среда выполнения пользовательских функций](./custom-functions-runtime.md).</span><span class="sxs-lookup"><span data-stu-id="34220-131">For more general information about `storage`, see [Custom functions runtime](./custom-functions-runtime.md).</span></span>

<span data-ttu-id="34220-132">Объект `storage` также может быть удобен для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="34220-132">`storage` can also be useful for authentication.</span></span> <span data-ttu-id="34220-133">Дополнительные сведения см. в статье [Проверка подлинности пользовательских функций](custom-functions-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="34220-133">For more information, see [Custom functions authentication](custom-functions-authentication.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="34220-134">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="34220-134">Next steps</span></span>
<span data-ttu-id="34220-135">Узнайте подробнее о том, [как использовать пользовательские функции](custom-functions-runtime.md).</span><span class="sxs-lookup"><span data-stu-id="34220-135">Learn more about how to [use the custom functions runtime](custom-functions-runtime.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="34220-136">См. также</span><span class="sxs-lookup"><span data-stu-id="34220-136">See also</span></span>

* [<span data-ttu-id="34220-137">Среда выполнения для пользовательских функций Excel</span><span class="sxs-lookup"><span data-stu-id="34220-137">Runtime for Excel custom functions</span></span>](custom-functions-runtime.md)
* [<span data-ttu-id="34220-138">Получение и обработка данных с помощью пользовательских функций</span><span class="sxs-lookup"><span data-stu-id="34220-138">Receive and handle data with custom functions</span></span>](custom-functions-web-reqs.md)
* [<span data-ttu-id="34220-139">Метаданные пользовательских функций</span><span class="sxs-lookup"><span data-stu-id="34220-139">Custom functions metadata</span></span>](custom-functions-json.md)
* [<span data-ttu-id="34220-140">Руководство по пользовательским функциям в Excel</span><span class="sxs-lookup"><span data-stu-id="34220-140">Excel custom functions tutorial</span></span>](../tutorials/excel-tutorial-create-custom-functions.md)
